<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Week03: Goå¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup</title>
    <link href="/post/go-training-week3-waitgroup.html"/>
    <url>/post/go-training-week3-waitgroup.html</url>
    
    <content type="html"><![CDATA[<p>tags: [Go, å­¦ä¹ ç¬”è®°, Go è¿›é˜¶è®­ç»ƒè¥, å¹¶å‘]<br>categories: [Go è¿›é˜¶è®­ç»ƒè¥, Go å¹¶å‘ç¼–ç¨‹]<br>date: 2020-12-27 22:08:51 +0800</p><hr><blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><p>åœ¨å‰é¢çš„å‡ ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½ç”¨åˆ°äº† WaitGroup æ¥ç­‰å¾…å¤šä¸ª goroutine æ‰§è¡Œç»“æŸï¼Œä»Šå¤©æˆ‘ä»¬æ¥æ·±å…¥å­¦ä¹ ä¸€ä¸‹</p><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p><code>WaitGroup</code> å¯ä»¥è§£å†³ä¸€ä¸ª goroutine ç­‰å¾…å¤šä¸ª goroutine åŒæ—¶ç»“æŸçš„åœºæ™¯ï¼Œè¿™ä¸ªæ¯”è¾ƒå¸¸è§çš„åœºæ™¯å°±æ˜¯ä¾‹å¦‚ åç«¯ worker å¯åŠ¨äº†å¤šä¸ªæ¶ˆè´¹è€…å¹²æ´»ï¼Œè¿˜æœ‰çˆ¬è™«å¹¶å‘çˆ¬å–æ•°æ®ï¼Œå¤šçº¿ç¨‹ä¸‹è½½ç­‰ç­‰ã€‚<br>æˆ‘ä»¬è¿™é‡Œæ¨¡æ‹Ÿä¸€ä¸ª worker çš„ä¾‹å­</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"sync"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>)</span></span> &#123;fmt.Println(<span class="hljs-string">"worker: "</span>, i)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> wg sync.WaitGroup<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;wg.Add(<span class="hljs-number">1</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">defer</span> wg.Done()worker(i)&#125;(i)&#125;wg.Wait()&#125;</code></pre><div style="background:#e8f7ff;padding:10px;border:1px solid #abd2da;border-radius:5px;margin-bottom:5px">é—®é¢˜: åè¿‡æ¥æ”¯æŒå¤šä¸ª goroutine ç­‰å¾…ä¸€ä¸ª goroutine å®Œæˆåå†å¹²æ´»å—ï¼Ÿ<br>çœ‹æˆ‘ä»¬æ¥ä¸‹æ¥çš„æºç åˆ†æä½ å°±çŸ¥é“äº†</div><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><pre><code class="hljs go"><span class="hljs-keyword">type</span> WaitGroup <span class="hljs-keyword">struct</span> &#123;noCopy noCopy<span class="hljs-comment">// 64-bit value: high 32 bits are counter, low 32 bits are waiter count.</span><span class="hljs-comment">// 64-bit atomic operations require 64-bit alignment, but 32-bit</span><span class="hljs-comment">// compilers do not ensure it. So we allocate 12 bytes and then use</span><span class="hljs-comment">// the aligned 8 bytes in them as state, and the other 4 as storage</span><span class="hljs-comment">// for the sema.</span>state1 [<span class="hljs-number">3</span>]<span class="hljs-keyword">uint32</span>&#125;</code></pre><p><code>WaitGroup</code> ç»“æ„ååˆ†ç®€å•ï¼Œç”± <code>nocopy</code> å’Œ <code>state1</code> ä¸¤ä¸ªå­—æ®µç»„æˆï¼Œå…¶ä¸­ <code>nocopy</code> æ˜¯ç”¨æ¥é˜²æ­¢å¤åˆ¶çš„</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> noCopy <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Lock is a no-op used by -copylocks checker from `go vet`.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*noCopy)</span> <span class="hljs-title">Lock</span><span class="hljs-params">()</span></span>   &#123;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(*noCopy)</span> <span class="hljs-title">Unlock</span><span class="hljs-params">()</span></span> &#123;&#125;</code></pre><p>ç”±äºåµŒå…¥äº† <code>nocopy</code> æ‰€ä»¥åœ¨æ‰§è¡Œ <code>go vet</code> æ—¶å¦‚æœæ£€æŸ¥åˆ° <code>WaitGroup</code> è¢«å¤åˆ¶äº†å°±ä¼šæŠ¥é”™ã€‚è¿™æ ·å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šä¿è¯ <code>WaitGroup</code> ä¸è¢«å¤åˆ¶ï¼Œå¯¹äº†ç›´æ¥ go run æ˜¯ä¸ä¼šæœ‰é”™è¯¯çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»£ç  push ä¹‹å‰éƒ½ä¼šå¼ºåˆ¶è¦æ±‚è¿›è¡Œ lint æ£€æŸ¥ï¼Œåœ¨ ci/cd é˜¶æ®µä¹Ÿéœ€è¦å…ˆè¿›è¡Œ lint æ£€æŸ¥ï¼Œé¿å…å‡ºç°è¿™ç§ç±»ä¼¼çš„é”™è¯¯ã€‚</p><pre><code class="hljs go">~/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">06</span>_waitgroup/<span class="hljs-number">02</span> main*â¯ <span class="hljs-keyword">go</span> run ./main.<span class="hljs-keyword">go</span>~/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">06</span>_waitgroup/<span class="hljs-number">02</span> main*â¯ <span class="hljs-keyword">go</span> vet .# github.com/mohuishou/<span class="hljs-keyword">go</span>-training/Week03/blog/<span class="hljs-number">06</span>_waitgroup/<span class="hljs-number">02</span>./main.<span class="hljs-keyword">go</span>:<span class="hljs-number">7</span>:<span class="hljs-number">9</span>: assignment copies lock value to wg2: sync.WaitGroup contains sync.noCopy</code></pre><p><code>state1</code> çš„è®¾è®¡éå¸¸å·§å¦™ï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜¯åäºŒå­—èŠ‚çš„æ•°æ®ï¼Œè¿™é‡Œé¢ä¸»è¦åŒ…å«ä¸¤å¤§å—ï¼Œcounter å ç”¨äº† 8 å­—èŠ‚ç”¨äºè®¡æ•°ï¼Œsema å ç”¨ 4 å­—èŠ‚ç”¨åšä¿¡å·é‡</p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆæå‘¢ï¼Ÿç›´æ¥ç”¨ä¸¤ä¸ªå­—æ®µä¸€ä¸ªè¡¨ç¤º counterï¼Œä¸€ä¸ªè¡¨ç¤º sema ä¸è¡Œä¹ˆï¼Ÿ<br>ä¸è¡Œï¼Œæˆ‘ä»¬çœ‹çœ‹æ³¨é‡Šé‡Œé¢æ€ä¹ˆå†™çš„ã€‚</p><blockquote><p><em>// 64-bit value: high 32 bits are counter, low 32 bits are waiter count.</em> &gt; <em>// 64-bit atomic operations require 64-bit alignment, but 32-bit</em> &gt; <em>// compilers do not ensure it. So we allocate 12 bytes and then use</em> &gt; <em>// the aligned 8 bytes in them as state, and the other 4 as storage</em> &gt; <em>// for the sema.</em></p></blockquote><p>è¿™æ®µè¯çš„å…³é”®ç‚¹åœ¨äºï¼Œåœ¨åš 64 ä½çš„åŸå­æ“ä½œçš„æ—¶å€™å¿…é¡»è¦ä¿è¯ 64 ä½ï¼ˆ8 å­—èŠ‚ï¼‰å¯¹é½ï¼Œå¦‚æœæ²¡æœ‰å¯¹é½çš„å°±ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ 32 ä½çš„ç¼–è¯‘å™¨å¹¶ä¸èƒ½ä¿è¯ 64 ä½å¯¹é½æ‰€ä»¥è¿™é‡Œç”¨ä¸€ä¸ª 12 å­—èŠ‚çš„ state1 å­—æ®µæ¥å­˜å‚¨è¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œç„¶åæ ¹æ®æ˜¯å¦ 8 å­—èŠ‚å¯¹é½é€‰æ‹©ä¸åŒçš„ä¿å­˜æ–¹å¼ã€‚<br><img src="https://lailin.xyz/images/1609085423413-88a8f508-0269-4cf9-9474-9f78b78a53ea.svg" srcset="/img/loading.gif" alt="02_Goè¿›é˜¶03_blog_waitgroup.drawio.svg"><br>è¿™ä¸ªæ“ä½œå·§å¦™åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><ul><li>å¦‚æœæ˜¯ 64 ä½çš„æœºå™¨é‚£è‚¯å®šæ˜¯ 8 å­—èŠ‚å¯¹é½äº†çš„ï¼Œæ‰€ä»¥æ˜¯ä¸Šé¢ç¬¬ä¸€ç§æ–¹å¼</li><li>å¦‚æœåœ¨ 32 ä½çš„æœºå™¨ä¸Š<ul><li>å¦‚æœæ°å¥½ 8 å­—èŠ‚å¯¹é½äº†ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ç¬¬ä¸€ç§æ–¹å¼å–å‰é¢çš„ 8 å­—èŠ‚æ•°æ®</li><li>å¦‚æœæ˜¯æ²¡æœ‰å¯¹é½ï¼Œä½†æ˜¯ 32 ä½ 4 å­—èŠ‚æ˜¯å¯¹é½äº†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åç§»å››ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°± 8 å­—èŠ‚å¯¹é½äº†ï¼Œæ‰€ä»¥æ˜¯ç¬¬äºŒç§æ–¹å¼</li></ul></li></ul><p>æ‰€ä»¥é€šè¿‡ sema ä¿¡å·é‡è¿™å››ä¸ªå­—èŠ‚çš„ä½ç½®ä¸åŒï¼Œä¿è¯äº† counter è¿™ä¸ªå­—æ®µæ— è®ºåœ¨ 32 ä½è¿˜æ˜¯ 64 ä¸ºæœºå™¨ä¸Šéƒ½æ˜¯ 8 å­—èŠ‚å¯¹é½çš„ï¼Œåç»­åš 64 ä½åŸå­æ“ä½œçš„æ—¶å€™å°±æ²¡é—®é¢˜äº†ã€‚<br>è¿™ä¸ªå®ç°æ˜¯åœ¨ <code>state</code> æ–¹æ³•å®ç°çš„</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(wg *WaitGroup)</span> <span class="hljs-title">state</span><span class="hljs-params">()</span> <span class="hljs-params">(statep *<span class="hljs-keyword">uint64</span>, semap *<span class="hljs-keyword">uint32</span>)</span></span> &#123;<span class="hljs-keyword">if</span> <span class="hljs-keyword">uintptr</span>(unsafe.Pointer(&amp;wg.state1))%<span class="hljs-number">8</span> == <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> (*<span class="hljs-keyword">uint64</span>)(unsafe.Pointer(&amp;wg.state1)), &amp;wg.state1[<span class="hljs-number">2</span>]&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> (*<span class="hljs-keyword">uint64</span>)(unsafe.Pointer(&amp;wg.state1[<span class="hljs-number">1</span>])), &amp;wg.state1[<span class="hljs-number">0</span>]&#125;&#125;</code></pre><p><code>state</code> æ–¹æ³•è¿”å› counter å’Œä¿¡å·é‡ï¼Œé€šè¿‡ <code>uintptr(unsafe.Pointer(&amp;wg.state1))%8 == 0</code> æ¥åˆ¤æ–­æ˜¯å¦ 8 å­—èŠ‚å¯¹é½</p><h3 id="Add"><a href="#Add" class="headerlink" title="Add"></a>Add</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(wg *WaitGroup)</span> <span class="hljs-title">Add</span><span class="hljs-params">(delta <span class="hljs-keyword">int</span>)</span></span> &#123;    <span class="hljs-comment">// å…ˆä» state å½“ä¸­æŠŠæ•°æ®å’Œä¿¡å·é‡å–å‡ºæ¥</span>statep, semap := wg.state()    <span class="hljs-comment">// åœ¨ waiter ä¸ŠåŠ ä¸Š delta å€¼</span>state := atomic.AddUint64(statep, <span class="hljs-keyword">uint64</span>(delta)&lt;&lt;<span class="hljs-number">32</span>)    <span class="hljs-comment">// å–å‡ºå½“å‰çš„ counter</span>v := <span class="hljs-keyword">int32</span>(state &gt;&gt; <span class="hljs-number">32</span>)    <span class="hljs-comment">// å–å‡ºå½“å‰çš„ waiterï¼Œæ­£åœ¨ç­‰å¾… goroutine æ•°é‡</span>w := <span class="hljs-keyword">uint32</span>(state)    <span class="hljs-comment">// counter ä¸èƒ½ä¸ºè´Ÿæ•°</span><span class="hljs-keyword">if</span> v &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"sync: negative WaitGroup counter"</span>)&#125;    <span class="hljs-comment">// è¿™é‡Œå±äºé˜²å¾¡æ€§ç¼–ç¨‹</span>    <span class="hljs-comment">// w != 0 è¯´æ˜ç°åœ¨å·²ç»æœ‰ goroutine åœ¨ç­‰å¾…ä¸­ï¼Œè¯´æ˜å·²ç»è°ƒç”¨äº† Wait() æ–¹æ³•</span>    <span class="hljs-comment">// è¿™æ—¶å€™ delta &gt; 0 &amp;&amp; v == int32(delta) è¯´æ˜åœ¨è°ƒç”¨äº† Wait() æ–¹æ³•ä¹‹ååˆæƒ³åŠ å…¥æ–°çš„ç­‰å¾…è€…</span>    <span class="hljs-comment">// è¿™ç§æ“ä½œæ˜¯ä¸å…è®¸çš„</span><span class="hljs-keyword">if</span> w != <span class="hljs-number">0</span> &amp;&amp; delta &gt; <span class="hljs-number">0</span> &amp;&amp; v == <span class="hljs-keyword">int32</span>(delta) &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"sync: WaitGroup misuse: Add called concurrently with Wait"</span>)&#125;    <span class="hljs-comment">// å¦‚æœå½“å‰æ²¡æœ‰äººåœ¨ç­‰å¾…å°±ç›´æ¥è¿”å›ï¼Œå¹¶ä¸” counter &gt; 0</span><span class="hljs-keyword">if</span> v &gt; <span class="hljs-number">0</span> || w == <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span>&#125;    <span class="hljs-comment">// è¿™é‡Œä¹Ÿæ˜¯é˜²å¾¡ ä¸»è¦é¿å…å¹¶å‘è°ƒç”¨ add å’Œ wait</span><span class="hljs-keyword">if</span> *statep != state &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"sync: WaitGroup misuse: Add called concurrently with Wait"</span>)&#125;<span class="hljs-comment">// å”¤é†’æ‰€æœ‰ waiterï¼Œçœ‹åˆ°è¿™é‡Œå°±å›ç­”äº†ä¸Šé¢çš„é—®é¢˜äº†</span>*statep = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> ; w != <span class="hljs-number">0</span>; w-- &#123;runtime_Semrelease(semap, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>)&#125;&#125;</code></pre><h3 id="Wait"><a href="#Wait" class="headerlink" title="Wait"></a>Wait</h3><p>wait ä¸»è¦å°±æ˜¯ç­‰å¾…å…¶ä»–çš„ goroutine å®Œäº‹ä¹‹åå”¤é†’</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(wg *WaitGroup)</span> <span class="hljs-title">Wait</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// å…ˆä» state å½“ä¸­æŠŠæ•°æ®å’Œä¿¡å·é‡çš„åœ°å€å–å‡ºæ¥</span>    statep, semap := wg.state()<span class="hljs-keyword">for</span> &#123;     <span class="hljs-comment">// è¿™é‡Œå»é™¤ counter å’Œ waiter çš„æ•°æ®</span>state := atomic.LoadUint64(statep)v := <span class="hljs-keyword">int32</span>(state &gt;&gt; <span class="hljs-number">32</span>)w := <span class="hljs-keyword">uint32</span>(state)        <span class="hljs-comment">// counter = 0 è¯´æ˜æ²¡æœ‰åœ¨ç­‰çš„ï¼Œç›´æ¥è¿”å›å°±è¡Œ</span>        <span class="hljs-keyword">if</span> v == <span class="hljs-number">0</span> &#123;<span class="hljs-comment">// Counter is 0, no need to wait.</span><span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// waiter + 1ï¼Œè°ƒç”¨ä¸€æ¬¡å°±å¤šä¸€ä¸ªç­‰å¾…è€…ï¼Œç„¶åä¼‘çœ å½“å‰ goroutine ç­‰å¾…è¢«å”¤é†’</span><span class="hljs-keyword">if</span> atomic.CompareAndSwapUint64(statep, state, state+<span class="hljs-number">1</span>) &#123;runtime_Semacquire(semap)<span class="hljs-keyword">if</span> *statep != <span class="hljs-number">0</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"sync: WaitGroup is reused before previous Wait has returned"</span>)&#125;<span class="hljs-keyword">return</span>&#125;&#125;&#125;</code></pre><h3 id="Done"><a href="#Done" class="headerlink" title="Done"></a>Done</h3><p>è¿™ä¸ªåªæ˜¯ add çš„ç®€å•å°è£…</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(wg *WaitGroup)</span> <span class="hljs-title">Done</span><span class="hljs-params">()</span></span> &#123;wg.Add(<span class="hljs-number">-1</span>)&#125;</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><code>WaitGroup</code> å¯ä»¥ç”¨äºä¸€ä¸ª goroutine ç­‰å¾…å¤šä¸ª goroutine å¹²æ´»å®Œæˆï¼Œä¹Ÿå¯ä»¥å¤šä¸ª goroutine ç­‰å¾…ä¸€ä¸ª goroutine å¹²æ´»å®Œæˆï¼Œæ˜¯ä¸€ä¸ªå¤šå¯¹å¤šçš„å…³ç³»<ul><li>å¤šä¸ªç­‰å¾…ä¸€ä¸ªçš„å…¸å‹æ¡ˆä¾‹æ˜¯ <a href="https://pkg.go.dev/golang.org/x/sync/singleflight" target="_blank" rel="noopener">singleflight</a>ï¼Œè¿™ä¸ªåœ¨åé¢å°†å¾®æœåŠ¡å¯ç”¨æ€§çš„æ—¶å€™è¿˜ä¼šå†è®²åˆ°ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹æºç </li></ul></li><li><code>Add(n&gt;0)</code> æ–¹æ³•åº”è¯¥åœ¨å¯åŠ¨ goroutine ä¹‹å‰è°ƒç”¨ï¼Œç„¶ååœ¨ goroution å†…éƒ¨è°ƒç”¨ <code>Done</code> æ–¹æ³•</li><li><code>WaitGroup</code> å¿…é¡»åœ¨ <code>Wait</code> æ–¹æ³•è¿”å›ä¹‹åæ‰èƒ½å†æ¬¡ä½¿ç”¨</li><li><code>Done</code> åªæ˜¯ <code>Add</code> çš„ç®€å•å°è£…ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯å¯ä»¥é€šè¿‡ä¸€æ¬¡åŠ ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼å‡å°‘è°ƒç”¨ï¼Œæˆ–è€…è¾¾åˆ°å¿«é€Ÿå”¤é†’çš„ç›®çš„ã€‚</li></ul><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li><a href="https://pkg.go.dev/sync" target="_blank" rel="noopener">https://pkg.go.dev/sync</a> å®˜ç½‘æ–‡æ¡£ï¼Œå¿…è¯»</li><li><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-sync-primitives/" target="_blank" rel="noopener">Go è¯­è¨€è®¾è®¡ä¸å®ç°-6.2 åŒæ­¥åŸè¯­ä¸é”</a> è¿™æœ¬ä¹¦å€¼å¾—ä¸€çœ‹</li><li><a href="https://gobyexample.com/waitgroups" target="_blank" rel="noopener">Go by Example: WaitGroups</a></li><li><a href="https://golang.org/issues/8005#issuecomment-190753527" target="_blank" rel="noopener">https://golang.org/issues/8005#issuecomment-190753527</a></li><li><a href="https://juejin.cn/post/6893019249263001613" target="_blank" rel="noopener">Golang æºç ç³»åˆ— sync.waitgroup æºç å‰–æ</a></li></ol><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Week03: Goå¹¶å‘ç¼–ç¨‹(äº”) æ·±å…¥ç†è§£ sync/atomic</title>
    <link href="/post/go-training-week3-atomic.html"/>
    <url>/post/go-training-week3-atomic.html</url>
    
    <content type="html"><![CDATA[<p>tags: [Go, å­¦ä¹ ç¬”è®°, Go è¿›é˜¶è®­ç»ƒè¥, å¹¶å‘]<br>categories: [Go è¿›é˜¶è®­ç»ƒè¥, Go å¹¶å‘ç¼–ç¨‹]<br>date: 2020-12-27 14:08:51 +0800</p><hr><blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Š<a href="https://lailin.xyz/post/go-training-week3-sync.html">Week03: Go å¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</a>ã€‹å½“ä¸­æˆ‘ä»¬ä¸»è¦è®²åˆ°äº†äº’æ–¥é”ä»¥åŠè¯»å†™é”çš„ä½¿ç”¨ä»¥åŠæºç è§£æã€‚åœ¨çœ‹æºç çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥å‘ç°é‡Œé¢ä½¿ç”¨äº†å¾ˆå¤š atomic åŒ…çš„æ–¹æ³•æ¥ä¿è¯åŸå­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¶çƒ­æ‰“é“æ¥ä¸‹æ¥å°±éšç€æœ¬æ–‡æ¥çœ‹ä¸€çœ‹ atomic åº”è¯¥æ€ä¹ˆç”¨ï¼Œä»¥åŠå®ƒåˆæ˜¯å¦‚ä½•å®ç°çš„</p><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬åœ¨è®²è¯»å†™é”çš„æ—¶å€™è®²åˆ°äº†ä¸€ä¸ªé…ç½®è¯»å–çš„ä¾‹å­ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ atomic å®ç°çœ‹ä¸€ä¸‹</p><pre><code class="hljs go"><span class="hljs-comment">// Config atomic å®ç°</span><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;v atomic.Value <span class="hljs-comment">// å‡è®¾ data å°±æ˜¯æ•´ä¸ª config äº†</span>&#125;<span class="hljs-comment">// Get get config data</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Config)</span> <span class="hljs-title">Get</span><span class="hljs-params">()</span> []<span class="hljs-title">int</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œå·ä¸ªæ‡’ï¼Œä¸è¦å­¦</span><span class="hljs-keyword">return</span> (*c.v.Load().(*[]<span class="hljs-keyword">int</span>))&#125;<span class="hljs-comment">// Set set config data</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Config)</span> <span class="hljs-title">Set</span><span class="hljs-params">(n []<span class="hljs-keyword">int</span>)</span></span> &#123;c.v.Store(&amp;n)&#125;</code></pre><p>è·‘ä¸€ä¸ªä¸€æ ·çš„æµ‹è¯•ï¼Œå¯ä»¥å‘ç° atomic çš„æ€§èƒ½åˆå¥½ä¸Šäº†è®¸å¤š</p><pre><code class="hljs go">â¯ <span class="hljs-keyword">go</span> test -race -bench=.goos: linuxgoarch: amd64pkg: github.com/mohuishou/<span class="hljs-keyword">go</span>-training/Week03/blog/<span class="hljs-number">05</span>_atomicBenchmarkMutexConfig<span class="hljs-number">-4</span>           <span class="hljs-number">1021684</span>              <span class="hljs-number">1121</span> ns/opBenchmarkRWMutexConfig<span class="hljs-number">-4</span>         <span class="hljs-number">2604524</span>               <span class="hljs-number">433</span> ns/opBenchmarkConfig<span class="hljs-number">-4</span>                <span class="hljs-number">6941658</span>               <span class="hljs-number">170</span> ns/opPASS</code></pre><p><code>atomic.Value</code> è¿™ç§é€‚åˆé…ç½®æ–‡ä»¶è¿™ç§è¯»ç‰¹åˆ«å¤šï¼Œå†™ç‰¹åˆ«å°‘çš„åœºæ™¯ï¼Œå› ä¸ºä»–æ˜¯ COWï¼ˆCopy On Writeï¼‰å†™æ—¶å¤åˆ¶çš„ä¸€ç§æ€æƒ³ï¼ŒCOW å°±æ˜¯æŒ‡æˆ‘éœ€è¦å†™å…¥çš„æ—¶å€™æˆ‘å…ˆæŠŠè€çš„æ•°æ®å¤åˆ¶ä¸€ä»½åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åå†å†™å…¥æ–°çš„å€¼ã€‚<br>æˆ‘ä»¬çœ‹çœ‹ç»´åŸºç™¾ç§‘çš„æè¿°ï¼Œæˆ‘è§‰å¾—å·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†</p><blockquote><p>å†™å…¥æ—¶å¤åˆ¶ï¼ˆè‹±è¯­ï¼šCopy-on-writeï¼Œç®€ç§° COWï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¼˜åŒ–ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…ï¼ˆcallersï¼‰åŒæ—¶è¯·æ±‚ç›¸åŒèµ„æºï¼ˆå¦‚å†…å­˜æˆ–ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…±åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è¯•å›¾ä¿®æ”¹èµ„æºçš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨å‰¯æœ¬ï¼ˆprivate copyï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„æœ€åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™è¿‡ç¨‹å¯¹å…¶ä»–çš„è°ƒç”¨è€…éƒ½æ˜¯é€æ˜çš„ã€‚æ­¤ä½œæ³•ä¸»è¦çš„ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹è¯¥èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ï¼ˆprivate copyï¼‰è¢«åˆ›å»ºï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚</p></blockquote><p>è¿™ç§æ€è·¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¯èƒ½æœ‰éƒ¨åˆ† goroutine åœ¨ä½¿ç”¨è€çš„å¯¹è±¡ï¼Œæ‰€ä»¥è€çš„å¯¹è±¡ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œå¦‚æœå­˜åœ¨å¤§é‡å†™å…¥çš„è¯ï¼Œä¼šå¯¼è‡´äº§ç”Ÿå¤§é‡çš„å‰¯æœ¬ï¼Œæ€§èƒ½åè€Œä¸ä¸€å®šå¥½ ã€‚<br>è¿™ç§æ–¹å¼çš„å¥½å¤„å°±æ˜¯ä¸ç”¨åŠ é”ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæœ‰ goroutine çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¹¶ä¸”åœ¨è¯»å–çš„æ—¶å€™å¤§å®¶éƒ½è¯»å–çš„ç›¸åŒçš„å‰¯æœ¬æ‰€ä»¥æ€§èƒ½ä¸Šå›å¥½ä¸€äº›ã€‚<br>COW ç­–ç•¥åœ¨ linuxï¼Œ redis å½“ä¸­éƒ½ç”¨çš„å¾ˆå¤šï¼Œå…·ä½“å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘åé¢çš„å‚è€ƒæ–‡çŒ®ï¼Œæœ¬æ–‡å°±ä¸å±•å¼€è®²äº†ã€‚</p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="æ–¹æ³•ä¸€è§ˆ"><a href="#æ–¹æ³•ä¸€è§ˆ" class="headerlink" title="æ–¹æ³•ä¸€è§ˆ"></a>æ–¹æ³•ä¸€è§ˆ</h3><p>å¦‚æœå»çœ‹æ–‡æ¡£ä¼šå‘ç° atomic çš„å‡½æ•°ç­¾åæœ‰å¾ˆå¤šï¼Œä½†æ˜¯å¤§éƒ¨åˆ†éƒ½æ˜¯é‡å¤çš„ä¸ºäº†ä¸åŒçš„æ•°æ®ç±»å‹åˆ›å»ºäº†ä¸åŒçš„ç­¾åï¼Œè¿™å°±æ˜¯æ²¡æœ‰æ³›å‹çš„åå¤„äº†ï¼ŒåŸºç¡€åº“ä¼šæ¯”è¾ƒéº»çƒ¦</p><p>1ã€ç¬¬ä¸€ç±» <code>AddXXX</code> å½“éœ€è¦æ·»åŠ çš„å€¼ä¸ºè´Ÿæ•°çš„æ—¶å€™ï¼Œåšå‡æ³•ï¼Œæ­£æ•°åšåŠ æ³•</p><pre><code class="hljs go"><span class="hljs-comment">// ç¬¬ä¸€ç±»ï¼ŒAddXXXï¼Œdelta ä¸º</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>, delta <span class="hljs-keyword">int32</span>)</span> <span class="hljs-params">(<span class="hljs-built_in">new</span> <span class="hljs-keyword">int32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddInt64</span><span class="hljs-params">(addr *<span class="hljs-keyword">int64</span>, delta <span class="hljs-keyword">int64</span>)</span> <span class="hljs-params">(<span class="hljs-built_in">new</span> <span class="hljs-keyword">int64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddUint32</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint32</span>, delta <span class="hljs-keyword">uint32</span>)</span> <span class="hljs-params">(<span class="hljs-built_in">new</span> <span class="hljs-keyword">uint32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddUint64</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint64</span>, delta <span class="hljs-keyword">uint64</span>)</span> <span class="hljs-params">(<span class="hljs-built_in">new</span> <span class="hljs-keyword">uint64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddUintptr</span><span class="hljs-params">(addr *<span class="hljs-keyword">uintptr</span>, delta <span class="hljs-keyword">uintptr</span>)</span> <span class="hljs-params">(<span class="hljs-built_in">new</span> <span class="hljs-keyword">uintptr</span>)</span></span></code></pre><p>2ã€ç¬¬äºŒç±» <code>CompareAndSwapXXX</code> CAS æ“ä½œï¼Œ ä¼šå…ˆæ¯”è¾ƒä¼ å…¥çš„åœ°å€çš„å€¼æ˜¯å¦æ˜¯ oldï¼Œå¦‚æœæ˜¯çš„è¯å°±å°è¯•èµ‹æ–°å€¼ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±ç›´æ¥è¿”å› falseï¼Œè¿”å› true æ—¶è¡¨ç¤ºèµ‹å€¼æˆåŠŸã€‚</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CompareAndSwapInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>, old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">int32</span>)</span> <span class="hljs-params">(swapped <span class="hljs-keyword">bool</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CompareAndSwapInt64</span><span class="hljs-params">(addr *<span class="hljs-keyword">int64</span>, old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">int64</span>)</span> <span class="hljs-params">(swapped <span class="hljs-keyword">bool</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CompareAndSwapPointer</span><span class="hljs-params">(addr *unsafe.Pointer, old, <span class="hljs-built_in">new</span> unsafe.Pointer)</span> <span class="hljs-params">(swapped <span class="hljs-keyword">bool</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CompareAndSwapUint32</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint32</span>, old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uint32</span>)</span> <span class="hljs-params">(swapped <span class="hljs-keyword">bool</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CompareAndSwapUint64</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint64</span>, old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uint64</span>)</span> <span class="hljs-params">(swapped <span class="hljs-keyword">bool</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CompareAndSwapUintptr</span><span class="hljs-params">(addr *<span class="hljs-keyword">uintptr</span>, old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uintptr</span>)</span> <span class="hljs-params">(swapped <span class="hljs-keyword">bool</span>)</span></span></code></pre><p>3ã€ç¬¬ä¸‰ç±» <code>LoadXXX</code> ï¼Œä»æŸä¸ªåœ°å€ä¸­å–å€¼</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>)</span> <span class="hljs-params">(val <span class="hljs-keyword">int32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadInt64</span><span class="hljs-params">(addr *<span class="hljs-keyword">int64</span>)</span> <span class="hljs-params">(val <span class="hljs-keyword">int64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadPointer</span><span class="hljs-params">(addr *unsafe.Pointer)</span> <span class="hljs-params">(val unsafe.Pointer)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadUint32</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint32</span>)</span> <span class="hljs-params">(val <span class="hljs-keyword">uint32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadUint64</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint64</span>)</span> <span class="hljs-params">(val <span class="hljs-keyword">uint64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadUintptr</span><span class="hljs-params">(addr *<span class="hljs-keyword">uintptr</span>)</span> <span class="hljs-params">(val <span class="hljs-keyword">uintptr</span>)</span></span></code></pre><p>4ã€ç¬¬å››ç±» <code>StoreXXX</code> ï¼Œç»™æŸä¸ªåœ°å€èµ‹å€¼</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StoreInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>, val <span class="hljs-keyword">int32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StoreInt64</span><span class="hljs-params">(addr *<span class="hljs-keyword">int64</span>, val <span class="hljs-keyword">int64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StorePointer</span><span class="hljs-params">(addr *unsafe.Pointer, val unsafe.Pointer)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StoreUint32</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint32</span>, val <span class="hljs-keyword">uint32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StoreUint64</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint64</span>, val <span class="hljs-keyword">uint64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StoreUintptr</span><span class="hljs-params">(addr *<span class="hljs-keyword">uintptr</span>, val <span class="hljs-keyword">uintptr</span>)</span></span></code></pre><p>5ã€ç¬¬äº”ç±» <code>SwapXXX</code> ï¼Œäº¤æ¢ä¸¤ä¸ªå€¼ï¼Œå¹¶ä¸”è¿”å›è€çš„å€¼</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SwapInt32</span><span class="hljs-params">(addr *<span class="hljs-keyword">int32</span>, <span class="hljs-built_in">new</span> <span class="hljs-keyword">int32</span>)</span> <span class="hljs-params">(old <span class="hljs-keyword">int32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SwapInt64</span><span class="hljs-params">(addr *<span class="hljs-keyword">int64</span>, <span class="hljs-built_in">new</span> <span class="hljs-keyword">int64</span>)</span> <span class="hljs-params">(old <span class="hljs-keyword">int64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SwapPointer</span><span class="hljs-params">(addr *unsafe.Pointer, <span class="hljs-built_in">new</span> unsafe.Pointer)</span> <span class="hljs-params">(old unsafe.Pointer)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SwapUint32</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint32</span>, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uint32</span>)</span> <span class="hljs-params">(old <span class="hljs-keyword">uint32</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SwapUint64</span><span class="hljs-params">(addr *<span class="hljs-keyword">uint64</span>, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uint64</span>)</span> <span class="hljs-params">(old <span class="hljs-keyword">uint64</span>)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SwapUintptr</span><span class="hljs-params">(addr *<span class="hljs-keyword">uintptr</span>, <span class="hljs-built_in">new</span> <span class="hljs-keyword">uintptr</span>)</span> <span class="hljs-params">(old <span class="hljs-keyword">uintptr</span>)</span></span></code></pre><p>6ã€æœ€åä¸€ç±» <code>Value</code> ç”¨äºä»»æ„ç±»å‹çš„å€¼çš„ Storeã€Loadï¼Œæˆ‘ä»¬å¼€å§‹çš„æ¡ˆä¾‹å°±ç”¨åˆ°äº†è¿™ä¸ªï¼Œè¿™æ˜¯ 1.4 ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ï¼Œç­¾åçš„æ–¹æ³•éƒ½åªèƒ½ä½œç”¨äºç‰¹å®šçš„ç±»å‹ï¼Œå¼•å…¥è¿™ä¸ªæ–¹æ³•ä¹‹åå°±å¯ä»¥ç”¨äºä»»æ„ç±»å‹äº†ã€‚</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Value<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v *Value)</span> <span class="hljs-title">Load</span><span class="hljs-params">()</span> <span class="hljs-params">(x <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v *Value)</span> <span class="hljs-title">Store</span><span class="hljs-params">(x <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span></code></pre><h3 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h3><p>åœ¨ <code>sync/atomic</code> åŒ…ä¸­çš„æºç é™¤äº† <code>Value</code> ä¹‹å¤–å…¶ä»–çš„å‡½æ•°éƒ½æ˜¯æ²¡æœ‰ç›´æ¥çš„æºç çš„ï¼Œéœ€è¦å» <code>runtime/internal/atomic</code> ä¸­æ‰¾å¯»ï¼Œè¿™é‡Œä¸º <code>CAS</code> å‡½æ•°ä¸ºä¾‹ï¼Œå…¶ä»–çš„éƒ½æ˜¯å¤§åŒå°å¼‚</p><pre><code class="hljs go"><span class="hljs-comment">// bool Cas(int32 *val, int32 old, int32 new)</span><span class="hljs-comment">// Atomically:</span><span class="hljs-comment">//if(*val == old)&#123;</span><span class="hljs-comment">//*val = new;</span><span class="hljs-comment">//return 1;</span><span class="hljs-comment">//&#125; else</span><span class="hljs-comment">//return 0;</span>TEXT runtimeâˆ•internalâˆ•atomicÂ·Cas(SB),NOSPLIT,$<span class="hljs-number">0</span><span class="hljs-number">-17</span>MOVQptr+<span class="hljs-number">0</span>(FP), BXMOVLold+<span class="hljs-number">8</span>(FP), AXMOVL<span class="hljs-built_in">new</span>+<span class="hljs-number">12</span>(FP), CXLOCKCMPXCHGLCX, <span class="hljs-number">0</span>(BX)SETEQret+<span class="hljs-number">16</span>(FP)RET</code></pre><p>åœ¨æ³¨é‡Šéƒ¨åˆ†å†™çš„éå¸¸æ¸…æ¥šï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦å°±æ˜¯å…ˆæ¯”è¾ƒä¸€ä¸‹å½“å‰ä¼ å…¥çš„åœ°å€çš„å€¼æ˜¯å¦å’Œ old å€¼ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œå°±èµ‹å€¼æ–°å€¼è¿”å› trueï¼Œå¦‚æœä¸ç›¸ç­‰å°±è¿”å› false<br>æˆ‘ä»¬çœ‹è¿™ä¸ªå…·ä½“æ±‡ç¼–ä»£ç å°±å¯ä»¥å‘ç°ï¼Œä½¿ç”¨äº† <code>LOCK</code> æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œã€Š<a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html#%E5%86%85%E5%AD%98%E9%87%8D%E6%8E%92">Week03: Go å¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a>ã€‹æåˆ°è¿‡çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œ <code>CMPXCHG</code> æŒ‡ä»¤å…¶å®å°±æ˜¯ CPU å®ç°çš„ CAS æ“ä½œã€‚</p><div style="background:#fffbe6;padding:10px;border:1px solid #c3c3c3;border-radius:5px;margin-bottom:5px">å…³äº LOCK æŒ‡ä»¤é€šè¿‡æŸ¥é˜… intel çš„æ‰‹å†Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¯¹äºP6ä¹‹å‰çš„å¤„ç†å™¨ï¼ŒLOCK æŒ‡ä»¤ä¼šæ€»æ˜¯é”æ€»çº¿ï¼Œä½†æ˜¯ P6 ä¹‹åå¯èƒ½ä¼šæ‰§è¡Œâ€œç¼“å­˜é”å®šâ€ï¼Œå¦‚æœè¢«é”å®šçš„å†…å­˜åŒºåŸŸè¢«ç¼“å­˜åœ¨äº†å¤„ç†å™¨ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ä¼šé€šè¿‡ç¼“å­˜ä¸€è‡´æ€§æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§</div><h3 id="Value"><a href="#Value" class="headerlink" title="Value"></a>Value</h3><pre><code class="hljs go"><span class="hljs-keyword">type</span> Value <span class="hljs-keyword">struct</span> &#123;v <span class="hljs-keyword">interface</span>&#123;&#125;&#125;</code></pre><p>ç»“æ„éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ª v ç”¨æ¥ä¿å­˜ä¼ å…¥çš„å€¼</p><h4 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h4><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ store æ–¹æ³•ï¼Œstore æ–¹æ³•ä¼šå°†å€¼å­˜å‚¨ä¸º xï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæ¯æ¬¡ä¼ å…¥çš„ x ä¸èƒ½ä¸º nilï¼Œå¹¶ä¸”ä»–ä»¬ç±»å‹å¿…é¡»æ˜¯ç›¸åŒçš„ï¼Œä¸ç„¶ä¼šå¯¼è‡´ panic</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v *Value)</span> <span class="hljs-title">Store</span><span class="hljs-params">(x <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<span class="hljs-keyword">if</span> x == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"sync/atomic: store of nil value into Value"</span>)&#125;    <span class="hljs-comment">// ifaceWords å…¶å®å°±æ˜¯å®šä¹‰äº†ä¸€ä¸‹ interface çš„ç»“æ„ï¼ŒåŒ…å« data å’Œ type ä¸¤éƒ¨åˆ†</span>    <span class="hljs-comment">// è¿™é‡Œ vp æ˜¯åŸæœ‰å€¼</span>    <span class="hljs-comment">// xp æ˜¯ä¼ å…¥çš„å€¼</span>vp := (*ifaceWords)(unsafe.Pointer(v))xp := (*ifaceWords)(unsafe.Pointer(&amp;x))    <span class="hljs-comment">// for å¾ªç¯ä¸æ–­å°è¯•</span><span class="hljs-keyword">for</span> &#123;        <span class="hljs-comment">// è¿™é‡Œå…ˆç”¨åŸå­æ–¹æ³•å–ä¸€ä¸‹è€çš„ç±»å‹å€¼</span>typ := LoadPointer(&amp;vp.typ)<span class="hljs-keyword">if</span> typ == <span class="hljs-literal">nil</span> &#123;            <span class="hljs-comment">// ç­‰äº nil å°±è¯´æ˜è¿™æ˜¯ç¬¬ä¸€æ¬¡ store</span>            <span class="hljs-comment">// è°ƒç”¨ runtime çš„æ–¹æ³•ç¦æ­¢æŠ¢å ï¼Œé¿å…æ“ä½œå®Œæˆä¸€åŠå°±è¢«æŠ¢å äº†</span>            <span class="hljs-comment">// åŒæ—¶å¯ä»¥é¿å… GC çš„æ—¶å€™çœ‹åˆ° unsafe.Pointer(^uintptr(0)) è¿™ä¸ªä¸­é—´çŠ¶æ€çš„å€¼</span>runtime_procPin()<span class="hljs-keyword">if</span> !CompareAndSwapPointer(&amp;vp.typ, <span class="hljs-literal">nil</span>, unsafe.Pointer(^<span class="hljs-keyword">uintptr</span>(<span class="hljs-number">0</span>))) &#123;runtime_procUnpin()<span class="hljs-keyword">continue</span>&#125;<span class="hljs-comment">// åˆ†åˆ«æŠŠå€¼å’Œç±»å‹ä¿å­˜ä¸‹æ¥</span>StorePointer(&amp;vp.data, xp.data)StorePointer(&amp;vp.typ, xp.typ)runtime_procUnpin()<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">if</span> <span class="hljs-keyword">uintptr</span>(typ) == ^<span class="hljs-keyword">uintptr</span>(<span class="hljs-number">0</span>) &#123;            <span class="hljs-comment">// å¦‚æœåˆ¤æ–­å‘ç°è¿™ä¸ªç±»å‹æ˜¯è¿™ä¸ªå›ºå®šå€¼ï¼Œè¯´æ˜å½“å‰ç¬¬ä¸€æ¬¡èµ‹å€¼è¿˜æ²¡æœ‰å®Œæˆï¼Œæ‰€ä»¥è¿›å…¥è‡ªæ—‹ç­‰å¾…</span><span class="hljs-keyword">continue</span>&#125;<span class="hljs-comment">// ç¬¬ä¸€æ¬¡èµ‹å€¼å·²ç»å®Œæˆï¼Œåˆ¤æ–­æ–°çš„èµ‹å€¼çš„ç±»å‹å’Œä¹‹å‰æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±ç›´æ¥ panic</span><span class="hljs-keyword">if</span> typ != xp.typ &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"sync/atomic: store of inconsistently typed value into Value"</span>)&#125;        <span class="hljs-comment">// ä¿å­˜å€¼</span>StorePointer(&amp;vp.data, xp.data)<span class="hljs-keyword">return</span>&#125;&#125;</code></pre><p>å…·ä½“çš„é€»è¾‘éƒ½å†™åœ¨æ³¨é‡Šä¸­äº†ï¼Œè¿™é‡Œé¢å¤æ‚é€»è¾‘åœ¨ç¬¬ä¸€æ¬¡å†™å…¥ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å†™å…¥çš„æ—¶å€™æœ‰ä¸¤æ¬¡åŸå­å†™æ“ä½œï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ç”¨ typ å€¼ä½œä¸ºä¸€ä¸ªåˆ¤æ–­ï¼Œé€šè¿‡ä¸åŒå€¼åˆ¤æ–­å½“å‰æ‰€å¤„çš„çŠ¶æ€ï¼Œè¿™ä¸ªåœ¨æˆ‘ä»¬ä¸šåŠ¡ä»£ç ä¸­å…¶å®ä¹Ÿç»å¸¸ç”¨åˆ°ã€‚ç„¶åå› ä¸ºå¼•å…¥äº†è¿™ä¸ªä¸­é—´çŠ¶æ€ï¼Œæ‰€ä»¥åˆä½¿ç”¨äº† <code>runtime_procPin</code> æ–¹æ³•é¿å…æŠ¢å </p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sync_runtime_procPin</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;<span class="hljs-keyword">return</span> procPin()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">procPin</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;    <span class="hljs-comment">// è·å–åˆ°å½“å‰ goroutine çš„ m</span>_g_ := getg()mp := _g_.m    <span class="hljs-comment">// unpin çš„æ—¶å€™å°±æ˜¯ locks--</span>mp.locks++<span class="hljs-keyword">return</span> <span class="hljs-keyword">int</span>(mp.p.ptr().id)&#125;</code></pre><h4 id="Load"><a href="#Load" class="headerlink" title="Load"></a>Load</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v *Value)</span> <span class="hljs-title">Load</span><span class="hljs-params">()</span> <span class="hljs-params">(x <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;vp := (*ifaceWords)(unsafe.Pointer(v))    <span class="hljs-comment">// å…ˆæ‹¿åˆ°ç±»å‹å€¼</span>typ := LoadPointer(&amp;vp.typ)    <span class="hljs-comment">// è¿™ä¸ªè¯´æ˜è¿˜æ²¡æœ‰ç¬¬ä¸€æ¬¡ store æˆ–è€…æ˜¯ç¬¬ä¸€æ¬¡ store è¿˜æ²¡æœ‰å®Œæˆ</span><span class="hljs-keyword">if</span> typ == <span class="hljs-literal">nil</span> || <span class="hljs-keyword">uintptr</span>(typ) == ^<span class="hljs-keyword">uintptr</span>(<span class="hljs-number">0</span>) &#123;<span class="hljs-comment">// First store not yet completed.</span><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;    <span class="hljs-comment">// è·å–å€¼</span>data := LoadPointer(&amp;vp.data)    <span class="hljs-comment">// æ„é€  x ç±»å‹</span>xp := (*ifaceWords)(unsafe.Pointer(&amp;x))xp.typ = typxp.data = data<span class="hljs-keyword">return</span>&#125;</code></pre><h2 id="å®æˆ˜-å®ç°ä¸€ä¸ªâ€œæ— é”â€æ ˆ"><a href="#å®æˆ˜-å®ç°ä¸€ä¸ªâ€œæ— é”â€æ ˆ" class="headerlink" title="å®æˆ˜: å®ç°ä¸€ä¸ªâ€œæ— é”â€æ ˆ"></a>å®æˆ˜: å®ç°ä¸€ä¸ªâ€œæ— é”â€æ ˆ</h2><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"sync/atomic"</span><span class="hljs-string">"unsafe"</span>)<span class="hljs-comment">// LFStack æ— é”æ ˆ</span><span class="hljs-comment">// ä½¿ç”¨é“¾è¡¨å®ç°</span><span class="hljs-keyword">type</span> LFStack <span class="hljs-keyword">struct</span> &#123;head unsafe.Pointer <span class="hljs-comment">// æ ˆé¡¶</span>&#125;<span class="hljs-comment">// Node èŠ‚ç‚¹</span><span class="hljs-keyword">type</span> Node <span class="hljs-keyword">struct</span> &#123;val  <span class="hljs-keyword">int32</span>next unsafe.Pointer&#125;<span class="hljs-comment">// NewLFStack NewLFStack</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewLFStack</span><span class="hljs-params">()</span> *<span class="hljs-title">LFStack</span></span> &#123;n := unsafe.Pointer(&amp;Node&#123;&#125;)<span class="hljs-keyword">return</span> &amp;LFStack&#123;head: n&#125;&#125;<span class="hljs-comment">// Push å…¥æ ˆ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *LFStack)</span> <span class="hljs-title">Push</span><span class="hljs-params">(v <span class="hljs-keyword">int32</span>)</span></span> &#123;n := &amp;Node&#123;val: v&#125;<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// å…ˆå–å‡ºæ ˆé¡¶</span>old := atomic.LoadPointer(&amp;s.head)n.next = old<span class="hljs-keyword">if</span> atomic.CompareAndSwapPointer(&amp;s.head, old, unsafe.Pointer(n)) &#123;<span class="hljs-keyword">return</span>&#125;&#125;&#125;<span class="hljs-comment">// Pop å‡ºæ ˆï¼Œæ²¡æœ‰æ•°æ®æ—¶è¿”å› nil</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *LFStack)</span> <span class="hljs-title">Pop</span><span class="hljs-params">()</span> <span class="hljs-title">int32</span></span> &#123;<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// å…ˆå–å‡ºæ ˆé¡¶</span>old := atomic.LoadPointer(&amp;s.head)<span class="hljs-keyword">if</span> old == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>&#125;oldNode := (*Node)(old)<span class="hljs-comment">// å–å‡ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span>next := atomic.LoadPointer(&amp;oldNode.next)<span class="hljs-comment">// é‡ç½®æ ˆé¡¶</span><span class="hljs-keyword">if</span> atomic.CompareAndSwapPointer(&amp;s.head, old, next) &#123;<span class="hljs-keyword">return</span> oldNode.val&#125;&#125;&#125;</code></pre><p>è¿™é‡Œçš„æ— é”å…¶å®åªæ˜¯æ²¡ç”¨äº’æ–¥é”ï¼Œç”¨äº†åŸå­æ“ä½œï¼Œå‰é¢æˆ‘ä»¬çœ‹ atomic çš„æºç çš„æ—¶å€™å¯ä»¥å‘ç°å®é™…ä¸Šåœ¨ CPU ä¸Šè¿˜æ˜¯æœ‰é”çš„ï¼Œåªæ˜¯æˆ‘ä»¬è¿™ä¸ªé”çš„ç²’åº¦éå¸¸å°</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶åœ¨ä¸€äº›æƒ…å†µä¸‹ atomic çš„æ€§èƒ½è¦å¥½å¾ˆå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯ä¸€ä¸ª low level çš„åº“ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡ä»£ç ä¸­æœ€å¥½è¿˜æ˜¯ä½¿ç”¨ channel ä½†æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦çŸ¥é“ï¼Œåœ¨ä¸€äº›åŸºç¡€åº“ï¼Œæˆ–è€…æ˜¯éœ€è¦æè‡´æ€§èƒ½çš„åœ°æ–¹ç”¨ä¸Šè¿™ä¸ªè¿˜æ˜¯å¾ˆçˆ½çš„ï¼Œä½†æ˜¯ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ä¸€å®šè¦å°å¿ƒï¼Œä¸ç„¶è¿˜æ˜¯ä¼šå®¹æ˜“å‡º bugã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li><a href="https://pkg.go.dev/sync/atomic" target="_blank" rel="noopener">https://pkg.go.dev/sync/atomic</a></li><li><a href="https://blog.betacat.io/post/golang-atomic-value-exploration/" target="_blank" rel="noopener">Go è¯­è¨€æ ‡å‡†åº“ä¸­ atomic.Value çš„å‰ä¸–ä»Šç”Ÿ</a></li><li><a href="https://xie.infoq.cn/article/562eff7a1108a7a2bc46058ca" target="_blank" rel="noopener">æ·±å…¥æµ…å‡º Go - sync/atomic æºç åˆ†æ</a></li><li><a href="https://juejin.cn/post/6844903702373859335" target="_blank" rel="noopener">COW å¥¶ç‰›ï¼Copy On Write æœºåˆ¶äº†è§£ä¸€ä¸‹</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%AF%AB%E5%85%A5%E6%99%82%E8%A4%87%E8%A3%BD" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘: COW</a></li><li><a href="https://albk.tech/%E8%81%8A%E8%81%8ACPU%E7%9A%84LOCK%E6%8C%87%E4%BB%A4.html" target="_blank" rel="noopener">èŠèŠ CPU çš„ LOCK æŒ‡ä»¤</a></li><li><a href="https://zhuanlan.zhihu.com/p/24146167" target="_blank" rel="noopener">æµ…è®º Lock ä¸ X86 Cache ä¸€è‡´æ€§</a></li><li><a href="https://software.intel.com/sites/default/files/managed/39/c5/325462-sdm-vol-1-2abcd-3abcd.pdf" target="_blank" rel="noopener">intel æ‰‹å†Œ</a></li><li><a href="https://colobu.com/2020/08/14/lock-free-queue-in-go/" target="_blank" rel="noopener">ä½¿ç”¨ Go å®ç° lock-free çš„é˜Ÿåˆ—</a></li></ol><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Week03: Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</title>
    <link href="/post/go-training-week3-sync.html"/>
    <url>/post/go-training-week3-sync.html</url>
    
    <content type="html"><![CDATA[<p>tags: [Go, å­¦ä¹ ç¬”è®°, Go è¿›é˜¶è®­ç»ƒè¥, å¹¶å‘]<br>categories: [Go è¿›é˜¶è®­ç»ƒè¥, Go å¹¶å‘ç¼–ç¨‹]<br>date: 2020-12-26 13:08:51 +0800</p><hr><blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><h1 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h1><p>å‰é¢å‡ ç¯‡æ–‡ç« å½“ä¸­æˆ‘ä»¬éƒ½åå¤æåˆ°äº† goroutine åˆ›å»ºæ˜¯ç®€å•çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶è¦å°å¿ƒï¼Œä¹ æƒ¯æ€»ä¼šä¸ç»æ„é—´çš„å¯¼è‡´æˆ‘ä»¬å†™å‡ºå¾ˆå¤š bug å¯¹äºè¯­è¨€è§„èŒƒæ²¡æœ‰å®šä¹‰çš„å†…å®¹æˆ‘ä»¬ä¸è¦åšä»»ä½•å‡è®¾ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡åŒæ­¥è¯­ä¹‰æ§åˆ¶ä»–ä»¬çš„æ‰§è¡Œé¡ºåºï¼Œå…³äºä¹‹å‰çš„å†…å®¹å¯ä»¥çœ‹å‰é¢çš„ä¸‰ç¯‡æ–‡ç« ï¼š</p><ul><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Go å¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Go å¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Go å¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li></ul><p>æ¥ä¸‹æ¥çš„å‡ ç¯‡æ–‡ç« å°±è®©æˆ‘ä»¬æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹ sync åŒ…ç›¸å…³çš„ä¸€äº›ç”¨æ³•ï¼Œä»¥åŠéƒ¨åˆ†å®ç°åŸç†ï¼Œå½“ç„¶è¿™é‡Œè¯´æ˜¯ sync åŒ…ï¼Œå®é™…ä¸ŠåŒ…å«äº†ä¸‰ä¸ªåŒ…åˆ†åˆ«æ˜¯: sync, sync/atomic, golang.org/x/sync/errgroup</p><div style="background:#fffbe6;padding:10px;border:1px solid #c3c3c3;border-radius:5px;margin-bottom:5px">è¿™äº›åŒ…æä¾›äº†ä¸€äº›åŸºç¡€çš„åŒæ­¥è¯­ä¹‰ï¼Œä½†æ˜¯åœ¨å®é™…çš„å¹¶å‘ç¼–ç¨‹å½“ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ channel æ¥è¿›è¡ŒåŒæ­¥æ§åˆ¶ã€‚â€œShare memory by communicating; donâ€™t communicate by sharing memory.â€</div><h1 id="Mutex"><a href="#Mutex" class="headerlink" title="Mutex"></a>Mutex</h1><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« è¯´åˆ°çš„ä¾‹å­åº”è¯¥æ€ä¹ˆæ”¹</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> mu sync.Mutex<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2</span>; i++ &#123;wg.Add(<span class="hljs-number">1</span>)<span class="hljs-keyword">go</span> routine(i)&#125;wg.Wait()fmt.Printf(<span class="hljs-string">"Final Counter: %d\n"</span>, counter)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">routine</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++ &#123;mu.Lock()counter++mu.Unlock()&#125;wg.Done()&#125;</code></pre><p>è¿™é‡Œä¸»è¦çš„ç›®çš„å°±æ˜¯ä¸ºäº†ä¿æŠ¤æˆ‘ä»¬ä¸´ç•ŒåŒºçš„æ•°æ®ï¼Œé€šè¿‡é”æ¥è¿›è¡Œä¿è¯ã€‚é”çš„ä½¿ç”¨éå¸¸çš„ç®€å•ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹</p><ul><li>é”çš„èŒƒå›´è¦å°½é‡çš„å°ï¼Œä¸è¦æå¾ˆå¤šå¤§é”</li><li>ç”¨é”ä¸€å®šè¦è§£é”ï¼Œå°å¿ƒäº§ç”Ÿæ­»é”</li></ul><h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨ Go ä¸­é”æ˜¯æ€ä¹ˆå®ç°çš„</p><h3 id="é”çš„å®ç°æ¨¡å¼-5"><a href="#é”çš„å®ç°æ¨¡å¼-5" class="headerlink" title="é”çš„å®ç°æ¨¡å¼[5]"></a>é”çš„å®ç°æ¨¡å¼[5]</h3><ul><li><strong>Barging</strong>: è¿™ç§æ¨¡å¼æ˜¯ä¸ºäº†æé«˜ååé‡ï¼Œå½“é”è¢«é‡Šæ”¾æ—¶ï¼Œå®ƒä¼šå”¤é†’ç¬¬ä¸€ä¸ªç­‰å¾…è€…ï¼Œç„¶åæŠŠé”ç»™ç¬¬ä¸€ä¸ªç­‰å¾…è€…æˆ–è€…ç»™ç¬¬ä¸€ä¸ªè¯·æ±‚é”çš„äºº</li></ul><p><img src="https://lailin.xyz/images/1608967840701-d8c54ee4-964b-49d0-8fab-6f98dd777fd2.png" srcset="/img/loading.gif" alt="1_B1atM-b6GPDS0_Q_TPEUBw.png"></p><ul><li><strong>Handoff: </strong>å½“é”é‡Šæ”¾æ—¶å€™ï¼Œé”ä¼šä¸€ç›´æŒæœ‰ç›´åˆ°ç¬¬ä¸€ä¸ªç­‰å¾…è€…å‡†å¤‡å¥½è·å–é”ã€‚å®ƒé™ä½äº†ååé‡ï¼Œå› ä¸ºé”è¢«æŒæœ‰ï¼Œå³ä½¿å¦ä¸€ä¸ª goroutine å‡†å¤‡è·å–å®ƒã€‚<strong><em>è¿™ç§æ¨¡å¼å¯ä»¥è§£å†³å…¬å¹³æ€§çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ Barging æ¨¡å¼ä¸‹å¯èƒ½ä¼šå­˜åœ¨è¢«å”¤é†’çš„ goroutine æ°¸è¿œä¹Ÿè·å–ä¸åˆ°é”çš„æƒ…å†µï¼Œæ¯•ç«Ÿä¸€ç›´åœ¨ cpu ä¸Šè·‘ç€çš„ goroutine æ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šæ›´å¿«ä¸€äº›ã€‚ç¼ºç‚¹å°±æ˜¯æ€§èƒ½ä¼šç›¸å¯¹å·®ä¸€äº›</em></strong></li></ul><p><img src="https://lailin.xyz/images/1608967902210-d4c2937f-56fd-49e8-a5a3-903bec31e6fc.png" srcset="/img/loading.gif" alt="image.png"></p><ul><li><strong>Spiningï¼š</strong>è‡ªæ—‹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…åº”ç”¨ç¨‹åºé‡åº¦ä½¿ç”¨é”æ—¶æ•ˆæœä¸é”™ã€‚Parking å’Œ Unparking goroutines æœ‰ä¸ä½çš„æ€§èƒ½æˆæœ¬å¼€é”€ï¼Œç›¸æ¯”è‡ªæ—‹æ¥è¯´è¦æ…¢å¾—å¤šã€‚<em><strong>ä½†æ˜¯è‡ªæ—‹æ˜¯æœ‰æˆæœ¬çš„ï¼Œæ‰€ä»¥åœ¨ go çš„å®ç°ä¸­è¿›å…¥è‡ªæ—‹çš„æ¡ä»¶ååˆ†çš„è‹›åˆ»ã€‚</strong></em></li></ul><p><img src="https://lailin.xyz/images/1608967913891-eb4cf780-6ffd-4a2d-a3d5-8e05d7e3fce3.png" srcset="/img/loading.gif" alt="image.png"></p><h3 id="Go-Mutex-å®ç°åŸç†"><a href="#Go-Mutex-å®ç°åŸç†" class="headerlink" title="Go Mutex å®ç°åŸç†"></a>Go Mutex å®ç°åŸç†</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åœ¨ Go ä¸­å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæˆ‘ä»¬å…ˆè®²åŸç†å†çœ‹æºç ï¼Œé¿å…çœ‹çš„äº‘é‡Œé›¾é‡Œçš„ã€‚**</p><h4 id="åŠ é”"><a href="#åŠ é”" class="headerlink" title="åŠ é”"></a>åŠ é”</h4><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒGo åœ¨ 1.15 çš„ç‰ˆæœ¬ä¸­é”çš„å®ç°ç»“åˆä¸Šé¢æåˆ°çš„ä¸‰ç§æ¨¡å¼ï¼Œè°ƒç”¨ Lock æ–¹æ³•çš„æ—¶å€™ã€‚</p><ol><li>é¦–å…ˆå¦‚æœå½“å‰é”å¤„äºåˆå§‹åŒ–çŠ¶æ€å°±ç›´æ¥ç”¨ CAS æ–¹æ³•å°è¯•è·å–é”ï¼Œè¿™æ˜¯<strong>_ Fast Path_</strong></li><li>å¦‚æœå¤±è´¥å°±è¿›å…¥<strong><em> Slow Path</em></strong><ol><li>ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰èƒ½ä¸èƒ½è¿›å…¥è‡ªæ—‹çŠ¶æ€ï¼Œå¦‚æœå¯ä»¥å°±è¿›å…¥è‡ªæ—‹ï¼Œæœ€å¤šè‡ªæ—‹ 4 æ¬¡</li><li>è‡ªæ—‹å®Œæˆä¹‹åï¼Œå°±ä¼šå»è®¡ç®—å½“å‰çš„é”çš„çŠ¶æ€</li><li>ç„¶åå°è¯•é€šè¿‡ CAS è·å–é”</li><li>å¦‚æœæ²¡æœ‰è·å–åˆ°å°±è°ƒç”¨ <code>runtime_SemacquireMutex</code> æ–¹æ³•ä¼‘çœ å½“å‰ goroutine å¹¶ä¸”å°è¯•è·å–ä¿¡å·é‡</li><li>goroutine è¢«å”¤é†’ä¹‹åä¼šå…ˆåˆ¤æ–­å½“å‰æ˜¯å¦å¤„åœ¨é¥¥é¥¿çŠ¶æ€ï¼Œï¼ˆå¦‚æœå½“å‰ goroutine è¶…è¿‡ 1ms éƒ½æ²¡æœ‰è·å–åˆ°é”å°±ä¼šè¿›é¥¥é¥¿æ¨¡å¼ï¼‰ 1. å¦‚æœå¤„åœ¨é¥¥é¥¿çŠ¶æ€å°±ä¼šè·å¾—äº’æ–¥é”ï¼Œå¦‚æœç­‰å¾…é˜Ÿåˆ—ä¸­åªå­˜åœ¨å½“å‰ Goroutineï¼Œäº’æ–¥é”è¿˜ä¼šä»é¥¥é¥¿æ¨¡å¼ä¸­é€€å‡º 1. å¦‚æœä¸åœ¨ï¼Œå°±ä¼šè®¾ç½®å”¤é†’å’Œé¥¥é¥¿æ ‡è®°ã€é‡ç½®è¿­ä»£æ¬¡æ•°å¹¶é‡æ–°æ‰§è¡Œè·å–é”çš„å¾ªç¯<br><div style="background:#fffbe6;padding:10px;border:1px solid #c3c3c3;border-radius:5px;margin-bottom:5px">CAS æ–¹æ³•åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯ <code>atomic.CompareAndSwapInt32(addr, old, new) bool</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå…ˆæ¯”è¾ƒä¼ å…¥çš„åœ°å€çš„å€¼æ˜¯å¦æ˜¯ oldï¼Œå¦‚æœæ˜¯çš„è¯å°±å°è¯•èµ‹æ–°å€¼ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±ç›´æ¥è¿”å› falseï¼Œè¿”å› true æ—¶è¡¨ç¤ºèµ‹å€¼æˆåŠŸ<br>é¥¥é¥¿æ¨¡å¼æ˜¯ Go 1.9 ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ä¼˜åŒ–ï¼Œç”¨äºè§£å†³å…¬å¹³æ€§çš„é—®é¢˜[10]</div><br><img src="https://lailin.xyz/images/1608970759375-09d8cda7-77ac-48d3-b2f3-b8890e927bd4.svg" srcset="/img/loading.gif" alt="02_Goè¿›é˜¶03_blog_sync.drawio.svg"></li></ol></li></ol><h4 id="è§£é”"><a href="#è§£é”" class="headerlink" title="è§£é”"></a>è§£é”</h4><p>è§£é”çš„æµç¨‹ç›¸å¯¹äºåŠ é”ç®€å•è®¸å¤š<br><img src="https://lailin.xyz/images/1608978117259-455cf28e-aa1e-46cf-8fd6-6040ed6c0a7a.svg" srcset="/img/loading.gif" alt="02_Goè¿›é˜¶03_blog_sync.drawio.svg"></p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="Mutex-åŸºæœ¬ç»“æ„"><a href="#Mutex-åŸºæœ¬ç»“æ„" class="headerlink" title="Mutex åŸºæœ¬ç»“æ„"></a>Mutex åŸºæœ¬ç»“æ„</h3><p>çŸ¥é“å…¶ä¸­çš„åŸç†ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æºç åˆ†æ</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Mutex <span class="hljs-keyword">struct</span> &#123;state <span class="hljs-keyword">int32</span>sema  <span class="hljs-keyword">uint32</span>&#125;</code></pre><p><code>Mutex</code> ç»“æ„ä½“ç”± <code>state</code> <code>sema</code> ä¸¤ä¸ª 4 å­—èŠ‚æˆå‘˜ç»„æˆï¼Œå…¶ä¸­ <code>state</code> è¡¨ç¤ºäº†å½“å‰é”çš„çŠ¶æ€ï¼Œ <code>sema</code> æ˜¯ç”¨äºæ§åˆ¶é”çš„ä¿¡å·é‡<br><img src="https://lailin.xyz/images/1608972241012-8c0fe8e2-b1c8-4696-a9c4-454e11753e0f.svg" srcset="/img/loading.gif" alt="02_Goè¿›é˜¶03_blog_sync.drawio.svg"><br><code>state</code> å­—æ®µçš„æœ€ä½ä¸‰ä½è¡¨ç¤ºä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ <code>mutexLocked</code> <code>mutexWoken</code> <code>mutexStarving</code> ï¼Œå‰©ä¸‹çš„ç”¨äºç»Ÿè®¡å½“å‰åœ¨ç­‰å¾…é”çš„ goroutine æ•°é‡</p><ul><li><code>mutexLocked</code> è¡¨ç¤ºæ˜¯å¦å¤„äºé”å®šçŠ¶æ€</li><li><code>mutexWoken</code> è¡¨ç¤ºæ˜¯å¦å¤„äºå”¤é†’çŠ¶æ€</li><li><code>mutexStarving</code> è¡¨ç¤ºæ˜¯å¦å¤„äºé¥¥é¥¿çŠ¶æ€</li></ul><h3 id="åŠ é”-1"><a href="#åŠ é”-1" class="headerlink" title="åŠ é”"></a>åŠ é”</h3><p>å›å‘³ä¸€ä¸‹ä¸Šé¢çœ‹åˆ°çš„æµç¨‹å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹äº’æ–¥é”æ˜¯å¦‚ä½•åŠ é”çš„</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span> <span class="hljs-title">Lock</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// Fast path: grab unlocked mutex.</span><span class="hljs-keyword">if</span> atomic.CompareAndSwapInt32(&amp;m.state, <span class="hljs-number">0</span>, mutexLocked) &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// Slow path (outlined so that the fast path can be inlined)</span>m.lockSlow()&#125;</code></pre><ul><li>å½“æˆ‘ä»¬è°ƒç”¨ <code>Lock</code> æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…ˆå°è¯•èµ° Fast Pathï¼Œä¹Ÿå°±æ˜¯å¦‚æœå½“å‰äº’æ–¥é”å¦‚æœå¤„äºæœªåŠ é”çš„çŠ¶æ€ï¼Œå°è¯•åŠ é”ï¼Œåªè¦åŠ é”æˆåŠŸå°±ç›´æ¥è¿”å›</li><li>å¦åˆ™çš„è¯å°±è¿›å…¥ slow path</li></ul><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span> <span class="hljs-title">lockSlow</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> waitStartTime <span class="hljs-keyword">int64</span> <span class="hljs-comment">// ç­‰å¾…æ—¶é—´</span>starving := <span class="hljs-literal">false</span> <span class="hljs-comment">// æ˜¯å¦å¤„äºé¥¥é¥¿çŠ¶æ€</span>awoke := <span class="hljs-literal">false</span> <span class="hljs-comment">// æ˜¯å¦å¤„äºå”¤é†’çŠ¶æ€</span>iter := <span class="hljs-number">0</span> <span class="hljs-comment">// è‡ªæ—‹è¿­ä»£æ¬¡æ•°</span>old := m.state<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// Don't spin in starvation mode, ownership is handed off to waiters</span><span class="hljs-comment">// so we won't be able to acquire the mutex anyway.</span><span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexStarving) == mutexLocked &amp;&amp; runtime_canSpin(iter) &#123;<span class="hljs-comment">// Active spinning makes sense.</span><span class="hljs-comment">// Try to set mutexWoken flag to inform Unlock</span><span class="hljs-comment">// to not wake other blocked goroutines.</span><span class="hljs-keyword">if</span> !awoke &amp;&amp; old&amp;mutexWoken == <span class="hljs-number">0</span> &amp;&amp; old&gt;&gt;mutexWaiterShift != <span class="hljs-number">0</span> &amp;&amp;atomic.CompareAndSwapInt32(&amp;m.state, old, old|mutexWoken) &#123;awoke = <span class="hljs-literal">true</span>&#125;runtime_doSpin()iter++old = m.state<span class="hljs-keyword">continue</span>&#125;</code></pre><p>åœ¨ <code>lockSlow</code> æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ªå¤§çš„ for å¾ªç¯ï¼Œä¸æ–­çš„å°è¯•å»è·å–äº’æ–¥é”ï¼Œåœ¨å¾ªç¯çš„å†…éƒ¨ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯åˆ¤æ–­èƒ½å¦è‡ªæ—‹çŠ¶æ€ã€‚<br>è¿›å…¥è‡ªæ—‹çŠ¶æ€çš„åˆ¤æ–­æ¯”è¾ƒè‹›åˆ»ï¼Œå…·ä½“éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶å‘¢ï¼Ÿ <code>runtime_canSpin</code> æºç è§ä¸‹æ–¹</p><ul><li>å½“å‰äº’æ–¥é”çš„çŠ¶æ€æ˜¯éé¥¥é¥¿çŠ¶æ€ï¼Œå¹¶ä¸”å·²ç»è¢«é”å®šäº†</li><li>è‡ªæ—‹æ¬¡æ•°ä¸è¶…è¿‡ 4 æ¬¡</li><li>cpu ä¸ªæ•°å¤§äºä¸€ï¼Œå¿…é¡»è¦æ˜¯å¤šæ ¸ cpu</li><li>å½“å‰æ­£åœ¨æ‰§è¡Œå½“ä¸­ï¼Œå¹¶ä¸”é˜Ÿåˆ—ç©ºé—²çš„ p çš„ä¸ªæ•°å¤§äºç­‰äºä¸€</li></ul><pre><code class="hljs go"><span class="hljs-comment">// Active spinning for sync.Mutex.</span><span class="hljs-comment">//go:linkname sync_runtime_canSpin sync.runtime_canSpin</span><span class="hljs-comment">//go:nosplit</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sync_runtime_canSpin</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">if</span> i &gt;= active_spin || ncpu &lt;= <span class="hljs-number">1</span> || gomaxprocs &lt;= <span class="hljs-keyword">int32</span>(sched.npidle+sched.nmspinning)+<span class="hljs-number">1</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;<span class="hljs-keyword">if</span> p := getg().m.p.ptr(); !runqempty(p) &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;</code></pre><p>å¦‚æœå¯ä»¥è¿›å…¥è‡ªæ—‹çŠ¶æ€ä¹‹åå°±ä¼šè°ƒç”¨ <code>runtime_doSpin</code> æ–¹æ³•è¿›å…¥è‡ªæ—‹ï¼Œ <code>doSpin</code> æ–¹æ³•ä¼šè°ƒç”¨ <code>procyield(30)</code> æ‰§è¡Œä¸‰åæ¬¡ <code>PAUSE</code> æŒ‡ä»¤</p><pre><code class="hljs go">TEXT runtimeÂ·procyield(SB),NOSPLIT,$<span class="hljs-number">0</span><span class="hljs-number">-0</span>MOVLcycles+<span class="hljs-number">0</span>(FP), AXagain:PAUSESUBL$<span class="hljs-number">1</span>, AXJNZagainRET</code></pre><p></p><div style="background:#fffbe6;padding:10px;border:1px solid #c3c3c3;border-radius:5px;margin-bottom:5px">ä¸ºä»€ä¹ˆä½¿ç”¨ PAUSE æŒ‡ä»¤å‘¢ï¼Ÿ<br>PAUSE æŒ‡ä»¤ä¼šå‘Šè¯‰ CPU æˆ‘å½“å‰å¤„äºå¤„äºè‡ªæ—‹çŠ¶æ€ï¼Œè¿™æ—¶å€™ CPU ä¼šé’ˆå¯¹æ€§çš„åšä¸€äº›ä¼˜åŒ–ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤çš„æ—¶å€™ CPU ä¼šé™ä½è‡ªå·±çš„åŠŸè€—ï¼Œå‡å°‘èƒ½æºæ¶ˆè€—</div><br><pre><code class="hljs go"><span class="hljs-keyword">if</span> !awoke &amp;&amp; old&amp;mutexWoken == <span class="hljs-number">0</span> &amp;&amp; old&gt;&gt;mutexWaiterShift != <span class="hljs-number">0</span> &amp;&amp;atomic.CompareAndSwapInt32(&amp;m.state, old, old|mutexWoken) &#123;awoke = <span class="hljs-literal">true</span>&#125;</code></pre><p></p><p>åœ¨è‡ªæ—‹çš„è¿‡ç¨‹ä¸­ä¼šå°è¯•è®¾ç½® <code>mutexWoken</code> æ¥é€šçŸ¥è§£é”ï¼Œä»è€Œé¿å…å”¤é†’å…¶ä»–å·²ç»ä¼‘çœ çš„ <code>goroutine</code> åœ¨è‡ªæ—‹æ¨¡å¼ä¸‹ï¼Œå½“å‰çš„ <code>goroutine</code> å°±èƒ½æ›´å¿«çš„è·å–åˆ°é”<br><pre><code class="hljs go"><span class="hljs-built_in">new</span> := old<span class="hljs-comment">// Don't try to acquire starving mutex, new arriving goroutines must queue.</span><span class="hljs-keyword">if</span> old&amp;mutexStarving == <span class="hljs-number">0</span> &#123;<span class="hljs-built_in">new</span> |= mutexLocked&#125;<span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexStarving) != <span class="hljs-number">0</span> &#123;<span class="hljs-built_in">new</span> += <span class="hljs-number">1</span> &lt;&lt; mutexWaiterShift&#125;<span class="hljs-comment">// The current goroutine switches mutex to starvation mode.</span><span class="hljs-comment">// But if the mutex is currently unlocked, don't do the switch.</span><span class="hljs-comment">// Unlock expects that starving mutex has waiters, which will not</span><span class="hljs-comment">// be true in this case.</span><span class="hljs-keyword">if</span> starving &amp;&amp; old&amp;mutexLocked != <span class="hljs-number">0</span> &#123;<span class="hljs-built_in">new</span> |= mutexStarving&#125;<span class="hljs-keyword">if</span> awoke &#123;<span class="hljs-comment">// The goroutine has been woken from sleep,</span><span class="hljs-comment">// so we need to reset the flag in either case.</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span>&amp;mutexWoken == <span class="hljs-number">0</span> &#123;throw(<span class="hljs-string">"sync: inconsistent mutex state"</span>)&#125;<span class="hljs-built_in">new</span> &amp;^= mutexWoken&#125;</code></pre></p><p>è‡ªæ—‹ç»“æŸä¹‹åå°±ä¼šå»è®¡ç®—å½“å‰äº’æ–¥é”çš„çŠ¶æ€ï¼Œå¦‚æœå½“å‰å¤„åœ¨é¥¥é¥¿æ¨¡å¼ä¸‹åˆ™ä¸ä¼šå»è¯·æ±‚é”ï¼Œè€Œæ˜¯ä¼šå°†å½“å‰ goroutine æ”¾åˆ°é˜Ÿåˆ—çš„æœ«ç«¯<br><pre><code class="hljs go"><span class="hljs-keyword">if</span> atomic.CompareAndSwapInt32(&amp;m.state, old, <span class="hljs-built_in">new</span>) &#123;    <span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexStarving) == <span class="hljs-number">0</span> &#123;        <span class="hljs-keyword">break</span> <span class="hljs-comment">// locked the mutex with CAS</span>    &#125;    <span class="hljs-comment">// If we were already waiting before, queue at the front of the queue.</span>    queueLifo := waitStartTime != <span class="hljs-number">0</span>    <span class="hljs-keyword">if</span> waitStartTime == <span class="hljs-number">0</span> &#123;        waitStartTime = runtime_nanotime()    &#125;    runtime_SemacquireMutex(&amp;m.sema, queueLifo, <span class="hljs-number">1</span>)    starving = starving || runtime_nanotime()-waitStartTime &gt; starvationThresholdNs    old = m.state    <span class="hljs-keyword">if</span> old&amp;mutexStarving != <span class="hljs-number">0</span> &#123;        <span class="hljs-comment">// If this goroutine was woken and mutex is in starvation mode,</span>        <span class="hljs-comment">// ownership was handed off to us but mutex is in somewhat</span>        <span class="hljs-comment">// inconsistent state: mutexLocked is not set and we are still</span>        <span class="hljs-comment">// accounted as waiter. Fix that.</span>        <span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexWoken) != <span class="hljs-number">0</span> || old&gt;&gt;mutexWaiterShift == <span class="hljs-number">0</span> &#123;            throw(<span class="hljs-string">"sync: inconsistent mutex state"</span>)        &#125;        delta := <span class="hljs-keyword">int32</span>(mutexLocked - <span class="hljs-number">1</span>&lt;&lt;mutexWaiterShift)        <span class="hljs-keyword">if</span> !starving || old&gt;&gt;mutexWaiterShift == <span class="hljs-number">1</span> &#123;            <span class="hljs-comment">// Exit starvation mode.</span>            <span class="hljs-comment">// Critical to do it here and consider wait time.</span>            <span class="hljs-comment">// Starvation mode is so inefficient, that two goroutines</span>            <span class="hljs-comment">// can go lock-step infinitely once they switch mutex</span>            <span class="hljs-comment">// to starvation mode.</span>            delta -= mutexStarving        &#125;        atomic.AddInt32(&amp;m.state, delta)        <span class="hljs-keyword">break</span>    &#125;    awoke = <span class="hljs-literal">true</span>    iter = <span class="hljs-number">0</span>&#125;</code></pre></p><p>çŠ¶æ€è®¡ç®—å®Œæˆä¹‹åå°±ä¼šå°è¯•ä½¿ç”¨ CAS æ“ä½œè·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸå°±ä¼šç›´æ¥é€€å‡ºå¾ªç¯<br>å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™ä¼šè°ƒç”¨ <code>runtime_SemacquireMutex(&amp;m.sema, queueLifo, 1)</code> æ–¹æ³•ä¿è¯é”ä¸ä¼šåŒæ—¶è¢«ä¸¤ä¸ª goroutine è·å–ã€‚<code>runtime_SemacquireMutex</code> æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯:</p><ul><li>ä¸æ–­è°ƒç”¨å°è¯•è·å–é”</li><li>ä¼‘çœ å½“å‰ goroutine</li><li>ç­‰å¾…ä¿¡å·é‡ï¼Œå”¤é†’ goroutine</li></ul><p>goroutine è¢«å”¤é†’ä¹‹åå°±ä¼šå»åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºé¥¥é¥¿æ¨¡å¼ï¼Œå¦‚æœå½“å‰ç­‰å¾…è¶…è¿‡ <code>1ms</code> å°±ä¼šè¿›å…¥é¥¥é¥¿æ¨¡å¼</p><ul><li>é¥¥é¥¿æ¨¡å¼ä¸‹ï¼šä¼šè·å¾—äº’æ–¥é”ï¼Œå¦‚æœç­‰å¾…é˜Ÿåˆ—ä¸­åªå­˜åœ¨å½“å‰ Goroutineï¼Œäº’æ–¥é”è¿˜ä¼šä»é¥¥é¥¿æ¨¡å¼ä¸­é€€å‡º</li><li>æ­£å¸¸æ¨¡å¼ä¸‹ï¼šä¼šè®¾ç½®å”¤é†’å’Œé¥¥é¥¿æ ‡è®°ã€é‡ç½®è¿­ä»£æ¬¡æ•°å¹¶é‡æ–°æ‰§è¡Œè·å–é”çš„å¾ªç¯</li></ul><h3 id="è§£é”-1"><a href="#è§£é”-1" class="headerlink" title="è§£é”"></a>è§£é”</h3><p>å’ŒåŠ é”æ¯”è§£é”å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥çœ‹æ³¨é‡Šå°±å¥½</p><pre><code class="hljs go"><span class="hljs-comment">// è§£é”ä¸€ä¸ªæ²¡æœ‰é”å®šçš„äº’æ–¥é‡ä¼šæŠ¥è¿è¡Œæ—¶é”™è¯¯</span><span class="hljs-comment">// è§£é”æ²¡æœ‰ç»‘å®šå…³ç³»ï¼Œå¯ä»¥ä¸€ä¸ª goroutine é”å®šï¼Œå¦å¤–ä¸€ä¸ª goroutine è§£é”</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span> <span class="hljs-title">Unlock</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// Fast path: ç›´æ¥å°è¯•è®¾ç½® state çš„å€¼ï¼Œè¿›è¡Œè§£é”</span><span class="hljs-built_in">new</span> := atomic.AddInt32(&amp;m.state, -mutexLocked)    <span class="hljs-comment">// å¦‚æœå‡å»äº† mutexLocked çš„å€¼ä¹‹åä¸ä¸ºé›¶å°±ä¼šè¿›å…¥æ…¢é€Ÿé€šé“ï¼Œè¿™è¯´æ˜æœ‰å¯èƒ½å¤±è´¥äº†ï¼Œæˆ–è€…æ˜¯è¿˜æœ‰å…¶ä»–çš„ goroutine ç­‰ç€</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span> != <span class="hljs-number">0</span> &#123;<span class="hljs-comment">// Outlined slow path to allow inlining the fast path.</span><span class="hljs-comment">// To hide unlockSlow during tracing we skip one extra frame when tracing GoUnblock.</span>m.unlockSlow(<span class="hljs-built_in">new</span>)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span> <span class="hljs-title">unlockSlow</span><span class="hljs-params">(<span class="hljs-built_in">new</span> <span class="hljs-keyword">int32</span>)</span></span> &#123;    <span class="hljs-comment">// è§£é”ä¸€ä¸ªæ²¡æœ‰é”å®šçš„äº’æ–¥é‡ä¼šæŠ¥è¿è¡Œæ—¶é”™è¯¯</span><span class="hljs-keyword">if</span> (<span class="hljs-built_in">new</span>+mutexLocked)&amp;mutexLocked == <span class="hljs-number">0</span> &#123;throw(<span class="hljs-string">"sync: unlock of unlocked mutex"</span>)&#125;    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å¤„äºé¥¥é¥¿æ¨¡å¼</span><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span>&amp;mutexStarving == <span class="hljs-number">0</span> &#123;        <span class="hljs-comment">// æ­£å¸¸æ¨¡å¼</span>old := <span class="hljs-built_in">new</span><span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// å¦‚æœå½“å‰æ²¡æœ‰ç­‰å¾…è€….æˆ–è€… goroutine å·²ç»è¢«å”¤é†’æˆ–è€…æ˜¯å¤„äºé”å®šçŠ¶æ€äº†ï¼Œå°±ç›´æ¥è¿”å›</span><span class="hljs-keyword">if</span> old&gt;&gt;mutexWaiterShift == <span class="hljs-number">0</span> || old&amp;(mutexLocked|mutexWoken|mutexStarving) != <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// å”¤é†’ç­‰å¾…è€…å¹¶ä¸”ç§»äº¤é”çš„æ§åˆ¶æƒ</span><span class="hljs-built_in">new</span> = (old - <span class="hljs-number">1</span>&lt;&lt;mutexWaiterShift) | mutexWoken<span class="hljs-keyword">if</span> atomic.CompareAndSwapInt32(&amp;m.state, old, <span class="hljs-built_in">new</span>) &#123;runtime_Semrelease(&amp;m.sema, <span class="hljs-literal">false</span>, <span class="hljs-number">1</span>)<span class="hljs-keyword">return</span>&#125;old = m.state&#125;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// é¥¥é¥¿æ¨¡å¼ï¼Œèµ° handoff æµç¨‹ï¼Œç›´æ¥å°†é”äº¤ç»™ä¸‹ä¸€ä¸ªç­‰å¾…çš„ goroutineï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™ä¸ä¼šä»é¥¥é¥¿æ¨¡å¼ä¸­é€€å‡º</span>runtime_Semrelease(&amp;m.sema, <span class="hljs-literal">true</span>, <span class="hljs-number">1</span>)&#125;&#125;</code></pre><h1 id="RWMutex"><a href="#RWMutex" class="headerlink" title="RWMutex"></a>RWMutex</h1><p>è¯»å†™é”ç›¸å¯¹äºäº’æ–¥é”æ¥è¯´ç²’åº¦æ›´ç»†ï¼Œä½¿ç”¨è¯»å†™é”å¯ä»¥å¹¶å‘è¯»ï¼Œä½†æ˜¯ä¸èƒ½å¹¶å‘è¯»å†™ï¼Œæˆ–è€…å¹¶å‘å†™å†™</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"><strong>è¯»</strong></th><th style="text-align:center"><strong>å†™</strong></th></tr></thead><tbody><tr><td style="text-align:center">è¯»</td><td style="text-align:center">Y</td><td style="text-align:center">N</td></tr><tr><td style="text-align:center">å†™</td><td style="text-align:center">N</td><td style="text-align:center">N</td></tr></tbody></table><h2 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>å…¶å®å¤§éƒ¨åˆ†çš„ä¸šåŠ¡åº”ç”¨éƒ½æ˜¯è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨è¯»å†™é”çš„æ€§èƒ½å°±ä¼šæ¯”äº’æ–¥é”è¦å¥½ä¸€äº›ï¼Œä¾‹å¦‚ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ï¼Œæ˜¯ä¸€ä¸ªé…ç½®è¯»å†™çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨è¯»å†™é”å’Œäº’æ–¥é”å®ç°</p><pre><code class="hljs go"><span class="hljs-comment">// RWMutexConfig è¯»å†™é”å®ç°</span><span class="hljs-keyword">type</span> RWMutexConfig <span class="hljs-keyword">struct</span> &#123;rw   sync.RWMutexdata []<span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// Get get config data</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *RWMutexConfig)</span> <span class="hljs-title">Get</span><span class="hljs-params">()</span> []<span class="hljs-title">int</span></span> &#123;c.rw.RLock()<span class="hljs-keyword">defer</span> c.rw.RUnlock()<span class="hljs-keyword">return</span> c.data&#125;<span class="hljs-comment">// Set set config data</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *RWMutexConfig)</span> <span class="hljs-title">Set</span><span class="hljs-params">(n []<span class="hljs-keyword">int</span>)</span></span> &#123;c.rw.Lock()<span class="hljs-keyword">defer</span> c.rw.Unlock()c.data = n&#125;</code></pre><p>äº’æ–¥é”å®ç°</p><pre><code class="hljs go"><span class="hljs-comment">// MutexConfig äº’æ–¥é”å®ç°</span><span class="hljs-keyword">type</span> MutexConfig <span class="hljs-keyword">struct</span> &#123;data []<span class="hljs-keyword">int</span>mu   sync.Mutex&#125;<span class="hljs-comment">// Get get config data</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *MutexConfig)</span> <span class="hljs-title">Get</span><span class="hljs-params">()</span> []<span class="hljs-title">int</span></span> &#123;c.mu.Lock()<span class="hljs-keyword">defer</span> c.mu.Unlock()<span class="hljs-keyword">return</span> c.data&#125;<span class="hljs-comment">// Set set config data</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *MutexConfig)</span> <span class="hljs-title">Set</span><span class="hljs-params">(n []<span class="hljs-keyword">int</span>)</span></span> &#123;c.mu.Lock()<span class="hljs-keyword">defer</span> c.mu.Unlock()c.data = n&#125;</code></pre><p>å¹¶å‘åŸºå‡†æµ‹è¯•</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> iConfig <span class="hljs-keyword">interface</span> &#123;Get() []<span class="hljs-keyword">int</span>Set([]<span class="hljs-keyword">int</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bench</span><span class="hljs-params">(b *testing.B, c iConfig)</span></span> &#123;b.RunParallel(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(p *testing.PB)</span></span> &#123;<span class="hljs-keyword">for</span> p.Next() &#123;c.Set([]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">100</span>&#125;)c.Get()c.Get()c.Get()c.Set([]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">100</span>&#125;)c.Get()c.Get()&#125;&#125;)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkMutexConfig</span><span class="hljs-params">(b *testing.B)</span></span> &#123;conf := &amp;MutexConfig&#123;data: []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;&#125;bench(b, conf)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkRWMutexConfig</span><span class="hljs-params">(b *testing.B)</span></span> &#123;conf := &amp;RWMutexConfig&#123;data: []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;&#125;bench(b, conf)&#125;</code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code class="hljs go">â¯ <span class="hljs-keyword">go</span> test -race -bench=.goos: linuxgoarch: amd64pkg: github.com/mohuishou/<span class="hljs-keyword">go</span>-training/Week03/blog/<span class="hljs-number">04</span>_sync/<span class="hljs-number">02</span>_rwmutexBenchmarkMutexConfig<span class="hljs-number">-4</span>            <span class="hljs-number">179577</span>              <span class="hljs-number">6912</span> ns/opBenchmarkRWMutexConfig<span class="hljs-number">-4</span>          <span class="hljs-number">341620</span>              <span class="hljs-number">3425</span> ns/opPASSok      github.com/mohuishou/<span class="hljs-keyword">go</span>-training/Week03/blog/<span class="hljs-number">04</span>_sync/<span class="hljs-number">02</span>_rwmutex <span class="hljs-number">3.565</span>s</code></pre><p>å¯ä»¥çœ‹åˆ°é¦–å…ˆæ˜¯æ²¡æœ‰ data race é—®é¢˜ï¼Œå…¶æ¬¡è¯»å†™é”çš„æ€§èƒ½å‡ ä¹æ˜¯äº’æ–¥é”çš„ä¸€å€</p><h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><pre><code class="hljs go"><span class="hljs-keyword">type</span> RWMutex <span class="hljs-keyword">struct</span> &#123;w           Mutex  <span class="hljs-comment">// å¤ç”¨äº’æ–¥é”</span>writerSem   <span class="hljs-keyword">uint32</span> <span class="hljs-comment">// ä¿¡å·é‡ï¼Œç”¨äºå†™ç­‰å¾…è¯»</span>readerSem   <span class="hljs-keyword">uint32</span> <span class="hljs-comment">// ä¿¡å·é‡ï¼Œç”¨äºè¯»ç­‰å¾…å†™</span>readerCount <span class="hljs-keyword">int32</span>  <span class="hljs-comment">// å½“å‰æ‰§è¡Œè¯»çš„ goroutine æ•°é‡</span>readerWait  <span class="hljs-keyword">int32</span>  <span class="hljs-comment">// å†™æ“ä½œè¢«é˜»å¡çš„å‡†å¤‡è¯»çš„ goroutine çš„æ•°é‡</span>&#125;</code></pre><p>ç”±äºå¤ç”¨äº†äº’æ–¥é”çš„ä»£ç ï¼Œè¯»å†™é”çš„æºç å¾ˆç®€å•ï¼Œè¿™é‡Œæˆ‘å°±ä¸å•ç‹¬ç”»å›¾äº†</p><h3 id="è¯»é”"><a href="#è¯»é”" class="headerlink" title="è¯»é”"></a>è¯»é”</h3><h4 id="åŠ é”-2"><a href="#åŠ é”-2" class="headerlink" title="åŠ é”"></a>åŠ é”</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(rw *RWMutex)</span> <span class="hljs-title">RLock</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">if</span> atomic.AddInt32(&amp;rw.readerCount, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-comment">// A writer is pending, wait for it.</span>runtime_SemacquireMutex(&amp;rw.readerSem, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>)&#125;&#125;</code></pre><p>é¦–å…ˆæ˜¯è¯»é”ï¼Œ <code>atomic.AddInt32(&amp;rw.readerCount, 1)</code> è°ƒç”¨è¿™ä¸ªåŸå­æ–¹æ³•ï¼Œå¯¹å½“å‰åœ¨è¯»çš„æ•°é‡åŠ ä¸€ï¼Œå¦‚æœè¿”å›è´Ÿæ•°ï¼Œé‚£ä¹ˆè¯´æ˜å½“å‰æœ‰å…¶ä»–å†™é”ï¼Œè¿™æ—¶å€™å°±è°ƒç”¨ <code>runtime_SemacquireMutex</code> ä¼‘çœ  goroutine ç­‰å¾…è¢«å”¤é†’</p><h4 id="è§£é”-2"><a href="#è§£é”-2" class="headerlink" title="è§£é”"></a>è§£é”</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(rw *RWMutex)</span> <span class="hljs-title">RUnlock</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">if</span> r := atomic.AddInt32(&amp;rw.readerCount, <span class="hljs-number">-1</span>); r &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-comment">// Outlined slow-path to allow the fast-path to be inlined</span>rw.rUnlockSlow(r)&#125;&#125;</code></pre><p>è§£é”çš„æ—¶å€™å¯¹æ­£åœ¨è¯»çš„æ“ä½œå‡ä¸€ï¼Œå¦‚æœè¿”å›å€¼å°äº 0 é‚£ä¹ˆè¯´æ˜å½“å‰æœ‰åœ¨å†™çš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™è°ƒç”¨ <code>rUnlockSlow</code> è¿›å…¥æ…¢é€Ÿé€šé“</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(rw *RWMutex)</span> <span class="hljs-title">rUnlockSlow</span><span class="hljs-params">(r <span class="hljs-keyword">int32</span>)</span></span> &#123;<span class="hljs-keyword">if</span> r+<span class="hljs-number">1</span> == <span class="hljs-number">0</span> || r+<span class="hljs-number">1</span> == -rwmutexMaxReaders &#123;race.Enable()throw(<span class="hljs-string">"sync: RUnlock of unlocked RWMutex"</span>)&#125;<span class="hljs-comment">// A writer is pending.</span><span class="hljs-keyword">if</span> atomic.AddInt32(&amp;rw.readerWait, <span class="hljs-number">-1</span>) == <span class="hljs-number">0</span> &#123;<span class="hljs-comment">// The last reader unblocks the writer.</span>runtime_Semrelease(&amp;rw.writerSem, <span class="hljs-literal">false</span>, <span class="hljs-number">1</span>)&#125;&#125;</code></pre><p>è¢«é˜»å¡çš„å‡†å¤‡è¯»çš„ goroutine çš„æ•°é‡å‡ä¸€ï¼ŒreaderWait ä¸º 0ï¼Œå°±è¡¨ç¤ºå½“å‰æ²¡æœ‰æ­£åœ¨å‡†å¤‡è¯»çš„ goroutine è¿™æ—¶å€™è°ƒç”¨ <code>runtime_Semrelease</code> å”¤é†’å†™æ“ä½œ</p><h3 id="å†™é”"><a href="#å†™é”" class="headerlink" title="å†™é”"></a>å†™é”</h3><h4 id="åŠ é”-3"><a href="#åŠ é”-3" class="headerlink" title="åŠ é”"></a>åŠ é”</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(rw *RWMutex)</span> <span class="hljs-title">Lock</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// First, resolve competition with other writers.</span>rw.w.Lock()<span class="hljs-comment">// Announce to readers there is a pending writer.</span>r := atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders<span class="hljs-comment">// Wait for active readers.</span><span class="hljs-keyword">if</span> r != <span class="hljs-number">0</span> &amp;&amp; atomic.AddInt32(&amp;rw.readerWait, r) != <span class="hljs-number">0</span> &#123;runtime_SemacquireMutex(&amp;rw.writerSem, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>)&#125;&#125;</code></pre><p>é¦–å…ˆè°ƒç”¨äº’æ–¥é”çš„ lockï¼Œè·å–åˆ°äº’æ–¥é”ä¹‹åï¼Œ</p><ul><li><code>atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders)</code> è°ƒç”¨è¿™ä¸ªå‡½æ•°é˜»å¡åç»­çš„è¯»æ“ä½œ</li><li>å¦‚æœè®¡ç®—ä¹‹åå½“å‰ä»ç„¶æœ‰å…¶ä»– goroutine æŒæœ‰è¯»é”ï¼Œé‚£ä¹ˆå°±è°ƒç”¨ <code>runtime_SemacquireMutex</code> ä¼‘çœ å½“å‰çš„ goroutine ç­‰å¾…æ‰€æœ‰çš„è¯»æ“ä½œå®Œæˆ</li></ul><h4 id="è§£é”-3"><a href="#è§£é”-3" class="headerlink" title="è§£é”"></a>è§£é”</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(rw *RWMutex)</span> <span class="hljs-title">Unlock</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// Announce to readers there is no active writer.</span>r := atomic.AddInt32(&amp;rw.readerCount, rwmutexMaxReaders)<span class="hljs-keyword">if</span> r &gt;= rwmutexMaxReaders &#123;race.Enable()throw(<span class="hljs-string">"sync: Unlock of unlocked RWMutex"</span>)&#125;<span class="hljs-comment">// Unblock blocked readers, if any.</span><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">int</span>(r); i++ &#123;runtime_Semrelease(&amp;rw.readerSem, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>)&#125;&#125;</code></pre><p>è§£é”çš„æ“ä½œï¼Œä¼šå…ˆè°ƒç”¨ <code>atomic.AddInt32(&amp;rw.readerCount, rwmutexMaxReaders)</code> å°†æ¢å¤ä¹‹å‰å†™å…¥çš„è´Ÿæ•°ï¼Œç„¶åæ ¹æ®å½“å‰æœ‰å¤šå°‘ä¸ªè¯»æ“ä½œåœ¨ç­‰å¾…ï¼Œå¾ªç¯å”¤é†’</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ol><li><a href="https://pkg.go.dev/sync" target="_blank" rel="noopener">https://pkg.go.dev/sync</a> å®˜ç½‘æ–‡æ¡£ï¼Œå¿…è¯»</li><li><a href="https://pkg.go.dev/golang.org/x/sync@v0.0.0-20201207232520-09787c993a3a/errgroup" target="_blank" rel="noopener">https://pkg.go.dev/golang.org/x/sync@v0.0.0-20201207232520-09787c993a3a/errgroup</a> å®˜ç½‘æ–‡æ¡£ï¼Œå¿…è¯»</li><li><a href="https://pkg.go.dev/sync/atomic" target="_blank" rel="noopener">https://pkg.go.dev/sync/atomic</a> å®˜ç½‘æ–‡æ¡£ï¼Œå¿…è¯»</li><li><a href="https://medium.com/a-journey-with-go/go-how-to-reduce-lock-contention-with-the-atomic-package-ba3b2664b549" target="_blank" rel="noopener">Go: How to Reduce Lock Contention with the Atomic Package</a></li><li><a href="https://medium.com/a-journey-with-go/go-mutex-and-starvation-3f4f4e75ad50" target="_blank" rel="noopener">Go: Mutex and Starvation</a></li><li><a href="https://mojotv.cn/go/golang-muteex-starvation" target="_blank" rel="noopener">Go è¿›é˜¶ 27:Go è¯­è¨€ Mutex Starvation(è¯‘)</a></li><li><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-sync-primitives/" target="_blank" rel="noopener">Go è¯­è¨€è®¾è®¡ä¸å®ç°-6.2 åŒæ­¥åŸè¯­ä¸é”</a> è¿™æœ¬ä¹¦å€¼å¾—ä¸€çœ‹</li><li><a href="https://www.felixcloutier.com/x86/pause" target="_blank" rel="noopener">PAUSE â€” Spin Loop Hint</a></li><li><a href="https://github.com/freelancer-leon/notes/blob/master/kernel/lock/Lock-2-Linux_x86_Spin_Lock.md#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AF-pause-%E6%8C%87%E4%BB%A4" target="_blank" rel="noopener">Linux x86 è‡ªæ—‹é”çš„å®ç°</a></li><li><a href="https://github.com/golang/go/commit/0556e26273f704db73df9e7c4c3d2e8434dec7be" target="_blank" rel="noopener">https://github.com/golang/go/commit/0556e26273f704db73df9e7c4c3d2e8434dec7be</a></li></ol><h1 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h1><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</title>
    <link href="/post/go-training-week3-data-race.html"/>
    <url>/post/go-training-week3-data-race.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>åœ¨å‰ä¸¤ç¯‡æ–‡ç« å½“ä¸­æˆ‘ä»¬åå¤æåˆ°äº†è™½ç„¶åœ¨ go ä¸­ï¼Œå¹¶å‘ç¼–ç¨‹ååˆ†ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>go func()</code> å°±èƒ½å¯åŠ¨ä¸€ä¸ª goroutine å»åšä¸€äº›äº‹æƒ…ï¼Œä½†æ˜¯æ­£æ˜¯ç”±äºè¿™ç§ç®€å•æˆ‘ä»¬è¦ååˆ†å½“å¿ƒï¼Œä¸ç„¶å¾ˆå®¹æ˜“å‡ºç°ä¸€äº›è«åå…¶å¦™çš„ bug æˆ–è€…æ˜¯ä½ çš„æœåŠ¡ç”±äºä¸çŸ¥åçš„åŸå› å°±é‡å¯äº†ã€‚</p><h2 id="æ•°æ®ç«äº‰-data-race"><a href="#æ•°æ®ç«äº‰-data-race" class="headerlink" title="æ•°æ®ç«äº‰(data race)"></a>æ•°æ®ç«äº‰(data race)</h2><p>ä¹‹å‰æˆ‘ä»¬æåˆ°äº†å¾ˆå¤šæ¬¡åœ¨å¤šä¸ª goroutine å¯¹åŒä¸€ä¸ªå˜é‡çš„æ•°æ®è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ä¼šå‡ºç°å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œé‚£æˆ‘ä»¬æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•æ£€æµ‹å®ƒå‘¢ï¼Œé™¤äº†é€šè¿‡æˆ‘ä»¬èªæ˜çš„è„‘è¢‹ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯ data race tagï¼Œgo å®˜æ–¹æ—©åœ¨ 1.1 ç‰ˆæœ¬å°±å¼•å…¥äº†æ•°æ®ç«äº‰çš„æ£€æµ‹å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ‰§è¡Œæµ‹è¯•æˆ–è€…æ˜¯ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š <code>-race</code> çš„ flag å°±å¯ä»¥å¼€å¯æ•°æ®ç«äº‰çš„æ£€æµ‹</p><pre><code class="hljs go"><span class="hljs-keyword">go</span> test -race ./...<span class="hljs-keyword">go</span> build -race</code></pre><div style="background:#fffbe6;padding:10px;border:1px solid #c3c3c3;border-radius:5px;margin-bottom:5px">ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒ build çš„æ—¶å€™å¼€å¯æ•°æ®ç«äº‰æ£€æµ‹ï¼Œå› ä¸ºè¿™ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æŸå¤±(ä¸€èˆ¬å†…å­˜5-10å€ï¼Œæ‰§è¡Œæ—¶é—´2-20å€)ï¼Œå½“ç„¶ å¿…é¡»è¦ debug çš„æ—¶å€™é™¤å¤–ã€‚<br>å»ºè®®åœ¨æ‰§è¡Œå•å…ƒæµ‹è¯•æ—¶å§‹ç»ˆå¼€å¯æ•°æ®ç«äº‰çš„æ£€æµ‹ã€‚</div><h3 id="æ¡ˆä¾‹ä¸€"><a href="#æ¡ˆä¾‹ä¸€" class="headerlink" title="æ¡ˆä¾‹ä¸€"></a>æ¡ˆä¾‹ä¸€</h3><p>æˆ‘ä»¬æ¥ç›´æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ï¼Œè¿™æ˜¯æ¥è‡ªè¯¾ä¸Šçš„ä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯æˆ‘ç¨ç¨åšäº†ä¸€äº›æ”¹é€ ï¼Œæºä»£ç æ²¡æœ‰è·‘ 10w æ¬¡è¿™ä¸ªæ“ä½œï¼Œä¼šå¯¼è‡´çœ‹èµ·æ¥æ¯æ¬¡è·‘çš„ç»“æœéƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªæ¬¡æ•°æ”¾å¤§å°±å¯ä»¥å‘ç°æ¯æ¬¡ç»“æœéƒ½ä¼šä¸ä¸€æ ·</p><h4 id="æ­£å¸¸æ‰§è¡Œ"><a href="#æ­£å¸¸æ‰§è¡Œ" class="headerlink" title="æ­£å¸¸æ‰§è¡Œ"></a>æ­£å¸¸æ‰§è¡Œ</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"sync"</span>)<span class="hljs-keyword">var</span> wg sync.WaitGroup<span class="hljs-keyword">var</span> counter <span class="hljs-keyword">int</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// å¤šè·‘å‡ æ¬¡æ¥çœ‹ç»“æœ</span><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++ &#123;run()&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2</span>; i++ &#123;wg.Add(<span class="hljs-number">1</span>)<span class="hljs-keyword">go</span> routine(i)&#125;wg.Wait()fmt.Printf(<span class="hljs-string">"Final Counter: %d\n"</span>, counter)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">routine</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++ &#123;value := countervalue++counter = value&#125;wg.Done()&#125;</code></pre><p>æˆ‘æ‰§è¡Œäº†ä¸‰æ¬¡æ¯æ¬¡çš„ç»“æœéƒ½ä¸ä¸€è‡´ï¼Œåˆ†åˆ«æ˜¯:</p><pre><code class="hljs go">Final Counter: <span class="hljs-number">399996</span>Final Counter: <span class="hljs-number">399989</span>Final Counter: <span class="hljs-number">399988</span></code></pre><p>ä¸ºä»€ä¹ˆä¼šå¯¼è‡´è¿™æ ·çš„ç»“æœå‘¢ï¼Œæ˜¯å› ä¸ºæ¯ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨ <code>go routine(i)</code> å¯åŠ¨äº†ä¸¤ä¸ª goroutineï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æ§åˆ¶å®ƒçš„æ‰§è¡Œé¡ºåºï¼Œé‚£å°±æœ‰å¥½å‡ ç§å¯èƒ½äº†ï¼Œæˆ‘è¿™é‡Œæè¿°ä¸¤ç§æƒ…å†µ</p><ol><li>æ‰§è¡Œä¸€æ¬¡ <code>run()</code> , <code>counter + 4</code> è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ª goroutine å¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ‹¿åˆ°äº†ç¬¬ä¸€ä¸ª goroutine çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå°±æ˜¯ <code>value := counter</code> è¿™ä¸€æ­¥æ—¶ï¼Œvalue = 2</li><li>æ‰§è¡Œä¸€æ¬¡ <code>run()</code> , <code>counter + 2</code> è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ª goroutine å¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ²¡æœ‰æ‹¿åˆ°äº†ç¬¬ä¸€ä¸ª goroutine çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå°±æ˜¯ <code>value := counter</code> è¿™ä¸€æ­¥æ—¶ï¼Œcounter è¿˜æ˜¯é›¶å€¼ï¼Œè¿™æ—¶å€™ value = 0</li></ol><p>å½“ç„¶ç”±äºç§ç§ä¸ç¡®å®šæ€§ï¼Œæ‰€æœ‰è‚¯å®šä¸æ­¢è¿™ä¸¤ç§æƒ…å†µï¼Œä½†æ˜¯è¿™ä¸ªä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ï¼Œå…·ä½“çš„åŸå› å¯ä»¥ç»“åˆä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Go å¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a> è¿›è¡Œæ€è€ƒ</p><h4 id="data-race-æ‰§è¡Œ"><a href="#data-race-æ‰§è¡Œ" class="headerlink" title="data race æ‰§è¡Œ"></a>data race æ‰§è¡Œ</h4><p>å¯ä»¥å‘ç°ï¼Œå†™å‡ºè¿™ç§ä»£ç æ—¶ä¸Šçº¿åå¦‚æœå‡ºç° bug ä¼šéå¸¸éš¾å®šä½ï¼Œå› ä¸ºä½ ä¸çŸ¥é“åˆ°åº•æ˜¯å“ªé‡Œå‡ºç°äº†é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦åœ¨æµ‹è¯•é˜¶æ®µå°±ç»“åˆ data race å·¥å…·æå‰å‘ç°é—®é¢˜ã€‚<br>æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre><code class="hljs go"><span class="hljs-keyword">go</span> run -race ./main.<span class="hljs-keyword">go</span></code></pre><p>ä¼šå‘ç°ç»“æœä¼šæ‰€æœ‰çš„éƒ½è¾“å‡ºï¼Œ <code>data race</code> çš„æŠ¥é”™ä¿¡æ¯ï¼Œæˆ‘ä»¬å·²ç»çœ‹ä¸åˆ°äº†ï¼Œå› ä¸ºç»ˆç«¯çš„æ‰“å°çš„å¤ªé•¿äº†ï¼Œå¯ä»¥å‘ç°çš„æ˜¯ï¼Œæœ€åæ‰“å°å‡ºå‘ç°äº†ä¸€å¤„ data race å¹¶ä¸”æ¨å‡ºç ä¸º <code>66</code></p><pre><code class="hljs go">Final Counter: <span class="hljs-number">399956</span>Final Counter: <span class="hljs-number">399960</span>Found <span class="hljs-number">1</span> data race(s)exit status <span class="hljs-number">66</span></code></pre><h4 id="data-race-é…ç½®"><a href="#data-race-é…ç½®" class="headerlink" title="data race é…ç½®"></a>data race é…ç½®</h4><p>é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç«‹å³çŸ¥é“ data race çš„æŠ¥é”™å‘¢ï¼Ÿ<br>ç­”æ¡ˆå°±åœ¨å®˜æ–¹çš„æ–‡æ¡£å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® <code>GORACE</code> ç¯å¢ƒå˜é‡ï¼Œæ¥æ§åˆ¶ data race çš„è¡Œä¸ºï¼Œ æ ¼å¼å¦‚ä¸‹:</p><pre><code class="hljs go">GORACE=<span class="hljs-string">"option1=val1 option2=val2"</span></code></pre><p>å¯é€‰é…ç½®:</p><table><thead><tr><th><strong>é…ç½®</strong></th><th><strong>é»˜è®¤å€¼</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>log_path</td><td>stderr</td><td>æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œé™¤äº†æ–‡ä»¶è·¯å¾„å¤–æ”¯æŒ stderr, stdout è¿™ä¸¤ä¸ªç‰¹æ®Šå€¼</td></tr><tr><td>exitcode</td><td>66</td><td>é€€å‡ºç </td></tr><tr><td>strip_path_prefix</td><td>â€œâ€</td><td>ä»æ—¥å¿—ä¸­çš„æ–‡ä»¶ä¿¡æ¯é‡Œé¢å»é™¤ç›¸å…³çš„å‰ç¼€ï¼Œå¯ä»¥å»é™¤æœ¬åœ°ä¿¡æ¯ï¼ŒåŒæ—¶ä¼šæ›´å¥½çœ‹</td></tr><tr><td>history_size</td><td>1</td><td>per-goroutine å†…å­˜è®¿é—®å†å²è®°å½•ä¸º 32K * 2 ** history_sizeï¼Œå¢åŠ è¿™ä¸ªå¯ä»¥é¿å…å‡ºç°å †æ ˆè¿˜åŸå¤±è´¥çš„é”™è¯¯ï¼Œä½†æ˜¯å¢åŠ è¿™ä¸ªä¼šå¯¼è‡´ä½¿ç”¨çš„å†…å­˜ä¹Ÿè·Ÿç€å¢åŠ </td></tr><tr><td>halt_on_error</td><td>0</td><td>ç”¨æ¥æ§åˆ¶ç¬¬ä¸€ä¸ªæ•°æ®ç«äº‰é”™è¯¯å‡ºç°åæ˜¯å¦ç«‹å³é€€å‡º</td></tr><tr><td>atexit_sleep_ms</td><td>100</td><td>ç”¨æ¥æ§åˆ¶ main é€€å‡ºä¹‹å‰ sleep çš„æ—¶é—´</td></tr></tbody></table><p>æœ‰äº†è¿™ä¸ªèƒŒæ™¯çŸ¥è¯†åå°±å¾ˆç®€å•äº†ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶å‘ç°æ•°æ®ç«äº‰åç›´æ¥é€€å‡º</p><pre><code class="hljs go">GORACE=<span class="hljs-string">"halt_on_error=1 strip_path_prefix=/home/ll/project/Go-000/Week03/blog/03_sync/01_data_race"</span> <span class="hljs-keyword">go</span> run -race ./main.<span class="hljs-keyword">go</span></code></pre><p>é‡æ–°æ‰§è¡Œåæˆ‘ä»¬çš„ç»“æœ</p><pre><code class="hljs go">==================WARNING: DATA RACERead at <span class="hljs-number">0x00000064a9c0</span> by goroutine <span class="hljs-number">7</span>:  main.routine()      /main.<span class="hljs-keyword">go</span>:<span class="hljs-number">29</span> +<span class="hljs-number">0x47</span>Previous write at <span class="hljs-number">0x00000064a9c0</span> by goroutine <span class="hljs-number">8</span>:  main.routine()      /main.<span class="hljs-keyword">go</span>:<span class="hljs-number">31</span> +<span class="hljs-number">0x64</span>Goroutine <span class="hljs-number">7</span> (running) created at:  main.run()      /main.<span class="hljs-keyword">go</span>:<span class="hljs-number">21</span> +<span class="hljs-number">0x75</span>  main.main()      /main.<span class="hljs-keyword">go</span>:<span class="hljs-number">14</span> +<span class="hljs-number">0x38</span>Goroutine <span class="hljs-number">8</span> (finished) created at:  main.run()      /main.<span class="hljs-keyword">go</span>:<span class="hljs-number">21</span> +<span class="hljs-number">0x75</span>  main.main()      /main.<span class="hljs-keyword">go</span>:<span class="hljs-number">14</span> +<span class="hljs-number">0x38</span>==================exit status <span class="hljs-number">66</span></code></pre><p>è¿™ä¸ªç»“æœéå¸¸æ¸…æ™°çš„å‘Šè¯‰äº†æˆ‘ä»¬åœ¨ 29 è¡Œè¿™ä¸ªåœ°æ–¹æˆ‘ä»¬æœ‰ä¸€ä¸ª goroutine åœ¨è¯»å–æ•°æ®ï¼Œä½†æ˜¯å‘¢ï¼Œåœ¨ 31 è¡Œè¿™ä¸ªåœ°æ–¹åˆæœ‰ä¸€ä¸ª goroutine åœ¨å†™å…¥ï¼Œæ‰€ä»¥äº§ç”Ÿäº†æ•°æ®ç«äº‰ã€‚<br>ç„¶åä¸‹é¢åˆ†åˆ«è¯´æ˜è¿™ä¸¤ä¸ª goroutine æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼Œå·²ç»å½“å‰æ˜¯å¦åœ¨è¿è¡Œå½“ä¸­ã€‚</p><h3 id="å…¸å‹æ¡ˆä¾‹"><a href="#å…¸å‹æ¡ˆä¾‹" class="headerlink" title="å…¸å‹æ¡ˆä¾‹"></a>å…¸å‹æ¡ˆä¾‹</h3><p>æ¥æ¥ä¸‹æˆ‘ä»¬å†æ¥çœ‹ä¸€äº›å…¸å‹æ¡ˆä¾‹ï¼Œè¿™äº›æ¡ˆä¾‹éƒ½æ¥è‡ª go å®˜æ–¹çš„æ–‡æ¡£ <a href="https://golang.org/doc/articles/race_detector.html" target="_blank" rel="noopener">Data Race Detector</a>ï¼Œè¿™äº›ä¹Ÿæ˜¯åˆå­¦è€…å¾ˆå®¹æ˜“çŠ¯çš„é”™è¯¯</p><h4 id="æ¡ˆä¾‹äºŒ-åœ¨å¾ªç¯ä¸­å¯åŠ¨-goroutine-å¼•ç”¨ä¸´æ—¶å˜é‡"><a href="#æ¡ˆä¾‹äºŒ-åœ¨å¾ªç¯ä¸­å¯åŠ¨-goroutine-å¼•ç”¨ä¸´æ—¶å˜é‡" class="headerlink" title="æ¡ˆä¾‹äºŒ åœ¨å¾ªç¯ä¸­å¯åŠ¨ goroutine å¼•ç”¨ä¸´æ—¶å˜é‡"></a>æ¡ˆä¾‹äºŒ åœ¨å¾ªç¯ä¸­å¯åŠ¨ goroutine å¼•ç”¨ä¸´æ—¶å˜é‡</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> wg sync.WaitGroupwg.Add(<span class="hljs-number">5</span>)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;fmt.Println(i) <span class="hljs-comment">// Not the 'i' you are looking for.</span>wg.Done()&#125;()&#125;wg.Wait()&#125;</code></pre><p>å¦‚æœä½ å»æ‰¾ä¸€äº› go çš„é¢è¯•é¢˜ï¼Œè‚¯å®šèƒ½æ‰¾åˆ°ç±»ä¼¼çš„ä¾‹å­ï¼Œç„¶åä¼šé—®ä½ è¿™é‡Œä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ<br>å¸¸è§çš„ç­”æ¡ˆå°±æ˜¯ä¼šè¾“å‡º 5 ä¸ª 5ï¼Œå› ä¸ºåœ¨ for å¾ªç¯çš„ i++ ä¼šæ‰§è¡Œçš„å¿«ä¸€äº›ï¼Œæ‰€ä»¥åœ¨æœ€åæ‰“å°çš„ç»“æœéƒ½æ˜¯ 5<br>è¿™ä¸ªç­”æ¡ˆä¸èƒ½è¯´ä¸å¯¹ï¼Œå› ä¸ºçœŸçš„æ‰§è¡Œçš„è¯å¤§æ¦‚ç‡ä¹Ÿæ˜¯è¿™ä¸ªç»“æœï¼Œä½†æ˜¯ä¸å…¨<br>å› ä¸ºè¿™é‡Œæœ¬è´¨ä¸Šæ˜¯æœ‰æ•°æ®ç«äº‰ï¼Œåœ¨æ–°å¯åŠ¨çš„ goroutine å½“ä¸­è¯»å– i çš„å€¼ï¼Œåœ¨ main ä¸­å†™å…¥ï¼Œå¯¼è‡´å‡ºç°äº† data raceï¼Œè¿™ä¸ªç»“æœåº”è¯¥æ˜¯ä¸å¯é¢„çŸ¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½å‡å®š goroutine ä¸­ print å°±ä¸€å®šæ¯”å¤–é¢çš„ i++ æ…¢ï¼Œä¹ æƒ¯æ€§çš„åšè¿™ç§å‡è®¾åœ¨å¹¶å‘ç¼–ç¨‹ä¸­æ˜¯å¾ˆæœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜çš„</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> wg sync.WaitGroupwg.Add(<span class="hljs-number">5</span>)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>)</span></span> &#123;fmt.Println(i)wg.Done()&#125;(i)&#125;wg.Wait()&#125;</code></pre><p>è¿™ä¸ªè¦ä¿®æ”¹ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å°† i ä½œä¸ºå‚æ•°ä¼ å…¥å³å¯ï¼Œè¿™æ ·æ¯ä¸ª goroutine æ‹¿åˆ°çš„éƒ½æ˜¯æ‹·è´åçš„æ•°æ®</p><h4 id="æ¡ˆä¾‹ä¸‰-ä¸€ä¸å°å¿ƒå°±æŠŠå˜é‡å…±äº«äº†"><a href="#æ¡ˆä¾‹ä¸‰-ä¸€ä¸å°å¿ƒå°±æŠŠå˜é‡å…±äº«äº†" class="headerlink" title="æ¡ˆä¾‹ä¸‰ ä¸€ä¸å°å¿ƒå°±æŠŠå˜é‡å…±äº«äº†"></a>æ¡ˆä¾‹ä¸‰ ä¸€ä¸å°å¿ƒå°±æŠŠå˜é‡å…±äº«äº†</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> <span class="hljs-string">"os"</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;ParallelWrite([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"xxx"</span>))&#125;<span class="hljs-comment">// ParallelWrite writes data to file1 and file2, returns the errors.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ParallelWrite</span><span class="hljs-params">(data []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">chan</span> <span class="hljs-title">error</span></span> &#123;res := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> error, <span class="hljs-number">2</span>)f1, err := os.Create(<span class="hljs-string">"/tmp/file1"</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;res &lt;- err&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// This err is shared with the main goroutine,</span><span class="hljs-comment">// so the write races with the write below.</span>_, err = f1.Write(data)res &lt;- errf1.Close()&#125;()&#125;f2, err := os.Create(<span class="hljs-string">"/tmp/file2"</span>) <span class="hljs-comment">// The second conflicting write to err.</span><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;res &lt;- err&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;_, err = f2.Write(data)res &lt;- errf2.Close()&#125;()&#125;<span class="hljs-keyword">return</span> res&#125;</code></pre><p>æˆ‘ä»¬ä½¿ç”¨ <code>go run -race main.go</code> æ‰§è¡Œï¼Œå¯ä»¥å‘ç°è¿™é‡ŒæŠ¥é”™çš„åœ°æ–¹æ˜¯ï¼Œ19 è¡Œå’Œ 24 è¡Œï¼Œæœ‰ data raceï¼Œè¿™é‡Œä¸»è¦æ˜¯å› ä¸ºå…±äº«äº† err è¿™ä¸ªå˜é‡</p><pre><code class="hljs go">==================WARNING: DATA RACEWrite at <span class="hljs-number">0x00c0000a01a0</span> by goroutine <span class="hljs-number">7</span>:  main.ParallelWrite.func1()      /home/ll/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">03</span>_data_race/<span class="hljs-number">03</span>/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">19</span> +<span class="hljs-number">0x94</span>Previous write at <span class="hljs-number">0x00c0000a01a0</span> by main goroutine:  main.ParallelWrite()      /home/ll/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">03</span>_data_race/<span class="hljs-number">03</span>/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">24</span> +<span class="hljs-number">0x1dd</span>  main.main()      /home/ll/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">03</span>_data_race/<span class="hljs-number">03</span>/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">6</span> +<span class="hljs-number">0x84</span>Goroutine <span class="hljs-number">7</span> (running) created at:  main.ParallelWrite()      /home/ll/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">03</span>_data_race/<span class="hljs-number">03</span>/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">16</span> +<span class="hljs-number">0x336</span>  main.main()      /home/ll/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">03</span>_data_race/<span class="hljs-number">03</span>/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">6</span> +<span class="hljs-number">0x84</span>==================Found <span class="hljs-number">1</span> data race(s)exit status <span class="hljs-number">66</span></code></pre><p>ä¿®æ”¹çš„è¯åªéœ€è¦åœ¨ä¸¤ä¸ª goroutine ä¸­ä½¿ç”¨æ–°çš„ä¸´æ—¶å˜é‡å°±è¡Œäº†</p><pre><code class="hljs go">..._, err := f1.Write(data)..._, err := f2.Write(data)...</code></pre><p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½ä¼šæœ‰è¿™ä¸ªç–‘é—®ï¼Œåœ¨ 24 è¡Œä¸ä¹Ÿæ˜¯é‡æ–°èµ‹å€¼äº†ä¹ˆï¼Œä¸ºä»€ä¹ˆåœ¨è¿™é‡Œä¼šå’Œ 19 è¡Œäº§ç”Ÿ data race å‘¢ï¼Ÿ<br>è¿™æ˜¯ç”±äº go çš„è¯­æ³•è§„åˆ™å¯¼è‡´çš„ï¼Œæˆ‘ä»¬åœ¨åˆå§‹åŒ–å˜é‡çš„æ—¶å€™å¦‚æœåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ï¼Œå¦‚ä¸‹æ–¹ä»£ç ï¼Œè¿™é‡Œä½¿ç”¨çš„ err å…¶å®æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯ f1 f2 ä¸åŒï¼Œå…·ä½“å¯ä»¥çœ‹ <a href="https://golang.org/doc/effective_go.html#redeclaration" target="_blank" rel="noopener">effective go å½“ä¸­ Redeclaration and reassignment</a> çš„å†…å®¹</p><pre><code class="hljs go">f1, err := os.Create(<span class="hljs-string">"a"</span>)f2, err := os.Create(<span class="hljs-string">"b"</span>)</code></pre><h4 id="æ¡ˆä¾‹å››-ä¸å—ä¿æŠ¤çš„å…¨å±€å˜é‡"><a href="#æ¡ˆä¾‹å››-ä¸å—ä¿æŠ¤çš„å…¨å±€å˜é‡" class="headerlink" title="æ¡ˆä¾‹å›› ä¸å—ä¿æŠ¤çš„å…¨å±€å˜é‡"></a>æ¡ˆä¾‹å›› ä¸å—ä¿æŠ¤çš„å…¨å±€å˜é‡</h4><pre><code class="hljs go"><span class="hljs-keyword">var</span> service = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>&#123;&#125;<span class="hljs-comment">// RegisterService RegisterService</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RegisterService</span><span class="hljs-params">(name, addr <span class="hljs-keyword">string</span>)</span></span> &#123;service[name] = addr&#125;<span class="hljs-comment">// LookupService LookupService</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LookupService</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> service[name]&#125;</code></pre><p>è¿™ä¸ªä¹Ÿæ˜¯å¾ˆå®¹æ˜“çŠ¯çš„ä¸€ä¸ªé”™ï¼Œåœ¨ä¹‹å‰å†™ Go è®¾è®¡æ¨¡å¼è¿™ä¸ªç³»åˆ—æ–‡ç« çš„æ—¶å€™ï¼Œåº”è¯¥æœ‰æåˆ°è¿‡æˆ‘ä»¬è¦å†™å‡ºå¯æµ‹æ€§æ¯”è¾ƒé«˜çš„ä»£ç å°±è¦å°‘ç”¨æˆ–è€…æ˜¯å°½é‡é¿å…ç”¨å…¨å±€å˜é‡ï¼Œä½¿ç”¨ map ä½œä¸ºå…¨å±€å˜é‡æ¯”è¾ƒå¸¸è§çš„ä¸€ç§æƒ…å†µå°±æ˜¯é…ç½®ä¿¡æ¯ã€‚å…³äºå…¨å±€å˜é‡çš„è¯ä¸€èˆ¬çš„åšæ³•å°±æ˜¯åŠ é”ï¼Œå°±æœ¬æ–‡è¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨ sync.Map è¿™ä¸ªä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè®²ï¼Œè¿™é‡Œç¯‡å¹…æœ‰é™å°±ä¸å¤šè®²äº†</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> (service   <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>serviceMu sync.Mutex)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RegisterService</span><span class="hljs-params">(name, addr <span class="hljs-keyword">string</span>)</span></span> &#123;serviceMu.Lock()<span class="hljs-keyword">defer</span> serviceMu.Unlock()service[name] = addr&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LookupService</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> &#123;serviceMu.Lock()<span class="hljs-keyword">defer</span> serviceMu.Unlock()<span class="hljs-keyword">return</span> service[name]&#125;</code></pre><h4 id="æ¡ˆä¾‹äº”-æœªå—ä¿æŠ¤çš„æˆå‘˜å˜é‡"><a href="#æ¡ˆä¾‹äº”-æœªå—ä¿æŠ¤çš„æˆå‘˜å˜é‡" class="headerlink" title="æ¡ˆä¾‹äº” æœªå—ä¿æŠ¤çš„æˆå‘˜å˜é‡"></a>æ¡ˆä¾‹äº” æœªå—ä¿æŠ¤çš„æˆå‘˜å˜é‡</h4><pre><code class="hljs go"><span class="hljs-keyword">type</span> Watchdog <span class="hljs-keyword">struct</span>&#123; last <span class="hljs-keyword">int64</span> &#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Watchdog)</span> <span class="hljs-title">KeepAlive</span><span class="hljs-params">()</span></span> &#123;w.last = time.Now().UnixNano() <span class="hljs-comment">// First conflicting access.</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Watchdog)</span> <span class="hljs-title">Start</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> &#123;time.Sleep(time.Second)<span class="hljs-comment">// Second conflicting access.</span><span class="hljs-keyword">if</span> w.last &lt; time.Now().Add(<span class="hljs-number">-10</span>*time.Second).UnixNano() &#123;fmt.Println(<span class="hljs-string">"No keepalives for 10 seconds. Dying."</span>)os.Exit(<span class="hljs-number">1</span>)&#125;&#125;&#125;()&#125;</code></pre><p>åŒæ ·æˆå‘˜å˜é‡ä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œå¯ä»¥ç”¨ <code>atomic</code> åŒ…æ¥è§£å†³ï¼ŒåŒæ ·è¿™ä¸ªæˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« ä¼šç»†è®²</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Watchdog <span class="hljs-keyword">struct</span>&#123; last <span class="hljs-keyword">int64</span> &#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Watchdog)</span> <span class="hljs-title">KeepAlive</span><span class="hljs-params">()</span></span> &#123;atomic.StoreInt64(&amp;w.last, time.Now().UnixNano())&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Watchdog)</span> <span class="hljs-title">Start</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> &#123;time.Sleep(time.Second)<span class="hljs-keyword">if</span> atomic.LoadInt64(&amp;w.last) &lt; time.Now().Add(<span class="hljs-number">-10</span>*time.Second).UnixNano() &#123;fmt.Println(<span class="hljs-string">"No keepalives for 10 seconds. Dying."</span>)os.Exit(<span class="hljs-number">1</span>)&#125;&#125;&#125;()&#125;</code></pre><h3 id="æ¡ˆä¾‹å…­-ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­"><a href="#æ¡ˆä¾‹å…­-ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­" class="headerlink" title="æ¡ˆä¾‹å…­ ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­"></a>æ¡ˆä¾‹å…­ ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­</h3><p>dava åœ¨åšå®¢ä¸­æåˆ°è¿‡ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ä¾‹å­çš„ <a href="https://dave.cheney.net/2014/06/27/ice-cream-makers-and-data-races" target="_blank" rel="noopener">Ice cream makers and data races</a></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-keyword">type</span> IceCreamMaker <span class="hljs-keyword">interface</span> &#123;<span class="hljs-comment">// Great a customer.</span>Hello()&#125;<span class="hljs-keyword">type</span> Ben <span class="hljs-keyword">struct</span> &#123;name <span class="hljs-keyword">string</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *Ben)</span> <span class="hljs-title">Hello</span><span class="hljs-params">()</span></span> &#123;fmt.Printf(<span class="hljs-string">"Ben says, \"Hello my name is %s\"\n"</span>, b.name)&#125;<span class="hljs-keyword">type</span> Jerry <span class="hljs-keyword">struct</span> &#123;name <span class="hljs-keyword">string</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(j *Jerry)</span> <span class="hljs-title">Hello</span><span class="hljs-params">()</span></span> &#123;fmt.Printf(<span class="hljs-string">"Jerry says, \"Hello my name is %s\"\n"</span>, j.name)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> ben = &amp;Ben&#123;name: <span class="hljs-string">"Ben"</span>&#125;<span class="hljs-keyword">var</span> jerry = &amp;Jerry&#123;<span class="hljs-string">"Jerry"</span>&#125;<span class="hljs-keyword">var</span> maker IceCreamMaker = ben<span class="hljs-keyword">var</span> loop0, loop1 <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>loop0 = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;maker = ben<span class="hljs-keyword">go</span> loop1()&#125;loop1 = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;maker = jerry<span class="hljs-keyword">go</span> loop0()&#125;<span class="hljs-keyword">go</span> loop0()<span class="hljs-keyword">for</span> &#123;maker.Hello()&#125;&#125;</code></pre><p>è¿™ä¸ªä¾‹å­æœ‰è¶£çš„ç‚¹åœ¨äºï¼Œæœ€åè¾“å‡ºçš„ç»“æœä¼šæœ‰è¿™ç§ä¾‹å­</p><pre><code class="hljs go">Ben says, <span class="hljs-string">"Hello my name is Jerry"</span>Ben says, <span class="hljs-string">"Hello my name is Jerry"</span></code></pre><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ <code>maker = jerry</code> è¿™ç§èµ‹å€¼æ“ä½œçš„æ—¶å€™å¹¶ä¸æ˜¯åŸå­çš„ï¼Œåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è®²åˆ°è¿‡ï¼Œåªæœ‰å¯¹ single machine word è¿›è¡Œèµ‹å€¼çš„æ—¶å€™æ‰æ˜¯åŸå­çš„ï¼Œè™½ç„¶è¿™ä¸ªçœ‹ä¸Šå»åªæœ‰ä¸€è¡Œï¼Œä½†æ˜¯ interface åœ¨ go ä¸­å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®ƒåŒ…å«äº† type å’Œ data ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒçš„å¤åˆ¶ä¹Ÿä¸æ˜¯åŸå­çš„ï¼Œä¼šå‡ºç°é—®é¢˜</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> <span class="hljs-keyword">interface</span> <span class="hljs-keyword">struct</span> &#123;       Type <span class="hljs-keyword">uintptr</span>     <span class="hljs-comment">// points to the type of the interface implementation</span>       Data <span class="hljs-keyword">uintptr</span>     <span class="hljs-comment">// holds the data for the interface's receiver</span>&#125;</code></pre><p>è¿™ä¸ªæ¡ˆä¾‹æœ‰è¶£çš„ç‚¹è¿˜åœ¨äºï¼Œè¿™ä¸ªæ¡ˆä¾‹çš„ä¸¤ä¸ªç»“æ„ä½“çš„å†…å­˜å¸ƒå±€ä¸€æ¨¡ä¸€æ ·æ‰€ä»¥å‡ºç°é”™è¯¯ä¹Ÿä¸ä¼š panic é€€å‡ºï¼Œå¦‚æœåœ¨é‡Œé¢å†åŠ å…¥ä¸€ä¸ª string çš„å­—æ®µï¼Œå»è¯»å–å°±ä¼šå¯¼è‡´ panicï¼Œä½†æ˜¯è¿™ä¹Ÿæ°æ°è¯´æ˜è¿™ä¸ªæ¡ˆä¾‹å¾ˆå¯æ€•ï¼Œè¿™ç§é”™è¯¯åœ¨çº¿ä¸Šå®åœ¨å¤ªéš¾å‘ç°äº†ï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½ä¼šå¾ˆè‡´å‘½ã€‚<br>è¿™ä¸ªæ¡ˆä¾‹è¿˜æœ‰ä¸€ä¸ªè¡ç”Ÿæ¡ˆä¾‹ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥ç‚¹å¼€æŸ¥çœ‹ä¸€ä¸‹ï¼Œå¹¶ä¸æ˜¯è¯´è¦çœ‹èµ·æ¥ä¸€æ ·æ‰ä¸ä¼š panic <a href="https://www.ardanlabs.com/blog/2014/06/ice-cream-makers-and-data-races-part-ii.html" target="_blank" rel="noopener">https://www.ardanlabs.com/blog/2014/06/ice-cream-makers-and-data-races-part-ii.html</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å›é¡¾ä¸€ä¸‹ï¼Œè¿™ç¯‡æ–‡ç« é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹è®²è§£äº† data race çš„ä½¿ç”¨æ–¹æ³•:</p><pre><code class="hljs go"><span class="hljs-keyword">go</span> build -race main.<span class="hljs-keyword">go</span><span class="hljs-keyword">go</span> test -race ./...</code></pre><p>ç„¶åè®²è¿°äº† data race å¦‚ä½•é€šè¿‡ GORACE ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®<br>æœ€åè®²è§£äº†å‡ ä¸ªå…¸å‹æ¡ˆä¾‹ï¼Œçœ‹å®Œè¿™ç¯‡ç›¸ä¿¡ä½ å¯¹ data race å·²ç»æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ï¼Œå¸Œæœ›å¯ä»¥åœ¨æ¥ä¸‹æ¥çš„å·¥ä½œå­¦ä¹ å½“ä¸­å¯¹ä½ æœ‰æœ‰æ‰€å¯å‘<br>æœ€ååœ¨é‡ç”³ä¸€ä¸‹å…³é”®ç‚¹ï¼š</p><ul><li>å–„ç”¨ data race è¿™ä¸ªå·¥å…·å¸®åŠ©æˆ‘ä»¬æå‰å‘ç°å¹¶å‘é”™è¯¯</li><li>ä¸è¦å¯¹æœªå®šä¹‰çš„è¡Œä¸ºåšä»»ä½•å‡è®¾ï¼Œè™½ç„¶æœ‰æ—¶å€™æˆ‘ä»¬å†™çš„åªæ˜¯ä¸€è¡Œä»£ç ï¼Œä½†æ˜¯ go ç¼–è¯‘å™¨å¯èƒ½åé¢åäº†å¾ˆå¤šäº‹æƒ…ï¼Œå¹¶ä¸æ˜¯è¯´ä¸€è¡Œå†™å®Œå°±ä¸€å®šæ˜¯åŸå­çš„</li><li>å³ä½¿æ˜¯åŸå­çš„å‡ºç°äº† data race ä¹Ÿä¸èƒ½ä¿è¯å®‰å…¨ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æœ‰å¯è§æ€§çš„é—®é¢˜ï¼Œä¸Šç¯‡æˆ‘ä»¬è®²åˆ°äº†ç°ä»£çš„ cpu åŸºæœ¬ä¸Šéƒ½ä¼šæœ‰ä¸€äº›ç¼“å­˜çš„æ“ä½œã€‚</li><li>æ‰€æœ‰å‡ºç°äº† data race çš„åœ°æ–¹éƒ½éœ€è¦è¿›è¡Œå¤„ç†</li></ul><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul><li><a href="https://dave.cheney.net/2014/06/27/ice-cream-makers-and-data-races" target="_blank" rel="noopener">https://dave.cheney.net/2014/06/27/ice-cream-makers-and-data-races</a></li><li><a href="https://www.ardanlabs.com/blog/2014/06/ice-cream-makers-and-data-races-part-ii.html" target="_blank" rel="noopener">https://www.ardanlabs.com/blog/2014/06/ice-cream-makers-and-data-races-part-ii.html</a></li><li><a href="http://blog.golang.org/race-detector" target="_blank" rel="noopener">http://blog.golang.org/race-detector</a></li><li><a href="https://golang.org/doc/articles/race_detector.html" target="_blank" rel="noopener">https://golang.org/doc/articles/race_detector.html</a></li><li><a href="https://dave.cheney.net/2018/01/06/if-aligned-memory-writes-are-atomic-why-do-we-need-the-sync-atomic-package" target="_blank" rel="noopener">https://dave.cheney.net/2018/01/06/if-aligned-memory-writes-are-atomic-why-do-we-need-the-sync-atomic-package</a> é™¤äº†è€ƒè™‘åŸå­æ€§ä¹‹å¤–ï¼Œè¿˜è¦è€ƒè™‘å¯è§æ€§ï¼Œå¹¶ä¸æ˜¯è¯´èµ‹å€¼åŸå­äº†ï¼Œå¹¶å‘æ“ä½œå°±æ²¡æœ‰é—®é¢˜äº†</li><li><a href="https://golang.org/doc/effective_go.html#redeclaration" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#redeclaration</a></li></ul><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li><li><a href="https://lailin.xyz/post/go-training-03.html">Week02: Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>Goè¿›é˜¶è®­ç»ƒè¥</category>
      
      <category>Goå¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>Goè¿›é˜¶è®­ç»ƒè¥</tag>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</title>
    <link href="/post/go-training-week3-go-memory-model.html"/>
    <url>/post/go-training-week3-go-memory-model.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å½“ä¸­æˆ‘ä»¬è®²åˆ°äº†ä½¿ç”¨ goroutine çš„ä¸€äº›æ³¨æ„äº‹é¡¹ï¼Œæˆ‘ä»¬å…ˆç®€å•å›é¡¾ä¸€ä¸‹:</p><ol><li><strong>è¯·å°†æ˜¯å¦å¼‚æ­¥è°ƒç”¨çš„é€‰æ‹©æƒäº¤ç»™è°ƒç”¨è€…</strong>ï¼Œä¸ç„¶å¾ˆæœ‰å¯èƒ½å¤§å®¶å¹¶ä¸çŸ¥é“ä½ åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ä½¿ç”¨äº† goroutine</li><li>å¦‚æœä½ è¦å¯åŠ¨ä¸€ä¸ª goroutine è¯·å¯¹å®ƒè´Ÿè´£<ol><li><strong>æ°¸è¿œä¸è¦å¯åŠ¨ä¸€ä¸ªä½ æ— æ³•æ§åˆ¶å®ƒé€€å‡ºï¼Œæˆ–è€…ä½ æ— æ³•çŸ¥é“å®ƒä½•æ—¶æ¨å‡ºçš„ goroutine</strong></li><li>è¿˜æœ‰ä¸Šä¸€ç¯‡æåˆ°çš„ï¼Œå¯åŠ¨ goroutine æ—¶è¯·åŠ ä¸Š panic recovery æœºåˆ¶ï¼Œé¿å…æœåŠ¡ç›´æ¥ä¸å¯ç”¨</li><li>é€ æˆ goroutine æ³„æ¼çš„ä¸»è¦åŸå› å°±æ˜¯ goroutine ä¸­é€ æˆäº†é˜»å¡ï¼Œå¹¶ä¸”æ²¡æœ‰å¤–éƒ¨æ‰‹æ®µæ§åˆ¶å®ƒé€€å‡º</li></ol></li><li><strong>å°½é‡é¿å…åœ¨è¯·æ±‚ä¸­ç›´æ¥å¯åŠ¨ goroutine æ¥å¤„ç†é—®é¢˜</strong>ï¼Œè€Œåº”è¯¥é€šè¿‡å¯åŠ¨ worker æ¥è¿›è¡Œæ¶ˆè´¹ï¼Œè¿™æ ·å¯ä»¥é¿å…ç”±äºè¯·æ±‚é‡è¿‡å¤§ï¼Œè€Œå¯¼è‡´å¤§é‡åˆ›å»º goroutine ä»è€Œå¯¼è‡´ oomï¼Œå½“ç„¶å¦‚æœè¯·æ±‚é‡æœ¬èº«éå¸¸å°ï¼Œé‚£å½“æˆ‘æ²¡è¯´</li></ol><p>é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆä½¿ç”¨ goroutine å‘¢ï¼Ÿä»Šå¤©æˆ‘ä»¬ä»åŸç†å±‚é¢æ¥äº†è§£ä¸€ä¸‹ goroutine çš„æ³¨æ„äº‹é¡¹ï¼Œæœ¬æ–‡ä»¥ Go å®˜æ–¹åšå®¢å½“ä¸­çš„ <a href="https://golang.org/ref/mem" target="_blank" rel="noopener">https://golang.org/ref/mem</a> ä¸ºä¸»å¹²ç©¿æ’è®²è§£ï¼Œå»ºè®®é˜…è¯»æœ¬æ–‡å‰å…ˆè‡ªè¡Œçœ‹å®Œä¸€éåŸæ–‡ï¼Œä¼šæœ‰æ›´å¤šçš„æ”¶è·</p><h2 id="Go-å†…å­˜æ¨¡å‹"><a href="#Go-å†…å­˜æ¨¡å‹" class="headerlink" title="Go å†…å­˜æ¨¡å‹"></a>Go å†…å­˜æ¨¡å‹</h2><p>åŒæ ·æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼Œè¯·é—®ä¸‹é¢çš„ä»£ç å¯èƒ½ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">var</span> a, b <span class="hljs-keyword">int</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span> &#123;a = <span class="hljs-number">1</span>b = <span class="hljs-number">2</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">g</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-built_in">print</span>(b)<span class="hljs-built_in">print</span>(a)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">go</span> f()g()&#125;</code></pre><p>okï¼Œè¯·å¸¦ç€ä½ çš„ç­”æ¡ˆæˆ–è€…æ˜¯å›°æƒ‘æˆ‘ä»¬å¾€ä¸‹èµ°<br><img src="https://lailin.xyz/images/1608363233129-3653a44c-74a9-46dc-94b0-c6151da0c07c.svg" srcset="/img/loading.gif" alt="02_Goè¿›é˜¶03_blog_img.drawio.svg"><br>æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„ç»“æœæ˜¯:</p><ul><li>æ‰§è¡Œé¡ºåº: 1 - 2 - 3 - 4, f å…ˆæ‰§è¡Œ, g åæ‰§è¡Œ, è¾“å‡º <code>2 1</code></li><li>æ‰§è¡Œé¡ºåº: 3 - 4 - 1 - 2, g å…ˆæ‰§è¡Œï¼Œf åæ‰§è¡Œï¼Œè¾“å‡º <code>0 0</code></li></ul><p>å°±è¿™å‡ ç§ç»“æœä¹ˆï¼Ÿå…¶å®ä¸ç„¶ï¼Œè¿˜æœ‰å¯èƒ½</p><ul><li>æ‰§è¡Œé¡ºåº: 1 - 3 - 4 - 2, <code>f</code> å…ˆæ‰§è¡Œä¸€éƒ¨åˆ†, ç„¶å <code>g</code> æ‰§è¡Œ, è¾“å‡º <code>0 1</code></li></ul><p>é‚£èƒ½ä¸èƒ½è¾“å‡º <code>2 0</code> å‘¢ï¼Ÿ</p><ul><li>å…ˆè¯´ç­”æ¡ˆï¼Œæ˜¯æœ‰å¯èƒ½çš„</li></ul><p>æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹åå¸¸è¯†ï¼Ÿæ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹é£˜å¿½ä¸å®šï¼Ÿå¼•ç”¨å‚è€ƒæ–‡ç« é‡Œé¢æ›¹å¤§çš„ä¸€å¥è¯ï¼š</p><blockquote><p>è½¯ä»¶(<em>ç¼–è¯‘å™¨</em>)æˆ–ç¡¬ä»¶(<em>CPU</em>)ç³»ç»Ÿå¯ä»¥æ ¹æ®å…¶å¯¹ä»£ç çš„åˆ†æç»“æœï¼Œä¸€å®šç¨‹åº¦ä¸Šæ‰“ä¹±ä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œä»¥è¾¾åˆ°å…¶ä¸å¯å‘Šäººçš„ç›®çš„(<em>æé«˜ CPU åˆ©ç”¨ç‡)</em></p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–å†™å¹¶å‘ç¨‹åºçš„æ—¶å€™ä¸€å®šè¦å°å¿ƒï¼Œç„¶åå›åˆ°æˆ‘ä»¬æœ¬æ¬¡çš„ä¸»é¢˜ Go å†…å­˜æ¨¡å‹ï¼Œå°±æ˜¯è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯è¦äº†è§£è°å…ˆè°åï¼Œæœ‰ä¸ªä¸“æœ‰åè¯å« <code>Happens Before</code> ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯äº†è§£å¯è§æ€§çš„é—®é¢˜ï¼Œæˆ‘è¿™æ¬¡è¯»å–èƒ½ä¸èƒ½çœ‹åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„å†™å…¥<br>æ¥ä¸‹æ¥æˆ‘ä»¬å®˜æ–¹çš„æ–‡æ¡£<a href="https://golang.org/ref/mem" target="_blank" rel="noopener">ã€ŠThe Go Memory Modelã€‹</a>çš„æ€è·¯ä¸€æ­¥ä¸€æ­¥çš„äº†è§£è¿™äº›é—®é¢˜ï¼Œå› ä¸ºå®˜æ–¹çš„æ–‡æ¡£å†™çš„ç›¸å¯¹æ¯”è¾ƒç²¾ç‚¼ï¼Œæ‰€ä»¥ä¼šæ¯”è¾ƒéš¾æ‡‚ï¼Œæˆ‘ä¼šå°è¯•åŠ å…¥ä¸€äº›æˆ‘çš„ç†è§£è¡¥å……è¯´æ˜</p><h3 id="å¿ å‘Š"><a href="#å¿ å‘Š" class="headerlink" title="å¿ å‘Š"></a>å¿ å‘Š</h3><blockquote><p>Programs that modify data being simultaneously accessed by multiple goroutines must serialize such access.<br>To serialize access, protect the data with channel operations or other synchronization primitives such as those in the <a href="https://golang.org/pkg/sync/" target="_blank" rel="noopener"><code>sync</code></a> and <a href="https://golang.org/pkg/sync/atomic/" target="_blank" rel="noopener"><code>sync/atomic</code></a> packages.</p></blockquote><p>è¿™ä¸ªæ˜¯è¯´å¦‚æœä½ çš„ç¨‹åºå­˜åœ¨å¤šä¸ª goroutine å»è®¿é—®æ•°æ®çš„æ—¶å€™ï¼Œ<strong>å¿…é¡»åºåˆ—åŒ–çš„è®¿é—®ï¼Œ</strong>å¦‚ä½•ä¿è¯åºåˆ—åŒ–å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ channel æˆ–è€…æ˜¯ sync ä»¥åŠ sync/atomic ä¸‹é¢æä¾›çš„åŒæ­¥è¯­ä¹‰æ¥ä¿è¯</p><h3 id="Happens-Before"><a href="#Happens-Before" class="headerlink" title="Happens Before"></a>Happens Before</h3><h4 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h4><blockquote><p>Within a single goroutine, reads and writes must behave as if they executed in the order specified by the program. That is, compilers and processors may reorder the reads and writes executed within a single goroutine only when the reordering does not change the behavior within that goroutine as defined by the language specification. Because of this reordering, the execution order observed by one goroutine may differ from the order perceived by another. For example, if one goroutine executes a = 1; b = 2;, another might observe the updated value of b before the updated value of a.</p></blockquote><p>è¿™æ®µè¯å°±è§£é‡Šäº†ä¸Šé¢æˆ‘ä»¬ç¤ºä¾‹å½“ä¸­ä¸ºä»€ä¹ˆä¼šå‡ºç° <code>2 0</code> è¿™ç§æƒ…å†µã€‚<br>è¿™æ®µè¯å°±æ˜¯è¯´æˆ‘ä»¬åœ¨å•ä¸ª goroutine å½“ä¸­çš„ç¼–å†™çš„ä»£ç ä¼šæ€»æ˜¯æŒ‰ç…§æˆ‘ä»¬ç¼–å†™ä»£ç çš„é¡ºåºæ¥æ‰§è¡Œ</p><ul><li>å½“ç„¶è¿™ä¸ªä¹Ÿæ˜¯ç¬¦åˆæˆ‘ä»¬çš„ä¹ æƒ¯çš„</li><li>å½“ç„¶è¿™å¹¶ä¸è¡¨ç¤ºç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸ä¼šå¯¹æˆ‘ä»¬çš„ç¨‹åºè¿›è¡ŒæŒ‡ä»¤é‡æ’</li><li>è€Œæ˜¯è¯´åªä¼šåœ¨ä¸å½±å“è¯­è¨€è§„èŒƒå¯¹ goroutine çš„è¡Œä¸ºå®šä¹‰çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å’Œ CPU æ‰ä¼šå¯¹è¯»å–å’Œå†™å…¥çš„é¡ºåºè¿›è¡Œé‡æ–°æ’åºã€‚</li></ul><p>ä½†æ˜¯æ­£æ˜¯å› ä¸ºå­˜åœ¨è¿™ç§é‡æ’çš„æƒ…å†µï¼Œæ‰€ä»¥ä¸€ä¸ª goroutine ç›‘æµ‹åˆ°çš„æ‰§è¡Œé¡ºåºå’Œå¦å¤–ä¸€ä¸ª goroutine ç›‘æµ‹åˆ°çš„æœ‰å¯èƒ½ä¸ä¸€æ ·ã€‚å°±åƒæˆ‘ä»¬æœ€ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸€æ ·ï¼Œå¯èƒ½æˆ‘ä»¬åœ¨ f æ‰§è¡Œçš„é¡ºåºæ˜¯å…ˆæ‰§è¡Œ <code>a = 1</code> åæ‰§è¡Œ <code>b = 2</code> ä½†æ˜¯åœ¨ g ä¸­æˆ‘ä»¬åªçœ‹åˆ°äº† b = 2 å…·ä½“ä»€ä¹ˆæƒ…å†µå¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªå‘¢ï¼Ÿä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬åé¢è¿˜ä¼šè¯´åˆ°</p><h4 id="ç¼–è¯‘å™¨é‡æ’"><a href="#ç¼–è¯‘å™¨é‡æ’" class="headerlink" title="ç¼–è¯‘å™¨é‡æ’"></a>ç¼–è¯‘å™¨é‡æ’</h4><p>æˆ‘ä»¬æ¥çœ‹å‚è€ƒæ–‡ç« ä¸­çš„ä¸€ä¸ªç¼–è¯‘å™¨é‡æ’ä¾‹å­</p><pre><code class="hljs go">X = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> i in <span class="hljs-keyword">range</span>(<span class="hljs-number">100</span>):    X = <span class="hljs-number">1</span>    <span class="hljs-built_in">print</span> X</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒX = 1 åœ¨ for å¾ªç¯å†…éƒ¨è¢«é‡å¤èµ‹å€¼äº† 100 æ¬¡ï¼Œè¿™å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œäºæ˜¯èªæ˜çš„ç¼–è¯‘å™¨å°±ä¼šå¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–æˆä¸‹é¢çš„æ ·å­</p><pre><code class="hljs go">X = <span class="hljs-number">1</span><span class="hljs-keyword">for</span> i in <span class="hljs-keyword">range</span>(<span class="hljs-number">100</span>):    <span class="hljs-built_in">print</span> X</code></pre><p>å®Œç¾ï¼Œåœ¨å•ä¸ª goroutine ä¸­å¹¶ä¸ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œï¼Œè¿™æ—¶å€™åŒæ ·ä¼šè¾“å‡º 100 æ¬¡ 1 ï¼Œå¹¶ä¸”å‡å°‘äº† 100 æ¬¡èµ‹å€¼æ“ä½œã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœä¸æ­¤åŒæ—¶æˆ‘ä»¬å­˜åœ¨ä¸€ä¸ªå¦å¤–ä¸€ä¸ª goroutine å¹²äº†å¦å¤–ä¸€ä¸ªäº‹æƒ… X = 0 é‚£ä¹ˆï¼Œè¿™ä¸ªè¾“å‡ºå°±å˜çš„ä¸å¯é¢„çŸ¥äº†ï¼Œå°±æœ‰å¯èƒ½æ˜¯ 1001111101â€¦ è¿™ç§ï¼Œæ‰€ä»¥å›åˆ°åˆšå¼€å§‹çš„å¿ å‘Šï¼š<strong>è¿™ä¸ªæ˜¯è¯´å¦‚æœä½ çš„ç¨‹åºå­˜åœ¨å¤šä¸ª goroutine å»è®¿é—®æ•°æ®çš„æ—¶å€™ï¼Œå¿…é¡»åºåˆ—åŒ–çš„è®¿é—®</strong></p><h4 id="happens-before-å®šä¹‰"><a href="#happens-before-å®šä¹‰" class="headerlink" title="happens before å®šä¹‰"></a>happens before å®šä¹‰</h4><blockquote><p>To specify the requirements of reads and writes, we define happens before, a partial order on the execution of memory operations in a Go program. If event <code>e1</code> happens before event <code>e2</code>, then we say that <code>e2</code> happens after <code>e1</code>. Also, if <code>e1</code> does not happen before <code>e2</code> and does not happen after <code>e2</code>, then we say that <code>e1</code> and <code>e2</code> happen concurrently.</p></blockquote><p>è¿™æ˜¯ Happens Before çš„å®šä¹‰ï¼Œå¦‚æœ <code>e1</code> å‘ç”Ÿåœ¨ <code>e2</code> ä¹‹å‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´ <code>e2</code> å‘ç”Ÿåœ¨ <code>e1</code> ä¹‹åï¼Œå¦‚æœ <code>e1</code> æ—¢ä¸åœ¨ <code>e2</code> å‰ï¼Œä¹Ÿä¸åœ¨ <code>e2</code> ä¹‹åï¼Œé‚£æˆ‘ä»¬å°±è¯´è¿™ä¿©æ˜¯å¹¶å‘çš„</p><blockquote><p>Within a single goroutine, the happens-before order is the order expressed by the program.</p></blockquote><p>è¿™å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„ï¼Œåœ¨å•ä¸ª goroutine å½“ä¸­ï¼Œäº‹ä»¶å‘ç”Ÿçš„é¡ºåºï¼Œå°±æ˜¯ç¨‹åºæ‰€è¡¨è¾¾çš„é¡ºåº</p><blockquote><p>A read r of a variable <code>v</code> is allowed to observe a write <code>w</code> to <code>v</code> if both of the following hold:</p><ol><li>r does not happen before <code>w</code>.</li><li>There is no other write <code>w&#39;</code> to <code>v</code> that happens after w but before <code>r</code>.</li></ol></blockquote><p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå˜é‡ <code>v</code>ï¼Œç„¶ååªè¦æ»¡è¶³ä¸‹é¢çš„ä¸¤ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆè¯»å–æ“ä½œ <code>r</code> å°±å¯ä»¥å¯¹è¿™ä¸ªå˜é‡ <code>v</code> çš„å†™å…¥æ“ä½œ <code>w</code> è¿›è¡Œç›‘æµ‹</p><ol><li>è¯»å–æ“ä½œ <code>v</code> å‘ç”Ÿåœ¨å†™å…¥æ“ä½œ <code>w</code> ä¹‹å</li><li>å¹¶ä¸”åœ¨ <code>w</code> ä¹‹åï¼Œ<code>r</code> ä¹‹å‰æ²¡æœ‰å…¶ä»–å¯¹ <code>v</code> çš„å†™å…¥æ“ä½œ <code>w&#39;</code></li></ol><p>æ³¨æ„è¿™é‡Œè¯´çš„åªæ˜¯è¯»å–æ“ä½œ r å¯ä»¥å¯¹ w è¿›è¡Œç›‘æµ‹ï¼Œä½†æ˜¯èƒ½ä¸èƒ½è¯»åˆ°å‘¢ï¼Œå¯èƒ½å¯ä»¥ä¹Ÿå¯èƒ½ä¸è¡Œ</p><blockquote><p>To guarantee that a read <code>r</code> of a variable <code>v</code> observes a particular write <code>w</code> to <code>v</code>, ensure that <code>w</code> is the only write <code>r</code> is allowed to observe. That is, <code>r</code> is guaranteed to observe <code>w</code> if both of the following hold:</p><ol><li><code>w</code> happens before <code>r</code>.</li><li>Any other write to the shared variable <code>v</code> either happens before <code>w</code> or after <code>r</code>.</li></ol></blockquote><p>ä¸ºç¡®ä¿å¯¹å˜é‡ <code>v</code> çš„è¯»å–æ“ä½œ <code>r</code> èƒ½å¤Ÿç›‘æµ‹åˆ°ç‰¹å®šçš„å¯¹ <code>v</code> è¿›è¡Œå†™å…¥çš„æ“ä½œ <code>w</code>ï¼Œéœ€ç¡®ä¿ <code>w</code> æ˜¯å”¯ä¸€å…è®¸è¢« <code>r</code> ç›‘æµ‹çš„å†™å…¥æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥ä»¥ä¸‹æ¡ä»¶å‡æˆç«‹ï¼Œåˆ™ <code>r</code> èƒ½ä¿è¯ç›‘æµ‹åˆ° <code>w</code>ï¼š</p><ol><li><code>w</code> å‘ç”Ÿåœ¨ <code>r</code> ä¹‹å‰ã€‚</li><li>å¯¹å…±äº«å˜é‡ <code>v</code> çš„å…¶å®ƒä»»ä½•å†™å…¥æ“ä½œéƒ½åªèƒ½å‘ç”Ÿåœ¨ <code>w</code> ä¹‹å‰æˆ– <code>r</code> ä¹‹åã€‚</li></ol><p>è¿™å¯¹æ¡ä»¶çš„è¦æ±‚æ¯”ç¬¬ä¸€ä¸ªæ¡ä»¶æ›´å¼ºï¼Œå®ƒéœ€è¦ç¡®ä¿æ²¡æœ‰å…¶å®ƒå†™å…¥æ“ä½œä¸ <code>w</code> æˆ– <code>r</code> å¹¶å‘ã€‚<br>åœ¨å•ä¸ª goroutine å½“ä¸­è¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯ç­‰ä»·çš„ï¼Œå› ä¸ºå•ä¸ª goroutine ä¸­ä¸å­˜åœ¨å¹¶å‘ï¼Œåœ¨å¤šä¸ª goroutine ä¸­å°±å¿…é¡»ä½¿ç”¨åŒæ­¥è¯­ä¹‰æ¥ç¡®ä¿é¡ºåºï¼Œè¿™æ ·æ‰èƒ½åˆ°ä¿è¯èƒ½å¤Ÿç›‘æµ‹åˆ°é¢„æœŸçš„å†™å…¥<br><strong>å•ä¸ª goroutine çš„æƒ…å†µ</strong>ï¼š<br>æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨å•ä¸ª goroutine å½“ä¸­ï¼Œè¯»å–æ“ä½œ r æ€»æ˜¯å¯ä»¥è¯»å–åˆ°ä¸Šä¸€æ¬¡ w å†™å…¥çš„å€¼çš„<br><img src="https://lailin.xyz/images/1608372439492-359ad5bf-1b06-4f4f-ae77-84e96d9f6a7f.png" srcset="/img/loading.gif" alt="image.png"><br><strong>å¤šä¸ª goroutine çš„æƒ…å†µ</strong>:<br>ä½†æ˜¯å­˜åœ¨å¤šä¸ª goroutine çš„æ—¶å€™è¿™ä¸ªå°±ä¸ä¸€å®šäº†ï¼Œr0 è¯»åˆ°çš„æ˜¯ å“ªä¸€æ¬¡å†™å…¥çš„å€¼å‘¢ï¼Ÿå¦‚æœçœ‹å›¾çš„è¯åƒæ˜¯ w4 çš„ï¼Œä½†å…¶å®ä¸ä¸€å®šï¼Œå› ä¸ºå›¾ä¸­çš„ä¸¤ä¸ª goroutine æ‰€è¡¨è¾¾çš„æ—¶é—´ç»´åº¦å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œæ‰€ä»¥ r0 å¯èƒ½è¯»åˆ°çš„æ˜¯ w0 w3 w4 ç”šè‡³æ˜¯ w5 çš„ç»“æœï¼Œå½“ç„¶æŒ‰ç…§æˆ‘ä»¬å‰é¢è¯´çš„ç†è®ºï¼Œè¯»åˆ°çš„ä¸å¯èƒ½æ˜¯ w1 çš„ç»“æœçš„<br><img src="https://lailin.xyz/images/1608372753766-f3b66fe5-ac34-4f5e-a1b2-c74e7d3dfbc9.png" srcset="/img/loading.gif" alt="image.png"><br><strong>æ·»åŠ ä¸€äº›åŒæ­¥ç‚¹</strong><br>å¦‚ä¸‹å›¾æ‰€ç¤ºæˆ‘ä»¬é€šè¿‡ sync åŒ…ä¸­çš„ä¸€äº›åŒæ­¥è¯­ä¹‰æˆ–è€…æ˜¯ channel ä¸ºå¤šä¸ª goroutine åŠ å…¥äº† åŒæ­¥ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å¯¹äº r1 è€Œè¨€ï¼Œä»–å°±æ˜¯æ™šäº w4 å¹¶ä¸”æ—©äº w1 å’Œ w5 æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å®ƒè¯»å–åˆ°çš„æ˜¯å†™å…¥æ“ä½œæ˜¯å¯ä»¥ç¡®å®šçš„ï¼Œæ˜¯ w4<br><img src="https://lailin.xyz/images/1608373281116-271c756e-386e-490b-aa7b-0fb2b741ed40.png" srcset="/img/loading.gif" alt="image.png"></p><blockquote><p>The initialization of variable <code>v</code> with the zero value for <code>v</code>â€˜s type behaves as a write in the memory model.</p></blockquote><p>ä»¥å˜é‡ <code>v</code> æ‰€å±ç±»å‹çš„é›¶å€¼æ¥å¯¹ <code>v</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œå…¶è¡¨ç°å¦‚åŒåœ¨å†…å­˜æ¨¡å‹ä¸­è¿›è¡Œçš„å†™å…¥æ“ä½œã€‚</p><h4 id="æœºå™¨å­—"><a href="#æœºå™¨å­—" class="headerlink" title="æœºå™¨å­—"></a>æœºå™¨å­—</h4><blockquote><p>Reads and writes of values larger than a single machine word behave as multiple machine-word-sized operations in an unspecified order.</p></blockquote><p>å¯¹å¤§äºå•ä¸ªæœºå™¨å­—çš„å€¼è¿›è¡Œè¯»å–å’Œå†™å…¥ï¼Œå…¶è¡¨ç°å¦‚åŒä»¥ä¸ç¡®å®šçš„é¡ºåºå¯¹å¤šä¸ªæœºå™¨å­—å¤§å°çš„å€¼è¿›è¡Œæ“ä½œã€‚è¦ç†è§£è¿™ä¸ªæˆ‘ä»¬é¦–å…ˆè¦ç†è§£ä»€ä¹ˆæ˜¯æœºå™¨å­—ã€‚<br>æˆ‘ä»¬ç°åœ¨å¸¸è§çš„è¿˜æœ‰ 32 ä½ç³»ç»Ÿå’Œ 64 ä½çš„ç³»ç»Ÿï¼Œcpu åœ¨æ‰§è¡Œä¸€æ¡æŒ‡ä»¤çš„æ—¶å€™å¯¹äºå•ä¸ªæœºå™¨å­—é•¿çš„çš„æ•°æ®çš„å†™å…¥å¯ä»¥ä¿è¯æ˜¯åŸå­çš„ï¼Œå¯¹äº 32 ä½çš„å°±æ˜¯ 4 ä¸ªå­—èŠ‚ï¼Œå¯¹äº 64 ä½çš„å°±æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œå¯¹äºåœ¨ 32 ä½æƒ…å†µä¸‹å»å†™å…¥ä¸€ä¸ª 8 å­—èŠ‚çš„æ•°æ®æ—¶å°±éœ€è¦æ‰§è¡Œä¸¤æ¬¡å†™å…¥æ“ä½œï¼Œè¿™ä¸¤æ¬¡æ“ä½œä¹‹é—´å°±æ²¡æœ‰åŸå­æ€§ï¼Œé‚£å°±å¯èƒ½å‡ºç°å…ˆå†™å…¥ååŠéƒ¨åˆ†çš„æ•°æ®å†å†™å…¥å‰åŠéƒ¨åˆ†ï¼Œæˆ–è€…æ˜¯å†™å…¥äº†ä¸€åŠæ•°æ®ç„¶åå†™å…¥å¤±è´¥çš„æƒ…å†µã€‚<br>ä¹Ÿå°±æ˜¯è¯´è™½ç„¶æœ‰æ—¶å€™æˆ‘ä»¬çœ‹ç€ä»…ä»…åªåšäº†ä¸€æ¬¡å†™å…¥ä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºå®ƒæœ¬èº«ä¸æ˜¯åŸå­çš„</p><h3 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h3><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><blockquote><p>Program initialization runs in a single goroutine, but that goroutine may create other goroutines, which run concurrently.<br>If a package <code>p</code> imports package <code>q</code>, the completion of <code>q</code>â€˜s <code>init</code> functions happens before the start of any of <code>p</code>â€˜s.<br>The start of the function <code>main.main</code> happens after all <code>init</code> functions have finished.</p></blockquote><ul><li>ç¨‹åºçš„åˆå§‹åŒ–è¿è¡Œåœ¨å•ä¸ª goroutine ä¸­ï¼Œä½†è¯¥ goroutine å¯èƒ½ä¼šåˆ›å»ºå…¶å®ƒå¹¶å‘è¿è¡Œçš„ goroutine</li><li>è‹¥åŒ… p å¯¼å…¥äº†åŒ… qï¼Œåˆ™ q çš„ init å‡½æ•°ä¼šåœ¨ p çš„ä»»ä½•å‡½æ•°å¯åŠ¨å‰å®Œæˆã€‚</li><li>å‡½æ•° main.main ä¼šåœ¨æ‰€æœ‰çš„ init å‡½æ•°ç»“æŸåå¯åŠ¨ã€‚<div style="background:#fffbe6;padding:10px;border:1px solid #c3c3c3;border-radius:5px;margin-bottom:5px">æ³¨æ„: åœ¨å®é™…çš„åº”ç”¨ä»£ç ä¸­ä¸è¦éšå¼çš„ä¾èµ–è¿™ä¸ªå¯åŠ¨é¡ºåº</div></li></ul><h4 id="goroutine-çš„åˆ›å»º"><a href="#goroutine-çš„åˆ›å»º" class="headerlink" title="goroutine çš„åˆ›å»º"></a>goroutine çš„åˆ›å»º</h4><blockquote><p>The <code>go</code> statement that starts a new goroutine happens before the goroutineâ€™s execution begins.</p></blockquote><p><code>go</code> è¯­å¥ä¼šåœ¨å½“å‰ goroutine å¼€å§‹æ‰§è¡Œå‰å¯åŠ¨æ–°çš„ goroutine</p><h4 id="goroutine-çš„é”€æ¯"><a href="#goroutine-çš„é”€æ¯" class="headerlink" title="goroutine çš„é”€æ¯"></a>goroutine çš„é”€æ¯</h4><blockquote><p>The exit of a goroutine is not guaranteed to happen before any event in the programã€‚</p></blockquote><p>goroutine æ— æ³•ç¡®ä¿åœ¨ç¨‹åºä¸­çš„ä»»ä½•äº‹ä»¶å‘ç”Ÿä¹‹å‰é€€å‡º</p><p>æ³¨æ„ <a href="https://golang.org/ref/mem" target="_blank" rel="noopener">ã€ŠThe Go Memory Modelã€‹</a>åŸæ–‡ä¸­è¿˜æœ‰å…³äº channelï¼Œ é”ç›¸å…³çš„é˜è¿°ï¼Œå› ä¸ºç¯‡å¹…åŸå› åœ¨æœ¬æ–‡ä¸­å°±ä¸å¤šè®²äº†ï¼Œåé¢æˆ‘ä»¬è¿˜æœ‰å•ç‹¬çš„æ–‡ç« è¯¦ç»†è®² channel å’Œ é” ç›¸å…³çš„ä½¿ç”¨ï¼Œåœ¨å¼ºè°ƒä¸€éï¼ŒåŸæ–‡ä¸€å®šè¦å¤šçœ‹å‡ é</p><h2 id="å†…å­˜é‡æ’"><a href="#å†…å­˜é‡æ’" class="headerlink" title="å†…å­˜é‡æ’"></a>å†…å­˜é‡æ’</h2><p>åœ¨ä¸Šé¢æˆ‘ä»¬è®²åˆ°äº†ç¼–è¯‘å™¨é‡æ’ï¼Œä»¥åŠåœ¨æœ€å¼€å§‹çš„ä¾‹å­ä¸­æˆ‘ä»¬æåˆ°äº†å¯èƒ½ä¼šå­˜åœ¨ <code>2 0</code> è¿™ä¸ªç­”æ¡ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆã€‚å¦‚æœå¤§å®¶è´­ä¹°ç”µè„‘çš„æ—¶å€™æœ‰å»å¯¹æ¯” cpu çš„è¯åº”è¯¥å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ª cpu éƒ½ä¼šå†™ä¸€ä¸‹ä¸€çº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜ï¼Œä¸‰çº§ç¼“å­˜çš„å¤§å°ï¼Œè¿™ä¸ªç¼“å­˜å°±æ˜¯è¿™é‡Œçš„ä¸€ä¸ªå…³é”®ç‚¹ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¶Šå¾€ä¸‹ç¼“å­˜çš„å¤§å°è¶Šå¤§é€Ÿåº¦è¶Šæ…¢ï¼Œè¿™æ˜¯ cpu ä¸ºäº†æé«˜æ‰§è¡Œé€Ÿåº¦åšçš„ç¼“å­˜ä½“ç³»ï¼Œå°±åƒæˆ‘ä»¬å¹³æ—¶åœ¨åº”ç”¨å½“ä¸­å¼•å…¥ redis ä½œä¸ºç¼“å­˜ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸ºäº†åŠ é€Ÿã€‚åŒæ—¶è¿™å°±ä¼šå¸¦æ¥ä¸€äº›æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚<br><img src="https://lailin.xyz/images/1608385154319-591875fe-fc6f-457f-8fd0-966b8e603310.png" srcset="/img/loading.gif" alt="02_Goè¿›é˜¶03_blog_img.drawio-ç¬¬ 4 é¡µ.png"><br><strong>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š</strong></p><ol><li>C1 æ‰§è¡Œ a = 1 å°† store buffer ä¸­ a çš„å€¼å†™ä¸º 1</li><li>C1 æ‰§è¡Œ b = 2 å°† store buffer ä¸­ b çš„å€¼å†™ä¸º 2, ç„¶åç”±äºæŸç§åŸå› å°† b çš„å€¼å†™å…¥åˆ°äº†å†…å­˜ä¸­</li><li>C2 å»è¯»å– b çš„å€¼ï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå°±å»å†…å­˜ä¸­è¯»ï¼Œè¿™æ—¶å€™ print å‡ºæ¥ 2</li><li>C2 å»è¯»å– a çš„å€¼ï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå°±å»å†…å­˜ä¸­è¯»ï¼Œè¿™æ—¶å€™ print å‡ºæ¥ 0</li></ol><p>äº†è§£åˆ°è¿™é‡Œä¹‹åå¯èƒ½ä¼šæœ‰ä¸€äº›ç–‘é—®ï¼Œæ—¢ç„¶ä¼šå­˜åœ¨è¿™ç§ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å»ä¿è¯ä¸€è‡´å‘¢ï¼ŸCPU çš„ä¸€è‡´æ€§å…·ä½“åˆæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ<br>ä¿è¯ä¸€è‡´ä»ç¨‹åºä¸Šæ¥è®²æˆ‘ä»¬å¿…é¡»ä½¿ç”¨åŒæ­¥è¯­ä¹‰çš„å·¥å…·ç¡®ä¿ä¸€è‡´ï¼Œå¦‚æœæ·±å…¥åˆ°åº•å±‚çš„è¯å°±æ˜¯ä½¿ç”¨ cpu æä¾›çš„å†…å­˜å±éšœå‘½ä»¤ï¼Œä¿è¯æ‰€æœ‰å¯¹å†…å­˜çš„æ“ä½œéƒ½å¿…é¡»è¦â€œæ‰©æ•£â€åˆ° memory ä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œå…¶ä»–å¯¹ memory çš„æ“ä½œã€‚<br>CPU ä¸€è‡´æ€§çš„åŸç†å»ºè®®çœ‹ä¸€ä¸‹ MSI(E)åè®®çš„å®ç°ï¼Œæˆ‘åœ¨å‚è€ƒæ–‡çŒ®ä¸­åˆ—å‡ºçš„æœ€åä¸¤ç¯‡æ–‡ç« è®²çš„å·²ç»æ¯”è¾ƒé€šä¿—æ˜“æ‡‚äº†ï¼Œåœ¨æœ¬æ–‡å°±ä¸å†å™è¿°</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><ul><li>Go çš„å¹¶å‘ç¼–ç¨‹éå¸¸çš„ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ go func å°±èƒ½å¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ï¼Œä½†æ˜¯å¹¶å‘ç¼–ç¨‹æœ¬èº«å°±æ˜¯å¾ˆå®¹æ˜“å‡ºç° bug çš„ï¼Œè€Œä¸”ç”±äºå¹¶å‘å¯¼è‡´çš„ bug è¿˜ä¸å¤ªå®¹æ˜“å‘ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™å¹¶å‘é€»è¾‘çš„æ—¶å€™ä¸€å®šè¦éå¸¸å°å¿ƒï¼Œç”¨å®˜æ–¹çš„ä¸€å¥è¯å°±æ˜¯<strong>ä½¿ç”¨æ˜¾ç¤ºçš„åŒæ­¥</strong></li><li>æœ¬æ–‡æ›´å¤šæ˜¯æŠ›ç –å¼•ç‰è¿™é‡Œé¢æåˆ°äº†å¾ˆå¤šæœ‰æ„æ€çš„åè¯éƒ½å€¼å¾—å¥½å¥½ç ”ç©¶</li></ul><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul><li><a href="https://golang.org/ref/mem" target="_blank" rel="noopener">https://golang.org/ref/mem</a> å®˜æ–¹æ–‡æ¡£ä¸€å®šè¦å¤šè¯»å‡ é</li><li><a href="https://go-zh.org/ref/mem" target="_blank" rel="noopener">https://go-zh.org/ref/mem</a> å®˜æ–¹æ–‡æ¡£çš„ä¸­æ–‡ç¿»è¯‘ï¼Œè‹±æ–‡æ¯”è¾ƒåƒåŠ›å¯ä»¥çœ‹è¿™ç¯‡</li><li><a href="https://qcrao.com/2019/06/17/cch-says-memory-reorder/" target="_blank" rel="noopener">https://qcrao.com/2019/06/17/cch-says-memory-reorder/</a></li><li><a href="https://cch123.github.io/ooo/" target="_blank" rel="noopener">https://cch123.github.io/ooo/</a></li><li><a href="https://www.cs.utexas.edu/~bornholt/post/memory-models.html" target="_blank" rel="noopener">https://www.cs.utexas.edu/~bornholt/post/memory-models.html</a></li><li><a href="https://baike.baidu.com/item/%E6%9C%BA%E5%99%A8%E5%AD%97%E9%95%BF" target="_blank" rel="noopener">https://baike.baidu.com/item/%E6%9C%BA%E5%99%A8%E5%AD%97%E9%95%BF</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%AD%97_(%E8%AE%A1%E7%AE%97%E6%9C%BA" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%AD%97_(%E8%AE%A1%E7%AE%97%E6%9C%BA)</a>&gt;)</li><li><a href="https://zhuanlan.zhihu.com/p/65245043" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/65245043</a></li><li><a href="https://zhuanlan.zhihu.com/p/94811032" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/94811032</a></li></ul><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li><li><a href="https://lailin.xyz/post/go-training-03.html">Week02: Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>Goè¿›é˜¶è®­ç»ƒè¥</category>
      
      <category>Goå¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>Goè¿›é˜¶è®­ç»ƒè¥</tag>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</title>
    <link href="/post/go-training-week3-goroutine.html"/>
    <url>/post/go-training-week3-goroutine.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><p>æ¥ä¸‹æ¥ä¼šä¸€å…±ä¼šæœ‰ 4 - 6 ç¯‡æ–‡ç« è®²è§£ Go å¹¶å‘ç¼–ç¨‹ï¼Œå¹¶å‘ç¼–ç¨‹æœ¬èº«æ˜¯ä¸€ä¸ªæŒºå¤§çš„è¯é¢˜ï¼Œåœ¨ç¬¬å››å‘¨çš„ä¸¤èŠ‚è¯¾ï¼Œæ¯›è€å¸ˆèŠ±äº†å°†è¿‘ 7 ä¸ªå°æ—¶è®²è§£è¿™äº›å†…å®¹ï¼Œæˆ‘ä¹Ÿç»“åˆè‡ªå·±çš„ä¸€äº›å¾®ä¸è¶³é“çš„ç»éªŒï¼Œå†åŠ ä¸Šä¸€äº›å¤§ç¥ä»¬çš„æ–‡ç« ï¼Œæ•´ç†å‡ºäº†è¿™ä¸€éƒ¨åˆ†çš„ç¬”è®°ã€‚<br>å½“ç„¶è¿™é‡Œæ›´å¤šçš„æ˜¯æŠ›ç –å¼•ç‰çš„ä½œç”¨ï¼Œæ›´å¤šçš„è¿˜æ˜¯æˆ‘ä»¬è‡ªå·±è¦æœ‰ç›¸å…³çš„æ„è¯†é¿å…è¸©å‘ï¼Œåœ¨å„ä¸ªå‘çš„è¾¹ç¼˜åå¤æ¨ªè·³ï¼Œå¯èƒ½æˆ‘ä»¬æœ‰ç¼˜ä¼šåœ¨åŒä¸€ä¸ªå‘ä¸­å‘ç°ï¼Œå’¦ï¼ŒåŸæ¥ä½ ä¹Ÿåœ¨è¿™é‡Œ ğŸ˜„</p><h2 id="è¯·å¯¹ä½ åˆ›å»ºçš„-goroutine-è´Ÿè´£"><a href="#è¯·å¯¹ä½ åˆ›å»ºçš„-goroutine-è´Ÿè´£" class="headerlink" title="è¯·å¯¹ä½ åˆ›å»ºçš„ goroutine è´Ÿè´£"></a>è¯·å¯¹ä½ åˆ›å»ºçš„ goroutine è´Ÿè´£</h2><h3 id="ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„-goroutine"><a href="#ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„-goroutine" class="headerlink" title="ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„ goroutine"></a>ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„ goroutine</h3><p>è¯·é˜…è¯»ä¸‹é¢è¿™æ®µä»£ç ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><blockquote><p>ä¸ºä»€ä¹ˆå…ˆä»ä¸‹é¢è¿™æ®µä»£ç å‡ºå‘ï¼Œæ˜¯å› ä¸ºåœ¨ä¹‹å‰çš„ç»éªŒé‡Œé¢æˆ‘ä»¬å†™äº†å¤§é‡ç±»ä¼¼çš„ä»£ç ï¼Œä¹‹å‰æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”è¿˜å› ä¸ºè¿™ç§ä»£ç å‡ºç°è¿‡çŸ­æš‚çš„äº‹æ•…</p></blockquote><pre><code class="hljs go"><span class="hljs-comment">// Week03/blog/01/01.go</span><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"log"</span><span class="hljs-string">"net/http"</span>_ <span class="hljs-string">"net/http/pprof"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;setup()<span class="hljs-comment">// ä¸»æœåŠ¡</span>server()<span class="hljs-comment">// for debug</span>pprof()<span class="hljs-keyword">select</span> &#123;&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">server</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;mux := http.NewServeMux()mux.HandleFunc(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pong"</span>))&#125;)<span class="hljs-comment">// ä¸»æœåŠ¡</span><span class="hljs-keyword">if</span> err := http.ListenAndServe(<span class="hljs-string">":8080"</span>, mux); err != <span class="hljs-literal">nil</span> &#123;log.Panicf(<span class="hljs-string">"http server err: %+v"</span>, err)<span class="hljs-keyword">return</span>&#125;&#125;()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pprof</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// è¾…åŠ©æœåŠ¡ï¼Œç›‘å¬äº†å…¶ä»–ç«¯å£ï¼Œè¿™é‡Œæ˜¯ pprof æœåŠ¡ï¼Œç”¨äº debug</span><span class="hljs-keyword">go</span> http.ListenAndServe(<span class="hljs-string">":8081"</span>, <span class="hljs-literal">nil</span>)&#125;</code></pre><p>çµé­‚æ‹·é—®æ¥äº†ï¼Œè¯·é—®ï¼š</p><ul><li>å¦‚æœ <code>server</code> æ˜¯åœ¨å…¶ä»–åŒ…é‡Œé¢ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œä½ çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ä¹ˆï¼Ÿ</li><li><code>main</code> å‡½æ•°å½“ä¸­æœ€ååœ¨å“ªé‡Œç©ºè½¬å¹²ä»€ä¹ˆï¼Ÿä¼šä¸ä¼šå­˜åœ¨æµªè´¹ï¼Ÿ</li><li>å¦‚æœçº¿ä¸Šå‡ºç°äº‹æ•…ï¼Œdebug æœåŠ¡å·²ç»é€€å‡ºï¼Œä½ æƒ³è¦ debug è¿™æ—¶ä½ æ˜¯å¦å¾ˆèŒ«ç„¶ï¼Ÿ</li><li>å¦‚æœæŸä¸€å¤©æœåŠ¡çªç„¶é‡å¯ï¼Œä½ å´æ‰¾ä¸åˆ°äº‹æ•…æ—¥å¿—ï¼Œä½ æ˜¯å¦èƒ½æƒ³èµ·è¿™ä¸ª <code>8081</code> ç«¯å£çš„æœåŠ¡ï¼Ÿ</li></ul><h4 id="è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©"><a href="#è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©" class="headerlink" title="è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©"></a>è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©</h4><p>è¯·æŠŠæ˜¯å¦å¹¶å‘çš„é€‰æ‹©æƒäº¤ç»™ä½ çš„è°ƒç”¨è€…ï¼Œè€Œä¸æ˜¯è‡ªå·±å°±ç›´æ¥æ‚„æ‚„çš„ç”¨ä¸Šäº† goroutine<br>ä¸‹é¢è¿™æ¬¡æ”¹åŠ¨å°†ä¸¤ä¸ªå‡½æ•°æ˜¯å¦å¹¶å‘æ“ä½œçš„é€‰æ‹©æƒç•™ç»™äº† main å‡½æ•°</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"log"</span><span class="hljs-string">"net/http"</span>_ <span class="hljs-string">"net/http/pprof"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;setup()<span class="hljs-comment">// for debug</span><span class="hljs-keyword">go</span> pprof()<span class="hljs-comment">// ä¸»æœåŠ¡</span><span class="hljs-keyword">go</span> server()<span class="hljs-keyword">select</span> &#123;&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">server</span><span class="hljs-params">()</span></span> &#123;mux := http.NewServeMux()mux.HandleFunc(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pong"</span>))&#125;)<span class="hljs-comment">// ä¸»æœåŠ¡</span><span class="hljs-keyword">if</span> err := http.ListenAndServe(<span class="hljs-string">":8080"</span>, mux); err != <span class="hljs-literal">nil</span> &#123;log.Panicf(<span class="hljs-string">"http server err: %+v"</span>, err)<span class="hljs-keyword">return</span>&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pprof</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// è¾…åŠ©æœåŠ¡ï¼Œç›‘å¬äº†å…¶ä»–ç«¯å£ï¼Œè¿™é‡Œæ˜¯ pprof æœåŠ¡ï¼Œç”¨äº debug</span>http.ListenAndServe(<span class="hljs-string">":8081"</span>, <span class="hljs-literal">nil</span>)&#125;</code></pre><h4 id="è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…"><a href="#è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…" class="headerlink" title="è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…"></a>è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸è¦è®©ä¸»è¿›ç¨‹æˆä¸ºä¸€ä¸ªæ—è§‚è€…ï¼Œæ˜æ˜å¯ä»¥å¹²æ´»ï¼Œä½†æ˜¯æœ€åä½¿ç”¨äº†ä¸€ä¸ª <code>select</code> åœ¨é‚£å„¿ç©ºè·‘<br>æ„Ÿè°¢ä¸Šä¸€æ­¥å°†æ˜¯å¦å¼‚æ­¥çš„é€‰æ‹©æƒäº¤ç»™äº†æˆ‘( <code>main</code> )ï¼Œåœ¨æ—è¾¹çœ‹ç€ä¹Ÿæ€ªå°´å°¬çš„</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"log"</span><span class="hljs-string">"net/http"</span>_ <span class="hljs-string">"net/http/pprof"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;setup()<span class="hljs-comment">// for debug</span><span class="hljs-keyword">go</span> pprof()<span class="hljs-comment">// ä¸»æœåŠ¡</span>server()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">server</span><span class="hljs-params">()</span></span> &#123;mux := http.NewServeMux()mux.HandleFunc(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pong"</span>))&#125;)<span class="hljs-comment">// ä¸»æœåŠ¡</span><span class="hljs-keyword">if</span> err := http.ListenAndServe(<span class="hljs-string">":8080"</span>, mux); err != <span class="hljs-literal">nil</span> &#123;log.Panicf(<span class="hljs-string">"http server err: %+v"</span>, err)<span class="hljs-keyword">return</span>&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pprof</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// è¾…åŠ©æœåŠ¡ï¼Œç›‘å¬äº†å…¶ä»–ç«¯å£ï¼Œè¿™é‡Œæ˜¯ pprof æœåŠ¡ï¼Œç”¨äº debug</span>http.ListenAndServe(<span class="hljs-string">":8081"</span>, <span class="hljs-literal">nil</span>)&#125;</code></pre><h4 id="ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„-goroutine"><a href="#ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„-goroutine" class="headerlink" title="ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„ goroutine"></a>ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„ goroutine</h4><p>æˆ‘ä»¬å†åšä¸€äº›æ”¹é€ ï¼Œä½¿ç”¨ <code>channel</code> æ¥æ§åˆ¶ï¼Œè§£é‡Šéƒ½å†™åœ¨ä»£ç æ³¨é‡Šé‡Œé¢äº†</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"context"</span><span class="hljs-string">"fmt"</span><span class="hljs-string">"log"</span><span class="hljs-string">"net/http"</span>_ <span class="hljs-string">"net/http/pprof"</span><span class="hljs-string">"time"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;setup()<span class="hljs-comment">// ç”¨äºç›‘å¬æœåŠ¡é€€å‡º</span>done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> error, <span class="hljs-number">2</span>)<span class="hljs-comment">// ç”¨äºæ§åˆ¶æœåŠ¡é€€å‡ºï¼Œä¼ å…¥åŒä¸€ä¸ª stopï¼Œåšåˆ°åªè¦æœ‰ä¸€ä¸ªæœåŠ¡é€€å‡ºäº†é‚£ä¹ˆå¦å¤–ä¸€ä¸ªæœåŠ¡ä¹Ÿä¼šéšä¹‹é€€å‡º</span>stop := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;, <span class="hljs-number">0</span>)<span class="hljs-comment">// for debug</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;done &lt;- pprof(stop)&#125;()<span class="hljs-comment">// ä¸»æœåŠ¡</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;done &lt;- app(stop)&#125;()<span class="hljs-comment">// stoped ç”¨äºåˆ¤æ–­å½“å‰ stop çš„çŠ¶æ€</span><span class="hljs-keyword">var</span> stoped <span class="hljs-keyword">bool</span><span class="hljs-comment">// è¿™é‡Œå¾ªç¯è¯»å– done è¿™ä¸ª channel</span><span class="hljs-comment">// åªè¦æœ‰ä¸€ä¸ªé€€å‡ºäº†ï¼Œæˆ‘ä»¬å°±å…³é—­ stop channel</span><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">cap</span>(done); i++ &#123;<span class="hljs-keyword">if</span> err := &lt;-done; err != <span class="hljs-literal">nil</span> &#123;log.Printf(<span class="hljs-string">"server exit err: %+v"</span>, err)&#125;<span class="hljs-keyword">if</span> !stoped &#123;stoped = <span class="hljs-literal">true</span><span class="hljs-built_in">close</span>(stop)&#125;&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">app</span><span class="hljs-params">(stop &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;mux := http.NewServeMux()mux.HandleFunc(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pong"</span>))&#125;)<span class="hljs-keyword">return</span> server(mux, <span class="hljs-string">":8080"</span>, stop)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pprof</span><span class="hljs-params">(stop &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-comment">// æ³¨æ„è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†æ¨¡æ‹ŸæœåŠ¡æ„å¤–é€€å‡ºï¼Œç”¨äºéªŒè¯ä¸€ä¸ªæœåŠ¡é€€å‡ºï¼Œå…¶ä»–æœåŠ¡åŒæ—¶é€€å‡ºçš„åœºæ™¯</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;server(http.DefaultServeMux, <span class="hljs-string">":8081"</span>, stop)&#125;()time.Sleep(<span class="hljs-number">5</span> * time.Second)<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"mock pprof exit"</span>)&#125;<span class="hljs-comment">// å¯åŠ¨ä¸€ä¸ªæœåŠ¡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">server</span><span class="hljs-params">(handler http.Handler, addr <span class="hljs-keyword">string</span>, stop &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;s := http.Server&#123;Handler: handler,Addr:    addr,&#125;<span class="hljs-comment">// è¿™ä¸ª goroutine æˆ‘ä»¬å¯ä»¥æ§åˆ¶é€€å‡ºï¼Œå› ä¸ºåªè¦ stop è¿™ä¸ª channel close æˆ–è€…æ˜¯å†™å…¥æ•°æ®ï¼Œè¿™é‡Œå°±ä¼šé€€å‡º</span><span class="hljs-comment">// åŒæ—¶å› ä¸ºè°ƒç”¨äº† s.Shutdown è°ƒç”¨ä¹‹åï¼Œhttp è¿™ä¸ªå‡½æ•°å¯åŠ¨çš„ http server ä¹Ÿä¼šä¼˜é›…é€€å‡º</span><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;&lt;-stoplog.Printf(<span class="hljs-string">"server will exiting, addr: %s"</span>, addr)s.Shutdown(context.Background())&#125;()<span class="hljs-keyword">return</span> s.ListenAndServe()&#125;</code></pre><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿”å›ç»“æœï¼Œè¿™ä¸ªä»£ç å¯åŠ¨ 5s ä¹‹åå°±ä¼šé€€å‡ºç¨‹åº</p><pre><code class="hljs go">â¯ <span class="hljs-keyword">go</span> run ./<span class="hljs-number">01</span>_goroutine/<span class="hljs-number">04</span><span class="hljs-number">2020</span>/<span class="hljs-number">12</span>/<span class="hljs-number">08</span> <span class="hljs-number">21</span>:<span class="hljs-number">49</span>:<span class="hljs-number">43</span> server exit err: mock pprof exit<span class="hljs-number">2020</span>/<span class="hljs-number">12</span>/<span class="hljs-number">08</span> <span class="hljs-number">21</span>:<span class="hljs-number">49</span>:<span class="hljs-number">43</span> server will exiting, addr: :<span class="hljs-number">8081</span><span class="hljs-number">2020</span>/<span class="hljs-number">12</span>/<span class="hljs-number">08</span> <span class="hljs-number">21</span>:<span class="hljs-number">49</span>:<span class="hljs-number">43</span> server will exiting, addr: :<span class="hljs-number">8080</span><span class="hljs-number">2020</span>/<span class="hljs-number">12</span>/<span class="hljs-number">08</span> <span class="hljs-number">21</span>:<span class="hljs-number">49</span>:<span class="hljs-number">43</span> server exit err: http: Server closed</code></pre><h4 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h4><p>è™½ç„¶æˆ‘ä»¬å·²ç»ç»è¿‡äº†ä¸‰è½®ä¼˜åŒ–ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æ˜¯æœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹æ€ä¹ˆåš</p><ul><li>è™½ç„¶æˆ‘ä»¬è°ƒç”¨äº† <code>Shutdown</code> æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®å¹¶æ²¡æœ‰å®ç°ä¼˜é›…é€€å‡ºï¼Œç›¸ä¿¡èªæ˜çš„ä½ å¯ä»¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡ç¬”è®°ï¼š<a href="https://lailin.xyz/post/go-training-03.html">Go é”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li><li>åœ¨ <code>server</code> æ–¹æ³•ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰å¤„ç† <code>panic</code> çš„é€»è¾‘ï¼Œè¿™é‡Œéœ€è¦å¤„ç†ä¹ˆï¼Ÿå¦‚æœéœ€è¦é‚£è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</li></ul><h3 id="ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„-goroutine-goroutine-æ³„æ¼"><a href="#ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„-goroutine-goroutine-æ³„æ¼" class="headerlink" title="ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„ goroutine [goroutine æ³„æ¼]"></a>ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„ goroutine [goroutine æ³„æ¼]</h3><p>å†æ¥çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼Œè¿™ä¹Ÿæ˜¯å¸¸å¸¸ä¼šç”¨åˆ°çš„æ“ä½œ</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">leak</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>, <span class="hljs-number">0</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;fmt.Println(<span class="hljs-string">"å¼‚æ­¥ä»»åŠ¡åšä¸€äº›æ“ä½œ"</span>)&lt;-ch&#125;()w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"will leak"</span>))&#125;</code></pre><p>å¤ç”¨ä¸€ä¸‹ä¸Šé¢çš„ server ä»£ç ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå†™å‡ºè¿™ç§ç±»ä¼¼çš„ä»£ç </p><ul><li>http è¯·æ±‚æ¥äº†ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª goroutine å»åšä¸€äº›è€—æ—¶ä¸€ç‚¹çš„å·¥ä½œ</li><li>ç„¶åè¿”å›äº†</li><li>ç„¶åä¹‹å‰åˆ›å»ºçš„é‚£ä¸ª <strong>goroutine é˜»å¡</strong>äº†</li><li>ç„¶åå°±æ³„æ¼äº†</li></ul><p>ç»å¤§éƒ¨åˆ†çš„ goroutine æ³„æ¼éƒ½æ˜¯å› ä¸º goroutine å½“ä¸­å› ä¸ºå„ç§åŸå› é˜»å¡äº†ï¼Œæˆ‘ä»¬åœ¨å¤–é¢ä¹Ÿæ²¡æœ‰æ§åˆ¶å®ƒé€€å‡ºçš„æ–¹å¼ï¼Œæ‰€ä»¥å°±æ³„æ¼äº†ï¼Œå…·ä½“å¯¼è‡´é˜»å¡çš„å¸¸è§åŸå› ä¼šåœ¨æ¥ä¸‹æ¥çš„ sync åŒ…ã€channel ä¸­è®²åˆ°ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†<br>æ¥ä¸‹æ¥æˆ‘ä»¬éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯çœŸçš„æ³„æ¼äº†<br>å¯åŠ¨ä¹‹åæˆ‘ä»¬è®¿é—®ä¸€ä¸‹: <a href="http://localhost:8081/debug/pprof/goroutine?debug=1" target="_blank" rel="noopener">http://localhost:8081/debug/pprof/goroutine?debug=1</a> æŸ¥çœ‹å½“å‰çš„ goroutine ä¸ªæ•°ä¸º 7</p><pre><code class="hljs go">goroutine profile: total <span class="hljs-number">7</span><span class="hljs-number">2</span> @ <span class="hljs-number">0x43b945</span> <span class="hljs-number">0x40814f</span> <span class="hljs-number">0x407d8b</span> <span class="hljs-number">0x770998</span> <span class="hljs-number">0x470381</span>#<span class="hljs-number">0x770997</span>main.server.func1+<span class="hljs-number">0x37</span>/home/ll/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">01</span>_goroutine/<span class="hljs-number">05</span>/<span class="hljs-number">05.</span><span class="hljs-keyword">go</span>:<span class="hljs-number">71</span></code></pre><p>ç„¶åæˆ‘ä»¬å†è®¿é—®å‡ æ¬¡ <a href="http://localhost:8080/leak" target="_blank" rel="noopener">http://localhost:8080/leak</a> å¯ä»¥å‘ç° goroutine å¢åŠ åˆ°äº† 15 ä¸ªï¼Œè€Œä¸”ä¸€ç›´ä¸ä¼šä¸‹é™</p><pre><code class="hljs go">goroutine profile: total <span class="hljs-number">15</span><span class="hljs-number">7</span> @ <span class="hljs-number">0x43b945</span> <span class="hljs-number">0x40814f</span> <span class="hljs-number">0x407d8b</span> <span class="hljs-number">0x770ad0</span> <span class="hljs-number">0x470381</span>#<span class="hljs-number">0x770acf</span>main.leak.func1+<span class="hljs-number">0x8f</span>/home/ll/project/Go<span class="hljs-number">-000</span>/Week03/blog/<span class="hljs-number">01</span>_goroutine/<span class="hljs-number">05</span>/<span class="hljs-number">05.</span><span class="hljs-keyword">go</span>:<span class="hljs-number">83</span></code></pre><h3 id="ç¡®ä¿åˆ›å»ºå‡ºçš„-goroutine-çš„å·¥ä½œå·²ç»å®Œæˆ"><a href="#ç¡®ä¿åˆ›å»ºå‡ºçš„-goroutine-çš„å·¥ä½œå·²ç»å®Œæˆ" class="headerlink" title="ç¡®ä¿åˆ›å»ºå‡ºçš„ goroutine çš„å·¥ä½œå·²ç»å®Œæˆ"></a>ç¡®ä¿åˆ›å»ºå‡ºçš„ goroutine çš„å·¥ä½œå·²ç»å®Œæˆ</h3><p>è¿™ä¸ªå…¶å®å°±æ˜¯ä¼˜é›…é€€å‡ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½å¯åŠ¨äº†å¾ˆå¤šçš„ goroutine å»å¤„ç†ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯æœåŠ¡é€€å‡ºçš„æ—¶å€™æˆ‘ä»¬å¹¶æ²¡æœ‰è€ƒè™‘åˆ°å°±ç›´æ¥é€€å‡ºäº†ã€‚ä¾‹å¦‚é€€å‡ºå‰æ—¥å¿—æ²¡æœ‰ flush åˆ°ç£ç›˜ï¼Œæˆ‘ä»¬çš„è¯·æ±‚è¿˜æ²¡å®Œå…¨å…³é—­ï¼Œå¼‚æ­¥ worker ä¸­è¿˜æœ‰ job åœ¨æ‰§è¡Œç­‰ç­‰ã€‚<br>æˆ‘ä»¬ä¹Ÿæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªåŸ‹ç‚¹æœåŠ¡ï¼Œæ¯æ¬¡è¯·æ±‚æˆ‘ä»¬éƒ½ä¼šä¸ŠæŠ¥ä¸€äº›ä¿¡æ¯åˆ°åŸ‹ç‚¹æœåŠ¡ä¸Š</p><pre><code class="hljs go"><span class="hljs-comment">// Reporter åŸ‹ç‚¹æœåŠ¡ä¸ŠæŠ¥</span><span class="hljs-keyword">type</span> Reporter <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-keyword">var</span> reporter Reporter<span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r Reporter)</span> <span class="hljs-title">report</span><span class="hljs-params">(data <span class="hljs-keyword">string</span>)</span></span> &#123;time.Sleep(time.Second)fmt.Printf(<span class="hljs-string">"report: %s\n"</span>, data)&#125;mux.HandleFunc(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;    <span class="hljs-comment">// åœ¨è¯·æ±‚ä¸­å¼‚æ­¥è°ƒç”¨</span>    <span class="hljs-keyword">go</span> reporter.report(<span class="hljs-string">"ping pong"</span>)    fmt.Println(<span class="hljs-string">"ping"</span>)    w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"pong"</span>))&#125;)</code></pre><p>æˆ‘åœ¨å‘é€äº†ä¸€æ¬¡è¯·æ±‚ä¹‹åç›´æ¥é€€å‡ºäº†ï¼Œå¼‚æ­¥ä¸ŠæŠ¥çš„é€»è¾‘æ ¹æœ¬æ²¡æ‰§è¡Œä¸Š</p><pre><code class="hljs go">â¯ <span class="hljs-keyword">go</span> run ./<span class="hljs-number">01</span>_goroutine/<span class="hljs-number">06</span>ping^Csignal: interrupt</code></pre><p>è¿™ä¸ªæœ‰ä¸¤ç§æ”¹æ³•ï¼Œä¸€ç§æ˜¯ç»™ reporter åŠ ä¸Š shutdown æ–¹æ³•ï¼Œç±»ä¼¼ http çš„ shutdownï¼Œç­‰å¾…æ‰€æœ‰çš„å¼‚æ­¥ä¸ŠæŠ¥å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†é€€å‡ºï¼Œå¦å¤–ä¸€ç§æ˜¯æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ ä¸€äº› worker æ¥æ‰§è¡Œï¼Œåœ¨å½“ç„¶è¿™ä¸ª worker ä¹Ÿè¦å®ç°ç±»ä¼¼ shutdown çš„æ–¹æ³•ã€‚ä¸€èˆ¬æ¨èåä¸€ç§ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é¿å…è¯·æ±‚é‡æ¯”è¾ƒå¤§æ—¶ï¼Œåˆ›å»ºå¤§é‡ goroutineï¼Œå½“ç„¶å¦‚æœè¯·æ±‚é‡æ¯”è¾ƒå°ï¼Œä¸ä¼šå¾ˆå¤§ï¼Œç”¨ç¬¬ä¸€ç§ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚<br>æˆ‘ä»¬ç»™ä¸€ä¸ªç¬¬äºŒç§çš„ç®€å•å®ç°ï¼Œç¬¬ä¸€ç§å¯ä»¥å‚è€ƒ <a href="https://www.ardanlabs.com/blog/2019/04/concurrency-trap-2-incomplete-work.html" target="_blank" rel="noopener">https://www.ardanlabs.com/blog/2019/04/concurrency-trap-2-incomplete-work.html</a></p><pre><code class="hljs go"><span class="hljs-comment">// Reporter åŸ‹ç‚¹æœåŠ¡ä¸ŠæŠ¥</span><span class="hljs-keyword">type</span> Reporter <span class="hljs-keyword">struct</span> &#123;worker   <span class="hljs-keyword">int</span>messages <span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>wg       sync.WaitGroupclosed   <span class="hljs-keyword">bool</span>&#125;<span class="hljs-comment">// NewReporter NewReporter</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewReporter</span><span class="hljs-params">(worker, buffer <span class="hljs-keyword">int</span>)</span> *<span class="hljs-title">Reporter</span></span> &#123;<span class="hljs-keyword">return</span> &amp;Reporter&#123;worker: worker, messages: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>, buffer)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Reporter)</span> <span class="hljs-title">run</span><span class="hljs-params">(stop &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)</span></span> &#123;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;&lt;-stopr.shutdown()&#125;()<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; r.worker; i++ &#123;r.wg.Add(<span class="hljs-number">1</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> msg := <span class="hljs-keyword">range</span> r.messages &#123;time.Sleep(<span class="hljs-number">5</span> * time.Second)fmt.Printf(<span class="hljs-string">"report: %s\n"</span>, msg)&#125;r.wg.Done()&#125;()&#125;r.wg.Wait()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Reporter)</span> <span class="hljs-title">shutdown</span><span class="hljs-params">()</span></span> &#123;r.closed = <span class="hljs-literal">true</span><span class="hljs-comment">// æ³¨æ„ï¼Œè¿™ä¸ªä¸€å®šè¦åœ¨ä¸»æœåŠ¡ç»“æŸä¹‹åå†æ‰§è¡Œï¼Œé¿å…å…³é—­ channel è¿˜æœ‰å…¶ä»–åœ°æ–¹åœ¨å•Šå†™å…¥</span><span class="hljs-built_in">close</span>(r.messages)&#125;<span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Reporter)</span> <span class="hljs-title">report</span><span class="hljs-params">(data <span class="hljs-keyword">string</span>)</span></span> &#123;<span class="hljs-keyword">if</span> r.closed &#123;<span class="hljs-keyword">return</span>&#125;r.messages &lt;- data&#125;</code></pre><p>ç„¶ååœ¨ main å‡½æ•°ä¸­æˆ‘ä»¬åŠ ä¸Š</p><pre><code class="hljs go"><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;    reporter.run(stop)    done &lt;- <span class="hljs-literal">nil</span>&#125;()</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹è¿™ä¸€éƒ¨åˆ†è®²åˆ°çš„å‡ ä¸ªè¦ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬</p><ol><li><strong>è¯·å°†æ˜¯å¦å¼‚æ­¥è°ƒç”¨çš„é€‰æ‹©æƒäº¤ç»™è°ƒç”¨è€…</strong>ï¼Œä¸ç„¶å¾ˆæœ‰å¯èƒ½å¤§å®¶å¹¶ä¸çŸ¥é“ä½ åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ä½¿ç”¨äº† goroutine</li><li>å¦‚æœä½ è¦å¯åŠ¨ä¸€ä¸ª goroutine è¯·å¯¹å®ƒè´Ÿè´£<ol><li><strong>æ°¸è¿œä¸è¦å¯åŠ¨ä¸€ä¸ªä½ æ— æ³•æ§åˆ¶å®ƒé€€å‡ºï¼Œæˆ–è€…ä½ æ— æ³•çŸ¥é“å®ƒä½•æ—¶æ¨å‡ºçš„ goroutine</strong></li><li>è¿˜æœ‰ä¸Šä¸€ç¯‡æåˆ°çš„ï¼Œå¯åŠ¨ goroutine æ—¶è¯·åŠ ä¸Š panic recovery æœºåˆ¶ï¼Œé¿å…æœåŠ¡ç›´æ¥ä¸å¯ç”¨</li><li>é€ æˆ goroutine æ³„æ¼çš„ä¸»è¦åŸå› å°±æ˜¯ goroutine ä¸­é€ æˆäº†é˜»å¡ï¼Œå¹¶ä¸”æ²¡æœ‰å¤–éƒ¨æ‰‹æ®µæ§åˆ¶å®ƒé€€å‡º</li></ol></li><li><strong>å°½é‡é¿å…åœ¨è¯·æ±‚ä¸­ç›´æ¥å¯åŠ¨ goroutine æ¥å¤„ç†é—®é¢˜</strong>ï¼Œè€Œåº”è¯¥é€šè¿‡å¯åŠ¨ worker æ¥è¿›è¡Œæ¶ˆè´¹ï¼Œè¿™æ ·å¯ä»¥é¿å…ç”±äºè¯·æ±‚é‡è¿‡å¤§ï¼Œè€Œå¯¼è‡´å¤§é‡åˆ›å»º goroutine ä»è€Œå¯¼è‡´ oomï¼Œå½“ç„¶å¦‚æœè¯·æ±‚é‡æœ¬èº«éå¸¸å°ï¼Œé‚£å½“æˆ‘æ²¡è¯´</li></ol><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul><li><a href="https://dave.cheney.net/practical-go/presentations/qcon-china.html" target="_blank" rel="noopener">https://dave.cheney.net/practical-go/presentations/qcon-china.html</a> è¿™ç¯‡ dave åœ¨ Qcon China ä¸Šçš„æ–‡ç« å€¼å¾—å¥½å¥½æ‹œè¯»å‡ é</li><li><a href="https://www.ardanlabs.com/blog/2018/11/goroutine-leaks-the-forgotten-sender.html" target="_blank" rel="noopener">https://www.ardanlabs.com/blog/2018/11/goroutine-leaks-the-forgotten-sender.html</a></li><li><a href="https://www.ardanlabs.com/blog/2019/04/concurrency-trap-2-incomplete-work.html" target="_blank" rel="noopener">https://www.ardanlabs.com/blog/2019/04/concurrency-trap-2-incomplete-work.html</a></li><li><a href="https://www.ardanlabs.com/blog/2014/01/concurrency-goroutines-and-gomaxprocs.html" target="_blank" rel="noopener">https://www.ardanlabs.com/blog/2014/01/concurrency-goroutines-and-gomaxprocs.html</a></li></ul><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-03.html">Week02: Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>Goè¿›é˜¶è®­ç»ƒè¥</category>
      
      <category>Goå¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>Goè¿›é˜¶è®­ç»ƒè¥</tag>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Week02: Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</title>
    <link href="/post/go-training-03.html"/>
    <url>/post/go-training-03.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><p>å¤ªé•¿ä¸çœ‹ç³»åˆ—ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹åœ¨ go ä¸­ å¦‚ä½•å¤„ç† errorï¼Œå…·ä½“çš„åŸå› æˆ‘ä»¬ä¼šåœ¨ä¸‹é¢çš„å†…å®¹ä¸­è¿›è¡Œè¯¦ç»†çš„è§£é‡Š</p><h3 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h3><ol><li>åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœæœ‰å¼ºä¾èµ–çš„æœåŠ¡å‡ºç°æ•…éšœæ—¶ <code>panic</code> é€€å‡º</li><li>åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰é…ç½®æ˜æ˜¾ä¸ç¬¦åˆè¦æ±‚ï¼Œ å¯ä»¥ <code>panic</code> é€€å‡ºï¼ˆé˜²å¾¡ç¼–ç¨‹ï¼‰</li><li>å…¶ä»–æƒ…å†µä¸‹åªè¦ä¸æ˜¯ä¸å¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œéƒ½ä¸åº”è¯¥ç›´æ¥ <code>panic</code> åº”è¯¥è¿”å› <code>error</code></li><li>åœ¨ç¨‹åºå…¥å£å¤„ï¼Œä¾‹å¦‚ <code>gin</code> ä¸­é—´ä»¶éœ€è¦ä½¿ç”¨ <code>recovery</code> é¢„é˜² <code>panic</code> ç¨‹åºé€€å‡º</li><li>åœ¨ç¨‹åºä¸­æˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨é‡ç”Ÿçš„ <code>goroutine</code><ol><li>å¦‚æœæ˜¯åœ¨è¯·æ±‚ä¸­éœ€è¦æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåº”è¯¥ä½¿ç”¨å¼‚æ­¥ <code>worker</code> ï¼Œæ¶ˆæ¯é€šçŸ¥çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œé¿å…è¯·æ±‚é‡å¤§æ—¶å¤§é‡ <code>goroutine</code> åˆ›å»º</li><li>å¦‚æœéœ€è¦ä½¿ç”¨ <code>goroutine</code> æ—¶ï¼Œåº”è¯¥ä½¿ç”¨åŒä¸€çš„ <code>Go</code> å‡½æ•°è¿›è¡Œåˆ›å»ºï¼Œè¿™ä¸ªå‡½æ•°ä¸­ä¼šè¿›è¡Œ <code>recovery</code> ï¼Œé¿å…å› ä¸ºé‡ç”Ÿ <code>goroutine</code> panic å¯¼è‡´ä¸»è¿›ç¨‹é€€å‡º</li></ol></li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Go</span><span class="hljs-params">(f <span class="hljs-keyword">func</span>()</span>)</span>&#123;    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;            <span class="hljs-keyword">if</span> err := recovery(); err != <span class="hljs-literal">nil</span> &#123;                log.Printf(<span class="hljs-string">"panic: %+v"</span>, err)            &#125;        &#125;()        f()    &#125;()&#125;</code></pre><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><ol><li>æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>github.com/pkg/errors</code> å¤„ç†åº”ç”¨é”™è¯¯ï¼Œ<strong>æ³¨æ„åœ¨å…¬å…±åº“å½“ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä½¿ç”¨è¿™ä¸ª</strong></li><li><code>error</code> åº”è¯¥æ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªè¿”å›å€¼ï¼Œå½“ <code>error</code> ä¸ä¸º <code>nil</code> æ—¶ï¼Œå‡½æ•°çš„å…¶ä»–è¿”å›å€¼æ˜¯ä¸å¯ç”¨çš„çŠ¶æ€ï¼Œä¸åº”è¯¥å¯¹å…¶ä»–è¿”å›å€¼åšä»»ä½•æœŸå¾…<ol><li><code>func f() (io.Reader, *S1, error)</code> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸çŸ¥é“ <code>io.Reader</code> ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¯èƒ½æœ‰ï¼Œä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€éƒ¨åˆ†</li></ol></li><li>é”™è¯¯å¤„ç†çš„æ—¶å€™åº”è¯¥å…ˆåˆ¤æ–­é”™è¯¯ï¼Œ <code>if err != nil</code> å‡ºç°é”™è¯¯åŠæ—¶è¿”å›ï¼Œä½¿ä»£ç æ˜¯ä¸€æ¡æµç•…çš„ç›´çº¿ï¼Œé¿å…è¿‡å¤šçš„åµŒå¥—</li></ol><pre><code class="hljs go"><span class="hljs-comment">// good case</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    a, err := A()    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span> err    &#125;    <span class="hljs-comment">// ... å…¶ä»–é€»è¾‘</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// bad case</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    a, err := A()    <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>    &#125;    <span class="hljs-keyword">return</span> err&#125;</code></pre><ol start="4"><li>åœ¨<strong>åº”ç”¨ç¨‹åº</strong>ä¸­å‡ºç°é”™è¯¯æ—¶ï¼Œä½¿ç”¨ <code>errors.New</code> æˆ–è€… <code>errors.Errorf</code> è¿”å›é”™è¯¯</li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *usecese)</span> <span class="hljs-title">usecase1</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    money := u.repo.getMoney(uid)    <span class="hljs-keyword">if</span> money &lt; <span class="hljs-number">10</span> &#123;        errors.Errorf(<span class="hljs-string">"ç”¨æˆ·ä½™é¢ä¸è¶³, uid: %d, money: %d"</span>, uid, money)    &#125;    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><ol start="5"><li>å¦‚æœæ˜¯è°ƒç”¨<strong>åº”ç”¨ç¨‹åºçš„</strong>å…¶ä»–å‡½æ•°å‡ºç°é”™è¯¯ï¼Œè¯·ç›´æ¥è¿”å›ï¼Œå¦‚æœéœ€è¦æºå¸¦ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ <code>errors.WithMessage</code></li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *usecese)</span> <span class="hljs-title">usecase2</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    name, err := u.repo.getUserName(uid)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span> errors.WithMessage(err, <span class="hljs-string">"å…¶ä»–é™„åŠ ä¿¡æ¯"</span>)    &#125;    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><ol start="6"><li>å¦‚æœæ˜¯è°ƒç”¨å…¶ä»–åº“ï¼ˆæ ‡å‡†åº“ã€ä¼ä¸šå…¬å…±åº“ã€å¼€æºç¬¬ä¸‰æ–¹åº“ç­‰ï¼‰è·å–åˆ°é”™è¯¯æ—¶ï¼Œè¯·ä½¿ç”¨ <code>errors.Wrap</code> æ·»åŠ å †æ ˆä¿¡æ¯<ol><li>åˆ‡è®°ï¼Œä¸è¦æ¯ä¸ªåœ°æ–¹éƒ½æ˜¯ç”¨ <code>errors.Wrap</code> åªéœ€è¦åœ¨é”™è¯¯ç¬¬ä¸€æ¬¡å‡ºç°æ—¶è¿›è¡Œ <code>errors.Wrap</code> å³å¯</li><li>æ ¹æ®åœºæ™¯è¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦å°†å…¶ä»–åº“çš„åŸå§‹é”™è¯¯åæ‰ï¼Œä¾‹å¦‚å¯ä»¥æŠŠ <code>repository</code> å±‚çš„æ•°æ®åº“ç›¸å…³é”™è¯¯åæ‰ï¼Œè¿”å›ä¸šåŠ¡é”™è¯¯ç ï¼Œé¿å…åç»­æˆ‘ä»¬åˆ†å‰²å¾®æœåŠ¡æˆ–è€…æ›´æ¢ <code>ORM</code> åº“æ—¶éœ€è¦å»ä¿®æ”¹ä¸Šå±‚ä»£ç </li><li>æ³¨æ„æˆ‘ä»¬åœ¨åŸºç¡€åº“ï¼Œè¢«å¤§é‡å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ç¼–å†™æ—¶ä¸€èˆ¬ä¸ä½¿ç”¨ <code>errors.Wrap</code> é¿å…å †æ ˆä¿¡æ¯é‡å¤</li></ol></li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    err := json.Unmashal(&amp;a, data)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span> errors.Wrap(err, <span class="hljs-string">"å…¶ä»–é™„åŠ ä¿¡æ¯"</span>)    &#125;    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><ol start="7"><li><strong>ç¦æ­¢</strong>æ¯ä¸ªå‡ºé”™çš„åœ°æ–¹éƒ½æ‰“æ—¥å¿—ï¼Œ<strong>åªéœ€è¦</strong>åœ¨è¿›ç¨‹çš„æœ€å¼€å§‹çš„åœ°æ–¹ä½¿ç”¨ <code>%+v</code> è¿›è¡Œç»Ÿä¸€æ‰“å°ï¼Œä¾‹å¦‚ http/rpc æœåŠ¡çš„ä¸­é—´ä»¶</li><li>é”™è¯¯åˆ¤æ–­ä½¿ç”¨ <code>errors.Is</code> è¿›è¡Œæ¯”è¾ƒ</li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    err := A()    <span class="hljs-keyword">if</span> errors.Is(err, io.EOF)&#123;    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>    &#125;    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><ol start="9"><li>é”™è¯¯ç±»å‹åˆ¤æ–­ï¼Œä½¿ç”¨ <code>errors.As</code> è¿›è¡Œèµ‹å€¼</li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;    err := A()    <span class="hljs-keyword">var</span> errA errorA    <span class="hljs-keyword">if</span> errors.As(err, &amp;errA)&#123;    <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><ol start="10"><li>å¦‚ä½•åˆ¤å®šé”™è¯¯çš„ä¿¡æ¯æ˜¯å¦è¶³å¤Ÿï¼Œæƒ³ä¸€æƒ³å½“ä½ çš„ä»£ç å‡ºç°é—®é¢˜éœ€è¦æ’æŸ¥çš„æ—¶å€™ä½ çš„é”™è¯¯ä¿¡æ¯æ˜¯å¦å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿçš„å®šä½é—®é¢˜ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨è¯·æ±‚ä¸­ä¸€èˆ¬ä¼šè¾“å‡ºå‚æ•°ä¿¡æ¯ï¼Œç”¨äºè¾…åŠ©åˆ¤æ–­é”™è¯¯</li><li>å¯¹äºä¸šåŠ¡é”™è¯¯ï¼Œæ¨èåœ¨ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹åˆ›å»ºä¸€ä¸ªé”™è¯¯å­—å…¸ï¼Œé”™è¯¯å­—å…¸é‡Œé¢åº”è¯¥åŒ…å«é”™è¯¯çš„ codeï¼Œå¹¶ä¸”åœ¨æ—¥å¿—ä¸­ä½œä¸ºç‹¬ç«‹å­—æ®µæ‰“å°ï¼Œæ–¹ä¾¿åšä¸šåŠ¡å‘Šè­¦çš„åˆ¤æ–­ï¼Œé”™è¯¯å¿…é¡»æœ‰æ¸…æ™°çš„é”™è¯¯æ–‡æ¡£</li><li>ä¸éœ€è¦è¿”å›ï¼Œè¢«å¿½ç•¥çš„é”™è¯¯<strong>å¿…é¡»</strong>è¾“å‡ºæ—¥å¿—ä¿¡æ¯</li><li>åŒä¸€ä¸ªåœ°æ–¹ä¸åœçš„æŠ¥é”™ï¼Œæœ€å¥½ä¸è¦ä¸åœè¾“å‡ºé”™è¯¯æ—¥å¿—ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´è¢«å¤§é‡çš„é”™è¯¯æ—¥å¿—ä¿¡æ¯æ·¹æ²¡ï¼Œæ— æ³•æ’æŸ¥é—®é¢˜ï¼Œæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯æ‰“å°ä¸€æ¬¡é”™è¯¯è¯¦æƒ…ï¼Œç„¶åæ‰“å°å‡ºé”™è¯¯å‡ºç°çš„æ¬¡æ•°</li><li>å¯¹åŒä¸€ä¸ªç±»å‹çš„é”™è¯¯ï¼Œé‡‡ç”¨ç›¸åŒçš„æ¨¡å¼ï¼Œä¾‹å¦‚å‚æ•°é”™è¯¯ï¼Œä¸è¦æœ‰çš„è¿”å› 404 æœ‰çš„è¿”å› 200</li><li>å¤„ç†é”™è¯¯çš„æ—¶å€™ï¼Œéœ€è¦å¤„ç†å·²åˆ†é…çš„èµ„æºï¼Œä½¿ç”¨ <code>defer</code> è¿›è¡Œæ¸…ç†ï¼Œä¾‹å¦‚æ–‡ä»¶å¥æŸ„</li></ol><h2 id="panic-or-error"><a href="#panic-or-error" class="headerlink" title="panic or error?"></a>panic or error?</h2><ol><li>åœ¨ Go ä¸­ panic ä¼šå¯¼è‡´ç¨‹åºç›´æ¥é€€å‡ºï¼Œæ˜¯ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯ï¼Œå¦‚æœä½¿ç”¨ <code>panic</code> <code>recovery</code> è¿›è¡Œå¤„ç†çš„è¯ï¼Œä¼šå­˜åœ¨å¾ˆå¤šé—®é¢˜<ol><li>æ€§èƒ½é—®é¢˜ï¼Œé¢‘ç¹ panic recovery æ€§èƒ½ä¸å¥½</li><li>å®¹æ˜“å¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œåªè¦æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡æœ‰å¤„ç†åˆ°å°±ä¼šå¯¼è‡´ç¨‹åºè¿›ç¨‹æ•´ä¸ªé€€å‡º</li><li>ä¸å¯æ§ï¼Œä¸€æ—¦ panic å°±å°†å¤„ç†é€»è¾‘ç§»äº¤ç»™äº†å¤–éƒ¨ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½é¢„è®¾å¤–éƒ¨åŒ…ä¸€å®šä¼šè¿›è¡Œå¤„ç†</li></ol></li><li>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ panic å‘¢ï¼Ÿ<ol><li>å¯¹äºçœŸæ­£æ„å¤–çš„æƒ…å†µï¼Œé‚£äº›è¡¨ç¤ºä¸å¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œä¾‹å¦‚ç´¢å¼•è¶Šç•Œã€ä¸å¯æ¢å¤çš„ç¯å¢ƒé—®é¢˜ã€æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨ panic</li></ol></li><li>ä½¿ç”¨ error å¤„ç†æœ‰å“ªäº›å¥½å¤„ï¼Ÿ<ol><li>ç®€å•ã€‚</li><li>è€ƒè™‘å¤±è´¥ï¼Œè€Œä¸æ˜¯æˆåŠŸ(Plan for failure, not success)ã€‚</li><li>æ²¡æœ‰éšè—çš„æ§åˆ¶æµã€‚</li><li>å®Œå…¨äº¤ç»™ä½ æ¥æ§åˆ¶ errorã€‚</li><li>Error are valuesã€‚</li></ol></li></ol><h2 id="ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­-errors-New-ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ"><a href="#ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­-errors-New-ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­ errors.New ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ"></a>ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­ errors.New ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ</h2><p>ç¿»çœ‹æ ‡å‡†åº“çš„æºä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ <code>errors</code> åº“ä¸­çš„ <code>errorString</code> ç»“æ„ä½“å®ç°äº† <code>error</code> æ¥å£ï¼Œä¸ºä»€ä¹ˆåœ¨ <code>New</code> ä¸€ä¸ª error çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆå‘¢ï¼Ÿ</p><pre><code class="hljs go"><span class="hljs-comment">// New returns an error that formats as the given text.</span><span class="hljs-comment">// Each call to New returns a distinct error value even if the text is identical.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(text <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> &amp;errorString&#123;text&#125;&#125;<span class="hljs-comment">// errorString is a trivial implementation of error.</span><span class="hljs-keyword">type</span> errorString <span class="hljs-keyword">struct</span> &#123;s <span class="hljs-keyword">string</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *errorString)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> e.s&#125;</code></pre><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åŒæ ·åˆ›å»ºäº† errorString çš„ç»“æ„ä½“ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å’Œæ ‡å‡†åº“ä¸­çš„å”¯ä¸€ä¸åŒå°±æ˜¯ï¼Œè‡ªå»ºçš„è¿™ä¸ªè¿”å›çš„æ˜¯å€¼ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆã€‚<br>åœ¨ <code>main</code> å‡½æ•°çš„å¯¹æ¯”ä¸­æˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ <code>errorString</code> åœ¨å¯¹æ¯”çš„æ—¶å€™åªè¦å¯¹åº”çš„å­—ç¬¦ä¸²ç›¸åŒå°±ä¼šè¿”å› trueï¼Œä½†æ˜¯æ ‡å‡†åº“çš„åŒ…ä¸ä¼šã€‚<br>è¿™æ˜¯å› ä¸ºï¼Œåœ¨å¯¹æ¯”ä¸¤ä¸ª struct æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä¼šå»å¯¹æ¯”ï¼Œè¿™ä¸¤ä¸ª struct é‡Œé¢çš„å„ä¸ªå­—æ®µæ˜¯å¦æ˜¯ç›¸åŒçš„ï¼Œå¦‚æœç›¸åŒå°±è¿”å› trueï¼Œä½†æ˜¯å¯¹æ¯”æŒ‡é’ˆçš„æ—¶å€™ä¼šå»åˆ¤æ–­ä¸¤ä¸ªæŒ‡é’ˆçš„åœ°å€æ˜¯å¦ä¸€è‡´ã€‚<br><strong>å¦‚æœå­—ç¬¦ä¸²ç›¸ç­‰å°±è¿”å› true ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</strong><br>å¦‚æœæˆ‘æœ‰ä¸¤ä¸ªåŒ…å®šä¹‰äº†å­—ç¬¦ä¸²ç›¸åŒçš„æƒ³ä¸ªé”™è¯¯ï¼Œåœ¨å…¶ä»–åº“è°ƒç”¨å¯¹æ¯”çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šç”±äºä¸åŒçš„ä¹¦å†™é¡ºåºèµ°è¿›ä¸åŒçš„åˆ†æ”¯å¯¼è‡´ä¸€äº›ä¸å¯é¢„æœŸçš„å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> errorString <span class="hljs-keyword">struct</span> &#123;text <span class="hljs-keyword">string</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e errorString)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> e.text&#125;<span class="hljs-comment">// New åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> errorString&#123;text: s&#125;&#125;<span class="hljs-keyword">var</span> errorString1 = New(<span class="hljs-string">"test a"</span>)<span class="hljs-keyword">var</span> err1 = errors.New(<span class="hljs-string">"test b"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">if</span> errorString1 == New(<span class="hljs-string">"test a"</span>) &#123;fmt.Println(<span class="hljs-string">"err string a"</span>) <span class="hljs-comment">// ä¼šè¾“å‡º</span>&#125;<span class="hljs-keyword">if</span> err1 == errors.New(<span class="hljs-string">"test b"</span>) &#123;fmt.Println(<span class="hljs-string">"err b"</span>) <span class="hljs-comment">// ä¸ä¼šè¾“å‡º</span>&#125;&#125;</code></pre><h2 id="error-type-é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­"><a href="#error-type-é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­" class="headerlink" title="error type: é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­"></a>error type: é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­</h2><h3 id="Sentinel-Error"><a href="#Sentinel-Error" class="headerlink" title="Sentinel Error"></a>Sentinel Error</h3><p>å“¨å…µé”™è¯¯ï¼Œå°±æ˜¯å®šä¹‰ä¸€äº›åŒ…çº§åˆ«çš„é”™è¯¯å˜é‡ï¼Œç„¶ååœ¨è°ƒç”¨çš„æ—¶å€™å¤–éƒ¨åŒ…å¯ä»¥ç›´æ¥å¯¹æ¯”å˜é‡è¿›è¡Œåˆ¤å®šï¼Œåœ¨æ ‡å‡†åº“å½“ä¸­å¤§é‡çš„ä½¿ç”¨äº†è¿™ç§æ–¹å¼<br>ä¾‹å¦‚ä¸‹æ–¹ <code>io</code> åº“ä¸­å®šä¹‰çš„é”™è¯¯</p><pre><code class="hljs go"><span class="hljs-comment">// EOF is the error returned by Read when no more input is available.</span><span class="hljs-comment">// Functions should return EOF only to signal a graceful end of input.</span><span class="hljs-comment">// If the EOF occurs unexpectedly in a structured data stream,</span><span class="hljs-comment">// the appropriate error is either ErrUnexpectedEOF or some other error</span><span class="hljs-comment">// giving more detail.</span><span class="hljs-keyword">var</span> EOF = errors.New(<span class="hljs-string">"EOF"</span>)<span class="hljs-comment">// ErrUnexpectedEOF means that EOF was encountered in the</span><span class="hljs-comment">// middle of reading a fixed-size block or data structure.</span><span class="hljs-keyword">var</span> ErrUnexpectedEOF = errors.New(<span class="hljs-string">"unexpected EOF"</span>)<span class="hljs-comment">// ErrNoProgress is returned by some clients of an io.Reader when</span><span class="hljs-comment">// many calls to Read have failed to return any data or error,</span><span class="hljs-comment">// usually the sign of a broken io.Reader implementation.</span><span class="hljs-keyword">var</span> ErrNoProgress = errors.New(<span class="hljs-string">"multiple Read calls return no data or error"</span>)</code></pre><p>æˆ‘ä»¬åœ¨å¤–éƒ¨åˆ¤å®šçš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨ç­‰å€¼åˆ¤å®šæˆ–è€…ä½¿ç”¨ <code>errors.Is</code> è¿›è¡Œåˆ¤æ–­</p><pre><code class="hljs go"><span class="hljs-keyword">if</span> err == io.EOF &#123;<span class="hljs-comment">//...</span>&#125;<span class="hljs-keyword">if</span> errors.Is(err, io.EOF)&#123;<span class="hljs-comment">//...</span>&#125;</code></pre><p>è¿™ç§é”™è¯¯å¤„ç†æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå°† error å½“åšåŒ…çš„ API æš´éœ²ç»™äº†ç¬¬ä¸‰æ–¹ï¼Œè¿™æ ·ä¼šå¯¼è‡´åœ¨åšé‡æ„æˆ–è€…å‡çº§çš„æ—¶å€™å¾ˆéº»çƒ¦ï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼åŒ…å«çš„é”™è¯¯ä¿¡æ¯ä¼šååˆ†çš„æœ‰é™</p><h3 id="error-types"><a href="#error-types" class="headerlink" title="error types"></a>error types</h3><p>è¿™ä¸ªå°±ç±»ä¼¼æˆ‘ä»¬å‰é¢å®šä¹‰çš„ <code>errorString</code> ä¸€æ ·å®ç°äº† <code>error</code> çš„æ¥å£ï¼Œç„¶ååœ¨å¤–éƒ¨æ˜¯å¦ç±»å‹æ–­è¨€æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è¿™ç§é”™è¯¯ç±»å‹</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> MyStruct <span class="hljs-keyword">struct</span> &#123;s <span class="hljs-keyword">string</span>    name <span class="hljs-keyword">string</span>    path <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// ä½¿ç”¨çš„æ—¶å€™</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span> &#123;    <span class="hljs-keyword">switch</span> err.(<span class="hljs-keyword">type</span>) &#123;        <span class="hljs-keyword">case</span> *MyStruct:        <span class="hljs-comment">// ...</span>        <span class="hljs-keyword">case</span> others:        <span class="hljs-comment">// ...</span>    &#125;&#125;</code></pre><p>è¿™ç§æ–¹å¼ç›¸å¯¹äºå“¨å…µæ¥è¯´ï¼Œå¯ä»¥åŒ…å«æ›´åŠ ä¸°å¯Œçš„ä¿¡æ¯ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿå°†é”™è¯¯çš„ç±»å‹æš´éœ²ç»™äº†å¤–éƒ¨ï¼Œä¾‹å¦‚æ ‡å‡†åº“ä¸­çš„ <code>os.PathError</code></p><h3 id="Opaque-errors"><a href="#Opaque-errors" class="headerlink" title="Opaque errors"></a>Opaque errors</h3><p>ä¸é€æ˜çš„é”™è¯¯å¤„ç†ï¼Œè¿™ç§æ–¹å¼æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯åªè¿”å›é”™è¯¯ï¼Œæš´éœ²é”™è¯¯åˆ¤å®šæ¥å£ï¼Œä¸è¿”å›ç±»å‹ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ API çš„æš´éœ²ï¼Œåç»­çš„å¤„ç†ä¼šæ¯”è¾ƒçµæ´»ï¼Œè¿™ä¸ªä¸€èˆ¬ç”¨åœ¨å…¬å…±åº“ä¼šæ¯”è¾ƒå¥½</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> temporary <span class="hljs-keyword">interface</span> &#123;Temporary() <span class="hljs-keyword">bool</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">IsTemporary</span><span class="hljs-params">(err error)</span> <span class="hljs-title">bool</span></span> &#123;te, ok := err.(temporary)<span class="hljs-keyword">return</span> ok &amp;&amp; te.Temporary()&#125;</code></pre><p>è¿™ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥æ–­è¨€é”™è¯¯å®ç°äº†ç‰¹å®šçš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯æ–­è¨€é”™è¯¯æ˜¯ç‰¹å®šçš„ç±»å‹æˆ–å€¼</p><h2 id="error-handle-é”™è¯¯å¤„ç†ä¼˜åŒ–"><a href="#error-handle-é”™è¯¯å¤„ç†ä¼˜åŒ–" class="headerlink" title="error handle: é”™è¯¯å¤„ç†ä¼˜åŒ–"></a>error handle: é”™è¯¯å¤„ç†ä¼˜åŒ–</h2><p>åœ¨ go ä¸­å¸¸å¸¸ä¼šå­˜åœ¨å¤§é‡çš„ <code>if err</code> ä»£ç ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§å¸¸è§çš„å‡å°‘è¿™ç§ä»£ç çš„æ–¹å¼</p><h3 id="bufio-scan"><a href="#bufio-scan" class="headerlink" title="bufio.scan"></a>bufio.scan</h3><p>å¯¹æ¯”ä¸‹é¢ä¸¤ä¸ªå‡½æ•°çš„å¤„ç†æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ <code>count2</code> ä½¿ç”¨ <code>sc.Scan</code> ä¹‹åä¸€ä¸ª <code>if err</code> çš„åˆ¤æ–­éƒ½æ²¡æœ‰ï¼Œæå¤§çš„ç®€åŒ–äº†ä»£ç ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ <code>sc.Scan</code> åšäº†å¾ˆå¤šå¤„ç†ï¼Œåƒå¾ˆå¤šç±»ä¼¼çš„ï¼Œéœ€è¦å¾ªç¯è¯»å–çš„éƒ½å¯ä»¥è€ƒè™‘åƒè¿™æ ·åŒ…è£…ä¹‹åè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å¤–éƒ¨åŒ…è°ƒç”¨çš„æ—¶å€™å°±ä¼šéå¸¸ç®€æ´</p><pre><code class="hljs go"><span class="hljs-comment">// ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">count</span><span class="hljs-params">(r io.Reader)</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, error)</span></span> &#123;<span class="hljs-keyword">var</span> (br    = bufio.NewReader(r)lines <span class="hljs-keyword">int</span>err   error)<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// è¯»å–åˆ°æ¢è¡Œç¬¦å°±è¯´æ˜æ˜¯ä¸€è¡Œ</span>_, err = br.ReadString(<span class="hljs-string">'\n'</span>)lines++<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">break</span>&#125;&#125;<span class="hljs-comment">// å½“é”™è¯¯æ˜¯ EOF çš„æ—¶å€™è¯´æ˜æ–‡ä»¶è¯»å–å®Œæ¯•äº†</span><span class="hljs-keyword">if</span> err != io.EOF &#123;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, err&#125;<span class="hljs-keyword">return</span> lines, err&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">count2</span><span class="hljs-params">(r io.Reader)</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, error)</span></span> &#123;<span class="hljs-keyword">var</span> (sc    = bufio.NewScanner(r)lines <span class="hljs-keyword">int</span>)<span class="hljs-keyword">for</span> sc.Scan() &#123;lines++&#125;<span class="hljs-keyword">return</span> lines, sc.Err()&#125;</code></pre><h3 id="error-writer"><a href="#error-writer" class="headerlink" title="error writer"></a>error writer</h3><p>çœ‹ä¸€ä¸ªæ¥è‡ª go blog çš„ä¾‹å­ï¼š<a href="https://blog.golang.org/errors-are-values" target="_blank" rel="noopener">https://blog.golang.org/errors-are-values</a><br>ä¸€èˆ¬ä»£ç </p><pre><code class="hljs go">_, err = fd.Write(p0[a:b])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    <span class="hljs-keyword">return</span> err&#125;_, err = fd.Write(p1[c:d])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    <span class="hljs-keyword">return</span> err&#125;_, err = fd.Write(p2[e:f])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    <span class="hljs-keyword">return</span> err&#125;<span class="hljs-comment">// and so on</span></code></pre><p>errWriter</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> errWriter <span class="hljs-keyword">struct</span> &#123;    w   io.Writer    err error&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ew *errWriter)</span> <span class="hljs-title">write</span><span class="hljs-params">(buf []<span class="hljs-keyword">byte</span>)</span></span> &#123;    <span class="hljs-keyword">if</span> ew.err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span>    &#125;    _, ew.err = ew.w.Write(buf)&#125;<span class="hljs-comment">// ä½¿ç”¨æ—¶</span>ew := &amp;errWriter&#123;w: fd&#125;ew.write(p0[a:b])ew.write(p1[c:d])ew.write(p2[e:f])<span class="hljs-comment">// and so on</span><span class="hljs-keyword">if</span> ew.err != <span class="hljs-literal">nil</span> &#123;    <span class="hljs-keyword">return</span> ew.err&#125;</code></pre><p>å¦‚æœå»ç¿» æ ‡å‡†åº“ä¸­ bufio.Writer çš„æºä»£ç ï¼Œä½ ä¼šå‘ç°ä¹Ÿæœ‰è¿™ç§ç”¨æ³•ï¼Œè¿™ç§å°±æ˜¯å°†é‡å¤çš„é€»è¾‘è¿›è¡Œäº†å°è£…ï¼Œç„¶åæŠŠ error æš‚å­˜ï¼Œç„¶åæˆ‘ä»¬å°±åªéœ€è¦åœ¨æœ€ååˆ¤æ–­ä¸€ä¸‹ error å°±è¡Œäº†</p><h2 id="wrap-error-é”™è¯¯åŒ…è£…"><a href="#wrap-error-é”™è¯¯åŒ…è£…" class="headerlink" title="wrap error: é”™è¯¯åŒ…è£…"></a>wrap error: é”™è¯¯åŒ…è£…</h2><h3 id="errors-wrap-æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„-fmt-Errorf-quot-w-quot"><a href="#errors-wrap-æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„-fmt-Errorf-quot-w-quot" class="headerlink" title="errors.wrap æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„ fmt.Errorf(&quot;%w&quot;)"></a>errors.wrap æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„ <code>fmt.Errorf(&quot;%w&quot;)</code></h3><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ ‡å‡†åº“çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å½“ <code>p.wrappedErr != nil</code> çš„æ—¶å€™ï¼ˆä¹Ÿå°±æ˜¯æœ‰ %wï¼‰çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ä¸€ä¸ª <code>wrapError</code> å°†é”™è¯¯åŒ…è£…ï¼Œçœ‹ <code>wrapError</code> çš„æºç å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ–¹æ³•åªæ˜¯åŒ…è£…äº†ä¸€ä¸‹åŸå§‹é”™è¯¯ï¼Œå¹¶ä¸”å¯ä»¥åšåˆ°é™„åŠ ä¸€äº›æ–‡æœ¬ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å †æ ˆä¿¡æ¯ã€‚</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Errorf</span><span class="hljs-params">(format <span class="hljs-keyword">string</span>, a ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;p := newPrinter()p.wrapErrs = <span class="hljs-literal">true</span>p.doPrintf(format, a)s := <span class="hljs-keyword">string</span>(p.buf)<span class="hljs-keyword">var</span> err error<span class="hljs-keyword">if</span> p.wrappedErr == <span class="hljs-literal">nil</span> &#123;err = errors.New(s)&#125; <span class="hljs-keyword">else</span> &#123;err = &amp;wrapError&#123;s, p.wrappedErr&#125;&#125;p.free()<span class="hljs-keyword">return</span> err&#125;<span class="hljs-keyword">type</span> wrapError <span class="hljs-keyword">struct</span> &#123;msg <span class="hljs-keyword">string</span>err error&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *wrapError)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> e.msg&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *wrapError)</span> <span class="hljs-title">Unwrap</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> e.err&#125;</code></pre><p>åœ¨çœ‹ä¸€ä¸‹ pkg/errors çš„æºç ï¼Œæˆ‘è‚¯å¯ä»¥å‘ç°é™¤äº†ä½¿ç”¨ <code>withMessage</code> é™„åŠ äº†é”™è¯¯ä¿¡æ¯ä¹‹å¤–è¿˜ä½¿ç”¨ <code>withStack</code> é™„åŠ äº†å †æ ˆä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ç¨‹åºå…¥å£å¤„æ‰“å°æ—¥å¿—ä¿¡æ¯çš„æ—¶å€™å°±å¯ä»¥å°†å †æ ˆä¿¡æ¯ä¸€å¹¶æ‰“å‡ºäº†</p><pre><code class="hljs go"><span class="hljs-comment">// Wrap returns an error annotating err with a stack trace</span><span class="hljs-comment">// at the point Wrap is called, and the supplied message.</span><span class="hljs-comment">// If err is nil, Wrap returns nil.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Wrap</span><span class="hljs-params">(err error, message <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;err = &amp;withMessage&#123;cause: err,msg:   message,&#125;<span class="hljs-keyword">return</span> &amp;withStack&#123;err,callers(),&#125;&#125;</code></pre><h3 id="ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨-errors-Wrap"><a href="#ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨-errors-Wrap" class="headerlink" title="ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨ errors.Wrap"></a>ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨ errors.Wrap</h3><p>å› ä¸ºæ¯ä¸€æ¬¡ <code>errors.Wrap</code> çš„è°ƒç”¨éƒ½ä¼šä¸ºé”™è¯¯æ·»åŠ å †æ ˆä¿¡æ¯ï¼Œå¦‚æœå¤„å¤„è°ƒç”¨é‚£ä¼šæœ‰å¤§é‡çš„æ— ç”¨å †æ ˆ<br>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹åªæœ‰ä¸€å¤„ wrap</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;fmt.Printf(<span class="hljs-string">"err: %+v"</span>, c())&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">a</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> errors.Wrap(fmt.Errorf(<span class="hljs-string">"xxx"</span>), <span class="hljs-string">"test"</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">b</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> a()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">c</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> b()&#125;</code></pre><p>çœ‹ç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°å·²ç»å¯ä»¥æ‰“å°å‡ºå…¨éƒ¨çš„å †æ ˆä¿¡æ¯äº†</p><pre><code class="hljs go">err: xxxtestmain.a        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">14</span>main.b        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">18</span>main.c        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>main.main        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>runtime.main        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>runtime.goexit        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span></code></pre><p>å†çœ‹å¤šå¤„ wrap çš„ç°è±¡</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;fmt.Printf(<span class="hljs-string">"err: %+v"</span>, c())&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">a</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> errors.Wrap(fmt.Errorf(<span class="hljs-string">"xxx"</span>), <span class="hljs-string">"a"</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">b</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> errors.Wrap(a(), <span class="hljs-string">"b"</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">c</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> errors.Wrap(b(), <span class="hljs-string">"c"</span>)&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°æ¯ä¸€å¤„ wrap éƒ½æ·»åŠ äº†ä¸€æ¬¡å †æ ˆä¿¡æ¯</p><pre><code class="hljs go">err: xxxamain.a        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">14</span>main.b        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">18</span>main.c        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>main.main        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>runtime.main        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>runtime.goexit        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span>bmain.b        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">18</span>main.c        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>main.main        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>runtime.main        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>runtime.goexit        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span>cmain.c        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>main.main        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>runtime.main        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>runtime.goexit        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span></code></pre><h2 id="æ ‡å‡†åº“-errors-Is-As-æ€ä¹ˆåˆ¤æ–­é”™è¯¯"><a href="#æ ‡å‡†åº“-errors-Is-As-æ€ä¹ˆåˆ¤æ–­é”™è¯¯" class="headerlink" title="æ ‡å‡†åº“ errors.Is / As æ€ä¹ˆåˆ¤æ–­é”™è¯¯"></a>æ ‡å‡†åº“ errors.Is / As æ€ä¹ˆåˆ¤æ–­é”™è¯¯</h2><h3 id="errors-Is"><a href="#errors-Is" class="headerlink" title="errors.Is"></a>errors.Is</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Is</span><span class="hljs-params">(err, target error)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">if</span> target == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err == target&#125;<span class="hljs-comment">// é€šè¿‡åå°„åˆ¤è¯» target æ˜¯å¦å¯ä»¥è¢«æ¯”è¾ƒ</span>isComparable := reflectlite.TypeOf(target).Comparable()<span class="hljs-keyword">for</span> &#123;        <span class="hljs-comment">// å¾ªç¯åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span><span class="hljs-keyword">if</span> isComparable &amp;&amp; err == target &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å®ç°äº† is æ¥å£ï¼Œå¦‚æœæœ‰å®ç°å°±ç›´æ¥åˆ¤æ–­</span><span class="hljs-keyword">if</span> x, ok := err.(<span class="hljs-keyword">interface</span>&#123; Is(error) <span class="hljs-keyword">bool</span> &#125;); ok &amp;&amp; x.Is(target) &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;<span class="hljs-comment">// å»åˆ¤æ–­æ˜¯å¦å®ç°äº† unwrap çš„æ¥å£ï¼Œå¦‚æœå®ç°äº†å°±è¿›è¡Œ unwrap</span><span class="hljs-keyword">if</span> err = Unwrap(err); err == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;&#125;&#125;</code></pre><h3 id="errors-As"><a href="#errors-As" class="headerlink" title="errors.As"></a>errors.As</h3><p>å’Œ is çš„é€»è¾‘ç±»ä¼¼ï¼Œå°±æ˜¯ä¸æ–­çš„è¿›è¡Œ unwrap è¿›è¡Œæ¯”è¾ƒï¼Œåªè¦æœ‰ä¸€ä¸ªç›¸åŒå°±è¿”å›ï¼Œå¦‚æœä¸€ç›´åˆ°åº•éƒ½ä¸è¡Œå°±è¿”å› false</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">As</span><span class="hljs-params">(err error, target <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">if</span> target == <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"errors: target cannot be nil"</span>)&#125;val := reflectlite.ValueOf(target)typ := val.Type()<span class="hljs-keyword">if</span> typ.Kind() != reflectlite.Ptr || val.IsNil() &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"errors: target must be a non-nil pointer"</span>)&#125;<span class="hljs-keyword">if</span> e := typ.Elem(); e.Kind() != reflectlite.Interface &amp;&amp; !e.Implements(errorType) &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"errors: *target must be interface or implement error"</span>)&#125;targetType := typ.Elem()<span class="hljs-keyword">for</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">if</span> reflectlite.TypeOf(err).AssignableTo(targetType) &#123;val.Elem().Set(reflectlite.ValueOf(err))<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;<span class="hljs-keyword">if</span> x, ok := err.(<span class="hljs-keyword">interface</span>&#123; As(<span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-keyword">bool</span> &#125;); ok &amp;&amp; x.As(target) &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;err = Unwrap(err)&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;</code></pre><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸ç‚¹ä¸ªå…³æ³¨èµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>Goè¿›é˜¶è®­ç»ƒè¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>Goè¿›é˜¶è®­ç»ƒè¥</tag>
      
      <tag>error</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Week01: å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&amp;å¤šç§Ÿæˆ·</title>
    <link href="/post/go-training-02.html"/>
    <url>/post/go-training-02.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><p>ä¸Šç¯‡æ–‡ç« æˆ‘ä»¬è®²åˆ°å¾®æœåŠ¡çš„å®šä¹‰ï¼Œä¼˜ç¼ºç‚¹ï¼Œå¯¹å¤–æš´éœ²ç­‰ï¼ŒæœåŠ¡é™¤äº†å¯¹å¤–æš´éœ²ä¹‹å¤–ï¼ŒæœåŠ¡ä¹‹é—´è¿˜éœ€è¦ç›¸äº’è¿›è¡Œè°ƒç”¨ï¼Œä¸åŒçš„æœåŠ¡ä¹‹é—´é€šè¿‡ä»€ä¹ˆæ ·çš„åè®®è¿›è¡Œäº¤äº’ï¼ŒæœåŠ¡å‘ç°å¦‚ä½•å®ç°ï¼Œå¦‚ä½•ä¿è¯æœåŠ¡çš„å¹³æ»‘å‘å¸ƒä¸é‡å¯ï¼Œæµ‹è¯•ç¯å¢ƒçš„é—®é¢˜å¦‚ä½•è§£å†³ç­‰ã€‚</p><h2 id="æœåŠ¡é—´é€šä¿¡æ–¹å¼-gRPC"><a href="#æœåŠ¡é—´é€šä¿¡æ–¹å¼-gRPC" class="headerlink" title="æœåŠ¡é—´é€šä¿¡æ–¹å¼: gRPC"></a>æœåŠ¡é—´é€šä¿¡æ–¹å¼: gRPC</h2><ul><li><strong>ä¸ºä»€ä¹ˆé‡‡ç”¨ gRPC?</strong><ul><li><strong>å¤šè¯­è¨€ï¼š</strong>è¯­è¨€ä¸­ç«‹ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚</li><li><strong>è½»é‡çº§ã€é«˜æ€§èƒ½ï¼š</strong>åºåˆ—åŒ–æ”¯æŒ PB(Protocol Buffer)å’Œ JSONï¼ŒPB æ˜¯ä¸€ç§è¯­è¨€æ— å…³çš„é«˜æ€§èƒ½åºåˆ—åŒ–æ¡†æ¶ã€‚</li><li><strong>å¯æ’æ‹”</strong></li><li><strong>IDLï¼š</strong>åŸºäºæ–‡ä»¶å®šä¹‰æœåŠ¡ï¼Œé€šè¿‡ proto3 å·¥å…·ç”ŸæˆæŒ‡å®šè¯­è¨€çš„æ•°æ®ç»“æ„ã€æœåŠ¡ç«¯æ¥å£ä»¥åŠå®¢æˆ·ç«¯ Stubã€‚</li><li>ç§»åŠ¨ç«¯ï¼šåŸºäº<strong>æ ‡å‡†çš„ HTTP2 è®¾è®¡ï¼Œæ”¯æŒåŒå‘æµã€æ¶ˆæ¯å¤´å‹ç¼©ã€å• TCP çš„å¤šè·¯å¤ç”¨</strong>ã€æœåŠ¡ç«¯æ¨é€ç­‰ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§ä½¿å¾— gRPC åœ¨ç§»åŠ¨ç«¯è®¾å¤‡ä¸Šæ›´åŠ <strong>çœç”µå’ŒèŠ‚çœç½‘ç»œæµé‡</strong>ã€‚</li><li><strong>æœåŠ¡è€Œéå¯¹è±¡ã€æ¶ˆæ¯è€Œéå¼•ç”¨ï¼š</strong>ä¿ƒè¿›å¾®æœåŠ¡çš„ç³»ç»Ÿé—´ç²—ç²’åº¦æ¶ˆæ¯äº¤äº’è®¾è®¡ç†å¿µã€‚</li><li><strong>è´Ÿè½½æ— å…³çš„ï¼š</strong>ä¸åŒçš„æœåŠ¡éœ€è¦ä½¿ç”¨ä¸åŒçš„æ¶ˆæ¯ç±»å‹å’Œç¼–ç ï¼Œä¾‹å¦‚ protocol buffersã€JSONã€XML å’Œ Thriftã€‚</li><li>æµï¼šStreaming APIã€‚</li><li><strong>é˜»å¡å¼å’Œéé˜»å¡å¼ï¼š</strong>æ”¯æŒå¼‚æ­¥å’ŒåŒæ­¥å¤„ç†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é—´äº¤äº’çš„æ¶ˆæ¯åºåˆ—ã€‚</li><li><strong>å…ƒæ•°æ®äº¤æ¢ï¼š</strong>å¸¸è§çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå¦‚è®¤è¯æˆ–è·Ÿè¸ªï¼Œä¾èµ–æ•°æ®äº¤æ¢ã€‚<ul><li>metadata</li></ul></li><li><strong>æ ‡å‡†åŒ–çŠ¶æ€ç ï¼š</strong>å®¢æˆ·ç«¯é€šå¸¸ä»¥æœ‰é™çš„æ–¹å¼å“åº” API è°ƒç”¨è¿”å›çš„é”™è¯¯ã€‚</li></ul></li><li><strong>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ restful</strong><ul><li>æ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦å•ç‹¬å†™ SDKï¼Œå¤æ‚éº»çƒ¦</li><li>éœ€è¦å•ç‹¬å†™æ–‡æ¡£ï¼Œå¸¸å¸¸ä¼šå› ä¸ºä»£ç æ›´æ–°äº†ä½†æ˜¯æ–‡æ¡£æ²¡æ›´æ–°é™·å…¥å‘ä¸­</li><li>æ€§èƒ½ä¸å¤ªå¥½ï¼Œjson ä¼ é€’ç›¸å¯¹äº pb æ›´è€—æµé‡ï¼Œæ€§èƒ½æ›´ä½</li><li>http1.1 æ˜¯ä¸€ä¸ªå•è¿æ¥çš„è¯·æ±‚ï¼Œåœ¨å†…éƒ¨ç½‘ç»œç¯å¢ƒï¼Œä½¿ç”¨ http æ¯”è¾ƒæµªè´¹</li><li><strong>restful æ˜¯ä¸€ä¸ªæ¾æ•£çº¦æŸçš„åè®®ï¼Œéå¸¸çµæ´»ï¼Œæ¯ä¸ªäººï¼Œæ¯ä¸ªå›¢é˜Ÿå‡ºæ¥çš„ä»£ç éƒ½ä¸å¤ªä¸€æ ·ï¼Œæ¯”è¾ƒå®¹æ˜“å‡ºé”™</strong></li></ul></li></ul><h2 id="ä¼˜é›…å¯åŠ¨ä¸ä¼˜é›…ä¸­æ­¢ï¼ˆå¥åº·æ£€æŸ¥ï¼‰"><a href="#ä¼˜é›…å¯åŠ¨ä¸ä¼˜é›…ä¸­æ­¢ï¼ˆå¥åº·æ£€æŸ¥ï¼‰" class="headerlink" title="ä¼˜é›…å¯åŠ¨ä¸ä¼˜é›…ä¸­æ­¢ï¼ˆå¥åº·æ£€æŸ¥ï¼‰"></a>ä¼˜é›…å¯åŠ¨ä¸ä¼˜é›…ä¸­æ­¢ï¼ˆå¥åº·æ£€æŸ¥ï¼‰</h2><h3 id="ä¼˜é›…å¯åŠ¨"><a href="#ä¼˜é›…å¯åŠ¨" class="headerlink" title="ä¼˜é›…å¯åŠ¨"></a>ä¼˜é›…å¯åŠ¨</h3><p><img src="https://lailin.xyz/images/1606735520428-1f37cd30-225e-4b2c-a104-7ba3bbfe17c2.svg" srcset="/img/loading.gif" alt="01_Goè¿›é˜¶è®­ç»ƒè¥_å¾®æœåŠ¡_v1.svg"></p><ol><li>Provider å¯åŠ¨ï¼Œk8s ä¸­çš„å¯åŠ¨è„šæœ¬ä¼šå®šæ—¶å»æ£€æŸ¥æœåŠ¡çš„å¥åº·æ£€æŸ¥æ¥å£</li><li>å¥åº·æ£€æŸ¥é€šè¿‡ä¹‹åï¼ŒæœåŠ¡æ³¨å†Œè„šæœ¬å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡ï¼ˆrpc://ip:portï¼‰</li><li>æ¶ˆè´¹è€…å®šæ—¶ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡æ–¹åœ°å€ä¿¡æ¯</li><li>è·å–æˆåŠŸåï¼Œä¼šå®šæ—¶çš„å‘æœåŠ¡æ–¹å‘èµ·å¥åº·æ£€æŸ¥ï¼Œå¥åº·æ£€æŸ¥é€šè¿‡åæ‰ä¼šå‘è¿™ä¸ªåœ°å€å‘èµ·è¯·æ±‚<ol><li>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¦‚æœå¥åº·æ£€æŸ¥å‡ºç°é—®é¢˜ï¼Œä¼šä»æ¶ˆè´¹è€…æœ¬åœ°çš„è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤</li></ol></li></ol><h3 id="ä¼˜é›…ä¸­æ­¢"><a href="#ä¼˜é›…ä¸­æ­¢" class="headerlink" title="ä¼˜é›…ä¸­æ­¢"></a>ä¼˜é›…ä¸­æ­¢</h3><p><img src="https://lailin.xyz/images/1606742744880-38b16366-6370-408b-8619-7a67d56c0c49.svg" srcset="/img/loading.gif" alt="01_Goè¿›é˜¶è®­ç»ƒè¥_å¾®æœåŠ¡_v1.drawio.svg"></p><ol><li>è§¦å‘ä¸‹çº¿æ“ä½œ: é¦–å…ˆç”¨æˆ·åœ¨å‘å¸ƒå¹³å°ç‚¹å‡»å‘ç‰ˆ/ä¸‹çº¿æŒ‰é’®</li><li>å‘å¸ƒéƒ¨ç½²å¹³å°å‘æ³¨å†Œä¸­å¿ƒå‘èµ·æœåŠ¡æ³¨é”€è¯·æ±‚ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒä¸‹çº¿æœåŠ¡çš„è¿™ä¸ªèŠ‚ç‚¹<ul><li>è¿™é‡Œåœ¨å‘å¸ƒéƒ¨ç½²å¹³å°å®ç°æœ‰ä¸ªå¥½å¤„ï¼Œä¸ç”¨æ¯ä¸ªåº”ç”¨éƒ½å»å®ç°ä¸€éç›¸åŒçš„é€»è¾‘</li><li>åœ¨åº”ç”¨å—åˆ°é€€å‡ºä¿¡å·ä¹‹åç”±åº”ç”¨ä¸»åŠ¨å‘èµ·æ³¨é”€æ“ä½œä¹Ÿæ˜¯å¯ä»¥çš„</li></ul></li></ol><ul><li>2.1 æ³¨å†Œä¸­å¿ƒä¸‹çº¿åº”ç”¨ä¹‹åï¼Œæ¶ˆè´¹è€…ä¼šè·å–åˆ°æœåŠ¡æ³¨é”€çš„äº‹ä»¶ï¼Œç„¶åå°†æœåŠ¡æ–¹çš„èŠ‚ç‚¹ä»æœ¬åœ°è´Ÿè½½å‡è¡¡å½“ä¸­ç§»é™¤<ol><li>æ³¨æ„è¿™ä¸€æ­¥æ“ä½œä¼šæœ‰ä¸€æ®µæ—¶é—´ï¼Œä¸‹é¢çš„ç¬¬å››æ­¥å¹¶ä¸æ˜¯è¿™ä¸€æ­¥ç»“æŸäº†æ‰å¼€å§‹</li></ol></li></ul><ol start="3"><li>å‘å¸ƒéƒ¨ç½²å¹³å°å‘åº”ç”¨å‘é€ <code>SIGTERM</code> ä¿¡å·ï¼Œåº”ç”¨æ•è·åˆ°ä¹‹åæ‰§è¡Œ<ol><li>å°†å¥åº·æ£€æŸ¥æ¥å£è®¾ç½®ä¸ºä¸å¥åº·ï¼Œè¿”å›é”™è¯¯<ol><li>è¿™ä¸ªæ—¶å€™å¦‚æœæ¶ˆè´¹è€…è¿˜åœ¨è°ƒç”¨åº”ç”¨ç¨‹åºï¼Œè°ƒç”¨å¥åº·æ£€æŸ¥æ¥å£å‘ç°æ— æ³•é€šè¿‡ï¼Œä¹Ÿä¼šå°†æœåŠ¡èŠ‚ç‚¹ä»æœ¬åœ°è´Ÿè½½å‡è¡¡å½“ä¸­ç§»é™¤</li></ol></li><li>è°ƒç”¨ grpc/http çš„ shutdown æ¥å£ï¼Œå¹¶ä¸”ä¼ é€’è¶…æ—¶æ—¶é—´ï¼Œç­‰å¾…è¿æ¥å…¨éƒ¨å…³é—­åé€€å‡º<ol><li>è¿™ä¸ªè¶…æ—¶æ—¶é—´ä¸€èˆ¬ä¸º 2 ä¸ªå¿ƒè·³å‘¨æœŸ</li></ol></li></ol></li><li>å‘å¸ƒéƒ¨ç½²å¹³å°å¦‚æœå‘ç°åº”ç”¨ç¨‹åºé•¿æ—¶é—´æ²¡æœ‰å®Œæˆé€€å‡ºï¼Œå‘é€ <code>SIGKILL</code> å¼ºåˆ¶é€€å‡ºåº”ç”¨<ol><li>è¿™ä¸ªè¶…æ—¶æ—¶é—´æ ¹æ®åº”ç”¨è¿›è¡Œè®¾ç½®ä¸€èˆ¬ä¸º 10 - 60s</li></ol></li></ol><h3 id="å®æˆ˜-åœ¨-gin-ä¸­å®ç°ä¼˜é›…å¯åŠ¨å’Œä¼˜é›…ä¸­æ­¢"><a href="#å®æˆ˜-åœ¨-gin-ä¸­å®ç°ä¼˜é›…å¯åŠ¨å’Œä¼˜é›…ä¸­æ­¢" class="headerlink" title="å®æˆ˜-åœ¨ gin ä¸­å®ç°ä¼˜é›…å¯åŠ¨å’Œä¼˜é›…ä¸­æ­¢"></a>å®æˆ˜-åœ¨ gin ä¸­å®ç°ä¼˜é›…å¯åŠ¨å’Œä¼˜é›…ä¸­æ­¢</h3><p>æºç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°<br><a href="https://github.com/mohuishou/Go-000/tree/main/Week01" target="_blank" rel="noopener">https://github.com/mohuishou/Go-000/tree/main/Week01</a></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"context"</span><span class="hljs-string">"log"</span><span class="hljs-string">"net/http"</span><span class="hljs-string">"os"</span><span class="hljs-string">"os/signal"</span><span class="hljs-string">"syscall"</span><span class="hljs-string">"time"</span><span class="hljs-string">"github.com/gin-gonic/gin"</span>)<span class="hljs-comment">// æ¨¡æ‹Ÿæ…¢è¯·æ±‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sleep</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;t := ctx.Query(<span class="hljs-string">"t"</span>)s, err := strconv.Atoi(t)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="hljs-string">"msg"</span>: <span class="hljs-string">"å‚æ•°é”™è¯¯: "</span> + t&#125;)<span class="hljs-keyword">return</span>&#125;time.Sleep(time.Duration(s) * time.Second)ctx.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">"msg"</span>: fmt.Sprintf(<span class="hljs-string">"sleep %d s"</span>, s)&#125;)&#125;<span class="hljs-keyword">const</span> (stateHealth   = <span class="hljs-string">"health"</span>stateUnHealth = <span class="hljs-string">"unhealth"</span>)<span class="hljs-keyword">var</span> state = stateHealth<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">health</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;status := http.StatusOK<span class="hljs-keyword">if</span> state == stateUnHealth &#123;status = http.StatusServiceUnavailable&#125;ctx.JSON(status, gin.H&#123;<span class="hljs-string">"data"</span>: state&#125;)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;e := gin.Default()e.GET(<span class="hljs-string">"/health"</span>, health)e.GET(<span class="hljs-string">"/sleep"</span>, sleep)server := &amp;http.Server&#123;Addr:    <span class="hljs-string">":8080"</span>,Handler: e,&#125;<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">if</span> err := server.ListenAndServe(); err != <span class="hljs-literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;log.Fatalf(<span class="hljs-string">"server run err: %+v"</span>, err)&#125;&#125;()<span class="hljs-comment">// ç”¨äºæ•è·é€€å‡ºä¿¡å·</span>quit := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal)<span class="hljs-comment">// kill (no param) default send syscall.SIGTERM</span><span class="hljs-comment">// kill -2 is syscall.SIGINT</span><span class="hljs-comment">// kill -9 is syscall.SIGKILL but can't be catch, so don't need add it</span>signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)&lt;-quitlog.Println(<span class="hljs-string">"Shutting down server..."</span>)<span class="hljs-comment">// æ•è·åˆ°é€€å‡ºä¿¡å·ä¹‹åå°†å¥åº·æ£€æŸ¥çŠ¶æ€è®¾ç½®ä¸º unhealth</span>state = stateUnHealthlog.Println(<span class="hljs-string">"Shutting down state: "</span>, state)<span class="hljs-comment">// è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸¤ä¸ªå¿ƒè·³å‘¨æœŸï¼Œå‡è®¾ä¸€æ¬¡å¿ƒè·³ 3s</span>ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">6</span>*time.Second)<span class="hljs-keyword">defer</span> cancel()<span class="hljs-comment">// Shutdown æ¥å£ï¼Œå¦‚æœæ²¡æœ‰æ–°çš„è¿æ¥äº†å°±ä¼šé‡Šæ”¾ï¼Œä¼ å…¥è¶…æ—¶ context</span><span class="hljs-comment">// è°ƒç”¨è¿™ä¸ªæ¥å£ä¼šå…³é—­æœåŠ¡ï¼Œä½†æ˜¯ä¸ä¼šä¸­æ–­æ´»åŠ¨è¿æ¥</span><span class="hljs-comment">// é¦–å…ˆä¼šå°†ç«¯å£ç›‘å¬ç§»é™¤</span><span class="hljs-comment">// ç„¶åä¼šå…³é—­æ‰€æœ‰çš„ç©ºé—²è¿æ¥</span><span class="hljs-comment">// ç„¶åç­‰å¾…æ´»åŠ¨çš„è¿æ¥å˜ä¸ºç©ºé—²åå…³é—­</span><span class="hljs-comment">// å¦‚æœç­‰å¾…æ—¶é—´è¶…è¿‡äº†ä¼ å…¥çš„ context çš„è¶…æ—¶æ—¶é—´ï¼Œå°±ä¼šå¼ºåˆ¶é€€å‡º</span><span class="hljs-comment">// è°ƒç”¨è¿™ä¸ªæ¥å£ server ç›‘å¬ç«¯å£ä¼šè¿”å› ErrServerClosed é”™è¯¯</span><span class="hljs-comment">// æ³¨æ„ï¼Œè¿™ä¸ªæ¥å£ä¸ä¼šå…³é—­å’Œç­‰å¾…websocketè¿™ç§è¢«åŠ«æŒçš„é“¾æ¥ï¼Œå¦‚æœåšä¸€äº›å¤„ç†ã€‚å¯ä»¥ä½¿ç”¨ RegisterOnShutdown æ³¨å†Œä¸€äº›æ¸…ç†çš„æ–¹æ³•</span><span class="hljs-keyword">if</span> err := server.Shutdown(ctx); err != <span class="hljs-literal">nil</span> &#123;log.Fatal(<span class="hljs-string">"Server forced to shutdown:"</span>, err)&#125;log.Println(<span class="hljs-string">"Server exiting"</span>)&#125;</code></pre><h2 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h2><p><img src="https://lailin.xyz/images/1606744144537-0fe881ca-5716-4b80-8800-0dee0a266c5f.png" srcset="/img/loading.gif" alt="image.png"></p><h3 id="å®¢æˆ·ç«¯å‘ç°"><a href="#å®¢æˆ·ç«¯å‘ç°" class="headerlink" title="å®¢æˆ·ç«¯å‘ç°"></a>å®¢æˆ·ç«¯å‘ç°</h3><ul><li>ç›´è¿ï¼Œæ¯”æœåŠ¡ç«¯æœåŠ¡å‘ç°å°‘ä¸€æ¬¡ç½‘ç»œè·³è½¬</li><li>Consumer éœ€è¦å†…ç½®ç‰¹å®šçš„æœåŠ¡å‘ç°å®¢æˆ·ç«¯å’Œå‘ç°é€»è¾‘<ul><li>å¯ä»¥å°†è´Ÿè½½å‡è¡¡é€»è¾‘ä¸‹æ”¾åˆ° sidecar ä¸­è¿›è¡Œè§£è€¦</li></ul></li></ul><h3 id="æœåŠ¡ç«¯å‘ç°"><a href="#æœåŠ¡ç«¯å‘ç°" class="headerlink" title="æœåŠ¡ç«¯å‘ç°"></a>æœåŠ¡ç«¯å‘ç°</h3><ul><li>Consumer æ— éœ€å…³æ³¨æœåŠ¡å‘ç°å…·ä½“ç»†èŠ‚ï¼Œåªéœ€çŸ¥é“æœåŠ¡çš„ DNS åŸŸåå³å¯</li><li>æ”¯æŒå¼‚æ„è¯­è¨€å¼€å‘ï¼Œéœ€è¦åŸºç¡€è®¾æ–½æ”¯æ’‘ï¼Œå¤šäº†ä¸€æ¬¡ç½‘ç»œè·³è½¬ï¼Œå¯èƒ½æœ‰æ€§èƒ½æŸå¤±ï¼ŒåŸºç¡€è®¾æ–½ä¼šæ¯”è¾ƒå¤æ‚<blockquote><p>B ç«™è¿™è¾¹é‡‡ç”¨çš„æ˜¯å®¢æˆ·ç«¯å‘ç°çš„æ¨¡å¼ï¼Œæˆ‘ä»¬å…¬å¸ç”¨çš„æ›´å¤šçš„æ˜¯æœåŠ¡ç«¯å‘ç°çš„æ¨¡å¼</p></blockquote></li></ul><h3 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h3><p><strong>CPã€CAã€è¿˜æ˜¯ AP</strong><br>å®é™…åœºæ™¯æ˜¯æµ·é‡æœåŠ¡å‘ç°å’Œæ³¨å†Œï¼ŒæœåŠ¡çŠ¶æ€å¯ä»¥å¼±ä¸€è‡´, éœ€è¦çš„æ˜¯ AP ç³»ç»Ÿï¼Œåªéœ€æœ€ç»ˆä¸€è‡´æ€§å³å¯</p><ul><li>æ³¨å†Œçš„äº‹ä»¶å»¶è¿Ÿ<ul><li>é«˜å¯ç”¨çš„æœåŠ¡åœ¨è¿™æ–¹é¢é—®é¢˜ä¸å¤§</li></ul></li><li>æ³¨é”€çš„äº‹ä»¶å»¶è¿Ÿ<ul><li>å› ä¸ºæœ‰ä¸Šæ–‡æåˆ°çš„å¥åº·æ£€æŸ¥çš„æœºåˆ¶ï¼Œå³ä½¿æ³¨é”€å»¶è¿Ÿï¼Œå®¢æˆ·ç«¯ä¹Ÿä¼šä¸»åŠ¨çš„å°†èŠ‚ç‚¹ç§»é™¤</li></ul></li><li>ç›¸å…³æ–‡æ¡£<ul><li>å¤šä¸ªæ³¨å†Œä¸­å¿ƒçš„å¯¹æ¯”ï¼š<a href="https://developer.aliyun.com/article/698930" target="_blank" rel="noopener">https://developer.aliyun.com/article/698930</a></li><li><a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener">https://nacos.io/zh-cn/index.html</a> é˜¿é‡Œå¼€æºçš„æ³¨å†Œä¸­å¿ƒï¼Œæ¯›è€å¸ˆæ¨è ğŸ˜‚</li></ul></li></ul><p><strong>eureka å®ç°åŸç†</strong></p><blockquote><p>b ç«™ä»¿ç…§ç”¨ go å†™äº†ä¸€ä¸ª <a href="https://github.com/bilibili/discovery" target="_blank" rel="noopener">https://github.com/bilibili/discovery</a></p></blockquote><p><strong><img src="https://lailin.xyz/images/1606745349658-c7638390-9cbd-4eca-b2ad-4baa15449c3f.png" srcset="/img/loading.gif" alt="image.png"></strong></p><ul><li>æœåŠ¡æ³¨å†Œ<ul><li><strong>æ³¨å†Œï¼š</strong>æœåŠ¡æ–¹å¯åŠ¨åå‘æ³¨å†Œä¸­å¿ƒä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å‘é€æ³¨å†Œè¯·æ±‚ï¼Œç„¶åè¿™ä¸ªèŠ‚ç‚¹ä¼šå‘å…¶ä»–èŠ‚ç‚¹è¿›è¡Œå¹¿æ’­åŒæ­¥</li><li><strong>å¿ƒè·³ï¼š</strong>æ³¨å†Œåå®šæœŸï¼ˆ30sï¼‰å‘æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³</li><li><strong>ä¸‹çº¿ï¼š</strong>ä¸‹çº¿æ—¶å‘æ³¨å†Œä¸­å¿ƒå‘é€ä¸‹çº¿è¯·æ±‚</li><li>æ³¨æ„ï¼šæ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹å¯ä¸œå¸‚éœ€è¦åŠ è½½ç¼“å­˜è¿›è¡Œé¢„çƒ­ï¼Œæ‰€ä»¥ä¸å»ºè®®è¿™ä¸ªæ—¶å€™æœåŠ¡è¿›è¡Œé‡å¯æˆ–è€…æ˜¯å‘ç‰ˆ</li></ul></li><li>æœåŠ¡å‘ç°<ul><li>æ¶ˆè´¹è€…å®šæœŸå‘æ³¨å†Œä¸­å¿ƒé•¿è½®è®­è·å–èŠ‚ç‚¹ä¿¡æ¯ï¼Œè·å–åˆ°ä¹‹åç¼“å­˜åˆ°æœ¬åœ°</li></ul></li><li><strong>ç½‘ç»œæ•…éšœ</strong><ul><li>æœåŠ¡æ–¹ä¸æ³¨å†Œä¸­å¿ƒ<ul><li>æ³¨å†Œä¸­å¿ƒä¼šå®šæœŸï¼ˆ60sï¼‰æ£€æµ‹å·²å¤±æ•ˆï¼ˆ90s æœªæ›´æ–°ï¼‰çš„å®ä¾‹ï¼Œå¤±æ•ˆä¹‹åå°±ä¼šç§»é™¤ï¼Œä½†æ˜¯å¦‚æœçŸ­æ—¶é—´å†…ä¸¢å¤±å¤§é‡å¿ƒè·³è¿æ¥ï¼Œï¼ˆ15min å†…å¿ƒè·³ä½äºæœŸæœ›å€¼çš„ 85%ï¼‰å°±ä¼šå¼€å¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œä¿ç•™è¿‡æœŸçš„æœåŠ¡ä¸ä¼šè¿›è¡Œåˆ é™¤</li></ul></li><li>æ³¨å†Œä¸­å¿ƒä¸æ¶ˆè´¹è€…<ul><li>æ¶ˆè´¹è€…æœ¬åœ°æœ‰ç¼“å­˜ï¼Œé—®é¢˜ä¸å¤§</li></ul></li><li>æœåŠ¡æ–¹ä¸æ¶ˆè´¹è€…<ul><li>æœ‰å¥åº·æ£€æŸ¥ï¼Œå¥åº·æ£€æŸ¥ä¸é€šè¿‡æ—¶ï¼Œä¼šä»æ¶ˆè´¹è€…æœ¬åœ°è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤</li></ul></li></ul></li><li><strong>æ³¨å†Œä¸­å¿ƒæ•…éšœ</strong><ul><li>ä¸å»ºè®®è¿™ä¸ªæ—¶å€™æœåŠ¡è¿›è¡Œé‡å¯æˆ–è€…æ˜¯å‘ç‰ˆï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æ³¨å†Œä¸ä¸Šï¼Œä¼šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼Œä¸å‘ç‰ˆçŸ­æ—¶é—´æ²¡æœ‰å½±å“</li><li>å¦‚æœå…¨éƒ¨æŒ‚æ‰ï¼Œå¯åŠ¨æ—¶å¿…é¡»è¦ç­‰ä¸¤åˆ°ä¸‰ä¸ªå¿ƒè·³å‘¨æœŸï¼Œç­‰æ‰€æœ‰çš„æœåŠ¡éƒ½æ³¨å†Œä¸Šä¹‹åå†å¼€å§‹æä¾›æœåŠ¡è¿è¡Œæ¶ˆè´¹è€…æ‹‰å–æ•°æ®</li><li>å¦‚æœæŒ‚æ‰ä¸€ä¸ªï¼Œéœ€è¦ç­‰å…¶ä»–çš„èŠ‚ç‚¹å°†ä¿¡æ¯åŒæ­¥åˆ°æœ¬æœºä¹‹åå†æä¾›æœåŠ¡</li><li>æ•°æ®åŒæ­¥æ—¶ä¼šå¯¹æ¯”æ—¶é—´æˆ³ï¼Œä¼šä¿è¯å½“å‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯æœ€æ–°çš„</li></ul></li></ul><h2 id="å¤šé›†ç¾¤"><a href="#å¤šé›†ç¾¤" class="headerlink" title="å¤šé›†ç¾¤"></a>å¤šé›†ç¾¤</h2><blockquote><p>æ³¨æ„è¿™é‡Œçš„å¤šé›†ç¾¤éƒ½æ˜¯å•ä¸ªæœºæˆ¿å†…çš„</p></blockquote><h3 id="å¤šé›†ç¾¤éœ€æ±‚ä»ä½•è€Œæ¥ï¼Ÿ"><a href="#å¤šé›†ç¾¤éœ€æ±‚ä»ä½•è€Œæ¥ï¼Ÿ" class="headerlink" title="å¤šé›†ç¾¤éœ€æ±‚ä»ä½•è€Œæ¥ï¼Ÿ"></a>å¤šé›†ç¾¤éœ€æ±‚ä»ä½•è€Œæ¥ï¼Ÿ</h3><p>å¯¹äºç±»ä¼¼è´¦å·æœåŠ¡çš„ L0 çº§åˆ«çš„æœåŠ¡ï¼Œå‡ ä¹æ‰€æœ‰çš„æœåŠ¡éƒ½æœ‰ä¾èµ–ï¼Œéœ€è¦å°½å¯èƒ½çš„æé«˜æœåŠ¡çš„å¯ç”¨æ€§</p><ul><li>ä»å•ä¸€é›†ç¾¤è€ƒè™‘ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¿è¯å¯ç”¨æ€§ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ N+2 çš„æ–¹å¼æ¥å†—ä½™èŠ‚ç‚¹ã€‚<ul><li>N ä¸€èˆ¬é€šè¿‡å‹æµ‹å¾—å‡º</li></ul></li><li>ä»å•ä¸€é›†ç¾¤æ•…éšœå¸¦æ¥çš„å½±å“é¢è§’åº¦è€ƒè™‘å†—ä½™å¤šå¥—é›†ç¾¤ã€‚<ul><li>ä¾‹å¦‚ä¾èµ–çš„ redis å‡ºç°é—®é¢˜ï¼Œæ•´ä¸ªé›†ç¾¤æŒ‚æ‰äº†</li></ul></li><li>å•ä¸ªæœºæˆ¿å†…çš„æœºæˆ¿æ•…éšœå¯¼è‡´çš„é—®é¢˜<ul><li>å¤šæœºæˆ¿éƒ¨ç½²ï¼Œå¦‚æœåœ¨äº‘ä¸Šå¯èƒ½æ˜¯å¤šä¸ªå¯ç”¨åŒº</li></ul></li></ul><h3 id="ä»€ä¹ˆæ˜¯å¤šé›†ç¾¤ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¤šé›†ç¾¤ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤šé›†ç¾¤ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¤šé›†ç¾¤ï¼Ÿ</h3><ul><li>ç»™æŸä¸ªæœåŠ¡éƒ¨ç½²å¤šå¥—ï¼Œæ¯ä¸€å¥—éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„ç¼“å­˜ï¼Œç‰©ç†ä¸Šç›¸å½“äºæœ‰å¤šå¥—èµ„æºï¼Œé€»è¾‘ä¸Šåˆ’åˆ†ä¸ºä¸åŒçš„é›†ç¾¤ï¼Œåœ¨æœåŠ¡æ³¨å†Œçš„æ—¶å€™å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æ—¶å€™æºå¸¦ç›¸å…³çš„é›†ç¾¤æ ‡ç­¾</li></ul><h3 id="å¦‚ä½•é™ä½å¥åº·æ£€æŸ¥æµé‡"><a href="#å¦‚ä½•é™ä½å¥åº·æ£€æŸ¥æµé‡" class="headerlink" title="å¦‚ä½•é™ä½å¥åº·æ£€æŸ¥æµé‡"></a>å¦‚ä½•é™ä½å¥åº·æ£€æŸ¥æµé‡</h3><p>å¯¹äºè´¦å·è¿™ç§å¤§é‡æœåŠ¡ä¾èµ–çš„æœåŠ¡ï¼Œä»…ä»…æ˜¯å¥åº·æ£€æŸ¥æµé‡å°±ä¼šå¯¼è‡´ 30%ä»¥ä¸Šçš„èµ„æºå ç”¨ï¼ˆB ç«™ä¹‹å‰çš„çœŸå®æƒ…å†µï¼‰<br>å¯ä»¥ä½¿ç”¨å­é›†ç®—æ³•ï¼Œå°†åç«¯çš„èŠ‚ç‚¹å‡åˆ†ç»™æ‰€æœ‰çš„å®¢æˆ·ç«¯</p><ul><li>é€šå¸¸ 20-100 ä¸ªåç«¯ï¼Œéƒ¨åˆ†åœºæ™¯éœ€è¦å¤§å­é›†ï¼Œæ¯”å¦‚å¤§æ‰¹é‡è¯»å†™æ“ä½œã€‚</li><li>åç«¯å¹³å‡åˆ†ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯é‡å¯ï¼Œä¿æŒé‡æ–°å‡è¡¡ï¼ŒåŒæ—¶å¯¹åç«¯é‡å¯ä¿æŒé€æ˜ï¼ŒåŒæ—¶è¿æ¥çš„å˜åŠ¨æœ€å°<ul><li>æ¶ˆè´¹è€…å˜åŒ–çš„æ—¶å€™éœ€è¦ é‡æ–°å¹³è¡¡</li></ul></li></ul><pre><code class="hljs go"><span class="hljs-comment">// from google sre</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Subset</span><span class="hljs-params">(backends []<span class="hljs-keyword">string</span>, clientID, subsetSize <span class="hljs-keyword">int</span>)</span> []<span class="hljs-title">string</span></span> &#123;subsetCount := <span class="hljs-built_in">len</span>(backends) / subsetSize<span class="hljs-comment">// Group clients into rounds; each round uses the same shuffled list:</span>round := clientID / subsetCountr := rand.New(rand.NewSource(<span class="hljs-keyword">int64</span>(round)))r.Shuffle(<span class="hljs-built_in">len</span>(backends), <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i, j <span class="hljs-keyword">int</span>)</span></span> &#123; backends[i], backends[j] = backends[j], backends[i] &#125;)<span class="hljs-comment">// The subset id corresponding to the current client:</span>subsetID := clientID % subsetCountstart := subsetID * subsetSize<span class="hljs-keyword">return</span> backends[start : start+subsetSize]&#125;</code></pre><p><strong>ä¸ºä»€ä¹ˆä¸Šé¢è¿™ä¸ªç®—æ³•å¯ä»¥ä¿è¯å¯ä»¥å‡åŒ€åˆ†å¸ƒï¼Ÿ</strong><br>é¦–å…ˆï¼Œ<strong>shuffle ç®—æ³•ä¿è¯åœ¨ round ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œbackend çš„æ’åˆ—ä¸€å®šæ˜¯ä¸€è‡´çš„ã€‚</strong><br>å› ä¸ºæ¯ä¸ªå®ä¾‹æ‹¥æœ‰ä» 0 å¼€å§‹çš„è¿ç»­å”¯ä¸€çš„è‡ªå¢ idï¼Œä¸”è®¡ç®—è¿‡ç¨‹èƒ½å¤Ÿä¿è¯æ¯ä¸ª round å†…æ‰€æœ‰å®ä¾‹æ‹¿åˆ°çš„æœåŠ¡åˆ—è¡¨çš„æ’åˆ—ä¸€è‡´ï¼Œå› æ­¤åœ¨åŒä¸€ä¸ª round å†…çš„ client ä¼šåˆ†åˆ« backend æ’åˆ—çš„ä¸åŒéƒ¨åˆ†çš„åˆ‡ç‰‡ä½œä¸ºé€‰ä¸­çš„åç«¯æœåŠ¡æ¥å»ºç«‹è¿æ¥ã€‚<br>æ‰€ä»¥åªè¦ client id æ˜¯è¿ç»­çš„ï¼Œé‚£ä¹ˆ client å‘å‘ åç«¯çš„è¿æ¥å°±ä¸€å®šæ˜¯è¿ç»­çš„<br><strong>å‚è€ƒèµ„æ–™:</strong><br><a href="https://sre.google/sre-book/load-balancing-datacenter/" target="_blank" rel="noopener">https://sre.google/sre-book/load-balancing-datacenter/</a><br><a href="https://xargin.com/limiting-conn-wih-subset/" target="_blank" rel="noopener">https://xargin.com/limiting-conn-wih-subset/</a></p><h2 id="å¤šç§Ÿæˆ·ï¼ˆå¦‚ä½•è§£å†³å¤šå¥—æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜ï¼‰"><a href="#å¤šç§Ÿæˆ·ï¼ˆå¦‚ä½•è§£å†³å¤šå¥—æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜ï¼‰" class="headerlink" title="å¤šç§Ÿæˆ·ï¼ˆå¦‚ä½•è§£å†³å¤šå¥—æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜ï¼‰"></a>å¤šç§Ÿæˆ·ï¼ˆå¦‚ä½•è§£å†³å¤šå¥—æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜ï¼‰</h2><p>åœ¨ä¸€ä¸ªå¾®æœåŠ¡æ¶æ„ä¸­<strong>å…è®¸å¤šç³»ç»Ÿå…±å­˜</strong>æ˜¯åˆ©ç”¨å¾®æœåŠ¡ç¨³å®šæ€§ä»¥åŠæ¨¡å—åŒ–æœ€æœ‰æ•ˆçš„æ–¹å¼ä¹‹ä¸€ï¼Œè¿™ç§æ–¹å¼ä¸€èˆ¬è¢«ç§°ä¸ºå¤šç§Ÿæˆ·(multi-tenancy)ã€‚ç§Ÿæˆ·å¯ä»¥æ˜¯æµ‹è¯•ï¼Œé‡‘ä¸é›€å‘å¸ƒï¼Œå½±å­ç³»ç»Ÿ(shadow systems)ï¼Œç”šè‡³æœåŠ¡å±‚æˆ–è€…äº§å“çº¿ï¼Œä½¿ç”¨ç§Ÿæˆ·èƒ½å¤Ÿä¿è¯ä»£ç çš„éš”ç¦»æ€§å¹¶ä¸”èƒ½å¤ŸåŸºäºæµé‡ç§Ÿæˆ·åšè·¯ç”±å†³ç­–ã€‚</p><h3 id="å¦‚ä½•è§£å†³æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜"><a href="#å¦‚ä½•è§£å†³æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜" class="headerlink" title="å¦‚ä½•è§£å†³æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜"></a>å¦‚ä½•è§£å†³æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜</h3><h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæœåŠ¡è°ƒç”¨é“¾ A -&gt; B -&gt; Cï¼Œå¦‚æœ C åŒæ—¶æœ‰å¤šä¸ªåŒå­¦å¼€å‘ï¼Œå¦‚æœç”²åŒå­¦çš„ä»£ç æ­£åœ¨æµ‹è¯•ä¸­ï¼Œä½†æ˜¯ä¹™åŒå­¦ä¸å°å¿ƒå‘äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå°±ä¼šå¯¼è‡´ç”²åŒå­¦çš„ä»£ç è¢«å†²æ‰ï¼Œå¯¼è‡´æµ‹è¯•åŒå­¦æµ‹ç€æµ‹ç€å°±å‡ºç° bugã€‚æµ‹è¯•åŒå­¦æ— æ³•å¾—çŸ¥è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºç¯å¢ƒå¯¼è‡´çš„è¿˜æ˜¯ä»£ç ç¼ºé™·ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-1ï¼šå¤šå¥—ç‰©ç†ç¯å¢ƒï¼ˆç±»ä¼¼ä¸Šæ–‡çš„å¤šé›†ç¾¤ï¼‰"><a href="#è§£å†³æ–¹æ¡ˆ-1ï¼šå¤šå¥—ç‰©ç†ç¯å¢ƒï¼ˆç±»ä¼¼ä¸Šæ–‡çš„å¤šé›†ç¾¤ï¼‰" class="headerlink" title="è§£å†³æ–¹æ¡ˆ 1ï¼šå¤šå¥—ç‰©ç†ç¯å¢ƒï¼ˆç±»ä¼¼ä¸Šæ–‡çš„å¤šé›†ç¾¤ï¼‰"></a>è§£å†³æ–¹æ¡ˆ 1ï¼šå¤šå¥—ç‰©ç†ç¯å¢ƒï¼ˆç±»ä¼¼ä¸Šæ–‡çš„å¤šé›†ç¾¤ï¼‰</h4><p>æ­å»ºå¤šå¥—æµ‹è¯•ç¯å¢ƒï¼Œå¯ä»¥åšåˆ°ç‰©ç†éš”ç¦»ï¼Œä½†æ˜¯ä¹Ÿä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>æ··ç”¨ç¯å¢ƒå¯¼è‡´çš„ä¸å¯é æµ‹è¯•ã€‚</li><li>å¤šå¥—ç¯å¢ƒå¸¦æ¥çš„ç¡¬ä»¶æˆæœ¬ã€‚</li><li>éš¾ä»¥åšè´Ÿè½½æµ‹è¯•ï¼Œä»¿çœŸçº¿ä¸ŠçœŸå®æµé‡æƒ…å†µã€‚</li><li>æ²»æ ‡ä¸æ²»æœ¬ï¼Œæ— æ³•çŸ¥é“å½“å‰ç¯å¢ƒè°åœ¨ä½¿ç”¨ï¼Œå¹¶ä¸”å‡ å¥—ç¯å¢ƒå¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Ÿä¸‡ä¸€åˆå¤šå‡ ä¸ªäººå¼€å‘æ˜¯ä¸æ˜¯åˆéœ€è¦å†æ¥å‡ å¥—ï¼Ÿ</li></ul><h4 id="è§£å†³æ–¹æ¡ˆ-2ï¼šå¤šç§Ÿæˆ·ï¼ŒæŸ“è‰²å‘å¸ƒ"><a href="#è§£å†³æ–¹æ¡ˆ-2ï¼šå¤šç§Ÿæˆ·ï¼ŒæŸ“è‰²å‘å¸ƒ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ 2ï¼šå¤šç§Ÿæˆ·ï¼ŒæŸ“è‰²å‘å¸ƒ"></a>è§£å†³æ–¹æ¡ˆ 2ï¼šå¤šç§Ÿæˆ·ï¼ŒæŸ“è‰²å‘å¸ƒ</h4><p><img src="https://lailin.xyz/images/1606799997241-a37aa06a-4d44-4001-96bb-b0287e9eead5.png" srcset="/img/loading.gif" alt="image.png"></p><ul><li>æ³¨å†Œæµç¨‹<ul><li>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€å¥—é—®é¢˜çš„ <code>FAT1</code> æµ‹è¯•ç¯å¢ƒï¼Œç„¶åç°åœ¨å¯¹åº”ç”¨ B åšäº†ä¿®æ”¹</li><li>å¼€å‘åŒå­¦é€šè¿‡å‘å¸ƒå¹³å°å‘å¸ƒä¸€ä¸ªæ–°çš„ B åº”ç”¨ B<code>ï¼Œå¹¶ä¸”å¸¦ä¸Šç¯å¢ƒæ ‡ç­¾ï¼Œä¾‹å¦‚:</code>red`</li><li>åº”ç”¨ B<code>å‘æ³¨å†Œä¸­å¿ƒè¿›è¡Œæ³¨å†Œæ—¶å€™ä¼šå¸¦ä¸Š</code>red` æ ‡ç­¾</li><li>æ¶ˆè´¹è€… A åœ¨å‘æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡èŠ‚ç‚¹æ•°æ®çš„æ—¶å€™ä¹Ÿä¼šè·å–åˆ°è¿™ä¸ªæ ‡ç­¾ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°çš„è´Ÿè½½å‡è¡¡å½“ä¸­ä½¿ç”¨ <code>map[string]pool</code> çš„ç»“æ„è¿›è¡Œä¿å­˜</li></ul></li><li>è°ƒç”¨æµç¨‹<ul><li>æµ‹è¯•åŒå­¦é€šè¿‡ A è¿›è¡Œè°ƒç”¨æµ‹è¯•ï¼Œå¦‚æœæ˜¯ http å°±åœ¨ header ä¸­æ‰“ä¸Šè¿™ä¸ª <code>red</code> æ ‡ç­¾ï¼Œå¦‚æœæ˜¯ grpc å°±åœ¨ metadata ä¸­åŠ å…¥è¿™ä¸ªæ ‡ç­¾</li><li>A è°ƒç”¨ B çš„æ—¶å€™ï¼Œå‘ç° header ä¸­å­˜åœ¨ <code>red</code> æ ‡ç­¾å°±ä¼šå»æœ¬åœ°è´Ÿè½½å‡è¡¡æŸ¥è¯¢ï¼Œå‘ç°è´Ÿè½½å‡è¡¡ä¸­æœ‰ red æ ‡ç­¾çš„è¿æ¥ï¼Œè¿™ä¸ªä¹‹åå°±ç›´æ¥è°ƒç”¨åˆ° B`ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨çš„æ—¶å€™ A ä¼šå°† header çš„æ ‡ç­¾ä¿¡æ¯è¿›è¡Œé€ä¼ </li><li>B` æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œéœ€è¦è°ƒç”¨ Cã€D è¿™æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·çš„ä¼šå»è´Ÿè½½å‡è¡¡ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œå‘ç°æ²¡æœ‰å°±ä¼šé€€å›åˆ°é»˜è®¤çš„è¿æ¥æ± ä¸­</li></ul></li><li>å¦‚ä½•è¿›è¡Œè”è°ƒï¼Ÿ<ul><li>éœ€è¦è”è°ƒçš„åº”ç”¨æ‰“ä¸Šç›¸åŒçš„æ ‡ç­¾å°±å¯ä»¥äº†</li></ul></li><li>æ³¨æ„äº‹é¡¹<ul><li>åº”ç”¨ç‰ˆæœ¬å‘å¸ƒæ—¶æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ db ä¸­çš„è¡¨ï¼Œredis ä¸­çš„ keyï¼Œå¿…é¡»ä¿è¯å‘ä¸‹å…¼å®¹</li><li>æµ‹è¯•çš„æ—¶å€™éœ€è¦ä½¿ç”¨ä¸åŒçš„æµ‹è¯•è´¦å·</li><li>æ³¨æ„æ¥è‡ªå¤–ç½‘çš„è¯·æ±‚ä¸­çš„ header å¿…é¡»åˆ é™¤ï¼Œç¡®ä¿å®‰å…¨</li></ul></li><li><strong>æ ¸å¿ƒæ€è·¯</strong><ul><li>è·¨æœåŠ¡ä¼ é€’è¯·æ±‚æºå¸¦ä¸Šä¸‹æ–‡(context)ï¼Œæ•°æ®éš”ç¦»çš„æµé‡è·¯ç”±æ–¹æ¡ˆã€‚<ul><li>æ ¹æ®æ ‡ç­¾è¿›è¡Œæµé‡è·¯ç”±ï¼Œå¹¶ä¸”è¦ç¡®ä¿å¯ä»¥é€ä¼ </li></ul></li><li>åˆ©ç”¨æœåŠ¡å‘ç°æ³¨å†Œç§Ÿæˆ·ä¿¡æ¯ï¼Œæ³¨å†Œæˆç‰¹å®šçš„ç§Ÿæˆ·ã€‚<ul><li>å‘å¸ƒéƒ¨ç½²å¹³å°éœ€è¦æ”¯æŒæ–¹ä¾¿å¯åŠ¨å¤šå¥—ç¯å¢ƒï¼Œä»¥åŠæ ‡ç­¾æ³¨å…¥</li><li>å¯¹ä¸åŒçš„ç¯å¢ƒåšäº†éš”ç¦»ï¼Œå¯ä»¥ä¿è¯å¯¹å…³é”®ä¸šåŠ¡æ²¡æœ‰å½±å“</li></ul></li></ul></li></ul><h3 id="å¦‚ä½•è¿›è¡Œå…¨é“¾è·¯å‹æµ‹"><a href="#å¦‚ä½•è¿›è¡Œå…¨é“¾è·¯å‹æµ‹" class="headerlink" title="å¦‚ä½•è¿›è¡Œå…¨é“¾è·¯å‹æµ‹"></a>å¦‚ä½•è¿›è¡Œå…¨é“¾è·¯å‹æµ‹</h3><p><img src="https://lailin.xyz/images/1606802196792-9f605d74-4f29-458a-923f-6adc7a087e70.png" srcset="/img/loading.gif" alt="image.png"><br>å’Œä¸Šé¢çš„æµ‹è¯•ç¯å¢ƒçš„è§£å†³æ–¹æ¡ˆç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ­å»ºä¸€å¥—å’Œçº¿ä¸Šä¸€è‡´çš„å½±å­ç³»ç»Ÿ</p><ul><li>å¦‚ä½•è§£å†³å‹æµ‹æ•°æ®å¯¹çº¿ä¸Šæ•°æ®çš„å½±å“<ul><li>åŸºç¡€è®¾æ–½éœ€è¦åšæ”¹é€ ï¼Œé‡‡ç”¨åŒæ ·çš„åŸºç¡€è®¾æ–½èŠ‚ç‚¹</li><li>ç¼“å­˜ï¼šå½±å­åº”ç”¨å­˜å‚¨çš„æ•°æ®æ”¾åˆ°å½±å­åº“ä¸­ï¼Œä½¿ç”¨ä¸åŒçš„ db</li><li>æ•°æ®åº“ï¼šè‡ªåŠ¨å°†çº¿ä¸Šçš„æ•°æ®ç»“æ„å¤åˆ¶ä¸€ä»½åˆ°å½±å­æ•°æ®åº“ä¸­ã€‚é‡Œé¢çš„è¡¨ç»“æ„ä¿æŒä¸€è‡´ï¼Œæ•°æ®åº“ååšä¸€äº›å˜åŒ–ï¼Œä¾‹å¦‚ db_shadow</li><li>æ¶ˆæ¯é˜Ÿåˆ—: æ¨é€æ¶ˆæ¯çš„æ—¶å€™ä½¿ç”¨ä¸åŒçš„ topic æˆ–è€…æ˜¯æºå¸¦ä¸€äº› metadata ä¿¡æ¯</li></ul></li><li>éœ€è¦æå‰åšä¸€äº›æ•°æ®åˆå§‹åŒ–çš„æ“ä½œï¼Œæå‰è¿›è¡Œå‡†å¤‡</li><li>å‹æµ‹æ—¶æºå¸¦å‹æµ‹æ ‡ç­¾ï¼Œå°†æµé‡è‡ªåŠ¨è·¯ç”±åˆ°å½±å­æœåŠ¡è¿›è¡Œå‹æµ‹</li></ul><p>è¿™ç§æ–¹æ¡ˆåŒæ ·å¯ä»¥ç”¨äºç°åº¦å‘ç‰ˆå½“ä¸­</p><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸ç‚¹ä¸ªå…³æ³¨èµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>Goè¿›é˜¶è®­ç»ƒè¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>Goè¿›é˜¶è®­ç»ƒè¥</tag>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Week01: å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</title>
    <link href="/post/go-training-01.html"/>
    <url>/post/go-training-01.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><h2 id="å‡ ä¸ªé—®é¢˜"><a href="#å‡ ä¸ªé—®é¢˜" class="headerlink" title="å‡ ä¸ªé—®é¢˜"></a>å‡ ä¸ªé—®é¢˜</h2><p>å…ˆé—®è‡ªå·±å‡ ä¸ªé—®é¢˜ï¼Œçœ‹æ˜¯å¦å¯ä»¥å›ç­”ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¸¦ç€é—®é¢˜æ€»ç»“è¯¾ç¨‹çš„å†…å®¹</p><ul><li>ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ</li><li>å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å¾®æœåŠ¡å¯ä»¥å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Œåˆæœ‰é‚£äº›ç¼ºç‚¹ï¼Ÿ</li><li>å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ</li><li>å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ</li><li>å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ</li><li>å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ</li></ul><h2 id="Q1-ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ"><a href="#Q1-ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="Q1: ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ"></a>Q1: ä¸ºä»€ä¹ˆä¼šæœ‰å¾®æœåŠ¡ï¼Ÿ</h2><ul><li>ä¹‹å‰ä¸€èˆ¬æ˜¯ä¸€ä¸ªå•ä¸€çš„å·¨çŸ³æ¶æ„ï¼Œå­˜åœ¨å¾ˆå¤šé—®é¢˜<ul><li>åº”ç”¨æ¯”è¾ƒå¤æ‚ï¼Œæ²¡æœ‰äººèƒ½å¤Ÿææ‡‚</li><li>åº”ç”¨æ‰©å±•æ¯”è¾ƒå¤æ‚ï¼Œå¯é æ€§æ¯”è¾ƒä½</li><li>æ— æ³•è¿›è¡Œæ•æ·å¼€å‘å’Œéƒ¨ç½²</li></ul></li><li>æ‰€ä»¥ä¸€èˆ¬è¿™ä¸ªæ—¶å€™å°±ä¼šè€ƒè™‘æŒ‰ç…§æœåŠ¡ã€åŠŸèƒ½è¿›è¡Œæ‹†åˆ†</li></ul><h2 id="Q2-å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Q2-å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Q2: å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Q2: å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>SOA ï¼ˆé¢å‘æœåŠ¡ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>æœåŠ¡æ‹†åˆ†åæ¯”è¾ƒå°ï¼ŒBUG å°‘ï¼Œå®¹æ˜“æµ‹è¯•å’Œç»´æŠ¤ï¼Œä¹Ÿå®¹æ˜“æ‰©å±•</li><li><strong>å•ä¸€èŒè´£ï¼Œ</strong>ä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹æƒ…</li><li><strong>å°½å¯èƒ½çš„æ—©çš„åˆ›å»ºåŸå‹ï¼Œ</strong>å…ˆå®šä¹‰ APIï¼Œè¾¾æˆå¥‘çº¦</li><li><strong>å¯ç§»æ¤æ€§æ¯”æ•ˆç‡æ›´é‡è¦ï¼Œ</strong>é€šè®¯åè®®çš„å¯ç§»æ¤æ€§æ›´åŠ é‡è¦</li></ul></li><li>SOA å’Œ å¾®æœåŠ¡ æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ<ul><li>å¾®æœåŠ¡æ˜¯ SOA çš„ä¸€ç§å®è·µï¼Œå¾®æœåŠ¡ä¹Ÿæ˜¯é¢å‘æœåŠ¡çš„ä¸€ç§æ¶æ„</li></ul></li><li>å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li><strong>å›´ç»•ä¸šåŠ¡åŠŸèƒ½æ„å»ºçš„ï¼ŒæœåŠ¡å…³æ³¨å•ä¸€ä¸šåŠ¡ï¼ŒæœåŠ¡é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶ï¼Œå¯ä»¥å…¨è‡ªåŠ¨ç‹¬ç«‹éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ•°æ®å­˜å‚¨æŠ€æœ¯ã€‚</strong></li></ul></li></ul><h2 id="Q3-å¾®æœåŠ¡å¯ä»¥å¸¦æ¥é‚£äº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ"><a href="#Q3-å¾®æœåŠ¡å¯ä»¥å¸¦æ¥é‚£äº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="Q3: å¾®æœåŠ¡å¯ä»¥å¸¦æ¥é‚£äº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ"></a>Q3: å¾®æœåŠ¡å¯ä»¥å¸¦æ¥é‚£äº›å¥½å¤„ï¼Œåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ</h2><ul><li>ä¼˜ç‚¹<ul><li>æœåŠ¡æ‹†åˆ†åæ¯”è¾ƒå°ï¼ŒBUG å°‘ï¼Œå®¹æ˜“æµ‹è¯•å’Œç»´æŠ¤ï¼Œä¹Ÿå®¹æ˜“æ‰©å±•</li><li><strong>åŸå­æœåŠ¡ï¼Œ</strong>ä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹æƒ…ï¼Œå¹¶ä¸”è¿™ä¸ªå±äºè¿™ä¸ªæœåŠ¡çš„ä¹Ÿä¸åº”è¯¥æ‹†åˆ†åˆ°å…¶ä»–æœåŠ¡å»</li><li><strong>ç‹¬ç«‹è¿›ç¨‹ï¼Œ</strong>ä¸€ä¸ªæœåŠ¡åªæœ‰ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œå¯ä»¥å¾ˆå¥½çš„å’Œå½“å‰çš„å®¹å™¨åŒ–è¿›è¡Œç»“åˆï¼Œæ— çŠ¶æ€çš„æœåŠ¡å¯ä»¥å¾ˆå®¹æ˜“çš„äº«å—åˆ°ï¼Œk8s ä¸Šçš„æ•…éšœè½¬ç§»ï¼Œè‡ªåŠ¨é‡å¯ç­‰å¥½å¤„</li><li><strong>éš”ç¦»éƒ¨ç½²ï¼Œ</strong>æ¯ä¸ªæœåŠ¡ä¹‹é—´ç‹¬ç«‹éƒ¨ç½²ï¼Œå¯ä»¥é¿å…ç›¸äº’å½±å“ï¼Œå¹¶ä¸”å’ŒæŒ‰éœ€è¿›è¡Œåˆ†é…èµ„æºï¼ŒèŠ‚çœæˆæœ¬</li><li><strong>å»ä¸­å¿ƒåŒ–æœåŠ¡æ²»ç†</strong><ul><li>æ•°æ®å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬äº«æ•°æ®åº“ï¼Œç¼“å­˜ç­‰è®¾æ–½ï¼Œä¹Ÿæœ‰ä¸ªåˆ«æƒ…å†µå¤šä¸ªæœåŠ¡å…±äº«æ•°æ®åº“ï¼Œä¾‹å¦‚é¢å‘ç”¨æˆ·çš„ç®¡ç†åå°å’Œé¢å‘ç®¡ç†å‘˜çš„ç®¡ç†åå°</li><li>æ²»ç†å»ä¸­å¿ƒåŒ–</li><li>æŠ€æœ¯å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªæœåŠ¡å¯ä»¥ä½¿ç”¨é€‚åˆè‡ªå·±çš„æŠ€æœ¯è¿›è¡Œå®æ–½ï¼Œä½†æ˜¯æ³¨æ„å¦‚æœæŠ€æœ¯æ ˆè¿‡äºå‘æ•£å¯¹äºä¼ä¸šæˆ–è€…å›¢é˜Ÿæœ¬èº«ä¹Ÿæ˜¯ä¸åˆ©çš„</li></ul></li></ul></li><li>ç¼ºç‚¹<ul><li><strong>æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å¤æ‚</strong>ï¼Œæˆåƒä¸Šä¸‡ä¸ªæœåŠ¡ç›¸äº’ä¾èµ–å°±åƒä¸€å›¢ä¹±éº»ä¸€æ ·ï¼Œå‰ªä¸æ–­ç†è¿˜ä¹±ã€‚<ul><li>å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼šå…¨é“¾è·¯è¿½è¸ªï¼Œä¾‹å¦‚ï¼Œ opentracing</li></ul></li><li>å¾®æœåŠ¡æœ¬èº«æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œéœ€è¦ä½¿ç”¨ RPC æˆ–è€… æ¶ˆæ¯è¿›è¡Œé€šä¿¡ï¼Œæ­¤å¤–<strong>ï¼Œå¿…é¡»è¦å†™ä»£ç æ¥å¤„ç†æ¶ˆæ¯ä¼ é€’ä¸­é€Ÿåº¦è¿‡æ…¢æˆ–è€…æœåŠ¡ä¸å¯ç”¨ç­‰å±€éƒ¨å¤±æ•ˆé—®é¢˜</strong><ul><li>ä¾‹å­ï¼šæœåŠ¡è°ƒç”¨æµé‡ä¼šå®¹æ˜“è¢«æ”¾å¤§ï¼Œå¦‚æœ æœåŠ¡ A -&gt; B -&gt;C å¦‚æœ A æœ‰ä¸€ä¸ªå¾ªç¯è°ƒç”¨ Bï¼ŒB ä¹Ÿæœ‰ä¸€ä¸ªå¾ªç¯è°ƒç”¨ Cï¼Œé‚£ä¹ˆä¸€ä¸ªè¯·æ±‚åˆ°è¾¾ C ä¹‹åå°±è¢«æ”¾å¤§äº† 100 å€ç”šè‡³ä¸Šåƒå€ã€‚è¿™æ˜¯æ‰›ä¸ä½çš„</li><li><strong>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šç²—ç²’åº¦çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆbatch æ¥å£ï¼Œæ‰¹é‡è¯·æ±‚ï¼Œé¿å… n+1 é—®é¢˜ï¼‰ï¼Œéš”ç¦»ï¼Œè¶…æ—¶ä¿æŠ¤ï¼Œè´Ÿè½½ä¿æŠ¤ï¼Œç†”æ–­ã€é™æµã€é™çº§ã€é‡è¯•ï¼Œè´Ÿè½½å‡è¡¡</strong></li></ul></li><li><strong>ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œ</strong>å› ä¸ºç°åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¹‹é—´éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œäº‹åŠ¡åœ¨å•ä½“åº”ç”¨ä¸­å¾ˆå¥½å¤„ç†ï¼Œä½†æ˜¯åœ¨è·¨æœåŠ¡æ—¶ä¼šå˜å¾—å¾ˆéº»çƒ¦<ul><li>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šä¸¤é˜¶æ®µæäº¤ã€TCC ç­‰</li><li><a href="https://xiaomi-info.github.io/2020/01/02/distributed-transaction/" target="_blank" rel="noopener">å°ç±³ä¿¡æ¯éƒ¨æŠ€æœ¯å›¢é˜Ÿ: åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></li></ul></li><li><strong>æµ‹è¯•ä¼šéå¸¸å¤æ‚ï¼Œ</strong>ç”±äºä¾èµ–å¤šï¼Œæ— æ³•å¾—çŸ¥æ˜¯å› ä¸ºåŠŸèƒ½å¼‚å¸¸è¿˜æ˜¯ä¾èµ–çš„æŸä¸ªæœåŠ¡å‘ç‰ˆå‡ºç°é—®é¢˜<ul><li>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šç‹¬ç«‹æµ‹è¯•ç¯å¢ƒï¼Œåé¢ä¼šæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</li></ul></li><li>æœåŠ¡æ¨¡å—é—´çš„ä¾èµ–ï¼Œåº”ç”¨çš„å‡çº§æœ‰å¯èƒ½ä¼šæ³¢åŠå¤šä¸ªæœåŠ¡æ¨¡å—çš„ä¿®æ”¹ã€‚<ul><li>åˆ‡è®°ï¼Œåœ¨æœåŠ¡éœ€è¦å˜æ›´æ—¶æˆ‘ä»¬è¦ç‰¹åˆ«å°å¿ƒï¼ŒæœåŠ¡æä¾›è€…çš„å˜æ›´å¯èƒ½å¼•å‘æœåŠ¡æ¶ˆè´¹è€…çš„å…¼å®¹æ€§ç ´åï¼Œ<strong>æ—¶åˆ»è°¨è®°ä¿æŒæœåŠ¡å¥‘çº¦(æ¥å£)çš„å…¼å®¹æ€§</strong></li><li>å‘é€æ—¶è¦ä¿å®ˆï¼Œæ¥æ”¶æ—¶è¦å¼€æ”¾ã€‚æŒ‰ç…§ä¼¯æ–¯å¡”å°”æ³•åˆ™çš„æ€æƒ³æ¥è®¾è®¡å’Œå®ç°æœåŠ¡æ—¶ï¼Œå‘é€çš„æ•°æ®è¦æ›´ä¿å®ˆï¼Œæ„å‘³ç€æœ€å°åŒ–çš„ä¼ é€å¿…è¦çš„ä¿¡æ¯ï¼Œæ¥æ”¶æ—¶æ›´å¼€æ”¾æ„å‘³ç€è¦æœ€å¤§é™åº¦çš„å®¹å¿å†—ä½™æ•°æ®ï¼Œä¿è¯å…¼å®¹æ€§ã€‚</li></ul></li><li><strong>å¯¹åŸºç¡€å»ºè®¾çš„è¦æ±‚å¾ˆé«˜ï¼Œ</strong>åŸºç¡€è®¾æ–½éœ€è¦è‡ªåŠ¨åŒ–ï¼Œæ—¥å¿—é‡‡é›†ï¼Œç›‘æ§æ•°æ®é‡‡é›†ï¼Œå‘Šè­¦ï¼ŒCICDï¼ŒK8s ç­‰<ul><li>å¸¸è§è§£å†³æ–¹æ¡ˆï¼šä¸Šäº‘</li></ul></li></ul></li></ul><h2 id="Q4-å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ"><a href="#Q4-å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ" class="headerlink" title="Q4: å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ"></a>Q4: å¾®æœåŠ¡å¦‚ä½•æ„å»ºï¼Ÿ</h2><blockquote><p>å¤šä¸ªå¾®æœåŠ¡ç»„åˆ(compose)å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·åœºæ™¯(usecase)ã€‚</p></blockquote><ul><li>kitï¼šä¸€ä¸ªå¾®æœåŠ¡çš„åŸºç¡€åº“(æ¡†æ¶)ã€‚</li><li>serviceï¼šä¸šåŠ¡ä»£ç  + kit ä¾èµ– + ç¬¬ä¸‰æ–¹ä¾èµ–ç»„æˆçš„ä¸šåŠ¡å¾®æœåŠ¡</li><li>rpc + message queueï¼šè½»é‡çº§é€šè®¯</li></ul><h2 id="Q5-å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ"><a href="#Q5-å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ" class="headerlink" title="Q5: å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ"></a>Q5: å¾®æœåŠ¡å¦‚ä½•å¯¹å¤–æš´éœ²ï¼Ÿ</h2><p><img src="https://lailin.xyz/images/1606552913072-f2ae26c9-6897-4dc8-9384-95f493ff5006.svg" srcset="/img/loading.gif" alt="01_Goè¿›é˜¶è®­ç»ƒè¥_å¾®æœåŠ¡_v1.svg"><br>æµé‡é“¾è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç§»åŠ¨ç«¯ -&gt; API Gateway -&gt; BFF -&gt; å¾®æœåŠ¡</li><li>ä¸å« CDNã€è´Ÿè½½å‡è¡¡ï¼ˆLBï¼‰</li><li>BFF çº¯ web çš„ä¸šåŠ¡ä¸€èˆ¬ç”¨ nodejs åš SSR</li></ul><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æœåŠ¡ä¸ç›´æ¥å¯¹å¤–è¿›è¡Œæš´éœ²ï¼Ÿ</p><ul><li>å‰ç«¯ï¼ˆç§»åŠ¨ç«¯ã€å®¢æˆ·ç«¯ã€webï¼‰åŒå­¦éå¸¸ç—›è‹¦ï¼Œéœ€è¦å¯¹æ¥å¤šä¸ªæœåŠ¡ï¼Œå…¼å®¹æ€§å·®ï¼Œæ²Ÿé€šæ•ˆç‡ä½</li><li>åç«¯åŒå­¦ä¹Ÿå¾ˆç—›è‹¦ï¼Œä¸€å¹´å‰çš„ç‰ˆæœ¬éƒ½æœ‰äººä½¿ç”¨ï¼ŒæœåŠ¡æ— æ³•è¿›è¡Œé‡æ„å‡çº§</li></ul><p>ä¸ºä»€ä¹ˆéœ€è¦æœ€å¤–å±‚çš„ api gateway?</p><ul><li>åŸºç¡€åº“çš„åŒå­¦éå¸¸åŒæ­¥ï¼Œé™æµç†”æ–­å®‰å…¨ç­‰ä¸šåŠ¡æ— å…³çš„åŠŸèƒ½éœ€è¦è¿›è¡Œå‡çº§çš„æ—¶å€™å‡ä¸åŠ¨</li></ul><h2 id="Q6-å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ"><a href="#Q6-å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ" class="headerlink" title="Q6: å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ"></a>Q6: å¾®æœåŠ¡å¦‚ä½•æ‹†åˆ†ï¼Ÿ</h2><ul><li>åœ¨å¯¹ä¸šåŠ¡é¢†åŸŸä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰çš„æ—¶å€™ï¼ŒæŒ‰ç…§<strong>éƒ¨é—¨èŒèƒ½è¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚è´¦å·ã€è´¢åŠ¡ç­‰</strong><ul><li>æ³¨æ„åˆ’åˆ†çš„æ—¶å€™<strong>è¦é—­ç¯</strong>ï¼Œä¸è¦ç›¸åŒçš„åŠŸèƒ½æ•£è½åˆ°å‡ ä¸ªéƒ¨é—¨å½“ä¸­</li></ul></li><li>åœ¨ç³»ç»Ÿç¨³å®šä¹‹åï¼Œç§¯ç´¯äº†ç›¸å…³çš„ä¸šåŠ¡ç»éªŒå’Œå¾®æœåŠ¡å¼€å‘ç»éªŒä¹‹åï¼Œå†è€ƒè™‘ä½¿ç”¨ DDD é™ç•Œä¸Šä¸‹æ–‡è¿›è¡Œåˆ’åˆ†</li><li>å¦‚æœå¯ä»¥é—­ç¯çš„è§£å†³ä¸€ä¸ªç”¨æˆ·åœºæ™¯ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå¾®æœåŠ¡</li><li>è¿˜å¯ä»¥æ ¹æ®è®¿é—®é¢‘ç‡è¿›è¡ŒåŒºåˆ†åˆ’åˆ†ï¼Œå°†ç”¨æˆ·é«˜é¢‘è®¿é—®çš„éƒ¨åˆ†åˆ’åˆ†ä¸ºä¸€ä¸ªæœåŠ¡</li><li>è¿˜å¯ä»¥æ ¹æ®è¯»å†™è¿›è¡Œåˆ’åˆ†<ul><li>CQRS: å°†åº”ç”¨ç¨‹åºåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå‘½ä»¤ç«¯å’ŒæŸ¥è¯¢ç«¯ã€‚å‘½ä»¤ç«¯å¤„ç†ç¨‹åºåˆ›å»ºï¼Œæ›´æ–°å’Œåˆ é™¤è¯·æ±‚ï¼Œå¹¶åœ¨æ•°æ®æ›´æ”¹æ—¶å‘å‡ºäº‹ä»¶ã€‚æŸ¥è¯¢ç«¯é€šè¿‡é’ˆå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªç‰©åŒ–è§†å›¾æ‰§è¡ŒæŸ¥è¯¢æ¥å¤„ç†æŸ¥è¯¢ï¼Œè¿™äº›ç‰©åŒ–è§†å›¾é€šè¿‡è®¢é˜…æ•°æ®æ›´æ”¹æ—¶å‘å‡ºçš„äº‹ä»¶æµè€Œä¿æŒæœ€æ–°</li><li><img src="https://lailin.xyz/images/1606631756304-ac2b31e1-771a-45e7-9b99-5234badc5d0d.svg" srcset="/img/loading.gif" alt="01_Goè¿›é˜¶è®­ç»ƒè¥_å¾®æœåŠ¡_v1.svg"></li></ul></li></ul><h2 id="Q7-å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ"><a href="#Q7-å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ" class="headerlink" title="Q7: å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ"></a>Q7: å¦‚ä½•ä¿è¯å¾®æœåŠ¡ä¹‹é—´çš„å®‰å…¨ï¼Ÿ</h2><p><img src="https://lailin.xyz/images/1606632869613-c887da17-ec2f-4221-822a-84bbd21e4d3f.svg" srcset="/img/loading.gif" alt="01_Goè¿›é˜¶è®­ç»ƒè¥_å¾®æœåŠ¡_v1.svg"><br>åœ¨å†…ç½‘ä¸»è¦çœ‹å®‰å…¨çº§åˆ«ä¸€èˆ¬æœ‰ä¸‰ç§ï¼š</p><ul><li>Full Trustï¼šå‡å®šå†…ç½‘æœåŠ¡ä¹‹é—´æ˜¯å®‰å…¨çš„ï¼Œåœ¨å†…ç½‘è£¸å¥”</li><li>Half Trustï¼šå†…ç½‘æœåŠ¡ä¹‹é—´éœ€è¦è¿›è¡Œè®¤è¯é‰´æƒï¼Œä½†æ˜¯ä¸éœ€è¦æ‰€æœ‰çš„éƒ½è¿›è¡ŒåŠ å¯†</li><li>Zero Trust: é›¶ä¿¡ä»»ï¼Œä»»åŠ¡å†…éƒ¨ç½‘ç»œæ˜¯ä¸å®‰å…¨çš„ï¼Œç±»ä¼¼å…¬ç½‘ï¼Œæ‰€æœ‰çš„è¯·æ±‚é€šè¿‡èº«ä»½è®¤è¯é‰´æƒä¹‹åï¼Œéƒ½éœ€è¦é€šè¿‡å®‰å…¨åŠ å¯†ï¼Œé˜²æ­¢è¢«å—…æ¢<ul><li><a href="https://www.microsoft.com/en-us/security/business/zero-trust" target="_blank" rel="noopener">https://www.microsoft.com/en-us/security/business/zero-trust</a></li></ul></li></ul><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸ç‚¹ä¸ªå…³æ³¨èµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>Goè¿›é˜¶è®­ç»ƒè¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>Goè¿›é˜¶è®­ç»ƒè¥</tag>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ•°æ®ç»“æ„ä¸ç®—æ³•05-æ ˆä¸‹: æ·±å…¥ç†è§£ defer</title>
    <link href="/post/defer.html"/>
    <url>/post/defer.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go æ•°æ®ç»“æ„ä¸ç®—æ³•ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« ä¸»è¦ä¼šåŒ…æ‹¬å¸¸è§çš„æ•°æ®ç»“æ„ä¸ç®—æ³•å®ç°ï¼ŒåŒæ—¶ä¼šåŒ…æ‹¬ Go æ ‡å‡†åº“ä»£ç çš„åˆ†æç†è§£ï¼Œè®²åˆ°å¯¹åº”ç« èŠ‚çš„æ—¶å€™ä¼˜å…ˆå­¦ä¹ åˆ†æ Go çš„æºç å®ç°ï¼Œä¾‹å¦‚ sliceã€listã€sort ç­‰ï¼Œç„¶åå¯èƒ½ä¼šæœ‰ä¸€äº›å¸¸è§çš„æ¡ˆä¾‹å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/126" target="_blank" rel="noopener">æå®¢æ—¶é—´-æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a> çš„è¯¾ç¨‹ç¬”è®°</li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“:</strong> <a href="https://github.com/mohuishou/go-algorithm" target="_blank" rel="noopener">https://github.com/mohuishou/go-algorithm</a> ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œé¢„è®¡åˆ° 202101 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°:</strong> <a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a>ã€<a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener">çŸ¥ä¹</a>ã€<a href="https://lailin.xyz/atom.xml">RSS</a>ã€<a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a></li><li>ä¸Šä¸€ä¸ªç³»åˆ—åˆšåˆšå®Œæˆäº† <a href="https://lailin.xyz/post/go-design-pattern.html">Go è®¾è®¡æ¨¡å¼</a>ï¼Œå¦‚æœæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥è¿›è¡ŒæŸ¥çœ‹</li></ul><h2 id="æ·±å…¥ç†è§£-go-defer"><a href="#æ·±å…¥ç†è§£-go-defer" class="headerlink" title="æ·±å…¥ç†è§£ go defer"></a>æ·±å…¥ç†è§£ go defer</h2><p>ä¸Šç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è®²åˆ°æ ˆçš„æ—¶å€™è¯´åˆ°å…ˆå…¥åå‡ºè¿™ç§ç‰¹æ€§ï¼Œåœ¨ Go ä¸­ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„å°±æ˜¯ <code>defer</code> æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ·±å…¥ç†è§£ä¸€ä¸‹ defer</p><h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>ä¸‹é¢å…ˆå›é¡¾ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ä»¥åŠè¾ƒä¸ºå¸¸è§çš„å‘ï¼Œæ–‡æœ«ä¼šç»™å‡ºè¾“å‡ºç»“æœï¼Œå¯ä»¥å…ˆæƒ³æƒ³ä¼šè¾“å‡ºä»€ä¹ˆ</p><h4 id="åŸºæœ¬ç”¨æ³•-1-å»¶è¿Ÿå¤„ç†ï¼Œèµ„æºæ¸…ç†"><a href="#åŸºæœ¬ç”¨æ³•-1-å»¶è¿Ÿå¤„ç†ï¼Œèµ„æºæ¸…ç†" class="headerlink" title="åŸºæœ¬ç”¨æ³• 1: å»¶è¿Ÿå¤„ç†ï¼Œèµ„æºæ¸…ç†"></a>åŸºæœ¬ç”¨æ³• 1: å»¶è¿Ÿå¤„ç†ï¼Œèµ„æºæ¸…ç†</h4><pre><code class="hljs go"><span class="hljs-comment">// åŸºæœ¬ç”¨æ³•ï¼šå»¶è¿Ÿè°ƒç”¨ï¼Œæ¸…ç†èµ„æº</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f0</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"clean"</span>)fmt.Println(<span class="hljs-string">"hello"</span>)&#125;</code></pre><h4 id="åŸºæœ¬ç”¨æ³•-2-åè¿›å…ˆå‡º"><a href="#åŸºæœ¬ç”¨æ³•-2-åè¿›å…ˆå‡º" class="headerlink" title="åŸºæœ¬ç”¨æ³• 2: åè¿›å…ˆå‡º"></a>åŸºæœ¬ç”¨æ³• 2: åè¿›å…ˆå‡º</h4><pre><code class="hljs go"><span class="hljs-comment">// åŸºæœ¬ç”¨æ³•1: åè¿›å…ˆå‡º</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f1</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"1"</span>)<span class="hljs-keyword">defer</span> fmt.Println(<span class="hljs-string">"2"</span>)fmt.Println(<span class="hljs-string">"3"</span>)&#125;</code></pre><h4 id="åŸºæœ¬ç”¨æ³•-3-å¼‚å¸¸æ¢å¤"><a href="#åŸºæœ¬ç”¨æ³•-3-å¼‚å¸¸æ¢å¤" class="headerlink" title="åŸºæœ¬ç”¨æ³• 3: å¼‚å¸¸æ¢å¤"></a>åŸºæœ¬ç”¨æ³• 3: å¼‚å¸¸æ¢å¤</h4><pre><code class="hljs go"><span class="hljs-comment">// åŸºæœ¬ç”¨æ³•2ï¼šå¼‚å¸¸æ¢å¤</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f2</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">if</span> err := <span class="hljs-built_in">recover</span>(); err != <span class="hljs-literal">nil</span> &#123;fmt.Printf(<span class="hljs-string">"paniced: %+v \n"</span>, err)&#125;&#125;()<span class="hljs-built_in">panic</span>(<span class="hljs-string">"test"</span>)&#125;</code></pre><h4 id="å®¹æ˜“æ‰å‘-1-é—­åŒ…å˜é‡"><a href="#å®¹æ˜“æ‰å‘-1-é—­åŒ…å˜é‡" class="headerlink" title="å®¹æ˜“æ‰å‘ 1: é—­åŒ…å˜é‡"></a>å®¹æ˜“æ‰å‘ 1: é—­åŒ…å˜é‡</h4><pre><code class="hljs go"><span class="hljs-comment">// å®¹æ˜“æ‰å‘ä¹‹ï¼Œå‡½æ•°å˜é‡ä¿®æ”¹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f3</span><span class="hljs-params">()</span> <span class="hljs-params">(res <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;res++&#125;()<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>&#125;</code></pre><h4 id="å®¹æ˜“æ‰å‘-2-å‚æ•°ä¼ é€’"><a href="#å®¹æ˜“æ‰å‘-2-å‚æ•°ä¼ é€’" class="headerlink" title="å®¹æ˜“æ‰å‘ 2: å‚æ•°ä¼ é€’"></a>å®¹æ˜“æ‰å‘ 2: å‚æ•°ä¼ é€’</h4><pre><code class="hljs go"><span class="hljs-comment">// å®¹æ˜“æ‰å‘ä¹‹ï¼Œå‚æ•°å¤åˆ¶</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f4</span><span class="hljs-params">()</span> <span class="hljs-params">(res <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(res <span class="hljs-keyword">int</span>)</span></span> &#123;res++&#125;(res)<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>&#125;</code></pre><h3 id="æºç å‰–æ"><a href="#æºç å‰–æ" class="headerlink" title="æºç å‰–æ"></a>æºç å‰–æ</h3><p>æƒ³è¦çœ‹æºç ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°æºç çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰§è¡Œ <code>go tool compile -N -l -S main.go</code> è·å–æ±‡ç¼–ä»£ç </p><pre><code class="hljs bash">// .... 0x00d8 00216 (main_2.go:6)PCDATA<span class="hljs-variable">$1</span>, <span class="hljs-variable">$0</span>0x00d8 00216 (main_2.go:6)CALLruntime.deferprocStack(SB)0x00dd 00221 (main_2.go:6)NOP0x00e0 00224 (main_2.go:6)TESTLAX, AX0x00e2 00226 (main_2.go:6)JNE2520x00e4 00228 (main_2.go:6)JMP2300x00e6 00230 (main_2.go:7)XCHGLAX, AX0x00e7 00231 (main_2.go:7)CALLruntime.deferreturn(SB)0x00ec 00236 (main_2.go:7)MOVQ216(SP), BP0x00f4 00244 (main_2.go:7)ADDQ<span class="hljs-variable">$224</span>, SP0x00fb 00251 (main_2.go:7)RET0x00fc 00252 (main_2.go:6)XCHGLAX, AX0x00fd 00253 (main_2.go:6)NOP0x0100 00256 (main_2.go:6)CALLruntime.deferreturn(SB)</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯è°ƒç”¨äº† <code>runtime.deferprocStack</code> ï¼Œ <code>runtime.deferreturn</code> è¿™ä¸¤ä¸ªè¿è¡Œæ—¶çš„æ–¹æ³•</p><h4 id="defer-å®šä¹‰"><a href="#defer-å®šä¹‰" class="headerlink" title="defer å®šä¹‰"></a>defer å®šä¹‰</h4><pre><code class="hljs go"><span class="hljs-keyword">type</span> _defer <span class="hljs-keyword">struct</span> &#123;siz     <span class="hljs-keyword">int32</span> <span class="hljs-comment">// æ‰€æœ‰ä¼ å…¥å‚æ•°å’Œè¿”å›å€¼çš„æ€»å¤§å°</span>started <span class="hljs-keyword">bool</span>  <span class="hljs-comment">// defer æ˜¯å¦æ‰§è¡Œäº†</span>heap    <span class="hljs-keyword">bool</span>  <span class="hljs-comment">// æ˜¯å¦åœ¨å †ä¸Šï¼Œè¿™æ˜¯ go1.13 æ–°åŠ çš„ï¼Œåˆ’é‡ç‚¹</span>sp        <span class="hljs-keyword">uintptr</span>  <span class="hljs-comment">// å‡½æ•°æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œä¸€èˆ¬æŒ‡å‘å½“å‰å‡½æ•°æ ˆçš„æ ˆé¡¶</span>pc        <span class="hljs-keyword">uintptr</span>  <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤</span>fn        *funcval <span class="hljs-comment">// æŒ‡å‘ä¼ å…¥çš„å‡½æ•°åœ°å€å’Œå‚æ•°</span>_panic    *_panic  <span class="hljs-comment">// æŒ‡å‘ panic é“¾è¡¨</span>link      *_defer  <span class="hljs-comment">// æŒ‡å‘ defer é“¾è¡¨</span>    <span class="hljs-comment">//...</span>&#125;</code></pre><h4 id="deferprocStack"><a href="#deferprocStack" class="headerlink" title="deferprocStack"></a>deferprocStack</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deferprocStack</span><span class="hljs-params">(d *_defer)</span></span> &#123;gp := getg() <span class="hljs-comment">// è·å– gï¼Œåˆ¤æ–­æ˜¯å¦åœ¨ç”¨æˆ·æ ˆä¸Š</span><span class="hljs-keyword">if</span> gp.m.curg != gp &#123;<span class="hljs-comment">// go code on the system stack can't defer</span>throw(<span class="hljs-string">"defer on system stack"</span>)&#125;<span class="hljs-comment">// siz and fn are already set.</span><span class="hljs-comment">// The other fields are junk on entry to deferprocStack and</span><span class="hljs-comment">// are initialized here.</span>d.started = <span class="hljs-literal">false</span>d.heap = <span class="hljs-literal">false</span>d.openDefer = <span class="hljs-literal">false</span>d.sp = getcallersp()d.pc = getcallerpc()d.framepc = <span class="hljs-number">0</span>d.varp = <span class="hljs-number">0</span><span class="hljs-comment">// The lines below implement:</span><span class="hljs-comment">//   d.panic = nil</span><span class="hljs-comment">//   d.fd = nil</span><span class="hljs-comment">//   d.link = gp._defer // è¿™ä¸¤ä¸ªæ˜¯å°†å½“å‰ defer æ’å…¥åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œä¹Ÿå°±æ˜¯deferä¸ºä»€ä¹ˆæ—¶å€™å…ˆå…¥åå‡ºçš„åŸå› </span><span class="hljs-comment">//   gp._defer = d</span><span class="hljs-comment">// But without write barriers. The first three are writes to</span><span class="hljs-comment">// the stack so they don't need a write barrier, and furthermore</span><span class="hljs-comment">// are to uninitialized memory, so they must not use a write barrier.</span><span class="hljs-comment">// The fourth write does not require a write barrier because we</span><span class="hljs-comment">// explicitly mark all the defer structures, so we don't need to</span><span class="hljs-comment">// keep track of pointers to them with a write barrier.</span>*(*<span class="hljs-keyword">uintptr</span>)(unsafe.Pointer(&amp;d._panic)) = <span class="hljs-number">0</span>*(*<span class="hljs-keyword">uintptr</span>)(unsafe.Pointer(&amp;d.fd)) = <span class="hljs-number">0</span>*(*<span class="hljs-keyword">uintptr</span>)(unsafe.Pointer(&amp;d.link)) = <span class="hljs-keyword">uintptr</span>(unsafe.Pointer(gp._defer))*(*<span class="hljs-keyword">uintptr</span>)(unsafe.Pointer(&amp;gp._defer)) = <span class="hljs-keyword">uintptr</span>(unsafe.Pointer(d))return0()<span class="hljs-comment">// No code can go here - the C return register has</span><span class="hljs-comment">// been set and must not be clobbered.</span>&#125;</code></pre><p><strong>æ³¨æ„è¿™å‡ è¡Œ</strong><br>è¯´æ˜è¿™ä¸ª defer ä¸åœ¨å †ä¸Š</p><pre><code class="hljs go">d.heap = <span class="hljs-literal">false</span></code></pre><p>è¿™ä¸¤ä¸ªæ˜¯å°†å½“å‰ defer æ’å…¥åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œä¹Ÿå°±æ˜¯ defer ä¸ºä»€ä¹ˆæ—¶å€™å…ˆå…¥åå‡ºçš„åŸå› </p><pre><code class="hljs go"><span class="hljs-comment">//   d.link = gp._defer</span><span class="hljs-comment">//   gp._defer = d</span></code></pre><h4 id="deferreturn"><a href="#deferreturn" class="headerlink" title="deferreturn"></a>deferreturn</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deferreturn</span><span class="hljs-params">(arg0 <span class="hljs-keyword">uintptr</span>)</span></span> &#123;gp := getg()d := gp._defer<span class="hljs-keyword">if</span> d == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span>&#125;sp := getcallersp()<span class="hljs-keyword">if</span> d.sp != sp &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">if</span> d.openDefer &#123;done := runOpenDeferFrame(gp, d)<span class="hljs-keyword">if</span> !done &#123;throw(<span class="hljs-string">"unfinished open-coded defers in deferreturn"</span>)&#125;gp._defer = d.linkfreedefer(d)<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">switch</span> d.siz &#123;<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<span class="hljs-comment">// Do nothing.</span><span class="hljs-keyword">case</span> sys.PtrSize:*(*<span class="hljs-keyword">uintptr</span>)(unsafe.Pointer(&amp;arg0)) = *(*<span class="hljs-keyword">uintptr</span>)(deferArgs(d))<span class="hljs-keyword">default</span>:memmove(unsafe.Pointer(&amp;arg0), deferArgs(d), <span class="hljs-keyword">uintptr</span>(d.siz))&#125;fn := d.fnd.fn = <span class="hljs-literal">nil</span>gp._defer = d.linkfreedefer(d)<span class="hljs-comment">// If the defer function pointer is nil, force the seg fault to happen</span><span class="hljs-comment">// here rather than in jmpdefer. gentraceback() throws an error if it is</span><span class="hljs-comment">// called with a callback on an LR architecture and jmpdefer is on the</span><span class="hljs-comment">// stack, because the stack trace can be incorrect in that case - see</span><span class="hljs-comment">// issue #8153).</span>_ = fn.fnjmpdefer(fn, <span class="hljs-keyword">uintptr</span>(unsafe.Pointer(&amp;arg0)))&#125;</code></pre><p>å¦‚æœå‡½æ•°ä¸­å­˜åœ¨ defer ç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨åœ¨å‡½æ•°çš„æœ€åæ’å…¥ä¸€ä¸ª deferreturn</p><ul><li>æ¸…ç©º defer çš„è°ƒç”¨ä¿¡æ¯</li><li>freedefer å°† defer å¯¹è±¡æ”¾å…¥åˆ° defer æ± ä¸­ï¼Œåé¢å¯ä»¥å¤ç”¨</li><li>å¦‚æœå­˜åœ¨å»¶è¿Ÿå‡½æ•°å°±ä¼šè°ƒç”¨ runtimeÂ·jmpdefer æ–¹æ³•è·³è½¬åˆ°å¯¹åº”çš„æ–¹æ³•ä¸Šå»</li><li>runtimeÂ·jmpdefer æ–¹æ³•ä¼šé€’å½’è°ƒç”¨ deferreturn ä¸€ç›´æ‰§è¡Œåˆ°ç»“æŸä¸ºæ­¢</li></ul><h4 id="deferproc"><a href="#deferproc" class="headerlink" title="deferproc"></a>deferproc</h4><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deferproc</span><span class="hljs-params">(siz <span class="hljs-keyword">int32</span>, fn *funcval)</span></span> &#123; <span class="hljs-comment">// arguments of fn follow fn</span>gp := getg()<span class="hljs-keyword">if</span> gp.m.curg != gp &#123;<span class="hljs-comment">// go code on the system stack can't defer</span>throw(<span class="hljs-string">"defer on system stack"</span>)&#125;<span class="hljs-comment">// the arguments of fn are in a perilous state. The stack map</span><span class="hljs-comment">// for deferproc does not describe them. So we can't let garbage</span><span class="hljs-comment">// collection or stack copying trigger until we've copied them out</span><span class="hljs-comment">// to somewhere safe. The memmove below does that.</span><span class="hljs-comment">// Until the copy completes, we can only call nosplit routines.</span>sp := getcallersp()argp := <span class="hljs-keyword">uintptr</span>(unsafe.Pointer(&amp;fn)) + unsafe.Sizeof(fn)callerpc := getcallerpc()d := newdefer(siz)<span class="hljs-keyword">if</span> d._panic != <span class="hljs-literal">nil</span> &#123;throw(<span class="hljs-string">"deferproc: d.panic != nil after newdefer"</span>)&#125;d.link = gp._defergp._defer = dd.fn = fnd.pc = callerpcd.sp = sp<span class="hljs-keyword">switch</span> siz &#123;<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<span class="hljs-comment">// Do nothing.</span><span class="hljs-keyword">case</span> sys.PtrSize:*(*<span class="hljs-keyword">uintptr</span>)(deferArgs(d)) = *(*<span class="hljs-keyword">uintptr</span>)(unsafe.Pointer(argp))<span class="hljs-keyword">default</span>:memmove(deferArgs(d), unsafe.Pointer(argp), <span class="hljs-keyword">uintptr</span>(siz))&#125;<span class="hljs-comment">// deferproc returns 0 normally.</span><span class="hljs-comment">// a deferred func that stops a panic</span><span class="hljs-comment">// makes the deferproc return 1.</span><span class="hljs-comment">// the code the compiler generates always</span><span class="hljs-comment">// checks the return value and jumps to the</span><span class="hljs-comment">// end of the function if deferproc returns != 0.</span>return0()<span class="hljs-comment">// No code can go here - the C return register has</span><span class="hljs-comment">// been set and must not be clobbered.</span>&#125;</code></pre><p>é™¤äº† deferprocStack è¿˜æœ‰ deferproc è¿™ä¸ªæ–¹æ³•ï¼Œé‚£è¿™ä¸ªæ–¹æ³•å’Œä¹‹å‰çš„æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ<br>ä¸»è¦çš„åŒºåˆ«å°±æ˜¯è¿™ä¸ªæ–¹æ³•å°† defer åˆ†é…åœ¨äº†å †ä¸Šï¼Œçœ‹ä¸‹æ–¹çš„ <code>newdefer</code></p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newdefer</span><span class="hljs-params">(siz <span class="hljs-keyword">int32</span>)</span> *_<span class="hljs-title">defer</span></span> &#123;    <span class="hljs-comment">// ...</span>    d.heap = <span class="hljs-literal">true</span><span class="hljs-keyword">return</span> d&#125;</code></pre><p>å…¶ä»–å’Œ deferprocStack ç±»ä¼¼è¿™é‡Œå°±ä¸èµ˜è¿°äº†</p><h4 id="ä»€ä¹ˆæ—¶å€™-defer-ä¼šåœ¨å †ä¸Šä»€ä¹ˆæ—¶å€™ä¼šåœ¨æ ˆä¸Šï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™-defer-ä¼šåœ¨å †ä¸Šä»€ä¹ˆæ—¶å€™ä¼šåœ¨æ ˆä¸Šï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ defer ä¼šåœ¨å †ä¸Šä»€ä¹ˆæ—¶å€™ä¼šåœ¨æ ˆä¸Šï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ defer ä¼šåœ¨å †ä¸Šä»€ä¹ˆæ—¶å€™ä¼šåœ¨æ ˆä¸Šï¼Ÿ</h4><p>é‚£é—®é¢˜æ¥äº†å¦‚ä½•åˆ¤æ–­ defer åœ¨å †ä¸Šè¿˜æ˜¯åœ¨æ ˆä¸Šå‘¢ï¼Ÿ<br><a href="https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/escape.go#L743" target="_blank" rel="noopener">https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/escape.go#L743</a></p><pre><code class="hljs go">topLevelDefer := where != <span class="hljs-literal">nil</span> &amp;&amp; where.Op == ODEFER &amp;&amp; e.loopDepth == <span class="hljs-number">1</span><span class="hljs-keyword">if</span> topLevelDefer &#123;    <span class="hljs-comment">// force stack allocation of defer record, unless</span>    <span class="hljs-comment">// open-coded defers are used (see ssa.go)</span>    where.Esc = EscNever&#125;</code></pre><p><a href="https://github.com/golang/go/blob/6965b01ea248cabb70c3749fd218b36089a21efb/src/cmd/compile/internal/gc/ssa.go#L1116" target="_blank" rel="noopener">https://github.com/golang/go/blob/6965b01ea248cabb70c3749fd218b36089a21efb/src/cmd/compile/internal/gc/ssa.go#L1116</a></p><pre><code class="hljs go">d := callDefer<span class="hljs-keyword">if</span> n.Esc == EscNever &#123;    d = callDeferStack&#125;s.call(n.Left, d)</code></pre><p>å¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯åœ¨é€ƒé€¸åˆ†æçš„æ—¶å€™ï¼Œå‘ç° <code>e.loopDepth == 1</code> å¹¶ä¸”ä¸æ˜¯ open-coded defer å°±ä¼šåˆ†é…åˆ°æ ˆä¸Šã€‚<br>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ go 1.13 ä¹‹å defer æ€§èƒ½æå‡çš„åŸå› ï¼Œæ‰€ä»¥<strong>åˆ‡è®°ä¸è¦åœ¨å¾ªç¯ä¸­ä½¿ç”¨ defer ä¸ç„¶ä¼˜åŒ–ä¹Ÿäº«å—ä¸åˆ°</strong><br>æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f6</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;fmt.Printf(<span class="hljs-string">"f6: %d\n"</span>, i)&#125;()&#125;&#125;</code></pre><p>çœ‹ä¸€ä¸‹æ±‡ç¼–ç»“æœ</p><pre><code class="hljs go"><span class="hljs-number">0x0073</span> <span class="hljs-number">00115</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">67</span>)CALLruntime.deferproc(SB)<span class="hljs-number">0x0078</span> <span class="hljs-number">00120</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">67</span>)TESTLAX, AX<span class="hljs-number">0x007a</span> <span class="hljs-number">00122</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">67</span>)JNE<span class="hljs-number">151</span><span class="hljs-number">0x007c</span> <span class="hljs-number">00124</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">67</span>)JMP<span class="hljs-number">126</span><span class="hljs-number">0x007e</span> <span class="hljs-number">00126</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)PCDATA$<span class="hljs-number">1</span>, $<span class="hljs-number">-1</span><span class="hljs-number">0x007e</span> <span class="hljs-number">00126</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)NOP<span class="hljs-number">0x0080</span> <span class="hljs-number">00128</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)JMP<span class="hljs-number">130</span><span class="hljs-number">0x0082</span> <span class="hljs-number">00130</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)MOVQ<span class="hljs-string">""</span>.&amp;i+<span class="hljs-number">32</span>(SP), AX<span class="hljs-number">0x0087</span> <span class="hljs-number">00135</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)MOVQ(AX), AX<span class="hljs-number">0x008a</span> <span class="hljs-number">00138</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)MOVQ<span class="hljs-string">""</span>.&amp;i+<span class="hljs-number">32</span>(SP), CX<span class="hljs-number">0x008f</span> <span class="hljs-number">00143</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)INCQAX<span class="hljs-number">0x0092</span> <span class="hljs-number">00146</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)MOVQAX, (CX)<span class="hljs-number">0x0095</span> <span class="hljs-number">00149</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">66</span>)JMP<span class="hljs-number">68</span><span class="hljs-number">0x0097</span> <span class="hljs-number">00151</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">67</span>)PCDATA$<span class="hljs-number">1</span>, $<span class="hljs-number">0</span><span class="hljs-number">0x0097</span> <span class="hljs-number">00151</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">67</span>)XCHGLAX, AX<span class="hljs-number">0x0098</span> <span class="hljs-number">00152</span> (main.<span class="hljs-keyword">go</span>:<span class="hljs-number">67</span>)CALLruntime.deferreturn(SB)</code></pre><p>å¯ä»¥å‘ç°åœ¨å¾ªç¯åµŒå¥—çš„åœºæ™¯ä¸‹ï¼Œçš„ç¡®è°ƒç”¨çš„æ˜¯ <code>runtime.deferproc</code> æ–¹æ³•ï¼Œè¢«åˆ†é…åˆ°æ ˆä¸Šäº†</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ•°æ®ç»“æ„ä¸ç®—æ³•04-æ ˆä¸Š: å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨</title>
    <link href="/post/stack.html"/>
    <url>/post/stack.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go æ•°æ®ç»“æ„ä¸ç®—æ³•ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« ä¸»è¦ä¼šåŒ…æ‹¬å¸¸è§çš„æ•°æ®ç»“æ„ä¸ç®—æ³•å®ç°ï¼ŒåŒæ—¶ä¼šåŒ…æ‹¬ Go æ ‡å‡†åº“ä»£ç çš„åˆ†æç†è§£ï¼Œè®²åˆ°å¯¹åº”ç« èŠ‚çš„æ—¶å€™ä¼˜å…ˆå­¦ä¹ åˆ†æ Go çš„æºç å®ç°ï¼Œä¾‹å¦‚ sliceã€listã€sort ç­‰ï¼Œç„¶åå¯èƒ½ä¼šæœ‰ä¸€äº›å¸¸è§çš„æ¡ˆä¾‹å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/126" target="_blank" rel="noopener">æå®¢æ—¶é—´-æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a> çš„è¯¾ç¨‹ç¬”è®°</li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“:</strong> <a href="https://github.com/mohuishou/go-algorithm" target="_blank" rel="noopener">https://github.com/mohuishou/go-algorithm</a> ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œé¢„è®¡åˆ° 202101 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°:</strong> <a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a>ã€<a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener">çŸ¥ä¹</a>ã€<a href="https://lailin.xyz/atom.xml">RSS</a>ã€<a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a></li><li>ä¸Šä¸€ä¸ªç³»åˆ—åˆšåˆšå®Œæˆäº† <a href="https://lailin.xyz/post/go-design-pattern.html">Go è®¾è®¡æ¨¡å¼</a>ï¼Œå¦‚æœæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥è¿›è¡ŒæŸ¥çœ‹</li></ul><h2 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>æ ˆæ˜¯ä¸€ç§â€œæ“ä½œå—é™â€çš„çº¿æ€§è¡¨ï¼Œ<strong>åè¿›è€…å…ˆå‡ºï¼Œå…ˆè¿›è€…åå‡ºã€‚</strong><br>æ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯æˆ‘ä»¬åœ¨å ç›˜å­çš„æ—¶å€™ï¼Œå çš„æ—¶å€™ä»ä¸‹åˆ°ä¸Šä¸€ä¸ªä¸€ä¸ªç£Šèµ·æ¥ï¼Œå–çš„æ—¶å€™ï¼Œå†ä»ä¸Šåˆ°ä¸‹ä¸€ä¸ªä¸€ä¸ªçš„æ‹¿å‡ºæ¥ã€‚<br>è¯´åˆ°å…ˆå…¥åå‡ºè¿™ç§ç‰¹æ€§ï¼Œåœ¨ Go ä¸­ä½ ç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿä¸çŸ¥é“æ˜¯å¦å’Œæˆ‘çš„ç­”æ¡ˆä¸€æ ·ï¼Œ <code>defer</code><br><img src="https://lailin.xyz/images/1606140416813-6b90944b-87c1-43eb-8443-c747e6559200.svg" srcset="/img/loading.gif" alt="01_stack.drawio.svg"></p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å­˜åœ¨ä¸¤ç§å®ç°æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯æ•°ç»„å®ç°çš„é¡ºåºæ ˆï¼Œç¬¬äºŒç§æ˜¯é“¾è¡¨é“¾å¼æ ˆ</p><h4 id="æ•°ç»„å®ç°"><a href="#æ•°ç»„å®ç°" class="headerlink" title="æ•°ç»„å®ç°"></a>æ•°ç»„å®ç°</h4><p>æ•°ç»„å®ç°æˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº† <code>slice</code> ï¼Œå¹¶ä¸”å€ŸåŠ© <code>slice</code> å®ç°äº†è‡ªåŠ¨æ‰©å®¹</p><pre><code class="hljs go"><span class="hljs-comment">// Stack Stack</span><span class="hljs-keyword">type</span> Stack <span class="hljs-keyword">struct</span> &#123;items   []<span class="hljs-keyword">string</span>current <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// NewStack NewStack</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewStack</span><span class="hljs-params">()</span> *<span class="hljs-title">Stack</span></span> &#123;<span class="hljs-keyword">return</span> &amp;Stack&#123;items:   <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">10</span>),current: <span class="hljs-number">0</span>,&#125;&#125;<span class="hljs-comment">// Push å…¥æ ˆ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span> <span class="hljs-title">Push</span><span class="hljs-params">(item <span class="hljs-keyword">string</span>)</span></span> &#123;s.current++<span class="hljs-comment">// åˆ¤æ–­åº•å±‚ slice æ˜¯å¦æ»¡äº†ï¼Œå¦‚æœæ»¡äº†å°± append</span><span class="hljs-keyword">if</span> s.current == <span class="hljs-built_in">len</span>(s.items) &#123;s.items = <span class="hljs-built_in">append</span>(s.items, item)<span class="hljs-keyword">return</span>&#125;s.items[s.current] = item&#125;<span class="hljs-comment">// Pop å‡ºæ ˆ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span> <span class="hljs-title">Pop</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">if</span> s.current == <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>&#125;item := s.items[s.current]s.current--<span class="hljs-keyword">return</span> item&#125;</code></pre><h4 id="é“¾è¡¨å®ç°"><a href="#é“¾è¡¨å®ç°" class="headerlink" title="é“¾è¡¨å®ç°"></a>é“¾è¡¨å®ç°</h4><p>é“¾å¼æ ˆçš„å®ç°æˆ‘ä»¬åˆ©ç”¨åŒå‘å¾ªç¯é“¾è¡¨ï¼Œç®€åŒ–æ ˆçš„æ’å…¥æ“ä½œ</p><pre><code class="hljs go"><span class="hljs-comment">// node èŠ‚ç‚¹</span><span class="hljs-keyword">type</span> node <span class="hljs-keyword">struct</span> &#123;prev, next *nodevalue      <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// Stack é“¾å¼æ ˆ</span><span class="hljs-keyword">type</span> Stack <span class="hljs-keyword">struct</span> &#123;root *node<span class="hljs-built_in">len</span>  <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// NewStack NewStack</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewStack</span><span class="hljs-params">()</span> *<span class="hljs-title">Stack</span></span> &#123;n := &amp;node&#123;&#125;n.next = nn.prev = n<span class="hljs-keyword">return</span> &amp;Stack&#123;root: n&#125;&#125;<span class="hljs-comment">// Push å…¥æ ˆ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span> <span class="hljs-title">Push</span><span class="hljs-params">(item <span class="hljs-keyword">string</span>)</span></span> &#123;n := &amp;node&#123;value: item&#125;s.root.prev.next = nn.prev = s.root.prevn.next = s.roots.root.prev = ns.<span class="hljs-built_in">len</span>++&#125;<span class="hljs-comment">// Pop å‡ºæ ˆ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stack)</span> <span class="hljs-title">Pop</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;item := s.root.prev<span class="hljs-keyword">if</span> item == s.root &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>&#125;s.root.prev = item.previtem.prev.next = s.root<span class="hljs-comment">// é¿å…å†…å­˜æ³„æ¼</span>item.prev = <span class="hljs-literal">nil</span>item.next = <span class="hljs-literal">nil</span>s.<span class="hljs-built_in">len</span>--<span class="hljs-keyword">return</span> item.value&#125;</code></pre><h3 id="å…¸å‹é—®é¢˜"><a href="#å…¸å‹é—®é¢˜" class="headerlink" title="å…¸å‹é—®é¢˜"></a>å…¸å‹é—®é¢˜</h3><h4 id="å®ç°ä¸€ä¸ªè®¡ç®—å™¨"><a href="#å®ç°ä¸€ä¸ªè®¡ç®—å™¨" class="headerlink" title="å®ç°ä¸€ä¸ªè®¡ç®—å™¨"></a>å®ç°ä¸€ä¸ªè®¡ç®—å™¨</h4><p>æˆ‘ä»¬å®ç°äº†æ”¯æŒ<code>+ã€-ã€*ã€/ã€(ã€)</code> çš„è®¡ç®—å™¨ï¼Œè¿™ä¹Ÿæ˜¯<a href="https://leetcode-cn.com/problems/basic-calculator/" target="_blank" rel="noopener">leetcode#244</a>çš„ä¸€ç§è§£æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿™ä¸ªå®ç°æ›´åŠ å¤æ‚ï¼ŒåŸé¢˜åªéœ€è¦è®¡ç®—åŠ å‡æ³•</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> calculation<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"strconv"</span>)<span class="hljs-comment">// æ“ä½œç¬¦çš„ä¼˜å…ˆçº§</span><span class="hljs-keyword">var</span> operatorPriority = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-string">"+"</span>: <span class="hljs-number">0</span>,<span class="hljs-string">"-"</span>: <span class="hljs-number">0</span>,<span class="hljs-string">"*"</span>: <span class="hljs-number">1</span>,<span class="hljs-string">"/"</span>: <span class="hljs-number">1</span>,<span class="hljs-string">"("</span>: <span class="hljs-number">2</span>,<span class="hljs-string">")"</span>: <span class="hljs-number">2</span>,&#125;<span class="hljs-comment">// Calculator è®¡ç®—å™¨</span><span class="hljs-keyword">type</span> Calculator <span class="hljs-keyword">struct</span> &#123;nums      *StackIntoperators *Stackexp       <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// NewCalculator NewCalculator</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewCalculator</span><span class="hljs-params">(exp <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">Calculator</span></span> &#123;<span class="hljs-keyword">return</span> &amp;Calculator&#123;nums:      NewStackInt(),operators: NewStack(),exp:       exp,&#125;&#125;<span class="hljs-comment">// Calculate è·å–è®¡ç®—ç»“æœ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Calculator)</span> <span class="hljs-title">Calculate</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;l := <span class="hljs-built_in">len</span>(c.exp)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; l; i++ &#123;<span class="hljs-keyword">switch</span> e := (c.exp[i]); e &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">' '</span>:<span class="hljs-keyword">continue</span><span class="hljs-keyword">case</span> <span class="hljs-string">'0'</span>, <span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>, <span class="hljs-string">'4'</span>, <span class="hljs-string">'5'</span>, <span class="hljs-string">'6'</span>, <span class="hljs-string">'7'</span>, <span class="hljs-string">'8'</span>, <span class="hljs-string">'9'</span>:<span class="hljs-comment">// ä¸€ç›´å¾€åè·å–æ•°å­—ï¼Œå¦‚æœä¸‹ä¸€ä¸ªè¿˜æ˜¯æ•°å­—è¯´æ˜è¿™ä¸€ä¸ªæ•°è¿˜ä¸å®Œæ•´</span>j := i<span class="hljs-keyword">for</span> j &lt; l &amp;&amp; c.exp[j] &lt;= <span class="hljs-string">'9'</span> &amp;&amp; c.exp[j] &gt;= <span class="hljs-string">'0'</span> &#123;j++&#125;n, _ := strconv.Atoi(c.exp[i:j])i = j - <span class="hljs-number">1</span>c.nums.Push(n)<span class="hljs-keyword">case</span> <span class="hljs-string">'+'</span>, <span class="hljs-string">'-'</span>, <span class="hljs-string">'*'</span>, <span class="hljs-string">'/'</span>:<span class="hljs-comment">// ä»è®¡ç®—ç¬¦æ ˆä¸­è·å–æ ˆé¡¶å…ƒç´ ï¼Œå¦‚æœå½“å‰æ“ä½œç¬¦çš„ä¼˜å…ˆçº§ä½äºæ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§</span><span class="hljs-comment">// å¹¶ä¸”æ ˆé¡¶å…ƒç´ ä¸ä¸ºç©ºï¼Œå’Œæ‹¬å·</span><span class="hljs-comment">// é‚£ä¹ˆä»æ•°æ®æ ˆä¸­å–ä¸¤ä¸ªæ•°æ®å’Œæ ˆé¡¶æ“ä½œç¬¦è¿›è¡Œè®¡ç®—</span>pre := c.operators.Pop()<span class="hljs-keyword">for</span> pre != <span class="hljs-string">""</span> &amp;&amp; pre != <span class="hljs-string">"("</span> &amp;&amp; operatorPriority[<span class="hljs-keyword">string</span>(e)] &lt;= operatorPriority[pre] &#123;c.nums.Push(c.calc(pre))pre = c.operators.Pop()&#125;<span class="hljs-keyword">if</span> pre != <span class="hljs-string">""</span> &#123;c.operators.Push(pre)&#125;c.operators.Push(<span class="hljs-keyword">string</span>(e))<span class="hljs-keyword">case</span> <span class="hljs-string">'('</span>:c.operators.Push(<span class="hljs-keyword">string</span>(e))<span class="hljs-keyword">case</span> <span class="hljs-string">')'</span>:<span class="hljs-comment">// ç¢°åˆ°å³æ‹¬å·ä¹‹åå°±ä¸€ç›´ä¸æ–­æ“ä½œç¬¦æ ˆä¸­å¼¹å‡ºå…ƒç´ ï¼Œå¹¶ä¸”å–ä¸¤ä¸ªæ•°æ®è¿›è¡Œè®¡ç®—</span><span class="hljs-comment">// ç›´åˆ°ç¢°åˆ°å·¦æ‹¬å·ä¸ºæ­¢</span><span class="hljs-keyword">for</span> o := c.operators.Pop(); o != <span class="hljs-string">"("</span> &amp;&amp; o != <span class="hljs-string">""</span>; o = c.operators.Pop() &#123;c.nums.Push(c.calc(o))&#125;<span class="hljs-keyword">default</span>:<span class="hljs-built_in">panic</span>(<span class="hljs-string">"invalid exp"</span>)&#125;&#125;<span class="hljs-comment">// æœ€åå¦‚æœä¸å­˜åœ¨æ“ä½œç¬¦ï¼Œè¯´æ˜æ•°æ®æ ˆä¸­çš„æ ˆé¡¶å…ƒç´ å°±æ˜¯æœ€åç»“æœ</span>o := c.operators.Pop()<span class="hljs-keyword">if</span> o == <span class="hljs-string">""</span> &#123;<span class="hljs-keyword">return</span> c.nums.Pop()&#125;<span class="hljs-comment">// å¦‚æœå­˜åœ¨ï¼Œå°±æŠŠæœ€åçš„æ•°æ®è¿›è¡Œè®¡ç®—åè¿”å›</span><span class="hljs-keyword">return</span> c.calc(o)&#125;<span class="hljs-comment">// calc å•æ¬¡è®¡ç®—æ“ä½œï¼Œo: è®¡ç®—ç¬¦</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Calculator)</span> <span class="hljs-title">calc</span><span class="hljs-params">(o <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">int</span></span> &#123;b := c.nums.Pop()a := c.nums.Pop()fmt.Printf(<span class="hljs-string">"%d %s %d\n"</span>, a, o, b)<span class="hljs-keyword">switch</span> o &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">"+"</span>:<span class="hljs-keyword">return</span> a + b<span class="hljs-keyword">case</span> <span class="hljs-string">"-"</span>:<span class="hljs-keyword">return</span> a - b<span class="hljs-keyword">case</span> <span class="hljs-string">"*"</span>:<span class="hljs-keyword">return</span> a * b<span class="hljs-keyword">case</span> <span class="hljs-string">"/"</span>:<span class="hljs-keyword">return</span> a / b&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>&#125;<span class="hljs-comment">// calculate è®¡ç®—å™¨ï¼Œæ”¯æŒåŠ å‡ä¹˜é™¤</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">calculate</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">int</span></span> &#123;<span class="hljs-keyword">return</span> NewCalculator(s).Calculate()&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go Struct åˆå§‹åŒ–é£æ ¼çš„æŠ‰æ‹©</title>
    <link href="/post/go-new-struct-style-select.html"/>
    <url>/post/go-new-struct-style-select.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ€è¿‘åœ¨å¯¹ä¹‹å‰çš„ä»£ç åšé‡æ„ï¼Œä»ä¹‹å‰çš„ <code>MVC</code> ç»“æ„åˆ‡æ¢åˆ° <code>Clean Arch</code> çš„ç»“æ„ï¼Œä½†æ˜¯åœ¨åˆ‡æ¢çš„æ—¶å€™å…³äºä»£ç é£æ ¼å‡ºç°äº†ä¸€äº›å›°æƒ‘<br>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ <code>repository</code> æ˜¯å­˜å‚¨åº“ï¼Œä¸»è¦ç”¨äºå°è£…æ•°æ®åº“æŸ¥è¯¢æˆ–è€…æ˜¯ç¬¬ä¸‰æ–¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå®ƒå®ç°äº† <code>domain.IAzRepository</code> æ¥å£ï¼Œå…¶ä»–å±‚çš„ä»£ç éƒ½åªä¾èµ–è¿™ä¸ªæ¥å£è€Œä¸ä¾èµ–å…·ä½“çš„å®ç°</p><h2 id="ä¸‰ç§ä»£ç é£æ ¼"><a href="#ä¸‰ç§ä»£ç é£æ ¼" class="headerlink" title="ä¸‰ç§ä»£ç é£æ ¼"></a>ä¸‰ç§ä»£ç é£æ ¼</h2><h3 id="é£æ ¼ä¸€"><a href="#é£æ ¼ä¸€" class="headerlink" title="é£æ ¼ä¸€"></a>é£æ ¼ä¸€</h3><p>åœ¨ Go ä¸­æˆ‘ä»¬å¸¸å¸¸â€œè¿”å›å®ç°(struct)ï¼Œä¾èµ–æ¥å£â€ï¼Œå…¶å®å°±æ˜¯åœ¨å‡½æ•°è¿”å›çš„æ—¶å€™æˆ‘ä»¬è¿”å›ä¸€ä¸ªå…·ä½“çš„å®ç°ï¼Œå‡½æ•°çš„å‚æ•°æˆ–è€…æ˜¯ Struct çš„æˆå‘˜éƒ¨åˆ†æˆ‘ä»¬ä¾èµ–æ¥å£ï¼Œè¿™ä¸ªé£æ ¼çœ‹èµ·æ¥æ˜¯è¿èƒŒäº†è¿™ä¸ªåŸåˆ™çš„</p><pre><code class="hljs go"><span class="hljs-comment">// repository å­˜å‚¨åº“</span><span class="hljs-keyword">type</span> repository <span class="hljs-keyword">struct</span> &#123;db *gorm.DB&#125;<span class="hljs-comment">// NewAZRepository NewAZRepository</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAZRepository</span><span class="hljs-params">(db *gorm.DB)</span> <span class="hljs-title">domain</span>.<span class="hljs-title">IAzRepository</span></span> &#123;<span class="hljs-keyword">return</span> &amp;repository&#123;db: db&#125;&#125;</code></pre><h3 id="é£æ ¼äºŒ"><a href="#é£æ ¼äºŒ" class="headerlink" title="é£æ ¼äºŒ"></a>é£æ ¼äºŒ</h3><p>è¿™ä¸ªé£æ ¼è¿”å›äº†å®ç°ï¼Œå¹¶ä¸”ç”±äºå¹¶æ²¡æœ‰å¯¼å‡ºçœ‹èµ·æ¥ä¹Ÿå…·æœ‰å°è£…çš„ç‰¹æ€§ï¼Œä½†æ˜¯å¦‚æœä½ è¿è¡Œ golint ä½ å°±ä¼šå‘ç°ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºè¿™ä¹ˆå†™ï¼Œä¼šå¯¼è‡´æˆ‘ä»¬ç”¨å¯¼å‡ºçš„æ–¹æ³•å°†æ²¡æœ‰å¯¼å‡º struct ç»™æš´éœ²äº†å‡ºå»</p><pre><code class="hljs go"><span class="hljs-comment">// repository å­˜å‚¨åº“</span><span class="hljs-keyword">type</span> repository <span class="hljs-keyword">struct</span> &#123;db *gorm.DB&#125;<span class="hljs-comment">// NewAZRepository NewAZRepository</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAZRepository</span><span class="hljs-params">(db *gorm.DB)</span> *<span class="hljs-title">repository</span></span> &#123;<span class="hljs-keyword">return</span> &amp;repository&#123;db: db&#125;&#125;</code></pre><h3 id="é£æ ¼ä¸‰"><a href="#é£æ ¼ä¸‰" class="headerlink" title="é£æ ¼ä¸‰"></a>é£æ ¼ä¸‰</h3><p>è¿™ä¸ªå†™æ³•çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œç”±äº <code>Repository</code> è¢«å¯¼å‡ºï¼Œæ‰€ä»¥åœ¨å¤–éƒ¨å…¶ä»–çš„åŒ…ä¸­å°±å¯ä»¥ç›´æ¥é€šè¿‡ <code>&amp;Repository{}</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·åˆå§‹åŒ–ä¹‹åä½¿ç”¨å°±ä¼šå¯¼è‡´ panicï¼Œå› ä¸ºæˆå‘˜å‡½æ•°æ˜¯ä¸€ä¸ª nil æŒ‡é’ˆ</p><pre><code class="hljs go"><span class="hljs-comment">// Repository å­˜å‚¨åº“</span><span class="hljs-keyword">type</span> Repository <span class="hljs-keyword">struct</span> &#123;db *gorm.DB&#125;<span class="hljs-comment">// NewAZRepository NewAZRepository</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAZRepository</span><span class="hljs-params">(db *gorm.DB)</span> *<span class="hljs-title">Repository</span></span> &#123;<span class="hljs-keyword">return</span> &amp;Repository&#123;db: db&#125;&#125;</code></pre><h2 id="é€‰æ‹©"><a href="#é€‰æ‹©" class="headerlink" title="é€‰æ‹©"></a>é€‰æ‹©</h2><p>é€‰æ‹©æ€»æ˜¯å›°éš¾çš„ï¼Œå¸¦ç€è¿™ä¸ªé—®é¢˜æˆ‘å’¨è¯¢äº†åŒç»„çš„åŒäº‹è¿˜æœ‰å¥½å‡ ä¸ª Go è¯­è¨€äº¤æµç¾¤çš„åŒå­¦ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½ä¼šé€‰æ‹©é£æ ¼ä¸‰ï¼Œå°éƒ¨åˆ†ä¼šé€‰æ‹©é£æ ¼ä¸€ï¼Œé£æ ¼äºŒå‡ ä¹æ²¡æœ‰äººé€‰æ‹©ã€‚æœ€åæˆ‘é€‰ä»€ä¹ˆå‘¢ï¼Ÿ<br>æœ€åæˆ‘çš„é€‰æ‹©æ˜¯é£æ ¼ä¸€ï¼Œè¿™æ˜¯é’ˆå¯¹åœºæ™¯æ¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„è¿™ä¸ªåŒ…å…¶å®ä¸å¸Œæœ›å…¶ä»–åŒ…ç›´æ¥ä¾èµ–å®ç°ï¼Œå› ä¸ºåç»­æœ‰å¯èƒ½éšç€å‘å±•è¢«å•ç‹¬æ‹†åˆ†æˆä¸€ä¸ªå¾®æœåŠ¡æˆ–è€…æ˜¯éœ€è¦æ›´æ¢å­˜å‚¨åº“ï¼Œå¦‚æœå¤–éƒ¨æœ‰åŒ…ç›´æ¥ä¾èµ– repository ä¼šå¯¼è‡´åç»­çš„é‡æ„æ¯”è¾ƒå›°éš¾<br>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨å…¶ä»–åœ°æ–¹ä¸€èˆ¬è¿˜æ˜¯ä¼šé€‰æ‹©é£æ ¼ä¸‰ï¼Œå› ä¸ºç»“æ„ä½“åä¸å¯¼å‡ºï¼Œå¤–éƒ¨å…¶å®æ²¡æœ‰æ¯”è¾ƒå¥½çš„åŠæ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œä¾‹å¦‚æƒ³è¦ <code>var r Repository</code>ï¼Œè‡³äºå‰é¢æåˆ°çš„ç›´æ¥å­—é¢é‡åˆå§‹åŒ–çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»Ÿä¸€ä»£ç é£æ ¼è§£å†³ã€‚</p><blockquote><p>åœ¨<strong>å¤–éƒ¨åŒ…</strong>ä¸­é™¤äº†ç”¨äºå‚æ•°ä¼ é€’çš„ <code>Option</code> ç»“æ„ä¹‹å¤–ï¼Œå…¶ä½™çš„ä¸å…è®¸ç›´æ¥é€šè¿‡ &amp;XXX{} çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–</p></blockquote><p>æœ€åæ„Ÿè°¢çƒ­å¿ƒå›ç­”æˆ‘çš„å›°æƒ‘çš„å°ä¼™ä¼´ä»¬ ğŸ¤—</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>ä»£ç é£æ ¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ•°æ®ç»“æ„ä¸ç®—æ³•03-æ•°ç»„ä¸‹: ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </title>
    <link href="/post/array_2.html"/>
    <url>/post/array_2.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go æ•°æ®ç»“æ„ä¸ç®—æ³•ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« ä¸»è¦ä¼šåŒ…æ‹¬å¸¸è§çš„æ•°æ®ç»“æ„ä¸ç®—æ³•å®ç°ï¼ŒåŒæ—¶ä¼šåŒ…æ‹¬ Go æ ‡å‡†åº“ä»£ç çš„åˆ†æç†è§£ï¼Œè®²åˆ°å¯¹åº”ç« èŠ‚çš„æ—¶å€™ä¼˜å…ˆå­¦ä¹ åˆ†æ Go çš„æºç å®ç°ï¼Œä¾‹å¦‚ sliceã€listã€sort ç­‰ï¼Œç„¶åå¯èƒ½ä¼šæœ‰ä¸€äº›å¸¸è§çš„æ¡ˆä¾‹å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/126" target="_blank" rel="noopener">æå®¢æ—¶é—´-æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a> çš„è¯¾ç¨‹ç¬”è®°</li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“:</strong> <a href="https://github.com/mohuishou/go-algorithm" target="_blank" rel="noopener">https://github.com/mohuishou/go-algorithm</a> ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œé¢„è®¡åˆ° 202101 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°:</strong> <a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a>ã€<a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener">çŸ¥ä¹</a>ã€<a href="https://lailin.xyz/atom.xml">RSS</a>ã€<a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a></li><li>ä¸Šä¸€ä¸ªç³»åˆ—åˆšåˆšå®Œæˆäº† <a href="https://lailin.xyz/post/go-design-pattern.html">Go è®¾è®¡æ¨¡å¼</a>ï¼Œå¦‚æœæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥è¿›è¡ŒæŸ¥çœ‹</li></ul><h2 id="é—®é¢˜å›é¡¾"><a href="#é—®é¢˜å›é¡¾" class="headerlink" title="é—®é¢˜å›é¡¾"></a>é—®é¢˜å›é¡¾</h2><p>æœ¬æ–‡ç« ä¸»è¦æ˜¯ä¸ºäº†å›ç­”ä¸Šä¸€ç¯‡æ–‡ç« çš„é—®é¢˜ï¼Œå¹¶ä¸”ä»‹ç»ä¸€ä¸‹åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä»¥åŠåç»­éƒ½ä¼šä½¿ç”¨åˆ°çš„è°ƒè¯•å·¥å…· <code>gdb</code></p><ul><li>è¯·æŸ¥çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼Œä¼šè¾“å‡ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ<ul><li>A: 5 8 B: 8 8 C: 5 5 D: 5 6</li></ul></li></ul><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;s := []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;s = <span class="hljs-built_in">append</span>(s, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)fmt.Println(<span class="hljs-built_in">len</span>(s), <span class="hljs-built_in">cap</span>(s))&#125;</code></pre><ul><li>åœ¨è®²è§£ slice åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆ <code>s2</code> , <code>s3</code> æ‰“å°çš„æ•°ç»„æŒ‡é’ˆéƒ½æ˜¯ <code>0x587450</code> ?</li></ul><h2 id="slice-æ‰©å®¹ç®—æ³•æ˜¯å¦é—æ¼äº†ä»€ä¹ˆï¼Ÿ"><a href="#slice-æ‰©å®¹ç®—æ³•æ˜¯å¦é—æ¼äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="slice æ‰©å®¹ç®—æ³•æ˜¯å¦é—æ¼äº†ä»€ä¹ˆï¼Ÿ"></a>slice æ‰©å®¹ç®—æ³•æ˜¯å¦é—æ¼äº†ä»€ä¹ˆï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« å½“ä¸­è®²åˆ°çš„ slice æ‰©å®¹çš„ ç®—æ³•:</p><ul><li>å¦‚æœéœ€è¦çš„æœ€å°å®¹é‡æ¯”ä¸¤å€åŸæœ‰å®¹é‡å¤§ï¼Œé‚£ä¹ˆå°±å–éœ€è¦çš„å®¹é‡</li><li>å¦‚æœåŸæœ‰ slice é•¿åº¦å°äº 1024 é‚£ä¹ˆæ¯æ¬¡å°±æ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€</li><li>å¦‚æœåŸ slice å¤§äºç­‰äº 1024 é‚£ä¹ˆæ¯æ¬¡æ‰©å®¹å°±æ‰©ä¸ºåŸæ¥çš„ 1.25 å€</li></ul><p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘è¿›è¡Œå¥—ç”¨:</p><ul><li><code>s</code> åˆå§‹åŒ–æ—¶ <code>len=2</code></li><li><code>s = append(s, 3, 4, 5)</code> æ­¤æ—¶éœ€è¦çš„æœ€å°å®¹é‡ä¸º <code>5 &gt; 2*2</code></li><li>æŒ‰ç…§è¿™ä¸ªé€»è¾‘æœ€åçš„ç­”æ¡ˆåº”è¯¥æ˜¯ <code>C: 5 5</code></li><li>ä½†æ˜¯å¦‚æœå¤§å®¶è¿è¡Œè¿‡è¿™æ®µä»£ç åº”è¯¥ä¼šçŸ¥é“è¿™ä¸ªç­”æ¡ˆæ˜¯ <code>D: 5 6</code> ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªé€»è¾‘å’Œæˆ‘ä»¬ä¹‹å‰äº†è§£åˆ°çš„ä¸å¤ªä¸€æ ·å•Š</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨ gdb è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ç»“æœ</p><h2 id="ä½¿ç”¨-GDB-è°ƒè¯•-Golang-ä»£ç "><a href="#ä½¿ç”¨-GDB-è°ƒè¯•-Golang-ä»£ç " class="headerlink" title="ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç "></a>ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </h2><p>è°ƒè¯• go ç¨‹åºæˆ‘ä»¬å¸¸ç”¨çš„è°ƒè¯•å·¥å…·å…¶å®æ˜¯ <a href="https://github.com/go-delve/delve" target="_blank" rel="noopener">dlv</a> è¿™ä¸ªå·¥å…·éå¸¸å¥½ç”¨ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå¥½çš„å’Œ <code>VS Code</code> <code>Goland</code> ç­‰ IDE è¿›è¡Œç»“åˆï¼Œä½†æ˜¯å®ƒæ— æ³•è°ƒè¯• runtime çš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨ä¸Š gdb äº†ï¼Œå¦‚æœå¤§å®¶ä¸éœ€è¦è°ƒè¯• runtime çš„ä»£ç çš„è¯è¿˜æ˜¯å»ºè®®ä½¿ç”¨ dlv</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre><code class="hljs bash">brew install gdb <span class="hljs-comment"># for mac</span></code></pre><p>å¦‚æœæ˜¯ linux ä½¿ç”¨è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·è¿›è¡Œå®‰è£…å³å¯<br>æ³¨æ„å®‰è£…å®Œæˆä¹‹åéœ€è¦åœ¨ home ç›®å½•ä¸Šæ·»åŠ ç›¸å…³é…ç½®</p><pre><code class="hljs bash">vim ~/.gdbinit<span class="hljs-comment"># è¾“å…¥ä¸‹é¢</span>add-auto-load-safe-path <span class="hljs-variable">$GOROOT</span>/src/runtime/runtime-gdb.py <span class="hljs-comment"># è¿™é‡Œå°† $GOROOT æ›¿æ¢ä¸ºä½ çš„ GO å®‰è£…ç›®å½•</span></code></pre><p>å¦‚æœä½ æ˜¯ mac é¦–æ¬¡å®‰è£… gdb éœ€è¦ç»™ gdb ç­¾åï¼Œå¯ä»¥å‚è€ƒ: <a href="https://gist.github.com/hlissner/898b7dfc0a3b63824a70e15cd0180154" target="_blank" rel="noopener">https://gist.github.com/hlissner/898b7dfc0a3b63824a70e15cd0180154</a></p><h3 id="ç¼–è¯‘ä»£ç "><a href="#ç¼–è¯‘ä»£ç " class="headerlink" title="ç¼–è¯‘ä»£ç "></a>ç¼–è¯‘ä»£ç </h3><ul><li>æˆ‘ä»¬ä½¿ç”¨ <code>-gcflags=all=&quot;-N -l&quot;</code> ç¦ç”¨å†…è”ä¼˜åŒ–æ–¹ä¾¿åé¢è°ƒè¯•</li><li>åœ¨ mac ä¸Šå¦‚æœä¸åŠ  <code>-ldflags=&#39;-compressdwarf=false&#39;</code> åœ¨ gdb è°ƒè¯•çš„æ—¶å€™å¯èƒ½ä¼šæç¤º <code>No symbol table is loaded. Use the &quot;file&quot; command.</code><ul><li>è¿™æ˜¯å› ä¸ºä¸ºäº†å‡å°‘äºŒè¿›åˆ¶å¤§å°ä¼šé»˜è®¤å‹ç¼© <strong>DWARF</strong> è°ƒè¯•ä¿¡æ¯ï¼Œè¿™ä¸ªåœ¨ mac å’Œ windows ä¸Šéƒ¨åˆ†å·¥å…·ä¸æ”¯æŒï¼Œlinux ä¸€èˆ¬æ²¡æœ‰è¿™ä¸ªé—®é¢˜</li><li>åŠ ä¸Š <code>-ldflags=&#39;-compressdwarf=false&#39;</code> è¿™ä¸ªæ ‡å¿—å¯ä»¥ç¦ç”¨å‹ç¼©æ–¹ä¾¿è°ƒè¯•</li></ul></li></ul><pre><code class="hljs bash">go build -o bin/03_q1_slice_cap -gcflags=all=<span class="hljs-string">"-N -l"</span> -ldflags=<span class="hljs-string">'-compressdwarf=false'</span> 02_array/03_q1_slice_cap/main.go</code></pre><h3 id="è¿›å…¥-GDB-è°ƒè¯•çª—å£"><a href="#è¿›å…¥-GDB-è°ƒè¯•çª—å£" class="headerlink" title="è¿›å…¥ GDB è°ƒè¯•çª—å£"></a>è¿›å…¥ GDB è°ƒè¯•çª—å£</h3><ul><li><code>-tui</code> è¡¨ç¤ºåŒæ—¶æ˜¾ç¤ºä»£ç çª—å£</li></ul><pre><code class="hljs bash">gdb -tui ./bin/03_q1_slice_cap</code></pre><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå›è½¦å‡ æ¬¡ä¹‹åå‡ºç° <code>Loading Go Runtime support.</code> å°±è¯´æ˜æ­£å¸¸äº†<br><img src="https://lailin.xyz/images/1605939788051-1d907407-893d-4d1c-bf87-8b9a91dc2905.png" srcset="/img/loading.gif" alt="image.png"></p><h3 id="å¸¸ç”¨è°ƒè¯•å‘½ä»¤"><a href="#å¸¸ç”¨è°ƒè¯•å‘½ä»¤" class="headerlink" title="å¸¸ç”¨è°ƒè¯•å‘½ä»¤"></a>å¸¸ç”¨è°ƒè¯•å‘½ä»¤</h3><ul><li><code>b æ–‡ä»¶å:è¡Œæ•°</code> æ‰“æ–­ç‚¹</li><li><code>info b</code> å½“å‰çš„æ–­ç‚¹æƒ…å†µ</li><li><code>r</code> è¿è¡Œç¨‹åºçŸ¥é“æ–­ç‚¹å¤„</li><li><code>c</code> ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</li><li><code>s</code> å•æ­¥æ‰§è¡Œï¼Œå¦‚æœæœ‰è°ƒç”¨å‡½æ•°åˆ™è¿›å…¥å‡½æ•°ï¼Œæ³¨æ„å’Œ n çš„åŒºåˆ«</li><li><code>n</code> å•æ­¥æ‰§è¡Œï¼Œå¦‚æœæœ‰è°ƒç”¨çš„å‡½æ•°ä¸ä¼šè¿›å…¥å‡½æ•°å†…éƒ¨</li><li><code>until</code> é€€å‡ºå¾ªç¯</li><li><code>until:è¡Œå·</code> æ‰§è¡Œåˆ°æŒ‡å®šè¡Œ</li><li><code>info locals</code> å½“å‰å †æ ˆçš„æ‰€æœ‰å˜é‡</li><li><code>info args</code> æ‰“å°å‚æ•°</li><li><code>info goroutines</code> æŸ¥çœ‹æ‰€æœ‰çš„ goroutine åŠå…¶ ID</li><li><code>help</code> å¸®åŠ©</li><li><code>q</code> é€€å‡º</li></ul><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>çŸ¥é“å¦‚ä½•æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å¹²æ´»</p><ol><li>é¦–å…ˆç»™ append å‡½æ•°æ‰“ä¸€ä¸ªæ–­ç‚¹ <code>b main.go:11</code></li><li>ç„¶åæ‰§è¡Œåˆ°æ–­ç‚¹å¤„ <code>r</code></li><li>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå•æ­¥è¿è¡Œè¿›å…¥åˆ° <code>slice</code> çš„æ‰©å®¹å‡½æ•°ä¸­ <code>s</code></li></ol><p><img src="https://lailin.xyz/images/1605942212393-f3cdd7f9-29a9-47ad-8d6b-f298dcf8a9e9.png" srcset="/img/loading.gif" alt="image.png"></p><ol start="4"><li>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>n</code> ä¸€ç›´å•æ­¥æ‰§è¡Œåˆ°æ‰©å®¹ç®—æ³•ç»“æŸï¼Œä½¿ç”¨ <code>info locals</code> æ‰“å°å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªæ—¶å€™è®¡ç®—å‡ºçš„ <code>newcap</code> å’Œæˆ‘ä»¬æœ€åˆé¢„è®¡çš„ä¸€æ ·æ˜¯ 5ï¼Œé‚£å“ªé‡Œå‡ºäº†é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ <code>n</code> æ¥ç€çœ‹</li></ol><p><img src="https://lailin.xyz/images/1605942355389-cee6e121-db45-4062-b100-7fc225346368.png" srcset="/img/loading.gif" alt="image.png"></p><ol start="5"><li>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ‰§è¡Œåˆ°è¿™é‡Œæˆ‘ä»¬å‘ç°ï¼Œ <code>newcap</code> è¢«é‡æ–°èµ‹å€¼äº†ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶å€™ <code>capmem=48</code> <code>PtrSize=8</code> æ‰€ä»¥æœ€åçš„å‡ºæ¥äº† <code>newcap</code> ç­‰äº 6</li></ol><p><img src="https://lailin.xyz/images/1605942584081-99ee845c-c590-48fe-8736-aafdc6088dbd.png" srcset="/img/loading.gif" alt="image.png"><br>çŸ¥é“é—®é¢˜å‡ºç°åœ¨å“ªé‡Œä¹‹åæˆ‘ä»¬å¯ä»¥å†æ¥çœ‹ä¸€ä¸‹æºä»£ç ï¼Œæœ‰ä¸€ä¸ªå†…å­˜å¯¹é½çš„å‡½æ•°</p><pre><code class="hljs go"><span class="hljs-comment">// Returns size of the memory block that mallocgc will allocate if you ask for the size.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">roundupsize</span><span class="hljs-params">(size <span class="hljs-keyword">uintptr</span>)</span> <span class="hljs-title">uintptr</span></span> &#123;<span class="hljs-keyword">if</span> size &lt; _MaxSmallSize &#123;<span class="hljs-keyword">if</span> size &lt;= smallSizeMax<span class="hljs-number">-8</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">uintptr</span>(class_to_size[size_to_class8[divRoundUp(size, smallSizeDiv)]])&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">uintptr</span>(class_to_size[size_to_class128[divRoundUp(size-smallSizeMax, largeSizeDiv)]])&#125;&#125;<span class="hljs-keyword">if</span> size+_PageSize &lt; size &#123;<span class="hljs-keyword">return</span> size&#125;<span class="hljs-keyword">return</span> alignUp(size, _PageSize)&#125;<span class="hljs-keyword">const</span> (_MaxSmallSize   = <span class="hljs-number">32768</span>smallSizeDiv    = <span class="hljs-number">8</span>smallSizeMax    = <span class="hljs-number">1024</span>largeSizeDiv    = <span class="hljs-number">128</span>_NumSizeClasses = <span class="hljs-number">67</span>_PageShift      = <span class="hljs-number">13</span>)<span class="hljs-keyword">var</span> class_to_size = [_NumSizeClasses]<span class="hljs-keyword">uint16</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">32</span>, <span class="hljs-number">48</span>, <span class="hljs-number">64</span>, <span class="hljs-number">80</span>, <span class="hljs-number">96</span>, <span class="hljs-number">112</span>, ...&#125;<span class="hljs-keyword">var</span> class_to_allocnpages = [_NumSizeClasses]<span class="hljs-keyword">uint8</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, ...&#125;</code></pre><p>å¯ä»¥å‘ç°æˆ‘ä»¬ä¹‹å‰åœ¨è®¡ç®— capmem çš„æ—¶å€™ä¼ å…¥çš„ <code>capmem = roundupsize(uintptr(newcap) * sys.PtrSize)</code> å€¼æ˜¯ <code>5*8=40</code> æœ€åå¯¹é½å‡ºçš„ç»“æœå°±æ˜¯ <code>48</code> äº†</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="slice-æ‰©å®¹ç®—æ³•"><a href="#slice-æ‰©å®¹ç®—æ³•" class="headerlink" title="slice æ‰©å®¹ç®—æ³•"></a>slice æ‰©å®¹ç®—æ³•</h3><ul><li><strong>å¦‚æœéœ€è¦çš„æœ€å°å®¹é‡æ¯”ä¸¤å€åŸæœ‰å®¹é‡å¤§ï¼Œé‚£ä¹ˆå°±å–éœ€è¦çš„å®¹é‡</strong></li><li>å¦‚æœåŸæœ‰ slice é•¿åº¦å°äº 1024 é‚£ä¹ˆæ¯æ¬¡å°±æ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€</li><li>å¦‚æœåŸ slice å¤§äºç­‰äº 1024 é‚£ä¹ˆæ¯æ¬¡æ‰©å®¹å°±æ‰©ä¸ºåŸæ¥çš„ 1.25 å€</li><li><strong>é™¤æ­¤ä¹‹å¤–æ‰©å®¹å®¹é‡è®¡ç®—å®Œæˆä¹‹åï¼Œè¿˜ä¼šè¿›è¡Œä¸€æ¬¡å†…å­˜å¯¹é½æ“ä½œ</strong></li></ul><p>æœç´¢ slice æ‰©å®¹ç­–ç•¥å¾ˆå¤šéƒ½ä¼šè¯´ç¬¬ 2ã€3 ç‚¹ä½†æ˜¯æ²¡æœ‰è¯´ 1, 4 ç‚¹å°±ä¼šé€ æˆä¸€äº›å›°æƒ‘</p><h3 id="GDB-è°ƒè¯•"><a href="#GDB-è°ƒè¯•" class="headerlink" title="GDB è°ƒè¯•"></a>GDB è°ƒè¯•</h3><ul><li>mac ä¸‹å®‰è£…ä½¿ç”¨ gdb æ¯”è¾ƒéº»çƒ¦ï¼Œå»ºè®®ä½¿ç”¨ linux</li><li>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬è¿˜æ˜¯å»ºè®®ä½¿ç”¨ dlv è¿›è¡Œè°ƒè¯•ï¼Œå¦‚æœæœ‰ runtime åº“çš„è°ƒè¯•éœ€æ±‚å¯ä»¥ä½¿ç”¨ gdb</li><li>å­¦ä¹ äº† gdb çš„å®‰è£…ä»¥åŠåŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼Œä½ ä¹‹å‰æœ‰ç±»ä¼¼çš„ç»å†ä¹ˆï¼Ÿä¸€èˆ¬ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ gdb è¿›è¡Œè°ƒè¯•</li></ul><h3 id="é—®é¢˜-2-è§£ç­”-åœ¨è®²è§£-slice-åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆ-s2-s3-æ‰“å°çš„æ•°ç»„æŒ‡é’ˆéƒ½æ˜¯-0x587450"><a href="#é—®é¢˜-2-è§£ç­”-åœ¨è®²è§£-slice-åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆ-s2-s3-æ‰“å°çš„æ•°ç»„æŒ‡é’ˆéƒ½æ˜¯-0x587450" class="headerlink" title="é—®é¢˜ 2 è§£ç­”: åœ¨è®²è§£ slice åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆ s2 , s3 æ‰“å°çš„æ•°ç»„æŒ‡é’ˆéƒ½æ˜¯ 0x587450 ?"></a>é—®é¢˜ 2 è§£ç­”: åœ¨è®²è§£ slice åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆ <code>s2</code> , <code>s3</code> æ‰“å°çš„æ•°ç»„æŒ‡é’ˆéƒ½æ˜¯ <code>0x587450</code> ?</h3><p>åœ¨è®²è§£ <code>makeslice</code> çš„æ—¶å€™æˆ‘ä»¬æœ‰è¯´åˆ°æœ€åä¸€æ­¥ä¼šè°ƒç”¨ <code>mallocgc</code> åˆ†é…å†…å­˜ï¼Œçœ‹è¿™ä¸ªå‡½æ•°çš„æºç æˆ‘ä»¬å°±èƒ½å‘ç°ï¼Œæœ‰ä¸€æ­¥åˆ¤æ–­ï¼Œå¦‚æœå®¹é‡ä¸º 0 ä¼šè¿”å›ä¸€ä¸ªå›ºå®šçš„åœ°å€</p><pre><code class="hljs go"><span class="hljs-keyword">if</span> size == <span class="hljs-number">0</span> &#123;    <span class="hljs-keyword">return</span> unsafe.Pointer(&amp;zerobase)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ•°æ®ç»“æ„ä¸ç®—æ³•02-æ•°ç»„ä¸Š: æ·±å…¥ç†è§£ slice</title>
    <link href="/post/array.html"/>
    <url>/post/array.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go æ•°æ®ç»“æ„ä¸ç®—æ³•ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« ä¸»è¦ä¼šåŒ…æ‹¬å¸¸è§çš„æ•°æ®ç»“æ„ä¸ç®—æ³•å®ç°ï¼ŒåŒæ—¶ä¼šåŒ…æ‹¬ Go æ ‡å‡†åº“ä»£ç çš„åˆ†æç†è§£ï¼Œè®²åˆ°å¯¹åº”ç« èŠ‚çš„æ—¶å€™ä¼˜å…ˆå­¦ä¹ åˆ†æ Go çš„æºç å®ç°ï¼Œä¾‹å¦‚ sliceã€listã€sort ç­‰ï¼Œç„¶åå¯èƒ½ä¼šæœ‰ä¸€äº›å¸¸è§çš„æ¡ˆä¾‹å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/126" target="_blank" rel="noopener">æå®¢æ—¶é—´-æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a> çš„è¯¾ç¨‹ç¬”è®°</li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“:</strong> <a href="https://github.com/mohuishou/go-algorithm" target="_blank" rel="noopener">https://github.com/mohuishou/go-algorithm</a> ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œé¢„è®¡åˆ° 202101 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°:</strong> <a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a>ã€<a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener">çŸ¥ä¹</a>ã€<a href="https://lailin.xyz/atom.xml">RSS</a>ã€<a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a></li><li>ä¸Šä¸€ä¸ªç³»åˆ—åˆšåˆšå®Œæˆäº† <a href="https://lailin.xyz/post/go-design-pattern.html">Go è®¾è®¡æ¨¡å¼</a>ï¼Œå¦‚æœæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥è¿›è¡ŒæŸ¥çœ‹</li></ul><h2 id="ä¸ŠæœŸç­”æ¡ˆ"><a href="#ä¸ŠæœŸç­”æ¡ˆ" class="headerlink" title="ä¸ŠæœŸç­”æ¡ˆ"></a>ä¸ŠæœŸç­”æ¡ˆ</h2><h3 id="Q-é€šè¿‡-Element-èŠ‚ç‚¹ä¸­çš„-List-ç»“æ„æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å±äºå½“å‰é“¾è¡¨çš„æ–¹å¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå‡ºç°-bug"><a href="#Q-é€šè¿‡-Element-èŠ‚ç‚¹ä¸­çš„-List-ç»“æ„æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å±äºå½“å‰é“¾è¡¨çš„æ–¹å¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå‡ºç°-bug" class="headerlink" title="Q: é€šè¿‡ Element èŠ‚ç‚¹ä¸­çš„ List ç»“æ„æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å±äºå½“å‰é“¾è¡¨çš„æ–¹å¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå‡ºç°  bug"></a>Q: é€šè¿‡ Element èŠ‚ç‚¹ä¸­çš„ List ç»“æ„æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å±äºå½“å‰é“¾è¡¨çš„æ–¹å¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå‡ºç° <code>bug</code></h3><pre><code class="hljs go">l := list.List&#123;&#125;e := l.PushBack(<span class="hljs-number">10</span>)l = list.List&#123;&#125;l.Remove(e)fmt.Println(<span class="hljs-string">"list len: "</span>, l.Len())</code></pre><p>æ¥ç€çœ‹ä¸‹é¢ä¹‹å‰ï¼Œå…ˆæƒ³ä¸€æƒ³ï¼Œä½ è§‰å¾—è¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ<br>è¿™ä¸ªé—®é¢˜æ¥è‡ª: <a href="https://github.com/golang/go/issues/39014" target="_blank" rel="noopener">https://github.com/golang/go/issues/39014</a><br>è¿™æ®µä»£ç ä¼šè¾“å‡º -1ï¼Œä½†æ˜¯æˆ‘ä»¬æœŸæœ›çš„ä¸åº”è¯¥æ˜¯è¾“å‡º 0 ä¹ˆï¼Ÿ<br>æˆ‘ä»¬æ¥çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ<br><img src="https://lailin.xyz/images/1605409586875-e7ef8b69-b95a-4fb8-9d6a-27f33f8f689c.svg" srcset="/img/loading.gif" alt="01_é“¾è¡¨.drawio.svg"></p><ul><li>å½“æˆ‘ä»¬æ‰§è¡Œå®Œ <code>l.PushBack(10)</code> è¿™æ®µä»£ç ç›´æ¥ï¼Œå°±å¦‚å·¦å›¾æ‰€ç¤ºäº†ï¼ŒèŠ‚ç‚¹ e æŒ‡å‘äº†é“¾è¡¨ lï¼Œé“¾è¡¨ l çš„å€¼çš„é•¿åº¦æ˜¯ 1</li><li>ä½†æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œå®Œ <code>l = list.List{}</code> æˆ‘ä»¬é‡ç½®äº†é“¾è¡¨ l çš„å€¼ï¼Œå¹¶æ²¡æœ‰ä¿®æ”¹ä»–çš„åœ°å€ï¼Œæ‰€ä»¥ e è¿˜æ˜¯æŒ‡å‘çš„é“¾è¡¨ lï¼Œå½“æ‰§è¡Œ <code>Remove</code> æ–¹æ³•çš„æ—¶å€™ï¼Œe çš„é“¾è¡¨å’Œå½“å‰æ‰§è¡Œçš„ l çš„åœ°å€åˆ¤æ–­æ˜¯å¯ä»¥å¯¹åº”çš„ä¸Šçš„ï¼Œä½†æ˜¯å®é™…ä¸Šé“¾è¡¨çš„å€¼å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œé“¾è¡¨çš„é•¿åº¦å·²ç»ä¸ä¸º 1 çš„ï¼Œå¹¶ä¸”æ–°çš„é“¾è¡¨çš„æ ¹èŠ‚ç‚¹ä¹Ÿæ²¡æœ‰æŒ‡å‘ e</li><li>æ‰€ä»¥æœ€åå¾—åˆ°çš„é•¿åº¦æ‰æ˜¯ -1</li><li>æœ€åç»†å¿ƒçš„åŒå­¦åº”è¯¥å·²ç»å‘ç°ï¼Œè¿™é‡Œå…¶å®è¿˜å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œå…ƒç´  e -&gt; root(0x2) å…¶å®å·²ç»æ²¡æœ‰ç”¨åˆ°äº†</li></ul><h2 id="ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ</h2><ul><li>æ•°ç»„å¤§å®¶åº”è¯¥éƒ½éå¸¸å±æ€§æˆ‘ä»¬æ¥ç®€å•çš„å›é¡¾ä¸€ä¸‹</li><li>æ•°ç»„æ˜¯ä¸€ä¸ªå…·æœ‰è¿ç»­çš„å†…å­˜ç©ºé—´å’Œç›¸åŒç±»å‹çš„æ•°æ®çš„æ•°æ®ç»“æ„</li><li>æˆ‘ä»¬éšæœºè®¿é—®ä»»æ„ä¸€ä¸ªä¸‹æ ‡çš„æ•°æ®çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)</li><li>ä½†æ˜¯æ­£æ˜¯ç”±äºè¿™ç§ç‰¹æ€§ï¼Œå¯¼è‡´å®ƒæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œæ˜¯ O(n)</li></ul><p><img src="https://lailin.xyz/images/1605409904549-b00a01d7-340f-4101-9e11-cdcea25528e1.svg" srcset="/img/loading.gif" alt="01_array.drawio.svg"></p><h2 id="Go-ä¸­çš„æ•°ç»„"><a href="#Go-ä¸­çš„æ•°ç»„" class="headerlink" title="Go ä¸­çš„æ•°ç»„"></a>Go ä¸­çš„æ•°ç»„</h2><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// åˆå§‹åŒ–æ•°ç»„</span><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<span class="hljs-comment">// æŸ¥æ‰¾å…ƒç´ </span>fmt.Printf(<span class="hljs-string">"arr[1]: %d\n"</span>, arr[<span class="hljs-number">1</span>])<span class="hljs-comment">// åˆ é™¤å…ƒç´ </span>remove(&amp;arr, <span class="hljs-number">2</span>)<span class="hljs-comment">// remove(&amp;arr, 3) // will panic</span>fmt.Println(arr)&#125;<span class="hljs-comment">// åˆ é™¤æ•°ç»„ arr çš„æŸä¸ªå…ƒç´ </span><span class="hljs-comment">// index ä¸ºéœ€è¦åˆ é™¤çš„ç´¢å¼•</span><span class="hljs-comment">// ä»éœ€è¦åˆ é™¤çš„å…ƒç´ å¼€å§‹ï¼Œä¾æ¬¡å°†åé¢çš„å…ƒç´ å¾€å‰ç§»åŠ¨ä¸€ä½å³å¯</span><span class="hljs-comment">// ç„¶åå°†æœ€åä¸€ä½ä¿®æ”¹ä¸ºè¯¥ç±»å‹çš„é»˜è®¤å€¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remove</span><span class="hljs-params">(arr *[3]<span class="hljs-keyword">int</span>, index <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">if</span> index &gt;= <span class="hljs-built_in">len</span>(arr) &#123;log.Panicf(<span class="hljs-string">"%d remove out range arr"</span>, index)&#125;<span class="hljs-keyword">for</span> i := index; i &lt; <span class="hljs-built_in">len</span>(arr)<span class="hljs-number">-1</span>; i++ &#123;arr[i] = arr[i+<span class="hljs-number">1</span>]&#125;arr[<span class="hljs-built_in">len</span>(arr)<span class="hljs-number">-1</span>] = <span class="hljs-number">0</span>&#125;</code></pre><h3 id="Q-ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨-remove-å‡½æ•°å½“ä¸­çš„å‚æ•°ä½¿ç”¨çš„æ˜¯æŒ‡é’ˆ"><a href="#Q-ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨-remove-å‡½æ•°å½“ä¸­çš„å‚æ•°ä½¿ç”¨çš„æ˜¯æŒ‡é’ˆ" class="headerlink" title="Q: ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ remove å‡½æ•°å½“ä¸­çš„å‚æ•°ä½¿ç”¨çš„æ˜¯æŒ‡é’ˆ"></a>Q: ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ remove å‡½æ•°å½“ä¸­çš„å‚æ•°ä½¿ç”¨çš„æ˜¯æŒ‡é’ˆ</h3><p>è¿™æ˜¯å› ä¸ºåœ¨ go ä¸­å‚æ•°çš„ä¼ é€’éƒ½æ˜¯å€¼ä¼ é€’ï¼Œå¦‚æœä¸ç”¨æŒ‡é’ˆçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¤åˆ¶ä¸€ä»½æ•°æ®åˆ°å‡½æ•°ä¸­ï¼Œè¿™æ ·å°±æ— æ³•åšåˆ°åˆ é™¤çš„ä½œç”¨</p><pre><code class="hljs go"><span class="hljs-comment">// åœ¨å‡½æ•° main ä¸­</span>fmt.Printf(<span class="hljs-string">"main: %p --&gt; %+v\n"</span>, &amp;arr, arr)p(arr)p2(&amp;arr)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">p</span><span class="hljs-params">(arr [3]<span class="hljs-keyword">int</span>)</span></span> &#123;fmt.Printf(<span class="hljs-string">"p: %p --&gt; %+v\n"</span>, &amp;arr, arr)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">p2</span><span class="hljs-params">(arr *[3]<span class="hljs-keyword">int</span>)</span></span> &#123;fmt.Printf(<span class="hljs-string">"p2: %p --&gt; %+v\n"</span>, arr, arr)&#125;</code></pre><p>è¾“å‡º:</p><pre><code class="hljs go">main: <span class="hljs-number">0xc0000c2000</span> --&gt; [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span>]p: <span class="hljs-number">0xc0000c2080</span> --&gt; [<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span>]p2: <span class="hljs-number">0xc0000c2000</span> --&gt; &amp;[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span>]</code></pre><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œåœ¨å‡½æ•° p ä¸­æˆ‘ä»¬ç›´æ¥ä¼ é€’çš„æ•°ç»„ï¼Œæœ€åæ‰“å°çš„å˜é‡åœ°å€æ˜¯å’Œ main ä¸­ä¸åŒçš„ï¼Œå°±å°è¯äº†æˆ‘ä»¬ä¹‹å‰çš„è¯´æ³•<br>åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å…¶å®æ˜¯å¾ˆå°‘ä½¿ç”¨åˆ°å›ºå®šé•¿åº¦çš„æ•°ç»„çš„ï¼Œè€Œæ˜¯ä½¿ç”¨å¯ä»¥è‡ªåŠ¨æ‰©å®¹çš„ sliceï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ·±å…¥çš„çœ‹ä¸€ä¸‹ slice å½“ä¸­çš„ä¸€äº›ç»†èŠ‚</p><h2 id="æ·±å…¥ç†è§£-Slice"><a href="#æ·±å…¥ç†è§£-Slice" class="headerlink" title="æ·±å…¥ç†è§£ Slice"></a>æ·±å…¥ç†è§£ Slice</h2><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="headerlink" title="åŸºç¡€ä½¿ç”¨"></a>åŸºç¡€ä½¿ç”¨</h4><pre><code class="hljs go"><span class="hljs-comment">// åˆå§‹åŒ–</span>s1 := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">2</span>)fmt.Printf(<span class="hljs-string">"s1(%p): %v, len: %d, cap: %d\n"</span>, &amp;s1, s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<span class="hljs-comment">// s1(0xc00000c080): [0 0], len: 2, cap: 2</span><span class="hljs-comment">// èµ‹å€¼</span>s1[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>s1[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>fmt.Printf(<span class="hljs-string">"s1(%p): %v, len: %d, cap: %d\n"</span>, &amp;s1, s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<span class="hljs-comment">//s1(0xc00000c080): [1 2], len: 2, cap: 2</span><span class="hljs-comment">// æ‰©å®¹</span>s1 = <span class="hljs-built_in">append</span>(s1, <span class="hljs-number">3</span>)fmt.Printf(<span class="hljs-string">"s1(%p): %v, len: %d, cap: %d\n"</span>, &amp;s1, s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<span class="hljs-comment">// s1(0xc00000c080): [1 2 3], len: 3, cap: 4</span><span class="hljs-comment">// åˆ é™¤å…ƒç´ </span>s1 = <span class="hljs-built_in">append</span>(s1[:<span class="hljs-number">1</span>], s1[<span class="hljs-number">2</span>:]...)fmt.Printf(<span class="hljs-string">"s1(%p): %v, len: %d, cap: %d\n"</span>, &amp;s1, s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<span class="hljs-comment">// s1(0xc00000c080): [1 3], len: 2, cap: 4</span></code></pre><ul><li>å¯ä»¥å‘ç°ï¼Œé€šè¿‡ append ä¹‹å s1 çš„å®¹é‡å’Œé•¿åº¦éƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œè¯´æ˜å®Œæˆäº†è‡ªåŠ¨æ‰©å®¹</li><li>åˆ é™¤å…ƒç´ ä¹‹åæˆ‘ä»¬çš„é•¿åº¦å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯å®¹é‡è¿˜æ˜¯åŸæœ¬ä¸å˜</li></ul><h4 id="å¸¸è§å‘"><a href="#å¸¸è§å‘" class="headerlink" title="å¸¸è§å‘"></a>å¸¸è§å‘</h4><pre><code class="hljs go"><span class="hljs-comment">// å¤åˆ¶ä¸€ä¸ª slice</span>s2 := s1[:<span class="hljs-number">2</span>]fmt.Printf(<span class="hljs-string">"s2(%p): %v, len: %d, cap: %d\n"</span>, &amp;s2, s2, <span class="hljs-built_in">len</span>(s2), <span class="hljs-built_in">cap</span>(s2))<span class="hljs-comment">// s2(0xc00000c120): [1 3], len: 2, cap: 4</span>s1[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span> <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å‘ç°ï¼Œs1[0] s2[0] éƒ½è¢«ä¿®æ”¹ä¸ºäº† 10</span>fmt.Printf(<span class="hljs-string">"s1(%p): %v, len: %d, cap: %d\n"</span>, &amp;s1, s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<span class="hljs-comment">// s1(0xc00000c080): [10 3], len: 2, cap: 4</span>fmt.Printf(<span class="hljs-string">"s2(%p): %v, len: %d, cap: %d\n"</span>, &amp;s2, s2, <span class="hljs-built_in">len</span>(s2), <span class="hljs-built_in">cap</span>(s2))<span class="hljs-comment">// s2(0xc00000c120): [10 3], len: 2, cap: 4</span>s1 = <span class="hljs-built_in">append</span>(s1, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>)s1[<span class="hljs-number">0</span>] = <span class="hljs-number">11</span> <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å‘ç°ï¼Œs1[0] è¢«ä¿®æ”¹ä¸ºäº† 11, s2[0] è¿˜æ˜¯10</span>fmt.Printf(<span class="hljs-string">"s1(%p): %v, len: %d, cap: %d\n"</span>, &amp;s1, s1, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1))<span class="hljs-comment">// s1(0xc00011c020): [11 3 5 6 7 8], len: 6, cap: 8</span>fmt.Printf(<span class="hljs-string">"s2(%p): %v, len: %d, cap: %d\n"</span>, &amp;s2, s2, <span class="hljs-built_in">len</span>(s2), <span class="hljs-built_in">cap</span>(s2))<span class="hljs-comment">// s2(0xc00011c0c0): [10 3], len: 2, cap: 4</span></code></pre><ul><li>è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä» s1 å¤åˆ¶äº†ä¸€ä¸ª s2</li><li>ä¿®æ”¹ s1 çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œs2 çš„ä¸€ä¸ªå…ƒç´ ä¹Ÿè¢«ä¿®æ”¹äº†</li><li>ä½†æ˜¯æˆ‘ä»¬è§¦å‘äº† s1 çš„è‡ªåŠ¨æ‰©å®¹ä¹‹åï¼Œs2 çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±ä¸ä¼šéšç€ s1 çš„ä¿®æ”¹è€Œå˜åŒ–äº†</li><li>è¿™ä¹Ÿæ˜¯å½“å‡½æ•°çš„å‚æ•°æ˜¯ slice æ—¶æˆ‘ä»¬ä¸å…è®¸ç›´æ¥ä¿®æ”¹ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹éœ€è¦è¿”å›è¿™ä¸ª slice çš„åŸå› ï¼Œå› ä¸ºå‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯å€¼çš„å¤åˆ¶</li></ul><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sliceChange</span><span class="hljs-params">(s []<span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-comment">// ä¸å…è®¸ç›´æ¥è¿™ä¹ˆæ“ä½œ</span>s[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>&#125;</code></pre><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>å¤§å®¶å¦‚æœä½¿ç”¨è¿‡ä¸€æ®µæ—¶é—´ golang åº”è¯¥çŸ¥é“ slice çš„åº•å±‚ç»“æ„å…¶å®æ˜¯ä¸€ä¸ª struct<br><a href="https://github.com/golang/go/blob/go1.15/src/runtime/slice.go" target="_blank" rel="noopener">https://github.com/golang/go/blob/go1.15/src/runtime/slice.go</a></p><pre><code class="hljs go"><span class="hljs-keyword">type</span> slice <span class="hljs-keyword">struct</span> &#123;array unsafe.Pointer<span class="hljs-built_in">len</span>   <span class="hljs-keyword">int</span><span class="hljs-built_in">cap</span>   <span class="hljs-keyword">int</span>&#125;</code></pre><p><img src="https://lailin.xyz/images/1605449197795-9ca02de7-b129-4f7c-a0c3-930798b881c0.svg" srcset="/img/loading.gif" alt="02_slice_struct.drawio.svg"></p><ul><li>å¦‚å›¾æ‰€ç¤ºæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œslice çš„åº•å±‚ç»“æ„æ˜¯ä¸€ä¸ªç»“æ„ä½“<ul><li>å®ƒåŒ…å«äº†ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œæ•°æ®å®é™…ä¸Šå­˜å‚¨åœ¨è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„ä¸Š</li><li>len è¡¨ç¤ºå½“å‰ slice ä½¿ç”¨åˆ°çš„é•¿åº¦</li><li>cap è¡¨ç¤ºå½“å‰ slice çš„å®¹é‡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯åº•å±‚æ•°ç»„ array çš„é•¿åº¦</li></ul></li><li>è¿™ä¹Ÿå°±å›ç­”äº†æˆ‘ä»¬ä¸Šé¢çš„å‘ç°çš„ç°è±¡ï¼Œåœ¨å¤åˆ¶ slice çš„æ—¶å€™ï¼Œslice ä¸­æ•°ç»„çš„æŒ‡é’ˆä¹Ÿè¢«å¤åˆ¶äº†ï¼Œåœ¨å‡ºå‘æ‰©å®¹é€»è¾‘ä¹‹å‰ï¼Œä¸¤ä¸ª slice æŒ‡å‘çš„æ˜¯ç›¸åŒçš„æ•°ç»„ï¼Œå‡ºå‘æ‰©å®¹é€»è¾‘ä¹‹åæŒ‡å‘çš„å°±æ˜¯ä¸åŒçš„æ•°ç»„äº†</li><li>åŒæ—¶å› ä¸ºç»“æ„ä½“ä¸­ array æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ‰€ä»¥åœ¨ slice ä½œä¸ºå‚æ•°ä¼ é€’çš„æ—¶å€™ï¼Œè¿™ä¸ªæŒ‡é’ˆä¹Ÿä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥ä¹Ÿä¼šæœ‰ç›¸åŒçš„é—®é¢˜</li></ul><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><pre><code class="hljs go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª slice</span><span class="hljs-comment">// et: æ•°æ®çš„ç±»å‹</span><span class="hljs-comment">// len: slice é•¿åº¦</span><span class="hljs-comment">// cap: slice å®¹é‡</span><span class="hljs-comment">// è¿”å›ä¸€ä¸ªæŒ‡é’ˆ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeslice</span><span class="hljs-params">(et *_type, <span class="hljs-built_in">len</span>, <span class="hljs-built_in">cap</span> <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">unsafe</span>.<span class="hljs-title">Pointer</span></span> &#123;    <span class="hljs-comment">// é€šè¿‡ cap è®¡ç®—å½“å‰ç±»å‹çš„ slice éœ€è¦çš„å†…å­˜å®¹é‡ä»¥åŠæ˜¯å¦è¶…å‡ºæœ€å¤§å®¹é‡</span>mem, overflow := math.MulUintptr(et.size, <span class="hljs-keyword">uintptr</span>(<span class="hljs-built_in">cap</span>))    <span class="hljs-comment">// å¼‚å¸¸æƒ…å†µåˆ¤æ–­</span><span class="hljs-keyword">if</span> overflow || mem &gt; maxAlloc || <span class="hljs-built_in">len</span> &lt; <span class="hljs-number">0</span> || <span class="hljs-built_in">len</span> &gt; <span class="hljs-built_in">cap</span> &#123;<span class="hljs-comment">// é€šè¿‡ len è®¡ç®—å½“å‰ç±»å‹çš„ slice éœ€è¦çš„å†…å­˜å®¹é‡ä»¥åŠæ˜¯å¦è¶…å‡ºæœ€å¤§å®¹é‡</span>        <span class="hljs-comment">// å¦‚æœæ˜¯ len è¶…è¿‡é™åˆ¶åˆ™æŠ›å‡º len çš„ç›¸å…³å¼‚å¸¸ï¼Œå¦åˆ™æŠ›å‡º cap å¼‚å¸¸</span>mem, overflow := math.MulUintptr(et.size, <span class="hljs-keyword">uintptr</span>(<span class="hljs-built_in">len</span>))<span class="hljs-keyword">if</span> overflow || mem &gt; maxAlloc || <span class="hljs-built_in">len</span> &lt; <span class="hljs-number">0</span> &#123;panicmakeslicelen()&#125;panicmakeslicecap()&#125;<span class="hljs-keyword">return</span> mallocgc(mem, et, <span class="hljs-literal">true</span>)&#125;</code></pre><p>è¿˜æœ‰ä¸€ä¸ª 64 ä½çš„</p><ul><li>64 ä½å¯¹æ¯”é»˜è®¤çš„åªæ˜¯è¿›è¡Œäº†ä¸€ä¸‹æ•°æ®æ ¼å¼è½¬æ¢ï¼Œä½†æ˜¯è¿™ä¸ªè½¬æ¢çš„å¯¹æ¯”è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„</li><li>å¦‚æœæ˜¯åœ¨ 64 ä½çš„æœºå™¨ä¸Šï¼Œé‚£ä¹ˆ int == int64 çš„</li><li>å¦‚æœæ˜¯åœ¨ 32 ä½çš„æœºå™¨ä¸Šï¼Œé‚£ä¹ˆ int == int32ï¼Œå¦‚æœ int64(int(len64)) != len64ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªé•¿åº¦è¶…å‡ºäº†å½“å‰æœºå™¨çš„å†…å­˜ä½æ•°ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸é”™è¯¯å°±å¥½äº†</li></ul><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeslice64</span><span class="hljs-params">(et *_type, len64, cap64 <span class="hljs-keyword">int64</span>)</span> <span class="hljs-title">unsafe</span>.<span class="hljs-title">Pointer</span></span> &#123;<span class="hljs-built_in">len</span> := <span class="hljs-keyword">int</span>(len64)<span class="hljs-keyword">if</span> <span class="hljs-keyword">int64</span>(<span class="hljs-built_in">len</span>) != len64 &#123;panicmakeslicelen()&#125;<span class="hljs-built_in">cap</span> := <span class="hljs-keyword">int</span>(cap64)<span class="hljs-keyword">if</span> <span class="hljs-keyword">int64</span>(<span class="hljs-built_in">cap</span>) != cap64 &#123;panicmakeslicecap()&#125;<span class="hljs-keyword">return</span> makeslice(et, <span class="hljs-built_in">len</span>, <span class="hljs-built_in">cap</span>)&#125;</code></pre><h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><pre><code class="hljs go"><span class="hljs-comment">// å½“ append éœ€è¦æ‰©å®¹çš„æ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><span class="hljs-comment">// et æ˜¯å½“å‰ slice çš„ç±»å‹</span><span class="hljs-comment">// old æ˜¯åŸæœ‰çš„ slice</span><span class="hljs-comment">// cap æ˜¯æ»¡è¶³æ‰©å®¹æ‰€éœ€çš„æœ€å°å®¹é‡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">growslice</span><span class="hljs-params">(et *_type, old slice, <span class="hljs-built_in">cap</span> <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">slice</span></span> &#123;<span class="hljs-comment">// ... ä¸€äº›æ ¡éªŒé€»è¾‘ï¼Œç•¥è¿‡</span>    <span class="hljs-comment">// ä¸‹é¢è¿™ä¸ªå°±æ˜¯æ‰©å®¹ç®—æ³•</span>newcap := old.<span class="hljs-built_in">cap</span>doublecap := newcap + newcap<span class="hljs-keyword">if</span> <span class="hljs-built_in">cap</span> &gt; doublecap &#123;newcap = <span class="hljs-built_in">cap</span>&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">if</span> old.<span class="hljs-built_in">len</span> &lt; <span class="hljs-number">1024</span> &#123;newcap = doublecap&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// Check 0 &lt; newcap to detect overflow</span><span class="hljs-comment">// and prevent an infinite loop.</span><span class="hljs-keyword">for</span> <span class="hljs-number">0</span> &lt; newcap &amp;&amp; newcap &lt; <span class="hljs-built_in">cap</span> &#123;newcap += newcap / <span class="hljs-number">4</span>&#125;<span class="hljs-comment">// Set newcap to the requested cap when</span><span class="hljs-comment">// the newcap calculation overflowed.</span><span class="hljs-keyword">if</span> newcap &lt;= <span class="hljs-number">0</span> &#123;newcap = <span class="hljs-built_in">cap</span>&#125;&#125;&#125;    <span class="hljs-comment">// ä¸‹é¢å»è®¡ç®—æ–°çš„æ•°ç»„æ‰€éœ€è¦çš„å†…å­˜</span>    <span class="hljs-comment">// é€šè¿‡ old.len, cap, ä»¥åŠ newcap è®¡ç®—</span><span class="hljs-keyword">var</span> overflow <span class="hljs-keyword">bool</span><span class="hljs-keyword">var</span> lenmem, newlenmem, capmem <span class="hljs-keyword">uintptr</span><span class="hljs-comment">// Specialize for common values of et.size.</span><span class="hljs-comment">// For 1 we don't need any division/multiplication.</span><span class="hljs-comment">// For sys.PtrSize, compiler will optimize division/multiplication into a shift by a constant.</span><span class="hljs-comment">// For powers of 2, use a variable shift.</span><span class="hljs-keyword">switch</span> &#123;<span class="hljs-keyword">case</span> et.size == <span class="hljs-number">1</span>:lenmem = <span class="hljs-keyword">uintptr</span>(old.<span class="hljs-built_in">len</span>)newlenmem = <span class="hljs-keyword">uintptr</span>(<span class="hljs-built_in">cap</span>)capmem = roundupsize(<span class="hljs-keyword">uintptr</span>(newcap))overflow = <span class="hljs-keyword">uintptr</span>(newcap) &gt; maxAllocnewcap = <span class="hljs-keyword">int</span>(capmem)<span class="hljs-comment">// ... æœ‰å¥½å‡ ä¸ªåˆ†æ”¯ï¼Œçœ‹ä¸€ä¸ªç±»ä¼¼çš„å°±å¯ä»¥äº†</span>&#125;<span class="hljs-comment">// æ£€æŸ¥æ˜¯ä¸æ˜¯è¶…è¿‡å†…å­˜é™åˆ¶</span><span class="hljs-keyword">if</span> overflow || capmem &gt; maxAlloc &#123;<span class="hljs-built_in">panic</span>(errorString(<span class="hljs-string">"growslice: cap out of range"</span>))&#125;    <span class="hljs-comment">// åˆ†é…å†…å­˜</span><span class="hljs-keyword">var</span> p unsafe.Pointer<span class="hljs-keyword">if</span> et.ptrdata == <span class="hljs-number">0</span> &#123;p = mallocgc(capmem, <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>)<span class="hljs-comment">// The append() that calls growslice is going to overwrite from old.len to cap (which will be the new length).</span><span class="hljs-comment">// Only clear the part that will not be overwritten.</span>memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// Note: can't use rawmem (which avoids zeroing of memory), because then GC can scan uninitialized memory.</span>p = mallocgc(capmem, et, <span class="hljs-literal">true</span>)<span class="hljs-keyword">if</span> lenmem &gt; <span class="hljs-number">0</span> &amp;&amp; writeBarrier.enabled &#123;<span class="hljs-comment">// Only shade the pointers in old.array since we know the destination slice p</span><span class="hljs-comment">// only contains nil pointers because it has been cleared during alloc.</span>bulkBarrierPreWriteSrcOnly(<span class="hljs-keyword">uintptr</span>(p), <span class="hljs-keyword">uintptr</span>(old.array), lenmem-et.size+et.ptrdata)&#125;&#125;    <span class="hljs-comment">// å°†åŸæœ¬çš„æ•°ç»„å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸Š</span>memmove(p, old.array, lenmem)<span class="hljs-keyword">return</span> slice&#123;p, old.<span class="hljs-built_in">len</span>, newcap&#125;&#125;</code></pre><p>æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹æ‰©å®¹çš„ç®—æ³•ï¼Œå¯ä»¥å‘ç°æœ‰ä¸‰ç§é€»è¾‘</p><ul><li>å¦‚æœéœ€è¦çš„æœ€å°å®¹é‡æ¯”ä¸¤å€åŸæœ‰å®¹é‡å¤§ï¼Œé‚£ä¹ˆå°±å–éœ€è¦çš„å®¹é‡</li><li>å¦‚æœåŸæœ‰ slice é•¿åº¦å°äº 1024 é‚£ä¹ˆæ¯æ¬¡å°±æ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€</li><li>å¦‚æœåŸ slice å¤§äºç­‰äº 1024 é‚£ä¹ˆæ¯æ¬¡æ‰©å®¹å°±æ‰©ä¸ºåŸæ¥çš„ 1.25 å€</li></ul><pre><code class="hljs go">newcap := old.<span class="hljs-built_in">cap</span>doublecap := newcap + newcap<span class="hljs-keyword">if</span> <span class="hljs-built_in">cap</span> &gt; doublecap &#123;    newcap = <span class="hljs-built_in">cap</span>&#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-keyword">if</span> old.<span class="hljs-built_in">len</span> &lt; <span class="hljs-number">1024</span> &#123;        newcap = doublecap    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-comment">// Check 0 &lt; newcap to detect overflow</span>        <span class="hljs-comment">// and prevent an infinite loop.</span>        <span class="hljs-keyword">for</span> <span class="hljs-number">0</span> &lt; newcap &amp;&amp; newcap &lt; <span class="hljs-built_in">cap</span> &#123;            newcap += newcap / <span class="hljs-number">4</span>        &#125;        <span class="hljs-comment">// Set newcap to the requested cap when</span>        <span class="hljs-comment">// the newcap calculation overflowed.</span>        <span class="hljs-keyword">if</span> newcap &lt;= <span class="hljs-number">0</span> &#123;            newcap = <span class="hljs-built_in">cap</span>        &#125;    &#125;&#125;</code></pre><h3 id="ç©º-Slice"><a href="#ç©º-Slice" class="headerlink" title="ç©º Slice"></a>ç©º Slice</h3><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ Slice åˆå§‹åŒ–çš„æ–¹å¼</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> s1 []<span class="hljs-keyword">int</span>s2 := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">uint</span>, <span class="hljs-number">0</span>)s3 := []<span class="hljs-keyword">int</span>&#123;&#125;<span class="hljs-comment">// fmt.Printf("%p: %v, len: %d, cap: %d\n", s1, s1, len(s1), cap(s1))</span><span class="hljs-comment">// 0x0: [], len: 0, cap: 0</span><span class="hljs-comment">// 0x587450: [], len: 0, cap: 0</span><span class="hljs-comment">// 0x587450: [], len: 0, cap: 0</span></code></pre><ul><li>tips: <code>%p</code> æ‰“å° slice ä¼šæ‰“å° slice åº•å±‚æŒ‡å‘çš„æ•°ç»„çš„åœ°å€</li><li>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç¬¬ä¸€ç§æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ï¼Œå‡ºç°çš„ä¹Ÿå°±æ˜¯ slice çš„é›¶å€¼ï¼Œåº•å±‚çš„æ•°ç»„æŒ‡é’ˆæ˜¯ä¸€ä¸ª nil</li><li>ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§çš„åº•å±‚æŒ‡é’ˆéƒ½æœ‰ä¸€ä¸ªå€¼ï¼Œä¸è¿‡æ²¡æœ‰å®é™…åˆ†é…å†…å­˜</li><li>è¿™ä¸‰ç§æ–¹å¼åˆå§‹åŒ–å‡ºæ¥çš„ capã€å’Œ len çš„é•¿åº¦éƒ½æ˜¯ 0</li></ul><h3 id="è§„èŒƒæŠ€å·§"><a href="#è§„èŒƒæŠ€å·§" class="headerlink" title="è§„èŒƒæŠ€å·§"></a>è§„èŒƒæŠ€å·§</h3><ol><li>slice ä½œä¸ºå‚æ•°æ—¶ï¼Œä¸è¦ç›´æ¥å­˜å‚¨å®ƒçš„å¼•ç”¨ï¼Œè€Œæ˜¯é€šè¿‡ <code>copy</code> å¤åˆ¶ä¸€ä»½<ol><li>åŸå› è¯·æŸ¥çœ‹ä¸Šæ–‡ï¼ŒSlice çš„ç»“æ„</li><li>ç¤ºä¾‹ï¼š<a href="https://github.com/xxjwxc/uber_go_guide_cn#nil-%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9C%89%E6%95%88%E7%9A%84-slice" target="_blank" rel="noopener">Uber Go è§„èŒƒ: nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice</a></li></ol></li><li>è¦æ£€æŸ¥åˆ‡ç‰‡æ˜¯å¦ä¸ºç©ºï¼Œè¯·å§‹ç»ˆä½¿ç”¨ <code>len(s) == 0</code> ã€‚è€Œé <code>nil</code> ã€‚<ol><li>åŸå› è¯·æŸ¥çœ‹ä¸Šæ–‡ï¼ŒSlice åˆå§‹åŒ–</li><li>ç¤ºä¾‹ï¼š<a href="https://github.com/xxjwxc/uber_go_guide_cn#%E5%9C%A8%E8%BE%B9%E7%95%8C%E5%A4%84%E6%8B%B7%E8%B4%9D-Slices-%E5%92%8C-Maps" target="_blank" rel="noopener">Uber Go è§„èŒƒ: åœ¨è¾¹ç•Œå¤„æ‹·è´-Slices-å’Œ-Maps</a></li></ol></li></ol><h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h2><ul><li>åœ¨è®²è§£ slice åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä»€ä¹ˆ <code>s2</code> , <code>s3</code> æ‰“å°çš„æ•°ç»„æŒ‡é’ˆéƒ½æ˜¯ <code>0x587450</code> ?</li><li>è¯·æŸ¥çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼Œä¼šè¾“å‡ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ<ul><li>A: 5 8 B: 8 8 C: 5 5 D: 5 6</li></ul></li></ul><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;s := []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;s = <span class="hljs-built_in">append</span>(s, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)fmt.Println(<span class="hljs-built_in">len</span>(s), <span class="hljs-built_in">cap</span>(s))&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ•°æ®ç»“æ„ä¸ç®—æ³•01-é“¾è¡¨: æ·±å…¥ç†è§£container/list&amp;LRUç¼“å­˜çš„å®ç°</title>
    <link href="/post/list.html"/>
    <url>/post/list.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go æ•°æ®ç»“æ„ä¸ç®—æ³•ç³»åˆ—æ–‡ç« ï¼Œæœ¬ç³»åˆ—æ–‡ç« ä¸»è¦ä¼šåŒ…æ‹¬å¸¸è§çš„æ•°æ®ç»“æ„ä¸ç®—æ³•å®ç°ï¼ŒåŒæ—¶ä¼šåŒ…æ‹¬ Go æ ‡å‡†åº“ä»£ç çš„åˆ†æç†è§£ï¼Œè®²åˆ°å¯¹åº”ç« èŠ‚çš„æ—¶å€™ä¼˜å…ˆå­¦ä¹ åˆ†æ Go çš„æºç å®ç°ï¼Œä¾‹å¦‚ sliceã€listã€sort ç­‰ï¼Œç„¶åå¯èƒ½ä¼šæœ‰ä¸€äº›å¸¸è§çš„æ¡ˆä¾‹å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/126" target="_blank" rel="noopener">æå®¢æ—¶é—´-æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a> çš„è¯¾ç¨‹ç¬”è®°</li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“:</strong> <a href="https://github.com/mohuishou/go-algorithm" target="_blank" rel="noopener">https://github.com/mohuishou/go-algorithm</a> ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œé¢„è®¡åˆ° 202101 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°:</strong> <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">Github</a>ã€<a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener">çŸ¥ä¹</a>ã€<a href="https://lailin.xyz/atom.xml">RSS</a>ã€<a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a></li><li>ä¸Šä¸€ä¸ªç³»åˆ—åˆšåˆšå®Œæˆäº† <a href="https://lailin.xyz/post/go-design-pattern.html">Go è®¾è®¡æ¨¡å¼</a>ï¼Œå¦‚æœæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥è¿›è¡ŒæŸ¥çœ‹</li></ul><h2 id="ä»€ä¹ˆæ˜¯é“¾è¡¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é“¾è¡¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é“¾è¡¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é“¾è¡¨ï¼Ÿ</h2><h3 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h3><ul><li>é“¾è¡¨é€šè¿‡æŒ‡é’ˆå°†é›¶æ•£çš„å†…å­˜æ•°æ®è”ç³»åœ¨ä¸€èµ·</li><li>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…å«ä¸¤ä¸ªç»“æ„ï¼Œä¸€ä¸ªæ˜¯æ•°æ® dataï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å†…å­˜åœ°å€</li><li>æœ€åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ NULL</li></ul><p><img src="https://lailin.xyz/images/1604804227362-0a6030ac-cf14-4052-8a4b-87eec4e1a904.jpeg" srcset="/img/loading.gif" alt="01_é“¾è¡¨-å•é“¾è¡¨.jpg"></p><h3 id="å¾ªç¯é“¾è¡¨"><a href="#å¾ªç¯é“¾è¡¨" class="headerlink" title="å¾ªç¯é“¾è¡¨"></a>å¾ªç¯é“¾è¡¨</h3><ul><li>å’Œå•é“¾è¡¨çš„åŒºåˆ«å°±æ˜¯ï¼Œå°†å°¾èŠ‚ç‚¹æŒ‡å‘çš„å¤´ç»“ç‚¹ï¼Œå°†æ•´ä¸ªé“¾è¡¨ç»„æˆäº†ä¸€ä¸ªç¯çŠ¶</li></ul><p><img src="https://lailin.xyz/images/1604804281440-be68f311-161b-42bf-b8ac-f48f917b8732.png" srcset="/img/loading.gif" alt="01_é“¾è¡¨-å¾ªç¯é“¾è¡¨.png"></p><h3 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h3><ul><li>å’Œåœ¨å•é“¾è¡¨çš„åŸºç¡€ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè¿™æ ·æˆ‘ä»¬çŸ¥é“ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å°±å¯ä»¥åŒæ—¶çŸ¥é“ä»–ä»¬çš„ä¸Šä¸‹ä¸¤ä¸ªèŠ‚ç‚¹</li><li>è¿™æ˜¯å®é™…ä½¿ç”¨çš„æ—¶å€™æœ€å¸¸ç”¨çš„</li></ul><p><img src="https://lailin.xyz/images/1604804268492-79fe5525-be57-4eb8-bee7-0900e041af66.jpeg" srcset="/img/loading.gif" alt="01_é“¾è¡¨-åŒå‘é“¾è¡¨.jpg"></p><h3 id="å’Œæ•°ç»„å¯¹æ¯”"><a href="#å’Œæ•°ç»„å¯¹æ¯”" class="headerlink" title="å’Œæ•°ç»„å¯¹æ¯”"></a>å’Œæ•°ç»„å¯¹æ¯”</h3><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"><strong>é“¾è¡¨</strong></th><th style="text-align:center"><strong>æ•°ç»„</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>æŸ¥æ‰¾æŸä¸ªå…ƒç´ </strong></td><td style="text-align:center">O(n)</td><td style="text-align:center">O(1)</td></tr><tr><td style="text-align:center"><strong>åˆ é™¤æˆ–è€…æ·»åŠ ä¸€ä¸ªå…ƒç´ </strong></td><td style="text-align:center">O(1)</td><td style="text-align:center">O(n)</td></tr></tbody></table><h2 id="æ ‡å‡†åº“-Container-list-çš„å®ç°"><a href="#æ ‡å‡†åº“-Container-list-çš„å®ç°" class="headerlink" title="æ ‡å‡†åº“ Container/list çš„å®ç°"></a>æ ‡å‡†åº“ Container/list çš„å®ç°</h2><h3 id="ç»“æ„ä½“å®šä¹‰"><a href="#ç»“æ„ä½“å®šä¹‰" class="headerlink" title="ç»“æ„ä½“å®šä¹‰"></a>ç»“æ„ä½“å®šä¹‰</h3><pre><code class="hljs go"><span class="hljs-comment">// Element ç”¨äºè¡¨ç¤ºé“¾è¡¨å½“ä¸­çš„èŠ‚ç‚¹</span><span class="hljs-keyword">type</span> Element <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// next, prev åˆ†åˆ«è¡¨ç¤ºä¸Šä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸ªèŠ‚ç‚¹</span>next, prev *Element<span class="hljs-comment">// è¡¨ç¤ºèŠ‚ç‚¹æ‰€åœ¨çš„å…ƒç´ </span>list *List<span class="hljs-comment">// èŠ‚ç‚¹æ‰€ä¿å­˜çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å›¾ä¸­çš„ data</span>Value <span class="hljs-keyword">interface</span>&#123;&#125;&#125;<span class="hljs-comment">// List è¿™æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨</span><span class="hljs-comment">// List çš„é›¶å€¼æ˜¯ä¸€ä¸ªç©ºé“¾è¡¨</span><span class="hljs-keyword">type</span> List <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// æ ¹èŠ‚ç‚¹ï¼ŒList å…¶å®æ˜¯ä¸€ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ï¼Œrootï¼Œ root.prev æ˜¯å°¾èŠ‚ç‚¹, å°¾èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ root</span>    <span class="hljs-comment">// æ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œæ˜¯ä¸ºäº†ç”¨æ¥ç®€åŒ–èŠ‚ç‚¹æ“ä½œä½¿ç”¨çš„</span>root Element    <span class="hljs-comment">// é“¾è¡¨çš„é•¿åº¦ï¼Œä¸åŒ…æ‹¬å“¨å…µèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ ¹èŠ‚ç‚¹</span><span class="hljs-built_in">len</span>  <span class="hljs-keyword">int</span>&#125;</code></pre><p>çœ‹åˆ°è¿™é‡Œæˆ‘ä¸‹æ„è¯†çš„ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>ä¸ºä»€ä¹ˆåœ¨ <code>Element</code> å½“ä¸­ä¼šæŒæœ‰ä¸€ä¸ª <code>List</code> ç»“æ„ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ <code>List</code> ç»“æ„ä½“ï¼Œç›´æ¥è¦ä¸€ä¸ª <code>Root</code> èŠ‚ç‚¹ä¸å°±å®Œäº‹äº†ä¹ˆï¼Ÿ</li></ul><h3 id="æ–¹æ³•é›†"><a href="#æ–¹æ³•é›†" class="headerlink" title="æ–¹æ³•é›†"></a>æ–¹æ³•é›†</h3><pre><code class="hljs go">Remove(e *Element) <span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-comment">// åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</span>PushFront(v <span class="hljs-keyword">interface</span>&#123;&#125;) *Element <span class="hljs-comment">// å°†å€¼æ’å…¥åˆ°é“¾è¡¨å¤´éƒ¨</span>PushBack(v <span class="hljs-keyword">interface</span>&#123;&#125;) *Element <span class="hljs-comment">// å°†å€¼æ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨</span>InsertBefore(v <span class="hljs-keyword">interface</span>&#123;&#125;, mark *Element) *Element <span class="hljs-comment">// åœ¨ mark èŠ‚ç‚¹ä¹‹å‰æ’å…¥å€¼</span>InsertAfter(v <span class="hljs-keyword">interface</span>&#123;&#125;, mark *Element) *Element <span class="hljs-comment">// åœ¨ mark èŠ‚ç‚¹ä¹‹åæ’å…¥å€¼</span>MoveToFront(e *Element) <span class="hljs-comment">// å°†èŠ‚ç‚¹ e ç§»åŠ¨è‡³é“¾è¡¨å¤´éƒ¨</span>MoveToBack(e *Element) <span class="hljs-comment">// å°†èŠ‚ç‚¹ e ç§»åŠ¨è‡³é“¾è¡¨å°¾éƒ¨</span>MoveBefore(e, mark *Element) <span class="hljs-comment">// å°†èŠ‚ç‚¹ e ç§»åŠ¨åˆ° mark èŠ‚ç‚¹ä¹‹å‰</span>MoveAfter(e, mark *Element) <span class="hljs-comment">// å°†èŠ‚ç‚¹ e ç§»åŠ¨åˆ° mark èŠ‚ç‚¹ä¹‹å</span>PushBackList(other *List) <span class="hljs-comment">// å°†é“¾è¡¨ other è¿æ¥åˆ°å½“å‰é“¾è¡¨ä¹‹å</span>PushFrontList(other *List) <span class="hljs-comment">// å°†é“¾è¡¨ other è¿æ¥åˆ°å½“å‰é“¾è¡¨ä¹‹å‰</span></code></pre><p>çœ‹äº†æš´éœ²çš„æ–¹æ³•é›†ä¹‹åæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™é‡Œé¢æ ¸å¿ƒçš„å‡ ä¸ªæ–¹æ³•ï¼Œä¸Šè¯‰æš´éœ²çš„æ–¹æ³•å®è´¨ä¸Šéƒ½æ˜¯é€šè¿‡è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•å®ç°çš„</p><h4 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h4><pre><code class="hljs go"><span class="hljs-comment">// å°†èŠ‚ç‚¹ e æ’å…¥ at ä¹‹å</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *List)</span> <span class="hljs-title">insert</span><span class="hljs-params">(e, at *Element)</span> *<span class="hljs-title">Element</span></span> &#123;    <span class="hljs-comment">// å‡è®¾ at.next ä¸º nt</span>    <span class="hljs-comment">// 1. å°†èŠ‚ç‚¹ e çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ at</span>e.prev = at    <span class="hljs-comment">// 2. å°†èŠ‚ç‚¹ e çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ nt</span>e.next = at.next    <span class="hljs-comment">// 3. è¿™ä¸ªæ—¶å€™  e.prev.next == at.next</span>    <span class="hljs-comment">// å…¶å®å°±æ˜¯æœ¬æ¥ at --&gt; ntï¼Œä¿®æ”¹ä¸º at --&gt; e</span>e.prev.next = e    <span class="hljs-comment">// 4. e.next.prev == nt.prev</span>    <span class="hljs-comment">// æœ¬æ¥ at &lt;--- ntï¼Œä¿®æ”¹ä¸º e &lt;--- nt</span>e.next.prev = ee.list = ll.<span class="hljs-built_in">len</span>++<span class="hljs-keyword">return</span> e&#125;</code></pre><h4 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h4><pre><code class="hljs go"><span class="hljs-comment">// remove removes e from its list, decrements l.len, and returns e.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *List)</span> <span class="hljs-title">remove</span><span class="hljs-params">(e *Element)</span> *<span class="hljs-title">Element</span></span> &#123;e.prev.next = e.nexte.next.prev = e.prev    <span class="hljs-comment">// è¿™é‡Œä¸ºäº†é¿å…å†…å­˜æ³„æ¼çš„æ“ä½œå¯ä»¥å­¦ä¹ </span>e.next = <span class="hljs-literal">nil</span> <span class="hljs-comment">// avoid memory leaks</span>e.prev = <span class="hljs-literal">nil</span> <span class="hljs-comment">// avoid memory leaks</span>e.list = <span class="hljs-literal">nil</span>l.<span class="hljs-built_in">len</span>--<span class="hljs-keyword">return</span> e&#125;</code></pre><h4 id="move"><a href="#move" class="headerlink" title="move"></a>move</h4><pre><code class="hljs go"><span class="hljs-comment">// move moves e to next to at and returns e.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *List)</span> <span class="hljs-title">move</span><span class="hljs-params">(e, at *Element)</span> *<span class="hljs-title">Element</span></span> &#123;<span class="hljs-keyword">if</span> e == at &#123;<span class="hljs-keyword">return</span> e&#125;    <span class="hljs-comment">// å…ˆæŠŠå½“å‰èŠ‚ç‚¹ä»åŸæ¥çš„ä½ç½®ç§»é™¤</span>e.prev.next = e.nexte.next.prev = e.prev    <span class="hljs-comment">// å†å°†å½“å‰èŠ‚ç‚¹ e æ’å…¥åˆ° at èŠ‚ç‚¹ä¹‹å</span>e.prev = ate.next = at.nexte.prev.next = ee.next.prev = e<span class="hljs-keyword">return</span> e&#125;</code></pre><h3 id="ä¸¤ä¸ªé—®é¢˜"><a href="#ä¸¤ä¸ªé—®é¢˜" class="headerlink" title="ä¸¤ä¸ªé—®é¢˜"></a>ä¸¤ä¸ªé—®é¢˜</h3><p>æˆ‘ä»¬åœ¨çœ‹ä¸€ä¸‹æœ€å¼€å§‹çš„ä¸¤ä¸ªé—®é¢˜<br><strong>1. ä¸ºä»€ä¹ˆåœ¨ <code>Element</code> å½“ä¸­ä¼šæŒæœ‰ä¸€ä¸ª <code>List</code> ç»“æ„ï¼Ÿ</strong></p><ul><li>æŸ¥çœ‹ä¸Šæ–¹çš„ move æ–¹æ³•æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œlist æä¾›äº†è®²èŠ‚ç‚¹ç§»åŠ¨åˆ°æŸä¸ªèŠ‚ç‚¹ä¹‹åçš„æ–¹æ³•ï¼Œé€šè¿‡ e.List è¿›è¡Œå¯¹æ¯”æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯å±äºå½“å‰è¿™ä¸ªé“¾è¡¨äº†ï¼Œè¿™ä¹Ÿæ˜¯ <code>MoveToFront</code> ç­‰æ–¹æ³•çš„å®ç°æ–¹å¼</li></ul><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *List)</span> <span class="hljs-title">MoveToFront</span><span class="hljs-params">(e *Element)</span></span> &#123;<span class="hljs-keyword">if</span> e.list != l || l.root.next == e &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// see comment in List.Remove about initialization of l</span>l.move(e, &amp;l.root)&#125;</code></pre><p><strong>2. ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ <code>List</code> ç»“æ„ä½“ï¼Œç›´æ¥è¦ä¸€ä¸ª <code>Root</code> èŠ‚ç‚¹ä¸å°±å®Œäº‹äº†ä¹ˆï¼Ÿ</strong></p><ul><li>çœ‹ä¹‹å‰çš„ <code>List</code> çš„ç»“æ„æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨ç»“æ„ä½“ä¸­åŒ…å«äº†ä¸€ä¸ª <code>len</code> ï¼Œè¿™æ ·å¯ä»¥é¿å…éœ€è¦å–é•¿åº¦çš„æ—¶å€™æ¯æ¬¡éƒ½éœ€è¦ä»å¤´åˆ°å°¾éå†ä¸€é</li></ul><h2 id="å¦‚ä½•å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„-Container-listï¼Ÿ"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„-Container-listï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„ Container/listï¼Ÿ"></a>å¦‚ä½•å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„ Container/listï¼Ÿ</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>go test -race .</code> æµ‹è¯•æ˜¯å¦å­˜åœ¨å¹¶å‘å®‰å…¨çš„é—®é¢˜</p><h3 id="æ ‡å‡†åº“åŒ…"><a href="#æ ‡å‡†åº“åŒ…" class="headerlink" title="æ ‡å‡†åº“åŒ…"></a>æ ‡å‡†åº“åŒ…</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestList</span><span class="hljs-params">(t *testing.T)</span></span> &#123;l := list.New()wg := sync.WaitGroup&#123;&#125;wg.Add(<span class="hljs-number">1</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;l.PushBack(i)&#125;wg.Done()&#125;()l.PushBack(<span class="hljs-number">11</span>)wg.Wait()&#125;</code></pre><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°å­˜åœ¨å¹¶å‘é—®é¢˜</p><pre><code class="hljs go"> <span class="hljs-keyword">go</span> test  -v -timeout <span class="hljs-number">1</span>s -race -run ^TestList$ ./...=== RUN   TestList==================WARNING: DATA RACERead at <span class="hljs-number">0x00c00006e330</span> by goroutine <span class="hljs-number">8</span>:  container/list.(*List).lazyInit()      /usr/local/<span class="hljs-keyword">go</span>/src/container/list/list.<span class="hljs-keyword">go</span>:<span class="hljs-number">86</span> +<span class="hljs-number">0xb2</span></code></pre><h3 id="ç¨ä½œæ”¹é€ "><a href="#ç¨ä½œæ”¹é€ " class="headerlink" title="ç¨ä½œæ”¹é€ "></a>ç¨ä½œæ”¹é€ </h3><pre><code class="hljs go"><span class="hljs-comment">// List é“¾è¡¨</span><span class="hljs-keyword">type</span> List <span class="hljs-keyword">struct</span> &#123;*list.Listmu sync.Mutex&#125;<span class="hljs-comment">// New æ–°å»ºé“¾è¡¨</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span> *<span class="hljs-title">List</span></span> &#123;<span class="hljs-keyword">return</span> &amp;List&#123;List: list.New()&#125;&#125;<span class="hljs-comment">// PushBack åƒé“¾è¡¨å°¾éƒ¨æ’å…¥å€¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *List)</span> <span class="hljs-title">PushBack</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;    <span class="hljs-comment">// åŠ é”</span>l.mu.Lock()<span class="hljs-keyword">defer</span> l.mu.Unlock()l.List.PushBack(v)&#125;</code></pre><p>é—®é¢˜è§£å†³</p><pre><code class="hljs go"><span class="hljs-keyword">go</span> test  -v -timeout <span class="hljs-number">1</span>s -race -run ^TestList_PushBack$ ./...=== RUN   TestList_PushBack--- PASS: TestList_PushBack (<span class="hljs-number">0.00</span>s)PASSok      github.com/mohuishou/<span class="hljs-keyword">go</span>-algorithm/<span class="hljs-number">01</span>_list/list  (cached)</code></pre><h2 id="å¦‚ä½•å®ç°ä¸€ä¸ª-LRU-ç¼“å­˜ï¼Ÿ"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ª-LRU-ç¼“å­˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ª LRU ç¼“å­˜ï¼Ÿ"></a>å¦‚ä½•å®ç°ä¸€ä¸ª LRU ç¼“å­˜ï¼Ÿ</h2><p>LRU: Least Recently Used æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥</p><blockquote><p>è¿™é‡Œä¸ºäº†è®­ç»ƒä¸€ä¸‹ä»£ç ï¼Œå°±æ²¡æœ‰ç›´æ¥ä½¿ç”¨æ ‡å‡†åº“çš„åŒ…äº†</p></blockquote><pre><code class="hljs go"><span class="hljs-keyword">package</span> lru<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span>)<span class="hljs-comment">// Node é“¾è¡¨çš„èŠ‚ç‚¹</span><span class="hljs-keyword">type</span> Node <span class="hljs-keyword">struct</span> &#123;prev, next *Nodelist *LRUkey   <span class="hljs-keyword">string</span>value <span class="hljs-keyword">interface</span>&#123;&#125;&#125;<span class="hljs-comment">// LRU ç¼“å­˜</span><span class="hljs-keyword">type</span> LRU <span class="hljs-keyword">struct</span> &#123;root *Node <span class="hljs-comment">// æ ¹èŠ‚ç‚¹</span><span class="hljs-built_in">cap</span>  <span class="hljs-keyword">int</span>   <span class="hljs-comment">// å½“å‰ç¼“å­˜å®¹é‡</span><span class="hljs-built_in">len</span>  <span class="hljs-keyword">int</span>   <span class="hljs-comment">// ç¼“å­˜çš„é•¿åº¦</span>&#125;<span class="hljs-comment">// NewLRU NewLRU</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewLRU</span><span class="hljs-params">(<span class="hljs-built_in">cap</span> <span class="hljs-keyword">int</span>)</span> *<span class="hljs-title">LRU</span></span> &#123;l := &amp;LRU&#123;root: &amp;Node&#123;&#125;,<span class="hljs-built_in">cap</span>:  <span class="hljs-built_in">cap</span>,&#125;l.root.prev = l.rootl.root.next = l.rootl.root.list = l<span class="hljs-keyword">return</span> l&#125;<span class="hljs-comment">// Get è·å–ç¼“å­˜æ•°æ®</span><span class="hljs-comment">// å¦‚æœè·å–åˆ°æ•°æ®ï¼Œå°±æŠŠè¿™ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨</span><span class="hljs-comment">// å¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œå°±è¿”å›nil</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *LRU)</span> <span class="hljs-title">Get</span><span class="hljs-params">(key <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;<span class="hljs-keyword">defer</span> l.debug()n := l.get(key)<span class="hljs-keyword">if</span> n == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-keyword">return</span> n.value&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *LRU)</span> <span class="hljs-title">get</span><span class="hljs-params">(key <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">Node</span></span> &#123;<span class="hljs-keyword">for</span> n := l.root.next; n != l.root; n = n.next &#123;<span class="hljs-keyword">if</span> n.key == key &#123;n.prev.next = n.nextn.next.prev = n.prevn.next = l.root.nextl.root.next.prev = nl.root.next = nn.prev = l.root<span class="hljs-keyword">return</span> n&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// Put å†™å…¥ç¼“å­˜æ•°æ®</span><span class="hljs-comment">// å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆæ›´æ–°å€¼</span><span class="hljs-comment">// å¦‚æœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ’å…¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span><span class="hljs-comment">// å½“ç¼“å­˜å®¹é‡æ»¡äº†çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ é™¤æœ€åçš„æ•°æ®</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *LRU)</span> <span class="hljs-title">Put</span><span class="hljs-params">(key <span class="hljs-keyword">string</span>, value <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<span class="hljs-keyword">defer</span> l.debug()n := l.get(key)<span class="hljs-keyword">if</span> n != <span class="hljs-literal">nil</span> &#123;n.value = value<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// ç¼“å­˜æ»¡äº†</span><span class="hljs-keyword">if</span> l.<span class="hljs-built_in">len</span> == l.<span class="hljs-built_in">cap</span> &#123;last := l.root.prevlast.prev.next = l.rootl.root.prev = last.prevlast.list = <span class="hljs-literal">nil</span>last.prev = <span class="hljs-literal">nil</span>last.next = <span class="hljs-literal">nil</span>l.<span class="hljs-built_in">len</span>--&#125;node := &amp;Node&#123;key: key, value: value&#125;head := l.root.nexthead.prev = nodenode.next = headnode.prev = l.rootl.root.next = nodel.<span class="hljs-built_in">len</span>++node.list = l&#125;<span class="hljs-comment">// debug for debug</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *LRU)</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span></span> &#123;fmt.Println(<span class="hljs-string">"lru len: "</span>, l.<span class="hljs-built_in">len</span>)fmt.Println(<span class="hljs-string">"lru cap: "</span>, l.<span class="hljs-built_in">cap</span>)<span class="hljs-keyword">for</span> n := l.root.next; n != l.root; n = n.next &#123;fmt.Printf(<span class="hljs-string">"%s:%v -&gt; "</span>, n.key, n.value)&#125;fmt.Println()fmt.Println()&#125;</code></pre><p>å•å…ƒæµ‹è¯•</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> lru<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestNewLRU</span><span class="hljs-params">(t *testing.T)</span></span> &#123;l := NewLRU(<span class="hljs-number">3</span>)assert.Equal(t, l.Get(<span class="hljs-string">""</span>), <span class="hljs-literal">nil</span>)l.Put(<span class="hljs-string">"1"</span>, <span class="hljs-number">1</span>)l.Put(<span class="hljs-string">"2"</span>, <span class="hljs-number">2</span>)l.Put(<span class="hljs-string">"3"</span>, <span class="hljs-number">3</span>)assert.Equal(t, <span class="hljs-number">3</span>, l.Get(<span class="hljs-string">"3"</span>))assert.Equal(t, <span class="hljs-number">1</span>, l.Get(<span class="hljs-string">"1"</span>))l.Put(<span class="hljs-string">"4"</span>, <span class="hljs-number">4</span>)assert.Equal(t, <span class="hljs-literal">nil</span>, l.Get(<span class="hljs-string">"2"</span>))l.Put(<span class="hljs-string">"3"</span>, <span class="hljs-number">31</span>)assert.Equal(t, <span class="hljs-number">31</span>, l.Get(<span class="hljs-string">"3"</span>))&#125;</code></pre><h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h2><ul><li>å‰é¢è®²åˆ°çš„ é€šè¿‡ Element èŠ‚ç‚¹ä¸­çš„ List ç»“æ„æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å±äºå½“å‰é“¾è¡¨çš„æ–¹å¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå‡ºç° <code>bug</code> ä½ å‘ç°äº†ä¹ˆï¼Ÿ</li><li>LRU ç¼“å­˜å¯ä»¥å‚è€ƒ leetcode è¿›è¡Œæµ‹è¯•ï¼Œ<a href="https://leetcode-cn.com/problems/lru-cache/" target="_blank" rel="noopener">146. LRU ç¼“å­˜æœºåˆ¶</a>ï¼Œæ–‡ä¸­çš„ LRU ç¼“å­˜å®ç°æœ‰è®¸å¤šå€¼å¾—ä¼˜åŒ–çš„åœ°æ–¹ï¼Œä½ è®¤ä¸ºæœ‰å“ªäº›å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Ÿ</li><li>é—®é¢˜å¯ä»¥å›å¤åœ¨è¯„è®ºåŒºï¼Œå°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è§£ç­”</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>Go</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼24-æ€»ç»“(æ›´æ–°å®Œæ¯•)</title>
    <link href="/post/go-design-pattern.html"/>
    <url>/post/go-design-pattern.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/intro/100039001" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ä¹‹ç¾</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 24/24 </strong>è¿™æ˜¯è¯¥ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« å•¦ï¼Œåç»­çœ‹æƒ…å†µå¯èƒ½ä¼šä¸å®šæœŸè¡¥å……ä¸€äº›å®æˆ˜çš„å†…å®¹ï¼Œä½†æ˜¯æ­£æ–‡å°±è¿™ä¹ˆå¤šäº†</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åŸæœ¬é¢„è®¡æ˜¯åœ¨åæœˆåº•æ›´æ–°å®Œæ¯•è¿™ä¸ªç³»åˆ—ï¼Œåˆ°ä»Šå¤©æ˜¯ 11-05ï¼Œæ™šäº†å‡ å¤©ï¼Œä¸è¿‡ä¹Ÿè¿˜å¥½ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡è¿™ä¹ˆå¯†é›†çš„å»æ›´æ–°åšå®¢ä¸Šçš„å†…å®¹ï¼Œæ›´å¤šçš„æ˜¯ä»¥ç¬”è®°çš„å½¢å¼æ¥å‘ˆç°ï¼ŒåŠ ä¸Šè¿™ç¯‡ä¸€å…± 24 ç¯‡æ–‡ç« å·®ä¸å¤šä¸¤ä¸ªåŠæœˆçš„æ—¶é—´ï¼Œå¹³å‡æ¯å‘¨è¾“å‡ºä¸¤ç¯‡ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸é”™ã€‚åç»­å¯èƒ½ä¼šè§†æƒ…å†µä¸å®šæœŸçš„æ›´æ–°ä¸€äº›å®æˆ˜å†…å®¹ï¼Œä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰ã€‚æ¥ä¸‹æ¥ä¸‹ä¸€ä¸ªç³»åˆ—åº”è¯¥æ˜¯æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼ŒåŒ…å«å¯¹ Go ä¸­ä¸€äº›åº•å±‚æ•°æ®å’Œæ ‡å‡†åº“åŒ…çš„å­¦ä¹ ï¼Œä¾‹å¦‚ slice, sort ç­‰ç­‰ã€‚</p><p>è¯è¯´å›æ¥ï¼Œå›å¤´å†çœ‹å­¦ä¹ è®¾è®¡æ¨¡å¼æˆ‘ä»¬ç©¶ç«Ÿéœ€è¦å­¦ä¹ ä¸€äº›ä»€ä¹ˆï¼Ÿ</p><ul><li>å†™ Go éœ€è¦ä½¿ç”¨åˆ°è®¾è®¡æ¨¡å¼ä¹ˆï¼Ÿ<ul><li>éœ€è¦ï¼Œä½†æ˜¯åˆ‡è®°è¯·å‹¿ä½¿ç”¨å…¶ä»–è¯­è¨€çš„æ–¹å¼æ¥å†™ Go</li><li>å¦‚æœçœ‹è¿‡ä¹‹å‰çš„ä¸€äº›æ–‡ç« ï¼Œå°±ä¼šå‘ç°ç±»ä¼¼ JAVA çš„è¿™äº›é¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„æŸäº›è®¾è®¡æ¨¡å¼çš„å†™æ³•åœ¨ Go ä¸­ä¼šååˆ†çš„åˆ«æ‰­</li><li>ä½†æ˜¯ Go ä¸éœ€è¦è®¾è®¡æ¨¡å¼ä¹ˆï¼Ÿä¸æ˜¯çš„ï¼Œè®¾è®¡æ¨¡å¼çš„æ€æƒ³æ˜¯æƒ³é€šçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸€ç›´éƒ½åœ¨ä½¿ç”¨ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸¸è§çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ <code>NewXXX</code> è¿™å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•å·¥å‚</li></ul></li><li>è®¾è®¡æ¨¡å¼å­¦ä¹ çš„é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>è®¾è®¡åŸåˆ™ï¼Œä»¥åŠè®¾è®¡æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯å’Œä¼˜ç¼ºç‚¹ï¼Œå®ç°ç›¸å¯¹æ¥è¯´è¿˜æ²¡æœ‰é‚£ä¹ˆé‡è¦</li><li>å¦‚æœæ˜¯å¸¸è§çš„è®¾è®¡æ¨¡å¼æ˜¯æ­¦æœ¯æ‹›å¼ï¼Œé‚£ä¹ˆè®¾è®¡åŸåˆ™å°±æ˜¯å†…åŠŸå¿ƒæ³•ï¼Œæ²¡æœ‰å†…åŠŸå¿ƒæ³•é‚£ä¹ˆæ‹›å¼å¥—è·¯ä¹Ÿå°±æ˜¯èŠ±æ¶å­</li><li>ç†Ÿç»ƒæŒæ¡ä¸åŒè®¾è®¡æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å­¦ä¼šè§æ‹›æ‹†æ‹›ï¼Œçµæ´»åº”ç”¨è€Œä¸æ˜¯åªä¼šå¥—è·¯</li></ul></li><li><strong>æœ€åè®¾è®¡æ¨¡å¼ä¸æ˜¯é“¶å¼¹ï¼Œä¸è¦æ‹¿ç€ ğŸ”¨ å°±è§‰å¾—å“ªé‡Œéƒ½åƒæ˜¯é’‰å­ï¼Œä¸è¦è¿‡æ—©ä¼˜åŒ–ï¼ŒæŒç»­é‡æ„æ‰æ˜¯æ­£é“</strong></li></ul><h3 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h3><blockquote><p>åŒæ—¶è¿™ä¹Ÿæ˜¯ Code Review çš„é‡è¦æ ‡å‡†ä¹‹ä¸€</p></blockquote><p><img src="https://lailin.xyz/images/1604555465270-6b839dae-3cc4-43e8-bcad-b46ee314f0f7.png" srcset="/img/loading.gif" alt></p><h3 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h3><p><img src="https://lailin.xyz/images/1604555469082-5a1887e1-5640-4895-a018-8541ba78139e.png" srcset="/img/loading.gif" alt></p><h2 id="Go-è®¾è®¡æ¨¡å¼"><a href="#Go-è®¾è®¡æ¨¡å¼" class="headerlink" title="Go è®¾è®¡æ¨¡å¼"></a>Go è®¾è®¡æ¨¡å¼</h2><ul><li>å•ä¾‹æ¨¡å¼åŒ…å«é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼ä¸¤ç§å®ç°</li><li>å·¥å‚æ¨¡å¼åŒ…å«ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€DI å®¹å™¨</li><li>ä»£ç†æ¨¡å¼åŒ…å«é™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†ï¼ˆé‡‡ç”¨ go generate æ¨¡æ‹Ÿï¼‰</li><li>è§‚å¯Ÿè€…æ¨¡å¼åŒ…å«è§‚å¯Ÿè€…æ¨¡å¼ã€eventbus</li></ul><table><thead><tr><th style="text-align:center"><strong>ç±»å‹</strong></th><th style="text-align:center"><strong>è®¾è®¡æ¨¡å¼ï¼ˆGithubï¼‰</strong></th><th style="text-align:center"><strong>å¸¸ç”¨</strong></th><th style="text-align:center"><strong>åšå®¢</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>åˆ›å»ºå‹</strong></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/01_singleton" target="_blank" rel="noopener">å•ä¾‹æ¨¡å¼(Singleton Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/singleton.html">Go è®¾è®¡æ¨¡å¼ 01-å•ä¾‹æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/02_factory" target="_blank" rel="noopener">å·¥å‚æ¨¡å¼(Factory Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/factory.html">Go è®¾è®¡æ¨¡å¼ 02-å·¥å‚æ¨¡å¼&amp;DI å®¹å™¨</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/03_builder" target="_blank" rel="noopener">å»ºé€ è€…æ¨¡å¼(Builder Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/builder.html">Go è®¾è®¡æ¨¡å¼ 03-å»ºé€ è€…æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/04_prototype" target="_blank" rel="noopener">åŸå‹æ¨¡å¼(Prototype Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/prototype.html">Go è®¾è®¡æ¨¡å¼ 04-åŸå‹æ¨¡å¼</a></td></tr><tr><td style="text-align:center"><strong>ç»“æ„å‹</strong></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/05_proxy" target="_blank" rel="noopener">ä»£ç†æ¨¡å¼(Proxy Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/proxy.html">Go è®¾è®¡æ¨¡å¼ 06-ä»£ç†æ¨¡å¼(generate å®ç°ç±»ä¼¼åŠ¨æ€ä»£ç†)</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/06_bridge" target="_blank" rel="noopener">æ¡¥æ¥æ¨¡å¼(Bridge Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/bridge.html">Go è®¾è®¡æ¨¡å¼ 07-æ¡¥æ¥æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/07_decorator" target="_blank" rel="noopener">è£…é¥°å™¨æ¨¡å¼(Decorator Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/decorator.html">Go è®¾è®¡æ¨¡å¼ 08-è£…é¥°å™¨æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/08_adapter" target="_blank" rel="noopener">é€‚é…å™¨æ¨¡å¼(Adapter Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/adapter.html">Go è®¾è®¡æ¨¡å¼ 09-é€‚é…å™¨æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/09_facade" target="_blank" rel="noopener">é—¨é¢æ¨¡å¼(Facade Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/facade.html">Go è®¾è®¡æ¨¡å¼ 10-é—¨é¢æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/10_composite" target="_blank" rel="noopener">ç»„åˆæ¨¡å¼(Composite Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/composite.html">Go è®¾è®¡æ¨¡å¼ 11-ç»„åˆæ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/11_flyweight" target="_blank" rel="noopener">äº«å…ƒæ¨¡å¼(Flyweight Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/flyweight.html">Go è®¾è®¡æ¨¡å¼ 12-äº«å…ƒæ¨¡å¼</a></td></tr><tr><td style="text-align:center"><strong>è¡Œä¸ºå‹</strong></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/12_observer" target="_blank" rel="noopener">è§‚å¯Ÿè€…æ¨¡å¼(Observer Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/observer.html">Go è®¾è®¡æ¨¡å¼ 13-è§‚å¯Ÿè€…æ¨¡å¼(å®ç°ç®€å•çš„ EventBus)</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/13_template" target="_blank" rel="noopener">æ¨¡æ¿æ¨¡å¼(Template Method Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/template.html">Go æ¨¡æ¿æ¨¡å¼ 14-æ¨¡æ¿æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/14_strategy" target="_blank" rel="noopener">ç­–ç•¥æ¨¡å¼(Strategy Method Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/strategy.html">Go è®¾è®¡æ¨¡å¼ 15-ç­–ç•¥æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/15_chain" target="_blank" rel="noopener">èŒè´£é“¾æ¨¡å¼(Chain Of Responsibility Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/chain.html">Go è®¾è®¡æ¨¡å¼ 16-èŒè´£é“¾æ¨¡å¼(Gin çš„ä¸­é—´ä»¶å®ç°)</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/16_state" target="_blank" rel="noopener">çŠ¶æ€æ¨¡å¼(State Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/state.html">Go è®¾è®¡æ¨¡å¼ 17-çŠ¶æ€æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/17_iterator" target="_blank" rel="noopener">è¿­ä»£å™¨æ¨¡å¼(Iterator Design Pattern)</a></td><td style="text-align:center">âœ…</td><td style="text-align:center"><a href="https://lailin.xyz/post/iterator.html">Go è®¾è®¡æ¨¡å¼ 18-è¿­ä»£å™¨æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/18_visitor/visitor.go" target="_blank" rel="noopener">è®¿é—®è€…æ¨¡å¼(Visitor Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/visitor.html">Go è®¾è®¡æ¨¡å¼ 19-è®¿é—®è€…æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/19_memento" target="_blank" rel="noopener">å¤‡å¿˜å½•æ¨¡å¼(Memento Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/memento.html">Go è®¾è®¡æ¨¡å¼ 20-å¤‡å¿˜å½•æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/20_command" target="_blank" rel="noopener">å‘½ä»¤æ¨¡å¼(Command Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/command.html">Go è®¾è®¡æ¨¡å¼ 21-å‘½ä»¤æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/21_interpreter" target="_blank" rel="noopener">è§£é‡Šå™¨æ¨¡å¼(Interpreter Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/interpreter.html">Go è®¾è®¡æ¨¡å¼ 22-è§£é‡Šå™¨æ¨¡å¼</a></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/mohuishou/go-design-pattern/blob/master/22_mediator" target="_blank" rel="noopener">ä¸­ä»‹æ¨¡å¼(Mediator Design Pattern)</a></td><td style="text-align:center">âŒ</td><td style="text-align:center"><a href="https://lailin.xyz/post/mediator.html">Go è®¾è®¡æ¨¡å¼ 23-ä¸­ä»‹æ¨¡å¼</a></td></tr></tbody></table><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼23-ä¸­ä»‹æ¨¡å¼</title>
    <link href="/post/mediator.html"/>
    <url>/post/mediator.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/226710" target="_blank" rel="noopener">73 | ä¸­ä»‹æ¨¡å¼ï¼šä»€ä¹ˆæ—¶å€™ç”¨ä¸­ä»‹æ¨¡å¼ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 23/24 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604554249755-27489403-56d3-4128-a650-e81c68b1e621.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-comment">// Package mediator ä¸­ä»‹æ¨¡å¼</span><span class="hljs-comment">// é‡‡ç”¨åŸè¯¾ç¨‹çš„ç¤ºä¾‹ï¼Œå¹¶ä¸”åšäº†ä¸€äº›è£å‰ª</span><span class="hljs-comment">// å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„å¯¹è¯æ¡†ï¼Œé‡Œé¢åŒ…æ‹¬ï¼Œç™»å½•ç»„ä»¶ï¼Œæ³¨å†Œç»„ä»¶ï¼Œä»¥åŠé€‰æ‹©æ¡†</span><span class="hljs-comment">// å½“é€‰æ‹©æ¡†é€‰æ‹©â€œç™»å½•â€æ—¶ï¼Œå±•ç¤ºç™»å½•ç›¸å…³ç»„ä»¶</span><span class="hljs-comment">// å½“é€‰æ‹©æ¡†é€‰æ‹©â€œæ³¨å†Œâ€æ—¶ï¼Œå±•ç¤ºæ³¨å†Œç›¸å…³ç»„ä»¶</span><span class="hljs-keyword">package</span> mediator<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"reflect"</span>)<span class="hljs-comment">// Input å‡è®¾è¿™è¡¨ç¤ºä¸€ä¸ªè¾“å…¥æ¡†</span><span class="hljs-keyword">type</span> Input <span class="hljs-keyword">string</span><span class="hljs-comment">// String String</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(i Input)</span> <span class="hljs-title">String</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(i)&#125;<span class="hljs-comment">// Selection å‡è®¾è¿™è¡¨ç¤ºä¸€ä¸ªé€‰æ‹©æ¡†</span><span class="hljs-keyword">type</span> Selection <span class="hljs-keyword">string</span><span class="hljs-comment">// Selected å½“å‰é€‰ä¸­çš„å¯¹è±¡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s Selection)</span> <span class="hljs-title">Selected</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(s)&#125;<span class="hljs-comment">// Button å‡è®¾è¿™è¡¨ç¤ºä¸€ä¸ªæŒ‰é’®</span><span class="hljs-keyword">type</span> Button <span class="hljs-keyword">struct</span> &#123;onClick <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#125;<span class="hljs-comment">// SetOnClick æ·»åŠ ç‚¹å‡»äº‹ä»¶å›è°ƒ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *Button)</span> <span class="hljs-title">SetOnClick</span><span class="hljs-params">(f <span class="hljs-keyword">func</span>()</span>)</span> &#123;b.onClick = f&#125;<span class="hljs-comment">// IMediator ä¸­ä»‹æ¨¡å¼æ¥å£</span><span class="hljs-keyword">type</span> IMediator <span class="hljs-keyword">interface</span> &#123;HandleEvent(component <span class="hljs-keyword">interface</span>&#123;&#125;)&#125;<span class="hljs-comment">// Dialog å¯¹è¯æ¡†ç»„ä»¶</span><span class="hljs-keyword">type</span> Dialog <span class="hljs-keyword">struct</span> &#123;LoginButton         *ButtonRegButton           *ButtonSelection           *SelectionUsernameInput       *InputPasswordInput       *InputRepeatPasswordInput *Input&#125;<span class="hljs-comment">// HandleEvent HandleEvent</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *Dialog)</span> <span class="hljs-title">HandleEvent</span><span class="hljs-params">(component <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<span class="hljs-keyword">switch</span> &#123;<span class="hljs-keyword">case</span> reflect.DeepEqual(component, d.Selection):<span class="hljs-keyword">if</span> d.Selection.Selected() == <span class="hljs-string">"ç™»å½•"</span> &#123;fmt.Println(<span class="hljs-string">"select login"</span>)fmt.Printf(<span class="hljs-string">"show: %s\n"</span>, d.UsernameInput)fmt.Printf(<span class="hljs-string">"show: %s\n"</span>, d.PasswordInput)&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> d.Selection.Selected() == <span class="hljs-string">"æ³¨å†Œ"</span> &#123;fmt.Println(<span class="hljs-string">"select register"</span>)fmt.Printf(<span class="hljs-string">"show: %s\n"</span>, d.UsernameInput)fmt.Printf(<span class="hljs-string">"show: %s\n"</span>, d.PasswordInput)fmt.Printf(<span class="hljs-string">"show: %s\n"</span>, d.RepeatPasswordInput)&#125;<span class="hljs-comment">// others, å¦‚æœç‚¹å‡»äº†ç™»å½•æŒ‰é’®ï¼Œæ³¨å†ŒæŒ‰é’®</span>&#125;&#125;</code></pre><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> mediator<span class="hljs-keyword">import</span> <span class="hljs-string">"testing"</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestDemo</span><span class="hljs-params">(t *testing.T)</span></span> &#123;usernameInput := Input(<span class="hljs-string">"username input"</span>)passwordInput := Input(<span class="hljs-string">"password input"</span>)repeatPwdInput := Input(<span class="hljs-string">"repeat password input"</span>)selection := Selection(<span class="hljs-string">"ç™»å½•"</span>)d := &amp;Dialog&#123;Selection:           &amp;selection,UsernameInput:       &amp;usernameInput,PasswordInput:       &amp;passwordInput,RepeatPasswordInput: &amp;repeatPwdInput,&#125;d.HandleEvent(&amp;selection)regSelection := Selection(<span class="hljs-string">"æ³¨å†Œ"</span>)d.Selection = &amp;regSelectiond.HandleEvent(&amp;regSelection)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼22-è§£é‡Šå™¨æ¨¡å¼</title>
    <link href="/post/interpreter.html"/>
    <url>/post/interpreter.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/225904" target="_blank" rel="noopener">72 | è§£é‡Šå™¨æ¨¡å¼ï¼šå¦‚ä½•è®¾è®¡å®ç°ä¸€ä¸ªè‡ªå®šä¹‰æ¥å£å‘Šè­¦è§„åˆ™åŠŸèƒ½ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 22/24 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604554127547-78b30375-2e57-459b-95a5-d8479bf79c1c.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-comment">// Package interpreter è§£é‡Šå™¨æ¨¡å¼</span><span class="hljs-comment">// é‡‡ç”¨åŸè¯¾ç¨‹çš„ç¤ºä¾‹, å¹¶ä¸”åšäº†ä¸€ä¸‹ç®€åŒ–</span><span class="hljs-comment">// å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªç›‘æ§ç³»ç»Ÿ</span><span class="hljs-comment">// ç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªå‘Šè­¦æ¨¡å—ï¼Œå¯ä»¥æ ¹æ®è¾“å…¥çš„å‘Šè­¦è§„åˆ™æ¥å†³å®šæ˜¯å¦è§¦å‘å‘Šè­¦</span><span class="hljs-comment">// å‘Šè­¦è§„åˆ™æ”¯æŒ &amp;&amp;ã€&gt;ã€&lt; 3ç§è¿ç®—ç¬¦</span><span class="hljs-comment">// å…¶ä¸­ &gt;ã€&lt; ä¼˜å…ˆçº§æ¯”  &amp;&amp; æ›´é«˜</span><span class="hljs-keyword">package</span> interpreter<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"regexp"</span><span class="hljs-string">"strconv"</span><span class="hljs-string">"strings"</span>)<span class="hljs-comment">// AlertRule å‘Šè­¦è§„åˆ™</span><span class="hljs-keyword">type</span> AlertRule <span class="hljs-keyword">struct</span> &#123;expression IExpression&#125;<span class="hljs-comment">// NewAlertRule NewAlertRule</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAlertRule</span><span class="hljs-params">(rule <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(*AlertRule, error)</span></span> &#123;exp, err := NewAndExpression(rule)<span class="hljs-keyword">return</span> &amp;AlertRule&#123;expression: exp&#125;, err&#125;<span class="hljs-comment">// Interpret åˆ¤æ–­å‘Šè­¦æ˜¯å¦è§¦å‘</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r AlertRule)</span> <span class="hljs-title">Interpret</span><span class="hljs-params">(stats <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">float64</span>)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">return</span> r.expression.Interpret(stats)&#125;<span class="hljs-comment">// IExpression è¡¨è¾¾å¼æ¥å£</span><span class="hljs-keyword">type</span> IExpression <span class="hljs-keyword">interface</span> &#123;Interpret(stats <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">float64</span>) <span class="hljs-keyword">bool</span>&#125;<span class="hljs-comment">// GreaterExpression &gt;</span><span class="hljs-keyword">type</span> GreaterExpression <span class="hljs-keyword">struct</span> &#123;key   <span class="hljs-keyword">string</span>value <span class="hljs-keyword">float64</span>&#125;<span class="hljs-comment">// Interpret Interpret</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g GreaterExpression)</span> <span class="hljs-title">Interpret</span><span class="hljs-params">(stats <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">float64</span>)</span> <span class="hljs-title">bool</span></span> &#123;v, ok := stats[g.key]<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;<span class="hljs-keyword">return</span> v &gt; g.value&#125;<span class="hljs-comment">// NewGreaterExpression NewGreaterExpression</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewGreaterExpression</span><span class="hljs-params">(exp <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(*GreaterExpression, error)</span></span> &#123;data := regexp.MustCompile(<span class="hljs-string">`\s+`</span>).Split(strings.TrimSpace(exp), <span class="hljs-number">-1</span>)<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) != <span class="hljs-number">3</span> || data[<span class="hljs-number">1</span>] != <span class="hljs-string">"&gt;"</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"exp is invalid: %s"</span>, exp)&#125;val, err := strconv.ParseFloat(data[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"exp is invalid: %s"</span>, exp)&#125;<span class="hljs-keyword">return</span> &amp;GreaterExpression&#123;key:   data[<span class="hljs-number">0</span>],value: val,&#125;, <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// LessExpression &lt;</span><span class="hljs-keyword">type</span> LessExpression <span class="hljs-keyword">struct</span> &#123;key   <span class="hljs-keyword">string</span>value <span class="hljs-keyword">float64</span>&#125;<span class="hljs-comment">// Interpret Interpret</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g LessExpression)</span> <span class="hljs-title">Interpret</span><span class="hljs-params">(stats <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">float64</span>)</span> <span class="hljs-title">bool</span></span> &#123;v, ok := stats[g.key]<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;<span class="hljs-keyword">return</span> v &lt; g.value&#125;<span class="hljs-comment">// NewLessExpression NewLessExpression</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewLessExpression</span><span class="hljs-params">(exp <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(*LessExpression, error)</span></span> &#123;data := regexp.MustCompile(<span class="hljs-string">`\s+`</span>).Split(strings.TrimSpace(exp), <span class="hljs-number">-1</span>)<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) != <span class="hljs-number">3</span> || data[<span class="hljs-number">1</span>] != <span class="hljs-string">"&lt;"</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"exp is invalid: %s"</span>, exp)&#125;val, err := strconv.ParseFloat(data[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"exp is invalid: %s"</span>, exp)&#125;<span class="hljs-keyword">return</span> &amp;LessExpression&#123;key:   data[<span class="hljs-number">0</span>],value: val,&#125;, <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// AndExpression &amp;&amp;</span><span class="hljs-keyword">type</span> AndExpression <span class="hljs-keyword">struct</span> &#123;expressions []IExpression&#125;<span class="hljs-comment">// Interpret Interpret</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e AndExpression)</span> <span class="hljs-title">Interpret</span><span class="hljs-params">(stats <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">float64</span>)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">for</span> _, expression := <span class="hljs-keyword">range</span> e.expressions &#123;<span class="hljs-keyword">if</span> !expression.Interpret(stats) &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;<span class="hljs-comment">// NewAndExpression NewAndExpression</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAndExpression</span><span class="hljs-params">(exp <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(*AndExpression, error)</span></span> &#123;exps := strings.Split(exp, <span class="hljs-string">"&amp;&amp;"</span>)expressions := <span class="hljs-built_in">make</span>([]IExpression, <span class="hljs-built_in">len</span>(exps))<span class="hljs-keyword">for</span> i, e := <span class="hljs-keyword">range</span> exps &#123;<span class="hljs-keyword">var</span> expression IExpression<span class="hljs-keyword">var</span> err error<span class="hljs-keyword">switch</span> &#123;<span class="hljs-keyword">case</span> strings.Contains(e, <span class="hljs-string">"&gt;"</span>):expression, err = NewGreaterExpression(e)<span class="hljs-keyword">case</span> strings.Contains(e, <span class="hljs-string">"&lt;"</span>):expression, err = NewLessExpression(e)<span class="hljs-keyword">default</span>:err = fmt.Errorf(<span class="hljs-string">"exp is invalid: %s"</span>, exp)&#125;<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err&#125;expressions[i] = expression&#125;<span class="hljs-keyword">return</span> &amp;AndExpression&#123;expressions: expressions&#125;, <span class="hljs-literal">nil</span>&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> interpreter<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span><span class="hljs-string">"github.com/stretchr/testify/require"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestAlertRule_Interpret</span><span class="hljs-params">(t *testing.T)</span></span> &#123;stats := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">float64</span>&#123;<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>,<span class="hljs-string">"b"</span>: <span class="hljs-number">2</span>,<span class="hljs-string">"c"</span>: <span class="hljs-number">3</span>,&#125;tests := []<span class="hljs-keyword">struct</span> &#123;name  <span class="hljs-keyword">string</span>stats <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">float64</span>rule  <span class="hljs-keyword">string</span>want  <span class="hljs-keyword">bool</span>&#125;&#123;&#123;name:  <span class="hljs-string">"case1"</span>,stats: stats,rule:  <span class="hljs-string">"a &gt; 1 &amp;&amp; b &gt; 10 &amp;&amp; c &lt; 5"</span>,want:  <span class="hljs-literal">false</span>,&#125;,&#123;name:  <span class="hljs-string">"case2"</span>,stats: stats,rule:  <span class="hljs-string">"a &lt; 2 &amp;&amp; b &gt; 10 &amp;&amp; c &lt; 5"</span>,want:  <span class="hljs-literal">false</span>,&#125;,&#123;name:  <span class="hljs-string">"case3"</span>,stats: stats,rule:  <span class="hljs-string">"a &lt; 5 &amp;&amp; b &gt; 1 &amp;&amp; c &lt; 10"</span>,want:  <span class="hljs-literal">false</span>,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;r, err := NewAlertRule(tt.rule)require.NoError(t, err)assert.Equal(t, tt.want, r.Interpret(tt.stats))&#125;)&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼21-å‘½ä»¤æ¨¡å¼</title>
    <link href="/post/command.html"/>
    <url>/post/command.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/224549" target="_blank" rel="noopener">71 | å‘½ä»¤æ¨¡å¼ï¼šå¦‚ä½•åˆ©ç”¨å‘½ä»¤æ¨¡å¼å®ç°ä¸€ä¸ªæ‰‹æ¸¸åç«¯æ¶æ„ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 21/24 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604554065252-7fd51202-1ce7-48eb-8631-4061751f9b94.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>æ¥ä¸‹æ¥ä¼šæœ‰ä¸¤ä¸ªä¾‹å­ï¼Œç¬¬ä¸€ä¸ªæ˜¯æŒ‰ç…§åŸæ–‡å®šä¹‰çš„æ–¹å¼ï¼Œå°†å‡½æ•°å°è£…æˆå¯¹è±¡ï¼Œç¬¬äºŒä¸ªä¾‹å­æˆ‘ä»¬ç›´æ¥å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</p><h3 id="å°†å‡½æ•°å°è£…ä¸ºå¯¹è±¡"><a href="#å°†å‡½æ•°å°è£…ä¸ºå¯¹è±¡" class="headerlink" title="å°†å‡½æ•°å°è£…ä¸ºå¯¹è±¡"></a>å°†å‡½æ•°å°è£…ä¸ºå¯¹è±¡</h3><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><pre><code class="hljs go"><span class="hljs-comment">// Package command å‘½ä»¤æ¨¡å¼</span><span class="hljs-comment">// Blog: https://lailin.xyz/post/command.html</span><span class="hljs-comment">// è¿™æ˜¯ç¤ºä¾‹ä¸€ï¼Œé‡‡ç”¨å°†å‡½æ•°å°è£…ä¸ºå¯¹è±¡çš„æ–¹å¼å®ç°ï¼Œ</span><span class="hljs-comment">// ç¤ºä¾‹è¯´æ˜:</span><span class="hljs-comment">// å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ¸¸æˆæœåŠ¡ï¼Œæˆ‘ä»¬æ­£åœ¨å®ç°ä¸€ä¸ªæ¸¸æˆåç«¯</span><span class="hljs-comment">// ä½¿ç”¨ä¸€ä¸ª goroutine ä¸æ–­æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯è¯·æ±‚çš„å‘½ä»¤ï¼Œå¹¶ä¸”å°†å®ƒæ”¾ç½®åˆ°ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­</span><span class="hljs-comment">// ç„¶åæˆ‘ä»¬åœ¨å¦å¤–ä¸€ä¸ª goroutine ä¸­æ¥æ‰§è¡Œå®ƒ</span><span class="hljs-keyword">package</span> command<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-comment">// ICommand å‘½ä»¤</span><span class="hljs-keyword">type</span> ICommand <span class="hljs-keyword">interface</span> &#123;Execute() error&#125;<span class="hljs-comment">// StartCommand æ¸¸æˆå¼€å§‹è¿è¡Œ</span><span class="hljs-keyword">type</span> StartCommand <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// NewStartCommand NewStartCommand</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewStartCommand</span><span class="hljs-params">( /*æ­£å¸¸æƒ…å†µä¸‹è¿™é‡Œä¼šæœ‰ä¸€äº›å‚æ•°*/ )</span> *<span class="hljs-title">StartCommand</span></span> &#123;<span class="hljs-keyword">return</span> &amp;StartCommand&#123;&#125;&#125;<span class="hljs-comment">// Execute Execute</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *StartCommand)</span> <span class="hljs-title">Execute</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">"game start"</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// ArchiveCommand æ¸¸æˆå­˜æ¡£</span><span class="hljs-keyword">type</span> ArchiveCommand <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// NewArchiveCommand NewArchiveCommand</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewArchiveCommand</span><span class="hljs-params">( /*æ­£å¸¸æƒ…å†µä¸‹è¿™é‡Œä¼šæœ‰ä¸€äº›å‚æ•°*/ )</span> *<span class="hljs-title">ArchiveCommand</span></span> &#123;<span class="hljs-keyword">return</span> &amp;ArchiveCommand&#123;&#125;&#125;<span class="hljs-comment">// Execute Execute</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *ArchiveCommand)</span> <span class="hljs-title">Execute</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">"game archive"</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> command<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"testing"</span><span class="hljs-string">"time"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestDemo</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-comment">// ç”¨äºæµ‹è¯•ï¼Œæ¨¡æ‹Ÿæ¥è‡ªå®¢æˆ·ç«¯çš„äº‹ä»¶</span>eventChan := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;events := []<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">"start"</span>, <span class="hljs-string">"archive"</span>, <span class="hljs-string">"start"</span>, <span class="hljs-string">"archive"</span>, <span class="hljs-string">"start"</span>, <span class="hljs-string">"start"</span>&#125;<span class="hljs-keyword">for</span> _, e := <span class="hljs-keyword">range</span> events &#123;eventChan &lt;- e&#125;&#125;()<span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(eventChan)<span class="hljs-comment">// ä½¿ç”¨å‘½ä»¤é˜Ÿåˆ—ç¼“å­˜å‘½ä»¤</span>commands := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> ICommand, <span class="hljs-number">1000</span>)<span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(commands)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// ä»è¯·æ±‚æˆ–è€…å…¶ä»–åœ°æ–¹è·å–ç›¸å…³äº‹ä»¶å‚æ•°</span>event, ok := &lt;-eventChan<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">var</span> command ICommand<span class="hljs-keyword">switch</span> event &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">"start"</span>:command = NewStartCommand()<span class="hljs-keyword">case</span> <span class="hljs-string">"archive"</span>:command = NewArchiveCommand()&#125;<span class="hljs-comment">// å°†å‘½ä»¤å…¥é˜Ÿ</span>commands &lt;- command&#125;&#125;()<span class="hljs-keyword">for</span> &#123;<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> c := &lt;-commands:c.Execute()<span class="hljs-keyword">case</span> &lt;-time.After(<span class="hljs-number">1</span> * time.Second):fmt.Println(<span class="hljs-string">"timeout 1s"</span>)<span class="hljs-keyword">return</span>&#125;&#125;&#125;</code></pre><h3 id="å°†å‡½æ•°ç›´æ¥ä½œä¸ºå‚æ•°"><a href="#å°†å‡½æ•°ç›´æ¥ä½œä¸ºå‚æ•°" class="headerlink" title="å°†å‡½æ•°ç›´æ¥ä½œä¸ºå‚æ•°"></a>å°†å‡½æ•°ç›´æ¥ä½œä¸ºå‚æ•°</h3><h4 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h4><pre><code class="hljs go"><span class="hljs-comment">// Package command å‘½ä»¤æ¨¡å¼</span><span class="hljs-comment">// Blog: https://lailin.xyz/post/command.html</span><span class="hljs-comment">// è¿™æ˜¯ç¤ºä¾‹äºŒï¼Œé‡‡ç”¨å°†ç›´æ¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œä¸ç”¨å¯¹è±¡</span><span class="hljs-comment">// ç¤ºä¾‹è¯´æ˜:</span><span class="hljs-comment">// å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ¸¸æˆæœåŠ¡ï¼Œæˆ‘ä»¬æ­£åœ¨å®ç°ä¸€ä¸ªæ¸¸æˆåç«¯</span><span class="hljs-comment">// ä½¿ç”¨ä¸€ä¸ª goroutine ä¸æ–­æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯è¯·æ±‚çš„å‘½ä»¤ï¼Œå¹¶ä¸”å°†å®ƒæ”¾ç½®åˆ°ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­</span><span class="hljs-comment">// ç„¶åæˆ‘ä»¬åœ¨å¦å¤–ä¸€ä¸ª goroutine ä¸­æ¥æ‰§è¡Œå®ƒ</span><span class="hljs-keyword">package</span> command<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-comment">// Command å‘½ä»¤</span><span class="hljs-keyword">type</span> Command <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span><span class="hljs-comment">// StartCommandFunc è¿”å›ä¸€ä¸ª Command å‘½ä»¤</span><span class="hljs-comment">// æ˜¯å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šæ˜¯è¿™ä¹ˆç®€å•çš„å‡½æ•°</span><span class="hljs-comment">// ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€äº›å‚æ•°</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StartCommandFunc</span><span class="hljs-params">()</span> <span class="hljs-title">Command</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">"game start"</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;&#125;<span class="hljs-comment">// ArchiveCommandFunc ArchiveCommandFunc</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ArchiveCommandFunc</span><span class="hljs-params">()</span> <span class="hljs-title">Command</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">"game archive"</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;&#125;</code></pre><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> command<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"testing"</span><span class="hljs-string">"time"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestDemoFunc</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-comment">// ç”¨äºæµ‹è¯•ï¼Œæ¨¡æ‹Ÿæ¥è‡ªå®¢æˆ·ç«¯çš„äº‹ä»¶</span>eventChan := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;events := []<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">"start"</span>, <span class="hljs-string">"archive"</span>, <span class="hljs-string">"start"</span>, <span class="hljs-string">"archive"</span>, <span class="hljs-string">"start"</span>, <span class="hljs-string">"start"</span>&#125;<span class="hljs-keyword">for</span> _, e := <span class="hljs-keyword">range</span> events &#123;eventChan &lt;- e&#125;&#125;()<span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(eventChan)<span class="hljs-comment">// ä½¿ç”¨å‘½ä»¤é˜Ÿåˆ—ç¼“å­˜å‘½ä»¤</span>commands := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Command, <span class="hljs-number">1000</span>)<span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(commands)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> &#123;<span class="hljs-comment">// ä»è¯·æ±‚æˆ–è€…å…¶ä»–åœ°æ–¹è·å–ç›¸å…³äº‹ä»¶å‚æ•°</span>event, ok := &lt;-eventChan<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">var</span> command Command<span class="hljs-keyword">switch</span> event &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">"start"</span>:command = StartCommandFunc()<span class="hljs-keyword">case</span> <span class="hljs-string">"archive"</span>:command = ArchiveCommandFunc()&#125;<span class="hljs-comment">// å°†å‘½ä»¤å…¥é˜Ÿ</span>commands &lt;- command&#125;&#125;()<span class="hljs-keyword">for</span> &#123;<span class="hljs-keyword">select</span> &#123;<span class="hljs-keyword">case</span> c := &lt;-commands:c()<span class="hljs-keyword">case</span> &lt;-time.After(<span class="hljs-number">1</span> * time.Second):fmt.Println(<span class="hljs-string">"timeout 1s"</span>)<span class="hljs-keyword">return</span>&#125;&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼20-å¤‡å¿˜å½•æ¨¡å¼</title>
    <link href="/post/memento.html"/>
    <url>/post/memento.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/223947" target="_blank" rel="noopener">70 | å¤‡å¿˜å½•æ¨¡å¼ï¼šå¯¹äºå¤§å¯¹è±¡çš„å¤‡ä»½å’Œæ¢å¤ï¼Œå¦‚ä½•ä¼˜åŒ–å†…å­˜å’Œæ—¶é—´çš„æ¶ˆè€—ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 20/24 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604554038423-9ec977cc-ec31-4b77-9644-14dd880c3836.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-comment">// Package memento å¤‡å¿˜å½•æ¨¡å¼</span><span class="hljs-comment">// ä¸‹é¢è¿™ä¸ªä¾‹å­é‡‡ç”¨åŸè¯¾ç¨‹çš„ä¾‹å­ï¼Œä¸€ä¸ªè¾“å…¥ç¨‹åº</span><span class="hljs-comment">// å¦‚æœè¾“å…¥ :list åˆ™æ˜¾ç¤ºå½“å‰ä¿å­˜çš„å†…å®¹</span><span class="hljs-comment">// å¦‚æœè¾“å…¥ :undo åˆ™åˆ é™¤ä¸Šä¸€æ¬¡çš„è¾“å…¥</span><span class="hljs-comment">// å¦‚æœè¾“å…¥å…¶ä»–çš„å†…å®¹åˆ™è¿½åŠ ä¿å­˜</span><span class="hljs-keyword">package</span> memento<span class="hljs-comment">// InputText ç”¨äºä¿å­˜æ•°æ®</span><span class="hljs-keyword">type</span> InputText <span class="hljs-keyword">struct</span> &#123;content <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// Append è¿½åŠ æ•°æ®</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *InputText)</span> <span class="hljs-title">Append</span><span class="hljs-params">(content <span class="hljs-keyword">string</span>)</span></span> &#123;in.content += content&#125;<span class="hljs-comment">// GetText è·å–æ•°æ®</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *InputText)</span> <span class="hljs-title">GetText</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> in.content&#125;<span class="hljs-comment">// Snapshot åˆ›å»ºå¿«ç…§</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *InputText)</span> <span class="hljs-title">Snapshot</span><span class="hljs-params">()</span> *<span class="hljs-title">Snapshot</span></span> &#123;<span class="hljs-keyword">return</span> &amp;Snapshot&#123;content: in.content&#125;&#125;<span class="hljs-comment">// Restore ä»å¿«ç…§ä¸­æ¢å¤</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *InputText)</span> <span class="hljs-title">Restore</span><span class="hljs-params">(s *Snapshot)</span></span> &#123;in.content = s.GetText()&#125;<span class="hljs-comment">// Snapshot å¿«ç…§ï¼Œç”¨äºå­˜å‚¨æ•°æ®å¿«ç…§</span><span class="hljs-comment">// å¯¹äºå¿«ç…§æ¥è¯´ï¼Œåªèƒ½ä¸èƒ½è¢«å¤–éƒ¨ï¼ˆä¸åŒåŒ…ï¼‰ä¿®æ”¹ï¼Œåªèƒ½è·å–æ•°æ®ï¼Œæ»¡è¶³å°è£…çš„ç‰¹æ€§</span><span class="hljs-keyword">type</span> Snapshot <span class="hljs-keyword">struct</span> &#123;content <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// GetText GetText</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Snapshot)</span> <span class="hljs-title">GetText</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> s.content&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> memento<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestDemo</span><span class="hljs-params">(t *testing.T)</span></span> &#123;in := &amp;InputText&#123;&#125;snapshots := []*Snapshot&#123;&#125;tests := []<span class="hljs-keyword">struct</span> &#123;input <span class="hljs-keyword">string</span>want  <span class="hljs-keyword">string</span>&#125;&#123;&#123;input: <span class="hljs-string">":list"</span>,want:  <span class="hljs-string">""</span>,&#125;,&#123;input: <span class="hljs-string">"hello"</span>,want:  <span class="hljs-string">""</span>,&#125;,&#123;input: <span class="hljs-string">":list"</span>,want:  <span class="hljs-string">"hello"</span>,&#125;,&#123;input: <span class="hljs-string">"world"</span>,want:  <span class="hljs-string">""</span>,&#125;,&#123;input: <span class="hljs-string">":list"</span>,want:  <span class="hljs-string">"helloworld"</span>,&#125;,&#123;input: <span class="hljs-string">":undo"</span>,want:  <span class="hljs-string">""</span>,&#125;,&#123;input: <span class="hljs-string">":list"</span>,want:  <span class="hljs-string">"hello"</span>,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.input, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">switch</span> tt.input &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">":list"</span>:assert.Equal(t, tt.want, in.GetText())<span class="hljs-keyword">case</span> <span class="hljs-string">":undo"</span>:in.Restore(snapshots[<span class="hljs-built_in">len</span>(snapshots)<span class="hljs-number">-1</span>])snapshots = snapshots[:<span class="hljs-built_in">len</span>(snapshots)<span class="hljs-number">-1</span>]<span class="hljs-keyword">default</span>:snapshots = <span class="hljs-built_in">append</span>(snapshots, in.Snapshot())in.Append(tt.input)&#125;&#125;)&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼19-è®¿é—®è€…æ¨¡å¼</title>
    <link href="/post/visitor.html"/>
    <url>/post/visitor.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/221852" target="_blank" rel="noopener">68 | è®¿é—®è€…æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šæ‰‹æŠŠæ‰‹å¸¦ä½ è¿˜åŸè®¿é—®è€…æ¨¡å¼è¯ç”Ÿçš„æ€ç»´è¿‡ç¨‹</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 19/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604553945001-618def5a-9566-4d09-99f3-a227691538cf.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>åŸè¯¾ç¨‹ä¸­è®²è§£è®¿é—®è€…æ¨¡å¼çš„æ—¶å€™ç”¨åˆ°äº†ç»§æ‰¿å’Œå‡½æ•°é‡è½½è¿™ä¸¤ä¸ª Go ä¸­æ²¡æœ‰çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥çš„å‘¢ï¼Œä¼šé€šè¿‡ç»§æ‰¿å®ç°ã€‚<br><strong>æ³¨æ„ç”±äºæ²¡æœ‰å‡½æ•°é‡è½½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸çŸ¥é“ä¼ é€’è¿‡æ¥çš„å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œè¿™ä¸ªæ—¶å€™åªèƒ½é‡‡ç”¨ç±»å‹æ–­è¨€çš„æ–¹å¼æ¥å¯¹ä¸åŒçš„ç±»å‹åšä¸åŒçš„æ“ä½œï¼Œä½†æ˜¯æ­£å¼ç”±äºæ²¡æœ‰å‡½æ•°é‡è½½ï¼Œæ‰€ä»¥å…¶å®å®Œå…¨å¯ä»¥ä¸ç”¨è®¿é—®è€…æ¨¡å¼ç›´æ¥ä¼ å…¥å‚æ•°å°±å¥½äº†ã€‚</strong><br>ä»¥å‰æˆ‘ä»¬ç»å¸¸è¯´ä¸è¦ç”¨å†™å…¶ä»–è¯­è¨€çš„æ–¹å¼æ¥å†™ Goï¼ŒGo ä¸éœ€è¦å¤ªå¤šçš„è®¾è®¡æ¨¡å¼ï¼Œè¿™ä¸ªå°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒé²œæ˜çš„ä¾‹å­</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> visitor<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"path"</span>)<span class="hljs-comment">// Visitor è®¿é—®è€…</span><span class="hljs-keyword">type</span> Visitor <span class="hljs-keyword">interface</span> &#123;Visit(IResourceFile) error&#125;<span class="hljs-comment">// IResourceFile IResourceFile</span><span class="hljs-keyword">type</span> IResourceFile <span class="hljs-keyword">interface</span> &#123;Accept(Visitor) error&#125;<span class="hljs-comment">// NewResourceFile NewResourceFile</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewResourceFile</span><span class="hljs-params">(filepath <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(IResourceFile, error)</span></span> &#123;<span class="hljs-keyword">switch</span> path.Ext(filepath) &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">".ppt"</span>:<span class="hljs-keyword">return</span> &amp;PPTFile&#123;path: filepath&#125;, <span class="hljs-literal">nil</span><span class="hljs-keyword">case</span> <span class="hljs-string">".pdf"</span>:<span class="hljs-keyword">return</span> &amp;PdfFile&#123;path: filepath&#125;, <span class="hljs-literal">nil</span><span class="hljs-keyword">default</span>:<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"not found file type: %s"</span>, filepath)&#125;&#125;<span class="hljs-comment">// PdfFile PdfFile</span><span class="hljs-keyword">type</span> PdfFile <span class="hljs-keyword">struct</span> &#123;path <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// Accept Accept</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *PdfFile)</span> <span class="hljs-title">Accept</span><span class="hljs-params">(visitor Visitor)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> visitor.Visit(f)&#125;<span class="hljs-comment">// PPTFile PPTFile</span><span class="hljs-keyword">type</span> PPTFile <span class="hljs-keyword">struct</span> &#123;path <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// Accept Accept</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *PPTFile)</span> <span class="hljs-title">Accept</span><span class="hljs-params">(visitor Visitor)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> visitor.Visit(f)&#125;<span class="hljs-comment">// Compressor å®ç°å‹ç¼©åŠŸèƒ½</span><span class="hljs-keyword">type</span> Compressor <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Visit å®ç°è®¿é—®è€…æ¨¡å¼æ–¹æ³•</span><span class="hljs-comment">// æˆ‘ä»¬å¯ä»¥å‘ç°ç”±äºæ²¡æœ‰å‡½æ•°é‡è½½ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡æ–­è¨€æ¥æ ¹æ®ä¸åŒçš„ç±»å‹è°ƒç”¨ä¸åŒå‡½æ•°</span><span class="hljs-comment">// ä½†æ˜¯æˆ‘ä»¬å³ä½¿ä¸é‡‡ç”¨è®¿é—®è€…æ¨¡å¼ï¼Œæˆ‘ä»¬å…¶å®ä¹Ÿæ˜¯å¯ä»¥è¿™ä¹ˆæ“ä½œçš„</span><span class="hljs-comment">// å¹¶ä¸”ç”±äºé‡‡ç”¨äº†ç±»å‹æ–­è¨€ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦æ“ä½œçš„å¯¹è±¡æ¯”è¾ƒå¤šçš„è¯ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®ä¹Ÿä¼šè†¨èƒ€çš„æ¯”è¾ƒå‰å®³</span><span class="hljs-comment">// åç»­å¯ä»¥è€ƒè™‘æŒ‰ç…§å‘½åçº¦å®šä½¿ç”¨ generate è‡ªåŠ¨ç”Ÿæˆä»£ç </span><span class="hljs-comment">// æˆ–è€…æ˜¯ä½¿ç”¨åå°„ç®€åŒ–</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Compressor)</span> <span class="hljs-title">Visit</span><span class="hljs-params">(r IResourceFile)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">switch</span> f := r.(<span class="hljs-keyword">type</span>) &#123;<span class="hljs-keyword">case</span> *PPTFile:<span class="hljs-keyword">return</span> c.VisitPPTFile(f)<span class="hljs-keyword">case</span> *PdfFile:<span class="hljs-keyword">return</span> c.VisitPDFFile(f)<span class="hljs-keyword">default</span>:<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"not found resource typr: %#v"</span>, r)&#125;&#125;<span class="hljs-comment">// VisitPPTFile VisitPPTFile</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Compressor)</span> <span class="hljs-title">VisitPPTFile</span><span class="hljs-params">(f *PPTFile)</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">"this is ppt file"</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// VisitPDFFile VisitPDFFile</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Compressor)</span> <span class="hljs-title">VisitPDFFile</span><span class="hljs-params">(f *PdfFile)</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">"this is pdf file"</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> visitor<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/require"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestCompressor_Visit</span><span class="hljs-params">(t *testing.T)</span></span> &#123;tests := []<span class="hljs-keyword">struct</span> &#123;name    <span class="hljs-keyword">string</span>path    <span class="hljs-keyword">string</span>wantErr <span class="hljs-keyword">string</span>&#125;&#123;&#123;name: <span class="hljs-string">"pdf"</span>,path: <span class="hljs-string">"./xx.pdf"</span>,&#125;,&#123;name: <span class="hljs-string">"ppt"</span>,path: <span class="hljs-string">"./xx.ppt"</span>,&#125;,&#123;name:    <span class="hljs-string">"404"</span>,path:    <span class="hljs-string">"./xx.xx"</span>,wantErr: <span class="hljs-string">"not found file type"</span>,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;f, err := NewResourceFile(tt.path)<span class="hljs-keyword">if</span> tt.wantErr != <span class="hljs-string">""</span> &#123;require.Error(t, err)require.Contains(t, err.Error(), tt.wantErr)<span class="hljs-keyword">return</span>&#125;require.NoError(t, err)compressor := &amp;Compressor&#123;&#125;f.Accept(compressor)&#125;)&#125;&#125;<span class="hljs-comment">// ä¸ç”¨ Accept å…¶å®ä¹Ÿæ˜¯å¯ä»¥çš„</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestCompressor_Visit2</span><span class="hljs-params">(t *testing.T)</span></span> &#123;tests := []<span class="hljs-keyword">struct</span> &#123;name    <span class="hljs-keyword">string</span>path    <span class="hljs-keyword">string</span>wantErr <span class="hljs-keyword">string</span>&#125;&#123;&#123;name: <span class="hljs-string">"pdf"</span>,path: <span class="hljs-string">"./xx.pdf"</span>,&#125;,&#123;name: <span class="hljs-string">"ppt"</span>,path: <span class="hljs-string">"./xx.ppt"</span>,&#125;,&#123;name:    <span class="hljs-string">"404"</span>,path:    <span class="hljs-string">"./xx.xx"</span>,wantErr: <span class="hljs-string">"not found file type"</span>,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;f, err := NewResourceFile(tt.path)<span class="hljs-keyword">if</span> tt.wantErr != <span class="hljs-string">""</span> &#123;require.Error(t, err)require.Contains(t, err.Error(), tt.wantErr)<span class="hljs-keyword">return</span>&#125;require.NoError(t, err)compressor := &amp;Compressor&#123;&#125;compressor.Visit(f)&#125;)&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼18-è¿­ä»£å™¨æ¨¡å¼</title>
    <link href="/post/iterator.html"/>
    <url>/post/iterator.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/219290" target="_blank" rel="noopener">65 | è¿­ä»£å™¨æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šç›¸æ¯”ç›´æ¥éå†é›†åˆæ•°æ®ï¼Œä½¿ç”¨è¿­ä»£å™¨æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 18/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604553899885-458fad92-2e72-4ec6-8a5b-61d313acd29a.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰æ•°ç»„ç±»å‹çš„ä¾‹å­</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> iterator<span class="hljs-comment">// Iterator è¿­ä»£å™¨æ¥å£</span><span class="hljs-keyword">type</span> Iterator <span class="hljs-keyword">interface</span> &#123;HasNext() <span class="hljs-keyword">bool</span>Next()<span class="hljs-comment">// è·å–å½“å‰å…ƒç´ ï¼Œç”±äº Go 1.15 ä¸­è¿˜æ²¡æœ‰æ³›å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¿”å› interface&#123;&#125;</span>CurrentItem() <span class="hljs-keyword">interface</span>&#123;&#125;&#125;<span class="hljs-comment">// ArrayInt æ•°ç»„</span><span class="hljs-keyword">type</span> ArrayInt []<span class="hljs-keyword">int</span><span class="hljs-comment">// Iterator è¿”å›è¿­ä»£å™¨</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a ArrayInt)</span> <span class="hljs-title">Iterator</span><span class="hljs-params">()</span> <span class="hljs-title">Iterator</span></span> &#123;<span class="hljs-keyword">return</span> &amp;ArrayIntIterator&#123;arrayInt: a,index:    <span class="hljs-number">0</span>,&#125;&#125;<span class="hljs-comment">// ArrayIntIterator æ•°ç»„è¿­ä»£</span><span class="hljs-keyword">type</span> ArrayIntIterator <span class="hljs-keyword">struct</span> &#123;arrayInt ArrayIntindex    <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// HasNext æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ª</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(iter *ArrayIntIterator)</span> <span class="hljs-title">HasNext</span><span class="hljs-params">()</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">return</span> iter.index &lt; <span class="hljs-built_in">len</span>(iter.arrayInt)<span class="hljs-number">-1</span>&#125;<span class="hljs-comment">// Next æ¸¸æ ‡åŠ ä¸€</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(iter *ArrayIntIterator)</span> <span class="hljs-title">Next</span><span class="hljs-params">()</span></span> &#123;iter.index++&#125;<span class="hljs-comment">// CurrentItem è·å–å½“å‰å…ƒç´ </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(iter *ArrayIntIterator)</span> <span class="hljs-title">CurrentItem</span><span class="hljs-params">()</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;<span class="hljs-keyword">return</span> iter.arrayInt[iter.index]&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> iterator<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestArrayInt_Iterator</span><span class="hljs-params">(t *testing.T)</span></span> &#123;data := ArrayInt&#123;<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;iterator := data.Iterator()<span class="hljs-comment">// i ç”¨äºæµ‹è¯•</span>i := <span class="hljs-number">0</span><span class="hljs-keyword">for</span> iterator.HasNext() &#123;assert.Equal(t, data[i], iterator.CurrentItem())iterator.Next()i++&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼17-çŠ¶æ€æ¨¡å¼</title>
    <link href="/post/state.html"/>
    <url>/post/state.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/218375" target="_blank" rel="noopener">64 | çŠ¶æ€æ¨¡å¼ï¼šæ¸¸æˆã€å·¥ä½œæµå¼•æ“ä¸­å¸¸ç”¨çš„çŠ¶æ€æœºæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 17/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604553865908-d2176cad-7bd6-41df-83c3-a2a2edc3eaca.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>é€šè¿‡ä¸‹é¢çš„ä¾‹å­å¯ä»¥å‘ç°ï¼Œå¼•å…¥çŠ¶æ€æ¨¡å¼æ¥å†™çŠ¶æ€æœºä¼šæœ‰å¼•å…¥æ¯”è¾ƒå¤šçš„ç»“æ„ä½“ï¼Œå¹¶ä¸”æ”¹åŠ¨ä»£ç çš„æ—¶å€™å¦‚æœè¦æ–°å¢æˆ–è€…æ˜¯åˆ é™¤æŸä¸€ä¸ªçŠ¶æ€çš„è¯ï¼Œä¿®æ”¹ä¹Ÿéœ€è¦åœ¨å…¶ä»–çŠ¶æ€çš„ç»“æ„ä½“æ–¹æ³•ä¸­ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªä¸å¤ªé€‚åˆçŠ¶æ€ç»å¸¸å˜æ›´æˆ–è€…æ˜¯çŠ¶æ€å¾ˆå¤šçš„æƒ…å†µ</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-comment">// Package state çŠ¶æ€æ¨¡å¼</span><span class="hljs-comment">// ç¬”è®°è¯·æŸ¥çœ‹: https://lailin.xyz/state.html</span><span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªå·¥ä½œæµçš„ä¾‹å­ï¼Œåœ¨ä¼ä¸šå†…éƒ¨æˆ–è€…æ˜¯å­¦æ ¡æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°å¾ˆå¤šå®¡æ‰¹æµç¨‹</span><span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæŠ¥é”€çš„æµç¨‹: å‘˜å·¥æäº¤æŠ¥é”€ç”³è¯· -&gt; ç›´å±éƒ¨é—¨é¢†å¯¼å®¡æ‰¹ -&gt; è´¢åŠ¡å®¡æ‰¹ -&gt; ç»“æŸ</span><span class="hljs-comment">// åœ¨è¿™ä¸ªå®¡æ‰¹æµä¸­ï¼Œå¤„åœ¨ä¸åŒçš„ç¯èŠ‚å°±æ˜¯ä¸åŒçš„çŠ¶æ€</span><span class="hljs-comment">// è€Œæµç¨‹çš„å®¡æ‰¹ã€é©³å›å°±æ˜¯ä¸åŒçš„äº‹ä»¶</span><span class="hljs-keyword">package</span> state<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-comment">// Machine çŠ¶æ€æœº</span><span class="hljs-keyword">type</span> Machine <span class="hljs-keyword">struct</span> &#123;state IState&#125;<span class="hljs-comment">// SetState æ›´æ–°çŠ¶æ€</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span> <span class="hljs-title">SetState</span><span class="hljs-params">(state IState)</span></span> &#123;m.state = state&#125;<span class="hljs-comment">// GetStateName è·å–å½“å‰çŠ¶æ€</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span> <span class="hljs-title">GetStateName</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> m.state.GetName()&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span> <span class="hljs-title">Approval</span><span class="hljs-params">()</span></span> &#123;m.state.Approval(m)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span> <span class="hljs-title">Reject</span><span class="hljs-params">()</span></span> &#123;m.state.Reject(m)&#125;<span class="hljs-comment">// IState çŠ¶æ€</span><span class="hljs-keyword">type</span> IState <span class="hljs-keyword">interface</span> &#123;<span class="hljs-comment">// å®¡æ‰¹é€šè¿‡</span>Approval(m *Machine)<span class="hljs-comment">// é©³å›</span>Reject(m *Machine)<span class="hljs-comment">// è·å–å½“å‰çŠ¶æ€åç§°</span>GetName() <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// leaderApproveState ç›´å±é¢†å¯¼å®¡æ‰¹</span><span class="hljs-keyword">type</span> leaderApproveState <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Approval è·å–çŠ¶æ€åå­—</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(leaderApproveState)</span> <span class="hljs-title">Approval</span><span class="hljs-params">(m *Machine)</span></span> &#123;fmt.Println(<span class="hljs-string">"leader å®¡æ‰¹æˆåŠŸ"</span>)m.SetState(GetFinanceApproveState())&#125;<span class="hljs-comment">// GetName è·å–çŠ¶æ€åå­—</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(leaderApproveState)</span> <span class="hljs-title">GetName</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">"LeaderApproveState"</span>&#125;<span class="hljs-comment">// Reject è·å–çŠ¶æ€åå­—</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(leaderApproveState)</span> <span class="hljs-title">Reject</span><span class="hljs-params">(m *Machine)</span></span> &#123;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetLeaderApproveState</span><span class="hljs-params">()</span> <span class="hljs-title">IState</span></span> &#123;<span class="hljs-keyword">return</span> &amp;leaderApproveState&#123;&#125;&#125;<span class="hljs-comment">// financeApproveState è´¢åŠ¡å®¡æ‰¹</span><span class="hljs-keyword">type</span> financeApproveState <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Approval å®¡æ‰¹é€šè¿‡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f financeApproveState)</span> <span class="hljs-title">Approval</span><span class="hljs-params">(m *Machine)</span></span> &#123;fmt.Println(<span class="hljs-string">"è´¢åŠ¡å®¡æ‰¹æˆåŠŸ"</span>)fmt.Println(<span class="hljs-string">"å‡ºå‘æ‰“æ¬¾æ“ä½œ"</span>)&#125;<span class="hljs-comment">// æ‹’ç»</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f financeApproveState)</span> <span class="hljs-title">Reject</span><span class="hljs-params">(m *Machine)</span></span> &#123;m.SetState(GetLeaderApproveState())&#125;<span class="hljs-comment">// GetName è·å–åå­—</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f financeApproveState)</span> <span class="hljs-title">GetName</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">"FinanceApproveState"</span>&#125;<span class="hljs-comment">// GetFinanceApproveState GetFinanceApproveState</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetFinanceApproveState</span><span class="hljs-params">()</span> <span class="hljs-title">IState</span></span> &#123;<span class="hljs-keyword">return</span> &amp;financeApproveState&#123;&#125;&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> state<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestMachine_GetStateName</span><span class="hljs-params">(t *testing.T)</span></span> &#123;m := &amp;Machine&#123;state: GetLeaderApproveState()&#125;assert.Equal(t, <span class="hljs-string">"LeaderApproveState"</span>, m.GetStateName())m.Approval()assert.Equal(t, <span class="hljs-string">"FinanceApproveState"</span>, m.GetStateName())m.Reject()assert.Equal(t, <span class="hljs-string">"LeaderApproveState"</span>, m.GetStateName())m.Approval()assert.Equal(t, <span class="hljs-string">"FinanceApproveState"</span>, m.GetStateName())m.Approval()&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼16-èŒè´£é“¾æ¨¡å¼(Ginçš„ä¸­é—´ä»¶å®ç°)</title>
    <link href="/post/chain.html"/>
    <url>/post/chain.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/216278" target="_blank" rel="noopener">62 | èŒè´£é“¾æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•å®ç°å¯çµæ´»æ‰©å±•ç®—æ³•çš„æ•æ„Ÿä¿¡æ¯è¿‡æ»¤æ¡†æ¶ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 16/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604553820863-78020ed6-f3be-4fd1-8b0b-22a204027642.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„å®ç°æ¨¡æ¿ï¼Œç„¶åæˆ‘ä»¬å†çœ‹çœ‹å®é™…ä¸Šæˆ‘ä»¬å¸¸ç”¨ web æ¡†æ¶ gin å½“ä¸­æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-comment">// Package chain èŒè´£é“¾æ¨¡å¼</span><span class="hljs-comment">// ğŸŒ° å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸ªæ ¡å›­è®ºå›ï¼Œç”±äºç¤¾åŒºè§„ç« åˆ¶åº¦ã€å¹¿å‘Šã€æ³•å¾‹æ³•è§„çš„åŸå› éœ€è¦å¯¹ç”¨æˆ·çš„å‘è¨€è¿›è¡Œæ•æ„Ÿè¯è¿‡æ»¤</span><span class="hljs-comment">//    å¦‚æœè¢«åˆ¤å®šä¸ºæ•æ„Ÿè¯ï¼Œé‚£ä¹ˆè¿™ç¯‡å¸–å­å°†ä¼šè¢«å°ç¦</span><span class="hljs-keyword">package</span> chain<span class="hljs-comment">// SensitiveWordFilter æ•æ„Ÿè¯è¿‡æ»¤å™¨ï¼Œåˆ¤å®šæ˜¯å¦æ˜¯æ•æ„Ÿè¯</span><span class="hljs-keyword">type</span> SensitiveWordFilter <span class="hljs-keyword">interface</span> &#123;Filter(content <span class="hljs-keyword">string</span>) <span class="hljs-keyword">bool</span>&#125;<span class="hljs-comment">// SensitiveWordFilterChain èŒè´£é“¾</span><span class="hljs-keyword">type</span> SensitiveWordFilterChain <span class="hljs-keyword">struct</span> &#123;filters []SensitiveWordFilter&#125;<span class="hljs-comment">// AddFilter æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *SensitiveWordFilterChain)</span> <span class="hljs-title">AddFilter</span><span class="hljs-params">(filter SensitiveWordFilter)</span></span> &#123;c.filters = <span class="hljs-built_in">append</span>(c.filters, filter)&#125;<span class="hljs-comment">// Filter æ‰§è¡Œè¿‡æ»¤</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *SensitiveWordFilterChain)</span> <span class="hljs-title">Filter</span><span class="hljs-params">(content <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">for</span> _, filter := <span class="hljs-keyword">range</span> c.filters &#123;<span class="hljs-comment">// å¦‚æœå‘ç°æ•æ„Ÿç›´æ¥è¿”å›ç»“æœ</span><span class="hljs-keyword">if</span> filter.Filter(content) &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;<span class="hljs-comment">// AdSensitiveWordFilter å¹¿å‘Š</span><span class="hljs-keyword">type</span> AdSensitiveWordFilter <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Filter å®ç°è¿‡æ»¤ç®—æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *AdSensitiveWordFilter)</span> <span class="hljs-title">Filter</span><span class="hljs-params">(content <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å®ç°ç®—æ³•</span><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;<span class="hljs-comment">// PoliticalWordFilter æ”¿æ²»æ•æ„Ÿ</span><span class="hljs-keyword">type</span> PoliticalWordFilter <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Filter å®ç°è¿‡æ»¤ç®—æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *PoliticalWordFilter)</span> <span class="hljs-title">Filter</span><span class="hljs-params">(content <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å®ç°ç®—æ³•</span><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> chain<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestSensitiveWordFilterChain_Filter</span><span class="hljs-params">(t *testing.T)</span></span> &#123;chain := &amp;SensitiveWordFilterChain&#123;&#125;chain.AddFilter(&amp;AdSensitiveWordFilter&#123;&#125;)assert.Equal(t, <span class="hljs-literal">false</span>, chain.Filter(<span class="hljs-string">"test"</span>))chain.AddFilter(&amp;PoliticalWordFilter&#123;&#125;)assert.Equal(t, <span class="hljs-literal">true</span>, chain.Filter(<span class="hljs-string">"test"</span>))&#125;</code></pre><h3 id="Gin-çš„ä¸­é—´ä»¶å®ç°"><a href="#Gin-çš„ä¸­é—´ä»¶å®ç°" class="headerlink" title="Gin çš„ä¸­é—´ä»¶å®ç°"></a>Gin çš„ä¸­é—´ä»¶å®ç°</h3><p>æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸‹ <code>gin Context</code> çš„å®ç°ï¼Œå…¶ä¸­ <code>Next()</code> æ–¹æ³•å°±æ˜¯ä¸»è¦çš„æ‰§è¡Œæ–¹æ³•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯æˆ‘ä»¬æœ€ä¸Šé¢è¯´åˆ°çš„èŒè´£é“¾æ¨¡å¼çš„å˜ä½“ï¼Œå› ä¸ºå®ƒä¼šåœ¨æ¯ä¸€ä¸ªå¤„ç†å‡½æ•°ä¸­è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€ä¸ªæ¥æ”¶åˆ°å°±åœæ­¢äº†</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// ...</span>    <span class="hljs-comment">// handlers æ˜¯ä¸€ä¸ªåŒ…å«æ‰§è¡Œå‡½æ•°çš„æ•°ç»„</span>    <span class="hljs-comment">// type HandlersChain []HandlerFunc</span>handlers HandlersChain    <span class="hljs-comment">// index è¡¨ç¤ºå½“å‰æ‰§è¡Œåˆ°å“ªä¸ªä½ç½®äº†</span>index    <span class="hljs-keyword">int8</span>    <span class="hljs-comment">// ...</span>&#125;<span class="hljs-comment">// Next ä¼šæŒ‰ç…§é¡ºåºå°†ä¸€ä¸ªä¸ªä¸­é—´ä»¶æ‰§è¡Œå®Œæ¯•</span><span class="hljs-comment">// å¹¶ä¸” Next ä¹Ÿå¯ä»¥åœ¨ä¸­é—´ä»¶ä¸­è¿›è¡Œè°ƒç”¨ï¼Œè¾¾åˆ°è¯·æ±‚å‰ä»¥åŠè¯·æ±‚åçš„å¤„ç†</span><span class="hljs-comment">// Next should be used only inside middleware.</span><span class="hljs-comment">// It executes the pending handlers in the chain inside the calling handler.</span><span class="hljs-comment">// See example in GitHub.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span> <span class="hljs-title">Next</span><span class="hljs-params">()</span></span> &#123;c.index++<span class="hljs-keyword">for</span> c.index &lt; <span class="hljs-keyword">int8</span>(<span class="hljs-built_in">len</span>(c.handlers)) &#123;c.handlers[c.index](c)c.index++&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼15-ç­–ç•¥æ¨¡å¼</title>
    <link href="/post/strategy.html"/>
    <url>/post/strategy.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/214014" target="_blank" rel="noopener">60 | ç­–ç•¥æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•é¿å…å†—é•¿çš„ if-else/switch åˆ†æ”¯åˆ¤æ–­ä»£ç ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 15/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604553796652-924605d4-830b-41ba-ba8e-fe3725630d00.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>æ¥ä¸ª ğŸŒ°ï¼Œæˆ‘ä»¬åœ¨ä¿å­˜æ–‡ä»¶çš„æ—¶å€™ï¼Œç”±äºæ”¿ç­–æˆ–è€…å…¶ä»–çš„åŸå› å¯èƒ½éœ€è¦é€‰æ‹©ä¸åŒçš„å­˜å‚¨æ–¹å¼ï¼Œæ•æ„Ÿæ•°æ®æˆ‘ä»¬éœ€è¦åŠ å¯†å­˜å‚¨ï¼Œä¸æ•æ„Ÿçš„æ•°æ®æˆ‘ä»¬å¯ä»¥ç›´æ¥æ˜æ–‡ä¿å­˜ã€‚</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> strategy<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"io/ioutil"</span><span class="hljs-string">"os"</span>)<span class="hljs-comment">// StorageStrategy å­˜å‚¨ç­–ç•¥</span><span class="hljs-keyword">type</span> StorageStrategy <span class="hljs-keyword">interface</span> &#123;Save(name <span class="hljs-keyword">string</span>, data []<span class="hljs-keyword">byte</span>) error&#125;<span class="hljs-keyword">var</span> strategys = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]StorageStrategy&#123;<span class="hljs-string">"file"</span>:         &amp;fileStorage&#123;&#125;,<span class="hljs-string">"encrypt_file"</span>: &amp;encryptFileStorage&#123;&#125;,&#125;<span class="hljs-comment">// NewStorageStrategy NewStorageStrategy</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewStorageStrategy</span><span class="hljs-params">(t <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(StorageStrategy, error)</span></span> &#123;s, ok := strategys[t]<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"not found StorageStrategy: %s"</span>, t)&#125;<span class="hljs-keyword">return</span> s, <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// FileStorage ä¿å­˜åˆ°æ–‡ä»¶</span><span class="hljs-keyword">type</span> fileStorage <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Save Save</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *fileStorage)</span> <span class="hljs-title">Save</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>, data []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> ioutil.WriteFile(name, data, os.ModeAppend)&#125;<span class="hljs-comment">// encryptFileStorage åŠ å¯†ä¿å­˜åˆ°æ–‡ä»¶</span><span class="hljs-keyword">type</span> encryptFileStorage <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Save Save</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *encryptFileStorage)</span> <span class="hljs-title">Save</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>, data []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-comment">// åŠ å¯†</span>data, err := encrypt(data)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err&#125;<span class="hljs-keyword">return</span> ioutil.WriteFile(name, data, os.ModeAppend)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encrypt</span><span class="hljs-params">(data []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-params">([]<span class="hljs-keyword">byte</span>, error)</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œå®ç°åŠ å¯†ç®—æ³•</span><span class="hljs-keyword">return</span> data, <span class="hljs-literal">nil</span>&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> strategy<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Test_demo</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-comment">// å‡è®¾è¿™é‡Œè·å–æ•°æ®ï¼Œä»¥åŠæ•°æ®æ˜¯å¦æ•æ„Ÿ</span>data, sensitive := getData()strategyType := <span class="hljs-string">"file"</span><span class="hljs-keyword">if</span> sensitive &#123;strategyType = <span class="hljs-string">"encrypt_file"</span>&#125;storage, err := NewStorageStrategy(strategyType)assert.NoError(t, err)assert.NoError(t, storage.Save(<span class="hljs-string">"./test.txt"</span>, data))&#125;<span class="hljs-comment">// getData è·å–æ•°æ®çš„æ–¹æ³•</span><span class="hljs-comment">// è¿”å›æ•°æ®ï¼Œä»¥åŠæ•°æ®æ˜¯å¦æ•æ„Ÿ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getData</span><span class="hljs-params">()</span> <span class="hljs-params">([]<span class="hljs-keyword">byte</span>, <span class="hljs-keyword">bool</span>)</span></span> &#123;<span class="hljs-keyword">return</span> []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"test data"</span>), <span class="hljs-literal">false</span>&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goæ¨¡æ¿æ¨¡å¼14-æ¨¡æ¿æ¨¡å¼</title>
    <link href="/post/template.html"/>
    <url>/post/template.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/212049" target="_blank" rel="noopener">58 | æ¨¡æ¿æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šå‰–ææ¨¡æ¿æ¨¡å¼åœ¨ JDKã€Servletã€JUnit ç­‰ä¸­çš„åº”ç”¨</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 14/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604553729036-301028ae-d64e-42e2-91aa-0cfdf5b54409.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>ä¸¾ä¸ª ğŸŒ°ï¼Œå‡è®¾æˆ‘ç°åœ¨è¦åšä¸€ä¸ªçŸ­ä¿¡æ¨é€çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆéœ€è¦</p><ol><li>æ£€æŸ¥çŸ­ä¿¡å­—æ•°æ˜¯å¦è¶…è¿‡é™åˆ¶</li><li>æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦æ­£ç¡®</li><li>å‘é€çŸ­ä¿¡</li><li>è¿”å›çŠ¶æ€</li></ol><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨å‘é€çŸ­ä¿¡çš„æ—¶å€™ç”±äºä¸åŒçš„ä¾›åº”å•†è°ƒç”¨çš„æ¥å£ä¸åŒï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€äº›å®ç°ä¸Šçš„å·®å¼‚ï¼Œä½†æ˜¯ä»–çš„ç®—æ³•ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰æ˜¯å›ºå®šçš„</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> template<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-comment">// ISMS ISMS</span><span class="hljs-keyword">type</span> ISMS <span class="hljs-keyword">interface</span> &#123;send(content <span class="hljs-keyword">string</span>, phone <span class="hljs-keyword">int</span>) error&#125;<span class="hljs-comment">// SMS çŸ­ä¿¡å‘é€åŸºç±»</span><span class="hljs-keyword">type</span> sms <span class="hljs-keyword">struct</span> &#123;ISMS&#125;<span class="hljs-comment">// Valid æ ¡éªŒçŸ­ä¿¡å­—æ•°</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *sms)</span> <span class="hljs-title">Valid</span><span class="hljs-params">(content <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(content) &gt; <span class="hljs-number">63</span> &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"content is too long"</span>)&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// Send å‘é€çŸ­ä¿¡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *sms)</span> <span class="hljs-title">Send</span><span class="hljs-params">(content <span class="hljs-keyword">string</span>, phone <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> err := s.Valid(content); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err&#125;<span class="hljs-comment">// è°ƒç”¨å­ç±»çš„æ–¹æ³•å‘é€çŸ­ä¿¡</span><span class="hljs-keyword">return</span> s.send(content, phone)&#125;<span class="hljs-comment">// TelecomSms èµ°ç”µä¿¡é€šé“</span><span class="hljs-keyword">type</span> TelecomSms <span class="hljs-keyword">struct</span> &#123;*sms&#125;<span class="hljs-comment">// NewTelecomSms NewTelecomSms</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewTelecomSms</span><span class="hljs-params">()</span> *<span class="hljs-title">TelecomSms</span></span> &#123;tel := &amp;TelecomSms&#123;&#125;<span class="hljs-comment">// è¿™é‡Œæœ‰ç‚¹ç»•ï¼Œæ˜¯å› ä¸º go æ²¡æœ‰ç»§æ‰¿ï¼Œç”¨åµŒå¥—ç»“æ„ä½“çš„æ–¹æ³•è¿›è¡Œæ¨¡æ‹Ÿ</span><span class="hljs-comment">// è¿™é‡Œå°†å­ç±»ä½œä¸ºæ¥å£åµŒå…¥çˆ¶ç±»ï¼Œå°±å¯ä»¥è®©çˆ¶ç±»çš„æ¨¡æ¿æ–¹æ³• Send è°ƒç”¨åˆ°å­ç±»çš„å‡½æ•°</span><span class="hljs-comment">// å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šè¿™ä¹ˆå†™ï¼Œéƒ½æ˜¯é‡‡ç”¨ç»„åˆ+æ¥å£çš„æ–¹å¼å®Œæˆç±»ä¼¼çš„åŠŸèƒ½</span>tel.sms = &amp;sms&#123;ISMS: tel&#125;<span class="hljs-keyword">return</span> tel&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(tel *TelecomSms)</span> <span class="hljs-title">send</span><span class="hljs-params">(content <span class="hljs-keyword">string</span>, phone <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;fmt.Println(<span class="hljs-string">"send by telecom success"</span>)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> template<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Test_sms_Send</span><span class="hljs-params">(t *testing.T)</span></span> &#123;tel := NewTelecomSms()err := tel.Send(<span class="hljs-string">"test"</span>, <span class="hljs-number">1239999</span>)assert.NoError(t, err)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼13-è§‚å¯Ÿè€…æ¨¡å¼(å®ç°ç®€å•çš„EventBus)</title>
    <link href="/post/observer.html"/>
    <url>/post/observer.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/210170" target="_blank" rel="noopener">56 | è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šè¯¦è§£å„ç§åº”ç”¨åœºæ™¯ä¸‹è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸åŒå®ç°æ–¹å¼</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 13/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a> **</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604553664374-ba397231-64a2-4a8e-bb2f-fbb54380806d.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="åŸºç¡€å®ç°"><a href="#åŸºç¡€å®ç°" class="headerlink" title="åŸºç¡€å®ç°"></a>åŸºç¡€å®ç°</h3><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> observer<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-comment">// ISubject subject</span><span class="hljs-keyword">type</span> ISubject <span class="hljs-keyword">interface</span> &#123;Register(observer IObsever)Remove(observer IObsever)Notify(observer IObsever)&#125;<span class="hljs-comment">// IObsever è§‚å¯Ÿè€…</span><span class="hljs-keyword">type</span> IObsever <span class="hljs-keyword">interface</span> &#123;Update(msg <span class="hljs-keyword">string</span>)&#125;<span class="hljs-comment">// Subject Subject</span><span class="hljs-keyword">type</span> Subject <span class="hljs-keyword">struct</span> &#123;observers []IObsever&#125;<span class="hljs-comment">// Register æ³¨å†Œ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sub *Subject)</span> <span class="hljs-title">Register</span><span class="hljs-params">(observer IObsever)</span></span> &#123;sub.observers = <span class="hljs-built_in">append</span>(sub.observers, observer)&#125;<span class="hljs-comment">// Remove ç§»é™¤è§‚å¯Ÿè€…</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sub *Subject)</span> <span class="hljs-title">Remove</span><span class="hljs-params">(observer IObsever)</span></span> &#123;<span class="hljs-keyword">for</span> i, ob := <span class="hljs-keyword">range</span> sub.observers &#123;<span class="hljs-keyword">if</span> ob == observer &#123;sub.observers = <span class="hljs-built_in">append</span>(sub.observers[:i], sub.observers[i+<span class="hljs-number">1</span>:]...)&#125;&#125;&#125;<span class="hljs-comment">// Notify é€šçŸ¥</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sub *Subject)</span> <span class="hljs-title">Notify</span><span class="hljs-params">(msg <span class="hljs-keyword">string</span>)</span></span> &#123;<span class="hljs-keyword">for</span> _, o := <span class="hljs-keyword">range</span> sub.observers &#123;o.Update(msg)&#125;&#125;<span class="hljs-comment">// Obsever1 Obsever1</span><span class="hljs-keyword">type</span> Obsever1 <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Update å®ç°è§‚å¯Ÿè€…æ¥å£</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(Obsever1)</span> <span class="hljs-title">Update</span><span class="hljs-params">(msg <span class="hljs-keyword">string</span>)</span></span> &#123;fmt.Printf(<span class="hljs-string">"Obsever1: %s"</span>, msg)&#125;<span class="hljs-comment">// Obsever2 Obsever2</span><span class="hljs-keyword">type</span> Obsever2 <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Update å®ç°è§‚å¯Ÿè€…æ¥å£</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(Obsever2)</span> <span class="hljs-title">Update</span><span class="hljs-params">(msg <span class="hljs-keyword">string</span>)</span></span> &#123;fmt.Printf(<span class="hljs-string">"Obsever2: %s"</span>, msg)&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> observer<span class="hljs-keyword">import</span> <span class="hljs-string">"testing"</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestSubject_Notify</span><span class="hljs-params">(t *testing.T)</span></span> &#123;sub := &amp;Subject&#123;&#125;sub.Register(&amp;Obsever1&#123;&#125;)sub.Register(&amp;Obsever2&#123;&#125;)sub.Notify(<span class="hljs-string">"hi"</span>)&#125;</code></pre><h3 id="ä½¿ç”¨-Golang-å®ç°-EventBus"><a href="#ä½¿ç”¨-Golang-å®ç°-EventBus" class="headerlink" title="ä½¿ç”¨ Golang å®ç° EventBus"></a>ä½¿ç”¨ Golang å®ç° EventBus</h3><p>æˆ‘ä»¬å®ç°ä¸€ä¸ªæ”¯æŒä»¥ä¸‹åŠŸèƒ½çš„äº‹ä»¶æ€»çº¿</p><ol><li>å¼‚æ­¥ä¸é˜»å¡</li><li>æ”¯æŒä»»æ„å‚æ•°å€¼</li></ol><h4 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> eventbus<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"reflect"</span><span class="hljs-string">"sync"</span>)<span class="hljs-comment">// Bus Bus</span><span class="hljs-keyword">type</span> Bus <span class="hljs-keyword">interface</span> &#123;Subscribe(topic <span class="hljs-keyword">string</span>, handler <span class="hljs-keyword">interface</span>&#123;&#125;) errorPublish(topic <span class="hljs-keyword">string</span>, args ...<span class="hljs-keyword">interface</span>&#123;&#125;)&#125;<span class="hljs-comment">// AsyncEventBus å¼‚æ­¥äº‹ä»¶æ€»çº¿</span><span class="hljs-keyword">type</span> AsyncEventBus <span class="hljs-keyword">struct</span> &#123;handlers <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>][]reflect.Valuelock     sync.Mutex&#125;<span class="hljs-comment">// NewAsyncEventBus new</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAsyncEventBus</span><span class="hljs-params">()</span> *<span class="hljs-title">AsyncEventBus</span></span> &#123;<span class="hljs-keyword">return</span> &amp;AsyncEventBus&#123;handlers: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>][]reflect.Value&#123;&#125;,lock:     sync.Mutex&#123;&#125;,&#125;&#125;<span class="hljs-comment">// Subscribe è®¢é˜…</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(bus *AsyncEventBus)</span> <span class="hljs-title">Subscribe</span><span class="hljs-params">(topic <span class="hljs-keyword">string</span>, f <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;bus.lock.Lock()<span class="hljs-keyword">defer</span> bus.lock.Unlock()v := reflect.ValueOf(f)<span class="hljs-keyword">if</span> v.Type().Kind() != reflect.Func &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"handler is not a function"</span>)&#125;handler, ok := bus.handlers[topic]<span class="hljs-keyword">if</span> !ok &#123;handler = []reflect.Value&#123;&#125;&#125;handler = <span class="hljs-built_in">append</span>(handler, v)bus.handlers[topic] = handler<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// Publish å‘å¸ƒ</span><span class="hljs-comment">// è¿™é‡Œå¼‚æ­¥æ‰§è¡Œï¼Œå¹¶ä¸”ä¸ä¼šç­‰å¾…è¿”å›ç»“æœ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(bus *AsyncEventBus)</span> <span class="hljs-title">Publish</span><span class="hljs-params">(topic <span class="hljs-keyword">string</span>, args ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;handlers, ok := bus.handlers[topic]<span class="hljs-keyword">if</span> !ok &#123;fmt.Println(<span class="hljs-string">"not found handlers in topic:"</span>, topic)<span class="hljs-keyword">return</span>&#125;params := <span class="hljs-built_in">make</span>([]reflect.Value, <span class="hljs-built_in">len</span>(args))<span class="hljs-keyword">for</span> i, arg := <span class="hljs-keyword">range</span> args &#123;params[i] = reflect.ValueOf(arg)&#125;<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> handlers &#123;<span class="hljs-keyword">go</span> handlers[i].Call(params)&#125;&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•-1"><a href="#å•å…ƒæµ‹è¯•-1" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> eventbus<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"testing"</span><span class="hljs-string">"time"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sub1</span><span class="hljs-params">(msg1, msg2 <span class="hljs-keyword">string</span>)</span></span> &#123;time.Sleep(<span class="hljs-number">1</span> * time.Microsecond)fmt.Printf(<span class="hljs-string">"sub1, %s %s\n"</span>, msg1, msg2)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sub2</span><span class="hljs-params">(msg1, msg2 <span class="hljs-keyword">string</span>)</span></span> &#123;fmt.Printf(<span class="hljs-string">"sub2, %s %s\n"</span>, msg1, msg2)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestAsyncEventBus_Publish</span><span class="hljs-params">(t *testing.T)</span></span> &#123;bus := NewAsyncEventBus()bus.Subscribe(<span class="hljs-string">"topic:1"</span>, sub1)bus.Subscribe(<span class="hljs-string">"topic:1"</span>, sub2)bus.Publish(<span class="hljs-string">"topic:1"</span>, <span class="hljs-string">"test1"</span>, <span class="hljs-string">"test2"</span>)bus.Publish(<span class="hljs-string">"topic:1"</span>, <span class="hljs-string">"testA"</span>, <span class="hljs-string">"testB"</span>)time.Sleep(<span class="hljs-number">1</span> * time.Second)&#125;</code></pre><p>ç»“æœ</p><pre><code class="hljs go">=== RUN   TestAsyncEventBus_Publishsub2, testA testBsub2, test1 test2sub1, testA testBsub1, test1 test2--- PASS: TestAsyncEventBus_Publish (<span class="hljs-number">1.01</span>s)</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼12-äº«å…ƒæ¨¡å¼</title>
    <link href="/post/flyweight.html"/>
    <url>/post/flyweight.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/208572" target="_blank" rel="noopener">54 | äº«å…ƒæ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•åˆ©ç”¨äº«å…ƒæ¨¡å¼ä¼˜åŒ–æ–‡æœ¬ç¼–è¾‘å™¨çš„å†…å­˜å ç”¨ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 12/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604552127501-2af05ce0-8947-4853-9f7f-997d40758322.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>å¤ç”¨è¯¾ç¨‹ä¸­çš„ ğŸŒ°ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨æ­£åœ¨åšä¸€ä¸ªæ£‹ç‰Œç±»çš„æ¸¸æˆï¼Œä¾‹å¦‚è±¡æ£‹ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆå¯¹å±€ï¼Œæ£‹å­çš„åŸºæœ¬å±æ€§å…¶å®æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸ä¼šå› ä¸ºéšç€ä¸‹æ£‹çš„è¿‡ç¨‹å˜åŒ–ã€‚é‚£æˆ‘ä»¬å°±å¯ä»¥æŠŠæ£‹å­å˜ä¸ºäº«å…ƒï¼Œè®©æ‰€æœ‰çš„å¯¹å±€éƒ½å…±äº«è¿™äº›å¯¹è±¡ï¼Œä»¥æ­¤è¾¾åˆ°èŠ‚çœå†…å­˜çš„ç›®çš„ã€‚</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> flyweight<span class="hljs-keyword">var</span> units = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">int</span>]*ChessPieceUnit&#123;<span class="hljs-number">1</span>: &#123;ID:    <span class="hljs-number">1</span>,Name:  <span class="hljs-string">"è»Š"</span>,Color: <span class="hljs-string">"red"</span>,&#125;,<span class="hljs-number">2</span>: &#123;ID:    <span class="hljs-number">2</span>,Name:  <span class="hljs-string">"ç‚®"</span>,Color: <span class="hljs-string">"red"</span>,&#125;,<span class="hljs-comment">// ... å…¶ä»–æ£‹å­</span>&#125;<span class="hljs-comment">// ChessPieceUnit æ£‹å­äº«å…ƒ</span><span class="hljs-keyword">type</span> ChessPieceUnit <span class="hljs-keyword">struct</span> &#123;ID    <span class="hljs-keyword">uint</span>Name  <span class="hljs-keyword">string</span>Color <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// NewChessPieceUnit å·¥å‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewChessPieceUnit</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>)</span> *<span class="hljs-title">ChessPieceUnit</span></span> &#123;<span class="hljs-keyword">return</span> units[id]&#125;<span class="hljs-comment">// ChessPiece æ£‹å­</span><span class="hljs-keyword">type</span> ChessPiece <span class="hljs-keyword">struct</span> &#123;Unit *ChessPieceUnitX    <span class="hljs-keyword">int</span>Y    <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// ChessBoard æ£‹å±€</span><span class="hljs-keyword">type</span> ChessBoard <span class="hljs-keyword">struct</span> &#123;chessPieces <span class="hljs-keyword">map</span>[<span class="hljs-keyword">int</span>]*ChessPiece&#125;<span class="hljs-comment">// NewChessBoard åˆå§‹åŒ–æ£‹ç›˜</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewChessBoard</span><span class="hljs-params">()</span> *<span class="hljs-title">ChessBoard</span></span> &#123;board := &amp;ChessBoard&#123;chessPieces: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">int</span>]*ChessPiece&#123;&#125;&#125;<span class="hljs-keyword">for</span> id := <span class="hljs-keyword">range</span> units &#123;board.chessPieces[id] = &amp;ChessPiece&#123;Unit: NewChessPieceUnit(id),X:    <span class="hljs-number">0</span>,Y:    <span class="hljs-number">0</span>,&#125;&#125;<span class="hljs-keyword">return</span> board&#125;<span class="hljs-comment">// Move ç§»åŠ¨æ£‹å­</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *ChessBoard)</span> <span class="hljs-title">Move</span><span class="hljs-params">(id, x, y <span class="hljs-keyword">int</span>)</span></span> &#123;c.chessPieces[id].X = xc.chessPieces[id].Y = y&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> flyweight<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestNewChessBoard</span><span class="hljs-params">(t *testing.T)</span></span> &#123;board1 := NewChessBoard()board1.Move(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)board2 := NewChessBoard()board2.Move(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)assert.Equal(t, board1.chessPieces[<span class="hljs-number">1</span>].Unit, board2.chessPieces[<span class="hljs-number">1</span>].Unit)assert.Equal(t, board1.chessPieces[<span class="hljs-number">2</span>].Unit, board2.chessPieces[<span class="hljs-number">2</span>].Unit)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼11-ç»„åˆæ¨¡å¼</title>
    <link href="/post/composite.html"/>
    <url>/post/composite.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/207456" target="_blank" rel="noopener">53 | ç»„åˆæ¨¡å¼ï¼šå¦‚ä½•è®¾è®¡å®ç°æ”¯æŒé€’å½’éå†çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘ç»“æ„ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 11/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604551967986-02f19644-e8c3-4d13-8f30-4f7eeb1034be.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>å…¬å¸çš„äººå‘˜ç»„ç»‡å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æ ‘çŠ¶çš„ç»“æ„ï¼Œç°åœ¨å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰éƒ¨åˆ†ï¼Œå’Œå‘˜å·¥ï¼Œä¸¤ç§è§’è‰²ï¼Œä¸€ä¸ªéƒ¨é—¨ä¸‹é¢å¯ä»¥å­˜åœ¨å­éƒ¨é—¨å’Œå‘˜å·¥ï¼Œå‘˜å·¥ä¸‹é¢ä¸èƒ½å†åŒ…å«å…¶ä»–èŠ‚ç‚¹ã€‚<br>æˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸€ä¸ªç»Ÿè®¡ä¸€ä¸ªéƒ¨é—¨ä¸‹å‘˜å·¥æ•°é‡çš„åŠŸèƒ½</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> composite<span class="hljs-comment">// IOrganization ç»„ç»‡æ¥å£ï¼Œéƒ½å®ç°ç»Ÿè®¡äººæ•°çš„åŠŸèƒ½</span><span class="hljs-keyword">type</span> IOrganization <span class="hljs-keyword">interface</span> &#123;Count() <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// Employee å‘˜å·¥</span><span class="hljs-keyword">type</span> Employee <span class="hljs-keyword">struct</span> &#123;Name <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// Count äººæ•°ç»Ÿè®¡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(Employee)</span> <span class="hljs-title">Count</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>&#125;<span class="hljs-comment">// Department éƒ¨é—¨</span><span class="hljs-keyword">type</span> Department <span class="hljs-keyword">struct</span> &#123;Name <span class="hljs-keyword">string</span>SubOrganizations []IOrganization&#125;<span class="hljs-comment">// Count äººæ•°ç»Ÿè®¡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d Department)</span> <span class="hljs-title">Count</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;c := <span class="hljs-number">0</span><span class="hljs-keyword">for</span> _, org := <span class="hljs-keyword">range</span> d.SubOrganizations &#123;c += org.Count()&#125;<span class="hljs-keyword">return</span> c&#125;<span class="hljs-comment">// AddSub æ·»åŠ å­èŠ‚ç‚¹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *Department)</span> <span class="hljs-title">AddSub</span><span class="hljs-params">(org IOrganization)</span></span> &#123;d.SubOrganizations = <span class="hljs-built_in">append</span>(d.SubOrganizations, org)&#125;<span class="hljs-comment">// NewOrganization æ„å»ºç»„ç»‡æ¶æ„ demo</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewOrganization</span><span class="hljs-params">()</span> <span class="hljs-title">IOrganization</span></span> &#123;root := &amp;Department&#123;Name: <span class="hljs-string">"root"</span>&#125;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;root.AddSub(&amp;Employee&#123;&#125;)root.AddSub(&amp;Department&#123;Name: <span class="hljs-string">"sub"</span>, SubOrganizations: []IOrganization&#123;&amp;Employee&#123;&#125;&#125;&#125;)&#125;<span class="hljs-keyword">return</span> root&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> composite<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestNewOrganization</span><span class="hljs-params">(t *testing.T)</span></span> &#123;got := NewOrganization().Count()assert.Equal(t, <span class="hljs-number">20</span>, got)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼10-é—¨é¢æ¨¡å¼</title>
    <link href="/post/facade.html"/>
    <url>/post/facade.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/206409" target="_blank" rel="noopener">52 | é—¨é¢æ¨¡å¼ï¼šå¦‚ä½•è®¾è®¡åˆç†çš„æ¥å£ç²’åº¦ä»¥å…¼é¡¾æ¥å£çš„æ˜“ç”¨æ€§å’Œé€šç”¨æ€§ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: /22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1604551910336-ea49926e-a6d4-45e1-aabb-f668fc4309e5.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>å‡è®¾ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œä»¥å‰æœ‰ç™»å½•å’Œæ³¨å†Œçš„æµç¨‹ï¼Œç™»å½•çš„æ—¶å€™è°ƒç”¨ç”¨æˆ·çš„æŸ¥è¯¢æ¥å£ï¼Œæ³¨å†Œæ—¶è°ƒç”¨ç”¨æˆ·çš„åˆ›å»ºæ¥å£ã€‚ä¸ºäº†ç®€åŒ–ç”¨æˆ·çš„ä½¿ç”¨æµç¨‹ï¼Œæˆ‘ä»¬ç°åœ¨æä¾›ç›´æ¥éªŒè¯ç ç™»å½•/æ³¨å†Œçš„åŠŸèƒ½ï¼Œå¦‚æœè¯¥æ‰‹æœºå·å·²æ³¨å†Œé‚£ä¹ˆæˆ‘ä»¬å°±èµ°ç™»å½•æµç¨‹ï¼Œå¦‚æœè¯¥æ‰‹æœºå·æœªæ³¨å†Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ã€‚</p><h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> facade<span class="hljs-comment">// IUser ç”¨æˆ·æ¥å£</span><span class="hljs-keyword">type</span> IUser <span class="hljs-keyword">interface</span> &#123;Login(phone <span class="hljs-keyword">int</span>, code <span class="hljs-keyword">int</span>) (*User, error)Register(phone <span class="hljs-keyword">int</span>, code <span class="hljs-keyword">int</span>) (*User, error)&#125;<span class="hljs-comment">// IUserFacade é—¨é¢æ¨¡å¼</span><span class="hljs-keyword">type</span> IUserFacade <span class="hljs-keyword">interface</span> &#123;LoginOrRegister(phone <span class="hljs-keyword">int</span>, code <span class="hljs-keyword">int</span>) error&#125;<span class="hljs-comment">// User ç”¨æˆ·</span><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;Name <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// UserService UserService</span><span class="hljs-keyword">type</span> UserService <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-comment">// Login ç™»å½•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u UserService)</span> <span class="hljs-title">Login</span><span class="hljs-params">(phone <span class="hljs-keyword">int</span>, code <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(*User, error)</span></span> &#123;<span class="hljs-comment">// æ ¡éªŒæ“ä½œ ...</span><span class="hljs-keyword">return</span> &amp;User&#123;Name: <span class="hljs-string">"test login"</span>&#125;, <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// Register æ³¨å†Œ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u UserService)</span> <span class="hljs-title">Register</span><span class="hljs-params">(phone <span class="hljs-keyword">int</span>, code <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(*User, error)</span></span> &#123;<span class="hljs-comment">// æ ¡éªŒæ“ä½œ ...</span><span class="hljs-comment">// åˆ›å»ºç”¨æˆ·</span><span class="hljs-keyword">return</span> &amp;User&#123;Name: <span class="hljs-string">"test register"</span>&#125;, <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// LoginOrRegister ç™»å½•æˆ–æ³¨å†Œ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u UserService)</span><span class="hljs-title">LoginOrRegister</span><span class="hljs-params">(phone <span class="hljs-keyword">int</span>, code <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(*User, error)</span></span> &#123;user, err := u.Login(phone, code)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err&#125;<span class="hljs-keyword">if</span> user != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> user, <span class="hljs-literal">nil</span>&#125;<span class="hljs-keyword">return</span> u.Register(phone, code)&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> facade<span class="hljs-keyword">import</span> (<span class="hljs-string">"github.com/stretchr/testify/assert"</span><span class="hljs-string">"testing"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserService_Login</span><span class="hljs-params">(t *testing.T)</span></span> &#123;service := UserService&#123;&#125;user, err := service.Login(<span class="hljs-number">13001010101</span>, <span class="hljs-number">1234</span>)assert.NoError(t, err)assert.Equal(t, &amp;User&#123;Name: <span class="hljs-string">"test login"</span>&#125;, user)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserService_LoginOrRegister</span><span class="hljs-params">(t *testing.T)</span></span> &#123;service := UserService&#123;&#125;user, err := service.LoginOrRegister(<span class="hljs-number">13001010101</span>, <span class="hljs-number">1234</span>)assert.NoError(t, err)assert.Equal(t, &amp;User&#123;Name: <span class="hljs-string">"test login"</span>&#125;, user)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserService_Register</span><span class="hljs-params">(t *testing.T)</span></span> &#123;service := UserService&#123;&#125;user, err := service.Register(<span class="hljs-number">13001010101</span>, <span class="hljs-number">1234</span>)assert.NoError(t, err)assert.Equal(t, &amp;User&#123;Name: <span class="hljs-string">"test register"</span>&#125;, user)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼09-é€‚é…å™¨æ¨¡å¼</title>
    <link href="/post/adapter.html"/>
    <url>/post/adapter.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/205912" target="_blank" rel="noopener">51 | é€‚é…å™¨æ¨¡å¼ï¼šä»£ç†ã€é€‚é…å™¨ã€æ¡¥æ¥ã€è£…é¥°ï¼Œè¿™å››ä¸ªæ¨¡å¼æœ‰ä½•åŒºåˆ«ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 09/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1600352298306-7105ca29-089d-4f54-bb65-82d3c0c3b31c.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>å‡è®¾æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªè¿ç»´ç³»ç»Ÿï¼Œéœ€è¦åˆ†åˆ«è°ƒç”¨é˜¿é‡Œäº‘å’Œ AWS çš„ SDK åˆ›å»ºä¸»æœºï¼Œä¸¤ä¸ª SDK æä¾›çš„åˆ›å»ºä¸»æœºçš„æ¥å£ä¸ä¸€è‡´ï¼Œæ­¤æ—¶å°±å¯ä»¥é€šè¿‡é€‚é…å™¨æ¨¡å¼ï¼Œå°†ä¸¤ä¸ªæ¥å£ç»Ÿä¸€ã€‚<br><strong>PSï¼šAWS å’Œ é˜¿é‡Œäº‘çš„æ¥å£çº¯å±è™šæ„ï¼Œæ²¡æœ‰ç›´æ¥ç”¨åŸå§‹çš„ SDKï¼Œåªæ˜¯ä¸¾ä¸ªä¾‹å­</strong></p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> adapter<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-comment">// ICreateServer åˆ›å»ºäº‘ä¸»æœº</span><span class="hljs-keyword">type</span> ICreateServer <span class="hljs-keyword">interface</span> &#123;CreateServer(cpu, mem <span class="hljs-keyword">float64</span>) error&#125;<span class="hljs-comment">// AWSClient aws sdk</span><span class="hljs-keyword">type</span> AWSClient <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// RunInstance å¯åŠ¨å®ä¾‹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *AWSClient)</span> <span class="hljs-title">RunInstance</span><span class="hljs-params">(cpu, mem <span class="hljs-keyword">float64</span>)</span> <span class="hljs-title">error</span></span> &#123;fmt.Printf(<span class="hljs-string">"aws client run success, cpuï¼š %f, mem: %f"</span>, cpu, mem)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// AwsClientAdapter é€‚é…å™¨</span><span class="hljs-keyword">type</span> AwsClientAdapter <span class="hljs-keyword">struct</span> &#123;Client AWSClient&#125;<span class="hljs-comment">// CreateServer å¯åŠ¨å®ä¾‹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *AwsClientAdapter)</span> <span class="hljs-title">CreateServer</span><span class="hljs-params">(cpu, mem <span class="hljs-keyword">float64</span>)</span> <span class="hljs-title">error</span></span> &#123;a.Client.RunInstance(cpu, mem)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// AliyunClient aliyun sdk</span><span class="hljs-keyword">type</span> AliyunClient <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// CreateServer å¯åŠ¨å®ä¾‹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *AliyunClient)</span> <span class="hljs-title">CreateServer</span><span class="hljs-params">(cpu, mem <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;fmt.Printf(<span class="hljs-string">"aws client run success, cpuï¼š %d, mem: %d"</span>, cpu, mem)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// AliyunClientAdapter é€‚é…å™¨</span><span class="hljs-keyword">type</span> AliyunClientAdapter <span class="hljs-keyword">struct</span> &#123;Client AliyunClient&#125;<span class="hljs-comment">// CreateServer å¯åŠ¨å®ä¾‹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *AliyunClientAdapter)</span> <span class="hljs-title">CreateServer</span><span class="hljs-params">(cpu, mem <span class="hljs-keyword">float64</span>)</span> <span class="hljs-title">error</span></span> &#123;a.Client.CreateServer(<span class="hljs-keyword">int</span>(cpu), <span class="hljs-keyword">int</span>(mem))<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> adapter<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestAliyunClientAdapter_CreateServer</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-comment">// ç¡®ä¿ adapter å®ç°äº†ç›®æ ‡æ¥å£</span><span class="hljs-keyword">var</span> a ICreateServer = &amp;AliyunClientAdapter&#123;Client: AliyunClient&#123;&#125;,&#125;a.CreateServer(<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestAwsClientAdapter_CreateServer</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-comment">// ç¡®ä¿ adapter å®ç°äº†ç›®æ ‡æ¥å£</span><span class="hljs-keyword">var</span> a ICreateServer = &amp;AwsClientAdapter&#123;Client: AWSClient&#123;&#125;,&#125;a.CreateServer(<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼08-è£…é¥°å™¨æ¨¡å¼</title>
    <link href="/post/decorator.html"/>
    <url>/post/decorator.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/204845" target="_blank" rel="noopener">50 | è£…é¥°å™¨æ¨¡å¼ï¼šé€šè¿‡å‰–æ Java IO ç±»åº“æºç å­¦ä¹ è£…é¥°å™¨æ¨¡å¼</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 08/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1599665456992-83f8ee96-e608-492d-9390-c08cab4fa0cb.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç”»ç”»çš„ä¾‹å­ï¼Œé»˜è®¤çš„ <code>Square</code> åªæœ‰åŸºç¡€çš„ç”»ç”»åŠŸèƒ½ï¼Œ <code>ColorSquare</code> ä¸ºä»–åŠ ä¸Šäº†é¢œè‰²</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> decorator<span class="hljs-comment">// IDraw IDraw</span><span class="hljs-keyword">type</span> IDraw <span class="hljs-keyword">interface</span> &#123;Draw() <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// Square æ­£æ–¹å½¢</span><span class="hljs-keyword">type</span> Square <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Draw Draw</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s Square)</span> <span class="hljs-title">Draw</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">"this is a square"</span>&#125;<span class="hljs-comment">// ColorSquare æœ‰é¢œè‰²çš„æ­£æ–¹å½¢</span><span class="hljs-keyword">type</span> ColorSquare <span class="hljs-keyword">struct</span> &#123;square IDrawcolor  <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// NewColorSquare NewColorSquare</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewColorSquare</span><span class="hljs-params">(square IDraw, color <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">ColorSquare</span></span> &#123;<span class="hljs-keyword">return</span> ColorSquare&#123;color: color, square: square&#125;&#125;<span class="hljs-comment">// Draw Draw</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c ColorSquare)</span> <span class="hljs-title">Draw</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">return</span> c.square.Draw() + <span class="hljs-string">", color is "</span> + c.color&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestColorSquare_Draw</span><span class="hljs-params">(t *testing.T)</span></span> &#123;sq := Square&#123;&#125;csq := NewColorSquare(sq, <span class="hljs-string">"red"</span>)got := csq.Draw()assert.Equal(t, <span class="hljs-string">"this is a square, color is red"</span>, got)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼07-æ¡¥æ¥æ¨¡å¼</title>
    <link href="/post/bridge.html"/>
    <url>/post/bridge.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/202786" target="_blank" rel="noopener">49 | æ¡¥æ¥æ¨¡å¼ï¼šå¦‚ä½•å®ç°æ”¯æŒä¸åŒç±»å‹å’Œæ¸ é“çš„æ¶ˆæ¯æ¨é€ç³»ç»Ÿï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 07/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1599580037511-2ca9ca33-6990-417a-8a3d-735d16c4b284.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> bridge<span class="hljs-comment">// IMsgSender IMsgSender</span><span class="hljs-keyword">type</span> IMsgSender <span class="hljs-keyword">interface</span> &#123;Send(msg <span class="hljs-keyword">string</span>) error&#125;<span class="hljs-comment">// EmailMsgSender å‘é€é‚®ä»¶</span><span class="hljs-comment">// å¯èƒ½è¿˜æœ‰ ç”µè¯ã€çŸ­ä¿¡ç­‰å„ç§å®ç°</span><span class="hljs-keyword">type</span> EmailMsgSender <span class="hljs-keyword">struct</span> &#123;emails []<span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// NewEmailMsgSender NewEmailMsgSender</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewEmailMsgSender</span><span class="hljs-params">(emails []<span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">EmailMsgSender</span></span> &#123;<span class="hljs-keyword">return</span> &amp;EmailMsgSender&#123;emails: emails&#125;&#125;<span class="hljs-comment">// Send Send</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *EmailMsgSender)</span> <span class="hljs-title">Send</span><span class="hljs-params">(msg <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-comment">// è¿™é‡Œå»å‘é€æ¶ˆæ¯</span><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// INotification é€šçŸ¥æ¥å£</span><span class="hljs-keyword">type</span> INotification <span class="hljs-keyword">interface</span> &#123;Notify(msg <span class="hljs-keyword">string</span>) error&#125;<span class="hljs-comment">// ErrorNotification é”™è¯¯é€šçŸ¥</span><span class="hljs-comment">// åé¢å¯èƒ½è¿˜æœ‰ warning å„ç§çº§åˆ«</span><span class="hljs-keyword">type</span> ErrorNotification <span class="hljs-keyword">struct</span> &#123;sender IMsgSender&#125;<span class="hljs-comment">// NewErrorNotification NewErrorNotification</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewErrorNotification</span><span class="hljs-params">(sender IMsgSender)</span> *<span class="hljs-title">ErrorNotification</span></span> &#123;<span class="hljs-keyword">return</span> &amp;ErrorNotification&#123;sender: sender&#125;&#125;<span class="hljs-comment">// Notify å‘é€é€šçŸ¥</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *ErrorNotification)</span> <span class="hljs-title">Notify</span><span class="hljs-params">(msg <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> n.sender.Send(msg)&#125;</code></pre><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestErrorNotification_Notify</span><span class="hljs-params">(t *testing.T)</span></span> &#123;sender := NewEmailMsgSender([]<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">"test@test.com"</span>&#125;)n := NewErrorNotification(sender)err := n.Notify(<span class="hljs-string">"test msg"</span>)assert.Nil(t, err)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼06-ä»£ç†æ¨¡å¼(generateå®ç°ç±»ä¼¼åŠ¨æ€ä»£ç†)</title>
    <link href="/post/proxy.html"/>
    <url>/post/proxy.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/201823" target="_blank" rel="noopener">48 | ä»£ç†æ¨¡å¼ï¼šä»£ç†åœ¨ RPCã€ç¼“å­˜ã€ç›‘æ§ç­‰åœºæ™¯ä¸­çš„åº”ç”¨</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 06/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1599405885948-ab2a5ede-bd05-49bd-a20d-6afea89e74c3.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>æ¥ä¸‹æ¥ä¼šé€šè¿‡ golang å®ç°é™æ€ä»£ç†ï¼Œæœ‰ Golang å’Œ java çš„å·®å¼‚æ€§ï¼Œæˆ‘ä»¬æ— æ³•æ¯”è¾ƒæ–¹ä¾¿çš„åˆ©ç”¨åå°„å®ç°åŠ¨æ€ä»£ç†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong> go generate </strong>å®ç°ç±»ä¼¼çš„æ•ˆæœï¼Œå¹¶ä¸”è¿™æ ·å®ç°æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„å¥½å¤„ï¼Œä¸€ä¸ªæ˜¯æœ‰é™æ€ä»£ç æ£€æŸ¥ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥åŠæ—©å‘ç°é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯æ€§èƒ½ä¼šæ›´å¥½ã€‚</p><h3 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h3><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> proxy<span class="hljs-keyword">import</span> (<span class="hljs-string">"log"</span><span class="hljs-string">"time"</span>)<span class="hljs-comment">// IUser IUser</span><span class="hljs-keyword">type</span> IUser <span class="hljs-keyword">interface</span> &#123;Login(username, password <span class="hljs-keyword">string</span>) error&#125;<span class="hljs-comment">// User ç”¨æˆ·</span><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-comment">// Login ç”¨æˆ·ç™»å½•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span> <span class="hljs-title">Login</span><span class="hljs-params">(username, password <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-comment">// ä¸å®ç°ç»†èŠ‚</span><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// UserProxy ä»£ç†ç±»</span><span class="hljs-keyword">type</span> UserProxy <span class="hljs-keyword">struct</span> &#123;user *User&#125;<span class="hljs-comment">// NewUserProxy NewUserProxy</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserProxy</span><span class="hljs-params">(user *User)</span> *<span class="hljs-title">UserProxy</span></span> &#123;<span class="hljs-keyword">return</span> &amp;UserProxy&#123;user: user,&#125;&#125;<span class="hljs-comment">// Login ç™»å½•ï¼Œå’Œ user å®ç°ç›¸åŒçš„æ¥å£</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *UserProxy)</span> <span class="hljs-title">Login</span><span class="hljs-params">(username, password <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-comment">// before è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€äº›ç»Ÿè®¡çš„é€»è¾‘</span>start := time.Now()<span class="hljs-comment">// è¿™é‡Œæ˜¯åŸæœ‰çš„ä¸šåŠ¡é€»è¾‘</span><span class="hljs-keyword">if</span> err := p.user.Login(username, password); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err&#125;<span class="hljs-comment">// after è¿™é‡Œå¯èƒ½ä¹Ÿæœ‰ä¸€äº›ç›‘æ§ç»Ÿè®¡çš„é€»è¾‘</span>log.Printf(<span class="hljs-string">"user login cost time: %s"</span>, time.Now().Sub(start))<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> proxy<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/require"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserProxy_Login</span><span class="hljs-params">(t *testing.T)</span></span> &#123;proxy := NewUserProxy(&amp;User&#123;&#125;)err := proxy.Login(<span class="hljs-string">"test"</span>, <span class="hljs-string">"password"</span>)require.Nil(t, err)&#125;</code></pre><h3 id="Go-Generate-å®ç°-â€œåŠ¨æ€ä»£ç†â€"><a href="#Go-Generate-å®ç°-â€œåŠ¨æ€ä»£ç†â€" class="headerlink" title="Go Generate å®ç° â€œåŠ¨æ€ä»£ç†â€"></a>Go Generate å®ç° â€œåŠ¨æ€ä»£ç†â€</h3><p>å…³äº go generate ä¹‹å‰å·²ç»å†™è¿‡ä¸€ç¯‡å…¥é—¨çš„ä»‹ç»æ–‡ç« : <a href="https://lailin.xyz/post/41140.html">go generate and ast</a>ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œå¦‚æœå¯¹ç›¸å…³çš„çŸ¥è¯†ç‚¹ä¸å¤ªæ¸…æ¥šï¼Œå¯ä»¥å…ˆçœ‹å‰é¢çš„é‚£ç¯‡æ–‡ç« ã€‚<br><strong>æ³¨æ„: åœ¨çœŸå®çš„é¡¹ç›®ä¸­å¹¶ä¸æ¨èè¿™ä¹ˆåšï¼Œå› ä¸ºæœ‰ç‚¹å¾—ä¸å¿å¤±ï¼Œæœ¬æ–‡åªæ˜¯åœ¨æ¢è®¨ä¸€ç§å¯èƒ½æ€§ï¼Œå¹¶ä¸”å¯ä»¥å¤ä¹ ä¸€ä¸‹ go è¯­æ³•æ ‘å…ˆå…³çš„çŸ¥è¯†ç‚¹</strong><br>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹éœ€æ±‚ã€‚</p><h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><p>åŠ¨æ€ä»£ç†ç›¸æ¯”é™æ€ä»£ç†ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³ç”Ÿäº§åŠ›ï¼Œå°†æˆ‘ä»¬ä»ç¹æ‚çš„é‡å¤åŠ³åŠ¨ä¸­è§£æ”¾å‡ºæ¥ï¼Œæ­£å¥½ï¼Œåœ¨ Go ä¸­ Generate ä¹Ÿæ˜¯å¹²è¿™ä¸ªæ´»çš„<br>å¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„ generate ä¼šè¯»å– struct ä¸Šçš„æ³¨é‡Šï¼Œå¦‚æœå‡ºç° <code>@proxy æ¥å£å</code> çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å°±ä¼šä¸ºè¿™ä¸ª struct ç”Ÿæˆä¸€ä¸ª proxy ç±»ï¼ŒåŒæ—¶å®ç°ç›¸åŒçš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£å°±æ˜¯åœ¨æ³¨é‡Šä¸­æŒ‡å®šçš„æ¥å£</p><pre><code class="hljs go"><span class="hljs-comment">// User ç”¨æˆ·</span><span class="hljs-comment">// @proxy IUser</span><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;&#125;</code></pre><h4 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h4><p>æ¥æ¥ä¸‹æˆ‘ä»¬ä¼šç®€å•çš„å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œç”±äºç¯‡å¹…å’Œæ—¶é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬ä¼šç•¥è¿‡ä¸€äº›æ£€æŸ¥ä¹‹ç±»çš„ä»£ç ï¼Œä¾‹å¦‚ <code>User</code> æ˜¯å¦çœŸæ­£å®ç°äº† <code>IUser</code> è¿™ç§æƒ…å†µã€‚<br><strong>ä»£ç æœ‰ç‚¹é•¿ï¼Œä¸»è¦æ€è·¯:</strong></p><ul><li>è¯»å–æ–‡ä»¶, è·å–æ–‡ä»¶çš„ ast è¯­æ³•æ ‘</li><li>é€šè¿‡ NewCommentMap æ„å»º node å’Œ comment çš„å…³ç³»</li><li>é€šè¿‡ comment æ˜¯å¦åŒ…å« <code>@proxy æ¥å£å</code> çš„æ¥å£ï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦éœ€è¦ç”Ÿæˆä»£ç†ç±»</li><li>é€šè¿‡ Lookup æ–¹æ³•æ‰¾åˆ°æ¥å£</li><li>å¾ªç¯è·å–æ¥å£çš„æ¯ä¸ªæ–¹æ³•çš„ï¼Œæ–¹æ³•åã€å‚æ•°ã€è¿”å›å€¼ä¿¡æ¯</li><li>å°†æ–¹æ³•ä¿¡æ¯ï¼ŒåŒ…åã€éœ€è¦ä»£ç†ç±»åä¼ é€’ç»™æ„å»ºå¥½çš„æ¨¡æ¿æ–‡ä»¶ï¼Œç”Ÿæˆä»£ç†ç±»</li><li>æœ€åç”¨ format åŒ…çš„æ–¹æ³•æ ¼å¼åŒ–æºä»£ç </li></ul><pre><code class="hljs go"><span class="hljs-keyword">package</span> proxy<span class="hljs-keyword">import</span> (<span class="hljs-string">"bytes"</span><span class="hljs-string">"fmt"</span><span class="hljs-string">"go/ast"</span><span class="hljs-string">"go/format"</span><span class="hljs-string">"go/parser"</span><span class="hljs-string">"go/token"</span><span class="hljs-string">"strings"</span><span class="hljs-string">"text/template"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">generate</span><span class="hljs-params">(file <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(<span class="hljs-keyword">string</span>, error)</span></span> &#123;fset := token.NewFileSet() <span class="hljs-comment">// positions are relative to fset</span>f, err := parser.ParseFile(fset, file, <span class="hljs-literal">nil</span>, parser.ParseComments)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err&#125;<span class="hljs-comment">// è·å–ä»£ç†éœ€è¦çš„æ•°æ®</span>data := proxyData&#123;Package: f.Name.Name,&#125;<span class="hljs-comment">// æ„å»ºæ³¨é‡Šå’Œ node çš„å…³ç³»</span>cmap := ast.NewCommentMap(fset, f, f.Comments)<span class="hljs-keyword">for</span> node, group := <span class="hljs-keyword">range</span> cmap &#123;<span class="hljs-comment">// ä»æ³¨é‡Š @proxy æ¥å£åï¼Œè·å–æ¥å£åç§°</span>name := getProxyInterfaceName(group)<span class="hljs-keyword">if</span> name == <span class="hljs-string">""</span> &#123;<span class="hljs-keyword">continue</span>&#125;<span class="hljs-comment">// è·å–ä»£ç†çš„ç±»å</span>data.ProxyStructName = node.(*ast.GenDecl).Specs[<span class="hljs-number">0</span>].(*ast.TypeSpec).Name.Name<span class="hljs-comment">// ä»æ–‡ä»¶ä¸­æŸ¥æ‰¾æ¥å£</span>obj := f.Scope.Lookup(name)<span class="hljs-comment">// ç±»å‹è½¬æ¢ï¼Œæ³¨æ„: è¿™é‡Œæ²¡æœ‰å¯¹æ–­è¨€è¿›è¡Œåˆ¤æ–­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ panic</span>t := obj.Decl.(*ast.TypeSpec).Type.(*ast.InterfaceType)<span class="hljs-keyword">for</span> _, field := <span class="hljs-keyword">range</span> t.Methods.List &#123;fc := field.Type.(*ast.FuncType)<span class="hljs-comment">// ä»£ç†çš„æ–¹æ³•</span>method := &amp;proxyMethod&#123;Name: field.Names[<span class="hljs-number">0</span>].Name,&#125;<span class="hljs-comment">// è·å–æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼</span>method.Params, method.ParamNames = getParamsOrResults(fc.Params)method.Results, method.ResultNames = getParamsOrResults(fc.Results)data.Methods = <span class="hljs-built_in">append</span>(data.Methods, method)&#125;&#125;<span class="hljs-comment">// ç”Ÿæˆæ–‡ä»¶</span>tpl, err := template.New(<span class="hljs-string">""</span>).Parse(proxyTpl)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err&#125;buf := &amp;bytes.Buffer&#123;&#125;<span class="hljs-keyword">if</span> err := tpl.Execute(buf, data); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err&#125;<span class="hljs-comment">// ä½¿ç”¨ go fmt å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ ¼å¼åŒ–</span>src, err := format.Source(buf.Bytes())<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err&#125;<span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(src), <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// getParamsOrResults è·å–å‚æ•°æˆ–è€…æ˜¯è¿”å›å€¼</span><span class="hljs-comment">// è¿”å›å¸¦ç±»å‹çš„å‚æ•°ï¼Œä»¥åŠä¸å¸¦ç±»å‹çš„å‚æ•°ï¼Œä»¥é€—å·é—´éš”</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getParamsOrResults</span><span class="hljs-params">(fields *ast.FieldList)</span> <span class="hljs-params">(<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>)</span></span> &#123;<span class="hljs-keyword">var</span> (params     []<span class="hljs-keyword">string</span>paramNames []<span class="hljs-keyword">string</span>)<span class="hljs-keyword">for</span> i, param := <span class="hljs-keyword">range</span> fields.List &#123;<span class="hljs-comment">// å¾ªç¯è·å–æ‰€æœ‰çš„å‚æ•°å</span><span class="hljs-keyword">var</span> names []<span class="hljs-keyword">string</span><span class="hljs-keyword">for</span> _, name := <span class="hljs-keyword">range</span> param.Names &#123;names = <span class="hljs-built_in">append</span>(names, name.Name)&#125;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(names) == <span class="hljs-number">0</span> &#123;names = <span class="hljs-built_in">append</span>(names, fmt.Sprintf(<span class="hljs-string">"r%d"</span>, i))&#125;paramNames = <span class="hljs-built_in">append</span>(paramNames, names...)<span class="hljs-comment">// å‚æ•°ååŠ å‚æ•°ç±»å‹ç»„æˆå®Œæ•´çš„å‚æ•°</span>param := fmt.Sprintf(<span class="hljs-string">"%s %s"</span>,strings.Join(names, <span class="hljs-string">","</span>),param.Type.(*ast.Ident).Name,)params = <span class="hljs-built_in">append</span>(params, strings.TrimSpace(param))&#125;<span class="hljs-keyword">return</span> strings.Join(params, <span class="hljs-string">","</span>), strings.Join(paramNames, <span class="hljs-string">","</span>)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getProxyInterfaceName</span><span class="hljs-params">(groups []*ast.CommentGroup)</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">for</span> _, commentGroup := <span class="hljs-keyword">range</span> groups &#123;<span class="hljs-keyword">for</span> _, comment := <span class="hljs-keyword">range</span> commentGroup.List &#123;<span class="hljs-keyword">if</span> strings.Contains(comment.Text, <span class="hljs-string">"@proxy"</span>) &#123;interfaceName := strings.TrimLeft(comment.Text, <span class="hljs-string">"// @proxy "</span>)<span class="hljs-keyword">return</span> strings.TrimSpace(interfaceName)&#125;&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>&#125;<span class="hljs-comment">// ç”Ÿæˆä»£ç†ç±»çš„æ–‡ä»¶æ¨¡æ¿</span><span class="hljs-keyword">const</span> proxyTpl = <span class="hljs-string">`package &#123;&#123;.Package&#125;&#125;type &#123;&#123; .ProxyStructName &#125;&#125;Proxy struct &#123;child *&#123;&#123; .ProxyStructName &#125;&#125;&#125;func New&#123;&#123; .ProxyStructName &#125;&#125;Proxy(child *&#123;&#123; .ProxyStructName &#125;&#125;) *&#123;&#123; .ProxyStructName &#125;&#125;Proxy &#123;return &amp;&#123;&#123; .ProxyStructName &#125;&#125;Proxy&#123;child: child&#125;&#125;&#123;&#123; range .Methods &#125;&#125;func (p *&#123;&#123;$.ProxyStructName&#125;&#125;Proxy) &#123;&#123; .Name &#125;&#125; (&#123;&#123; .Params &#125;&#125;) (&#123;&#123; .Results &#125;&#125;) &#123;// before è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€äº›ç»Ÿè®¡çš„é€»è¾‘start := time.Now()&#123;&#123; .ResultNames &#125;&#125; = p.child.&#123;&#123; .Name &#125;&#125;(&#123;&#123; .ParamNames &#125;&#125;)// after è¿™é‡Œå¯èƒ½ä¹Ÿæœ‰ä¸€äº›ç›‘æ§ç»Ÿè®¡çš„é€»è¾‘log.Printf("user login cost time: %s", time.Now().Sub(start))return &#123;&#123; .ResultNames &#125;&#125;&#125;&#123;&#123; end &#125;&#125;`</span><span class="hljs-keyword">type</span> proxyData <span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">// åŒ…å</span>Package <span class="hljs-keyword">string</span><span class="hljs-comment">// éœ€è¦ä»£ç†çš„ç±»å</span>ProxyStructName <span class="hljs-keyword">string</span><span class="hljs-comment">// éœ€è¦ä»£ç†çš„æ–¹æ³•</span>Methods []*proxyMethod&#125;<span class="hljs-comment">// proxyMethod ä»£ç†çš„æ–¹æ³•</span><span class="hljs-keyword">type</span> proxyMethod <span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">// æ–¹æ³•å</span>Name <span class="hljs-keyword">string</span><span class="hljs-comment">// å‚æ•°ï¼Œå«å‚æ•°ç±»å‹</span>Params <span class="hljs-keyword">string</span><span class="hljs-comment">// å‚æ•°å</span>ParamNames <span class="hljs-keyword">string</span><span class="hljs-comment">// è¿”å›å€¼</span>Results <span class="hljs-keyword">string</span><span class="hljs-comment">// è¿”å›å€¼å</span>ResultNames <span class="hljs-keyword">string</span>&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•-1"><a href="#å•å…ƒæµ‹è¯•-1" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> proxy<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span><span class="hljs-string">"github.com/stretchr/testify/require"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Test_generate</span><span class="hljs-params">(t *testing.T)</span></span> &#123;want := <span class="hljs-string">`package proxytype UserProxy struct &#123;child *User&#125;func NewUserProxy(child *User) *UserProxy &#123;return &amp;UserProxy&#123;child: child&#125;&#125;func (p *UserProxy) Login(username, password string) (r0 error) &#123;// before è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€äº›ç»Ÿè®¡çš„é€»è¾‘start := time.Now()r0 = p.child.Login(username, password)// after è¿™é‡Œå¯èƒ½ä¹Ÿæœ‰ä¸€äº›ç›‘æ§ç»Ÿè®¡çš„é€»è¾‘log.Printf("user login cost time: %s", time.Now().Sub(start))return r0&#125;`</span>got, err := generate(<span class="hljs-string">"./static_proxy.go"</span>)require.Nil(t, err)assert.Equal(t, want, got)&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼05-åˆ›å»ºå‹æ¨¡å¼æ€»ç»“</title>
    <link href="/post/go-design-pattern-create.html"/>
    <url>/post/go-design-pattern-create.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å« 23 ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 05/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è€—æ—¶ 2 å‘¨æ›´æ–°å®Œäº†åˆ›å»ºå‹çš„è®¾è®¡æ¨¡å¼ï¼Œå›å¤´æ€è€ƒä¸€ä¸‹ï¼Œå­¦ä¹ è®¾è®¡æ¨¡å¼æˆ‘ä»¬å…³æ³¨çš„æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å®ç°ä¹ˆï¼Ÿæ˜¯ä¹Ÿä¸æ˜¯ã€‚æˆ‘è®¤ä¸ºæ¯”äº†è§£å¦‚ä½•å®ç°è®¾è®¡æ¨¡å¼æ›´é‡è¦çš„æ˜¯è¿™äº›è®¾è®¡æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼Œä»€ä¹ˆåœºæ™¯ä¸‹æˆ‘ä»¬è¯¥ç”¨è¿™ç§è®¾è®¡æ¨¡å¼ï¼›ä»¥åŠè¿™äº›è®¾è®¡æ¨¡å¼æ‰€åŒ…å«çš„æ€æƒ³ï¼Œæœ€ç»ˆå¸®åŠ©æˆ‘ä»¬æŠŠä»£ç å†™â€œå¥½â€ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ»¡è¶³ä¸€ç³»åˆ—çš„è®¾è®¡åŸåˆ™ï¼š</p><ul><li>å•ä¸€èŒè´£</li><li>å¼€é—­åŸåˆ™</li><li>é‡Œå¼æ›¿æ¢</li><li>æ¥å£éš”ç¦»</li><li>ä¾èµ–å€’ç½®</li><li>KISS</li><li>DRYï¼šä¸è¦é‡å¤</li><li>é«˜å†…èšã€æ¾è€¦åˆ</li><li>è¿ªç±³ç‰¹æ³•åˆ™: ä¸è¦ä¾èµ–ç±»ï¼Œä¾èµ–æ¥å£</li><li><p>â€¦â€¦<br><img src="https://lailin.xyz/images/1599038480370-ac7b0eef-eaf3-4f6b-bd53-0b464aa591da.png" srcset="/img/loading.gif" alt><strong>å…·ä½“å®ç°å¯ä»¥æŸ¥çœ‹ä¹‹å‰æ›´æ–°çš„æ–‡ç« </strong></p></li><li><p><a href="https://lailin.xyz/post/singleton.html">å•ä¾‹æ¨¡å¼</a></p><ul><li>é¥¿æ±‰å¼</li><li>æ‡’æ±‰å¼</li></ul></li><li><a href="https://lailin.xyz/post/factory.html">å·¥å‚æ¨¡å¼</a><ul><li>ç®€å•å·¥å‚</li><li>å·¥å‚æ–¹æ³•</li><li>æŠ½è±¡å·¥å‚</li><li>DI å®¹å™¨</li></ul></li><li><a href="https://lailin.xyz/post/builder.html">å»ºé€ è€…æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/prototype.html">åŸå‹æ¨¡å¼</a></li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼04-åŸå‹æ¨¡å¼</title>
    <link href="/post/prototype.html"/>
    <url>/post/prototype.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/200786" target="_blank" rel="noopener">47 | åŸå‹æ¨¡å¼ï¼šå¦‚ä½•æœ€å¿«é€Ÿåœ° clone ä¸€ä¸ª HashMap æ•£åˆ—è¡¨ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 04/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1599027192070-e11cb300-094a-487c-9ab4-448a093dcc91.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><ul><li>è¿™ä¸ªæ¨¡å¼åœ¨ Javaã€C++ è¿™ç§é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸å¤ªå¸¸ç”¨ï¼Œä½†æ˜¯å¦‚æœå¤§å®¶ä½¿ç”¨è¿‡ javascript çš„è¯å°±ä¼šéå¸¸ç†Ÿæ‚‰äº†ï¼Œå› ä¸º js æœ¬èº«æ˜¯åŸºäºåŸå‹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€ä»¥åŸå‹æ¨¡å¼åœ¨ js ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</li><li>æ¥ä¸‹æ¥ä¼šæŒ‰ç…§ä¸€ä¸ªç±»ä¼¼è¯¾ç¨‹ä¸­çš„ä¾‹å­ä½¿ç”¨æ·±æ‹·è´å’Œæµ…æ‹·è´ç»“åˆçš„æ–¹å¼è¿›è¡Œå®ç°</li><li>éœ€æ±‚: å‡è®¾ç°åœ¨æ•°æ®åº“ä¸­æœ‰å¤§é‡æ•°æ®ï¼ŒåŒ…å«äº†å…³é”®è¯ï¼Œå…³é”®è¯è¢«æœç´¢çš„æ¬¡æ•°ç­‰ä¿¡æ¯ï¼Œæ¨¡å— A ä¸ºäº†ä¸šåŠ¡éœ€è¦<ul><li>ä¼šåœ¨å¯åŠ¨æ—¶åŠ è½½è¿™éƒ¨åˆ†æ•°æ®åˆ°å†…å­˜ä¸­</li><li>å¹¶ä¸”éœ€è¦å®šæ—¶æ›´æ–°é‡Œé¢çš„æ•°æ®</li><li>åŒæ—¶å±•ç¤ºç»™ç”¨æˆ·çš„æ•°æ®æ¯æ¬¡å¿…é¡»è¦æ˜¯ç›¸åŒç‰ˆæœ¬çš„æ•°æ®ï¼Œä¸èƒ½ä¸€éƒ¨åˆ†æ•°æ®æ¥è‡ªç‰ˆæœ¬ 1 ä¸€éƒ¨åˆ†æ¥è‡ªç‰ˆæœ¬ 2</li></ul></li></ul><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> prototype<span class="hljs-keyword">import</span> (<span class="hljs-string">"encoding/json"</span><span class="hljs-string">"time"</span>)<span class="hljs-comment">// Keyword æœç´¢å…³é”®å­—</span><span class="hljs-keyword">type</span> Keyword <span class="hljs-keyword">struct</span> &#123;word      <span class="hljs-keyword">string</span>visit     <span class="hljs-keyword">int</span>UpdatedAt *time.Time&#125;<span class="hljs-comment">// Clone è¿™é‡Œä½¿ç”¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ–¹å¼æ·±æ‹·è´</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(k *Keyword)</span> <span class="hljs-title">Clone</span><span class="hljs-params">()</span> *<span class="hljs-title">Keyword</span></span> &#123;<span class="hljs-keyword">var</span> newKeyword Keywordb, _ := json.Marshal(k)json.Unmarshal(b, &amp;newKeyword)<span class="hljs-keyword">return</span> &amp;newKeyword&#125;<span class="hljs-comment">// Keywords å…³é”®å­— map</span><span class="hljs-keyword">type</span> Keywords <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*Keyword<span class="hljs-comment">// Clone å¤åˆ¶ä¸€ä¸ªæ–°çš„ keywords</span><span class="hljs-comment">// updatedWords: éœ€è¦æ›´æ–°çš„å…³é”®è¯åˆ—è¡¨ï¼Œç”±äºä»æ•°æ®åº“ä¸­è·å–æ•°æ®å¸¸å¸¸æ˜¯æ•°ç»„çš„æ–¹å¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(words Keywords)</span> <span class="hljs-title">Clone</span><span class="hljs-params">(updatedWords []*Keyword)</span> <span class="hljs-title">Keywords</span></span> &#123;newKeywords := Keywords&#123;&#125;<span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> words &#123;<span class="hljs-comment">// è¿™é‡Œæ˜¯æµ…æ‹·è´ï¼Œç›´æ¥æ‹·è´äº†åœ°å€</span>newKeywords[k] = v&#125;<span class="hljs-comment">// æ›¿æ¢æ‰éœ€è¦æ›´æ–°çš„å­—æ®µï¼Œè¿™é‡Œç”¨çš„æ˜¯æ·±æ‹·è´</span><span class="hljs-keyword">for</span> _, word := <span class="hljs-keyword">range</span> updatedWords &#123;newKeywords[word.word] = word.Clone()&#125;<span class="hljs-keyword">return</span> newKeywords&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> prototype<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"time"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestKeywords_Clone</span><span class="hljs-params">(t *testing.T)</span></span> &#123;updateAt, _ := time.Parse(<span class="hljs-string">"2006"</span>, <span class="hljs-string">"2020"</span>)words := Keywords&#123;<span class="hljs-string">"testA"</span>: &amp;Keyword&#123;word:      <span class="hljs-string">"testA"</span>,visit:     <span class="hljs-number">1</span>,UpdatedAt: &amp;updateAt,&#125;,<span class="hljs-string">"testB"</span>: &amp;Keyword&#123;word:      <span class="hljs-string">"testB"</span>,visit:     <span class="hljs-number">2</span>,UpdatedAt: &amp;updateAt,&#125;,<span class="hljs-string">"testC"</span>: &amp;Keyword&#123;word:      <span class="hljs-string">"testC"</span>,visit:     <span class="hljs-number">3</span>,UpdatedAt: &amp;updateAt,&#125;,&#125;now := time.Now()updatedWords := []*Keyword&#123;&#123;word:      <span class="hljs-string">"testB"</span>,visit:     <span class="hljs-number">10</span>,UpdatedAt: &amp;now,&#125;,&#125;got := words.Clone(updatedWords)assert.Equal(t, words[<span class="hljs-string">"testA"</span>], got[<span class="hljs-string">"testA"</span>])assert.NotEqual(t, words[<span class="hljs-string">"testB"</span>], got[<span class="hljs-string">"testB"</span>])assert.NotEqual(t, updatedWords[<span class="hljs-number">0</span>], got[<span class="hljs-string">"testB"</span>])assert.Equal(t, words[<span class="hljs-string">"testC"</span>], got[<span class="hljs-string">"testC"</span>])&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼03-å»ºé€ è€…æ¨¡å¼</title>
    <link href="/post/builder.html"/>
    <url>/post/builder.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å«å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/199674" target="_blank" rel="noopener">46 | å»ºé€ è€…æ¨¡å¼ï¼šè¯¦è§£æ„é€ å‡½æ•°ã€set æ–¹æ³•ã€å»ºé€ è€…æ¨¡å¼ä¸‰ç§å¯¹è±¡åˆ›å»ºæ–¹å¼</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 03/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>å…³æ³¨æˆ‘ï¼Œè·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a>**</li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1599021006655-090c9fbc-fb5a-4c7c-ad23-a0d0a3e1ab65.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>å…¶å®åœ¨ Golang ä¸­å¯¹äºåˆ›å»ºç±»å‚æ•°æ¯”è¾ƒå¤šçš„å¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸è§çš„åšæ³•æ˜¯å¿…å¡«å‚æ•°ç›´æ¥ä¼ é€’ï¼Œå¯é€‰å‚æ•°é€šè¿‡ä¼ é€’å¯å˜çš„æ–¹æ³•è¿›è¡Œåˆ›å»ºã€‚<br>æœ¬æ–‡ä¼šå…ˆå®ç°è¯¾ç¨‹ä¸­çš„å»ºé€ è€…æ¨¡å¼ï¼Œç„¶åå†å®ç°æˆ‘ä»¬å¸¸ç”¨çš„æ–¹å¼ã€‚</p><h3 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h3><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>é€šè¿‡ä¸‹é¢å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ Go ç¼–å†™å»ºé€ è€…æ¨¡å¼çš„ä»£ç å…¶å®ä¼šå¾ˆé•¿ï¼Œè¿™äº›æ˜¯å®ƒçš„ä¸€ä¸ªç¼ºç‚¹ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯å‚æ•°çš„æ ¡éªŒé€»è¾‘å¾ˆå¤æ‚çš„æƒ…å†µä¸‹ä¸€èˆ¬æˆ‘ä»¬åœ¨ Go ä¸­ä¸ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œä¼šé‡‡ç”¨åé¢çš„å¦å¤–ä¸€ç§æ–¹å¼</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> builder<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-keyword">const</span> (defaultMaxTotal = <span class="hljs-number">10</span>defaultMaxIdle  = <span class="hljs-number">9</span>defaultMinIdle  = <span class="hljs-number">1</span>)<span class="hljs-comment">// ResourcePoolConfig resource pool</span><span class="hljs-keyword">type</span> ResourcePoolConfig <span class="hljs-keyword">struct</span> &#123;name     <span class="hljs-keyword">string</span>maxTotal <span class="hljs-keyword">int</span>maxIdle  <span class="hljs-keyword">int</span>minIdle  <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// ResourcePoolConfigBuilder ç”¨äºæ„å»º ResourcePoolConfig</span><span class="hljs-keyword">type</span> ResourcePoolConfigBuilder <span class="hljs-keyword">struct</span> &#123;name     <span class="hljs-keyword">string</span>maxTotal <span class="hljs-keyword">int</span>maxIdle  <span class="hljs-keyword">int</span>minIdle  <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// SetName SetName</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *ResourcePoolConfigBuilder)</span> <span class="hljs-title">SetName</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> name == <span class="hljs-string">""</span> &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"name can not be empty"</span>)&#125;b.name = name<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// SetMinIdle SetMinIdle</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *ResourcePoolConfigBuilder)</span> <span class="hljs-title">SetMinIdle</span><span class="hljs-params">(minIdle <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> minIdle &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"max tatal cannot &lt; 0, input: %d"</span>, minIdle)&#125;b.minIdle = minIdle<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// SetMaxIdle SetMaxIdle</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *ResourcePoolConfigBuilder)</span> <span class="hljs-title">SetMaxIdle</span><span class="hljs-params">(maxIdle <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> maxIdle &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"max tatal cannot &lt; 0, input: %d"</span>, maxIdle)&#125;b.maxIdle = maxIdle<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// SetMaxTotal SetMaxTotal</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *ResourcePoolConfigBuilder)</span> <span class="hljs-title">SetMaxTotal</span><span class="hljs-params">(maxTotal <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> maxTotal &lt;= <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"max tatal cannot &lt;= 0, input: %d"</span>, maxTotal)&#125;b.maxTotal = maxTotal<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// Build Build</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *ResourcePoolConfigBuilder)</span> <span class="hljs-title">Build</span><span class="hljs-params">()</span> <span class="hljs-params">(*ResourcePoolConfig, error)</span></span> &#123;<span class="hljs-keyword">if</span> b.name == <span class="hljs-string">""</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"name can not be empty"</span>)&#125;<span class="hljs-comment">// è®¾ç½®é»˜è®¤å€¼</span><span class="hljs-keyword">if</span> b.minIdle == <span class="hljs-number">0</span> &#123;b.minIdle = defaultMinIdle&#125;<span class="hljs-keyword">if</span> b.maxIdle == <span class="hljs-number">0</span> &#123;b.maxIdle = defaultMaxIdle&#125;<span class="hljs-keyword">if</span> b.maxTotal == <span class="hljs-number">0</span> &#123;b.maxTotal = defaultMaxTotal&#125;<span class="hljs-keyword">if</span> b.maxTotal &lt; b.maxIdle &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"max total(%d) cannot &lt; max idle(%d)"</span>, b.maxTotal, b.maxIdle)&#125;<span class="hljs-keyword">if</span> b.minIdle &gt; b.maxIdle &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"max idle(%d) cannot &lt; min idle(%d)"</span>, b.maxIdle, b.minIdle)&#125;<span class="hljs-keyword">return</span> &amp;ResourcePoolConfig&#123;name:     b.name,maxTotal: b.maxTotal,maxIdle:  b.maxIdle,minIdle:  b.minIdle,&#125;, <span class="hljs-literal">nil</span>&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> builder<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span><span class="hljs-string">"github.com/stretchr/testify/require"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestResourcePoolConfigBuilder_Build</span><span class="hljs-params">(t *testing.T)</span></span> &#123;tests := []<span class="hljs-keyword">struct</span> &#123;name    <span class="hljs-keyword">string</span>builder *ResourcePoolConfigBuilderwant    *ResourcePoolConfigwantErr <span class="hljs-keyword">bool</span>&#125;&#123;&#123;name: <span class="hljs-string">"name empty"</span>,builder: &amp;ResourcePoolConfigBuilder&#123;name:     <span class="hljs-string">""</span>,maxTotal: <span class="hljs-number">0</span>,&#125;,want:    <span class="hljs-literal">nil</span>,wantErr: <span class="hljs-literal">true</span>,&#125;,&#123;name: <span class="hljs-string">"maxIdle &lt; minIdle"</span>,builder: &amp;ResourcePoolConfigBuilder&#123;name:     <span class="hljs-string">"test"</span>,maxTotal: <span class="hljs-number">0</span>,maxIdle:  <span class="hljs-number">10</span>,minIdle:  <span class="hljs-number">20</span>,&#125;,want:    <span class="hljs-literal">nil</span>,wantErr: <span class="hljs-literal">true</span>,&#125;,&#123;name: <span class="hljs-string">"success"</span>,builder: &amp;ResourcePoolConfigBuilder&#123;name: <span class="hljs-string">"test"</span>,&#125;,want: &amp;ResourcePoolConfig&#123;name:     <span class="hljs-string">"test"</span>,maxTotal: defaultMaxTotal,maxIdle:  defaultMaxIdle,minIdle:  defaultMinIdle,&#125;,wantErr: <span class="hljs-literal">false</span>,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;got, err := tt.builder.Build()require.Equalf(t, tt.wantErr, err != <span class="hljs-literal">nil</span>, <span class="hljs-string">"Build() error = %v, wantErr %v"</span>, err, tt.wantErr)assert.Equal(t, tt.want, got)&#125;)&#125;&#125;</code></pre><h3 id="Go-å¸¸ç”¨çš„å‚æ•°ä¼ é€’æ–¹æ³•"><a href="#Go-å¸¸ç”¨çš„å‚æ•°ä¼ é€’æ–¹æ³•" class="headerlink" title="Go å¸¸ç”¨çš„å‚æ•°ä¼ é€’æ–¹æ³•"></a>Go å¸¸ç”¨çš„å‚æ•°ä¼ é€’æ–¹æ³•</h3><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> builder<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-comment">// ResourcePoolConfigOption option</span><span class="hljs-keyword">type</span> ResourcePoolConfigOption <span class="hljs-keyword">struct</span> &#123;maxTotal <span class="hljs-keyword">int</span>maxIdle  <span class="hljs-keyword">int</span>minIdle  <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// ResourcePoolConfigOptFunc to set option</span><span class="hljs-keyword">type</span> ResourcePoolConfigOptFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(option *ResourcePoolConfigOption)</span></span><span class="hljs-comment">// NewResourcePoolConfig NewResourcePoolConfig</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewResourcePoolConfig</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>, opts ...ResourcePoolConfigOptFunc)</span> <span class="hljs-params">(*ResourcePoolConfig, error)</span></span> &#123;<span class="hljs-keyword">if</span> name == <span class="hljs-string">""</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"name can not be empty"</span>)&#125;option := &amp;ResourcePoolConfigOption&#123;maxTotal: <span class="hljs-number">10</span>,maxIdle:  <span class="hljs-number">9</span>,minIdle:  <span class="hljs-number">1</span>,&#125;<span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts &#123;opt(option)&#125;<span class="hljs-keyword">if</span> option.maxTotal &lt; <span class="hljs-number">0</span> || option.maxIdle &lt; <span class="hljs-number">0</span> || option.minIdle &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"args err, option: %v"</span>, option)&#125;<span class="hljs-keyword">if</span> option.maxTotal &lt; option.maxIdle || option.minIdle &gt; option.maxIdle &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"args err, option: %v"</span>, option)&#125;<span class="hljs-keyword">return</span> &amp;ResourcePoolConfig&#123;name:     name,maxTotal: option.maxTotal,maxIdle:  option.maxIdle,minIdle:  option.minIdle,&#125;, <span class="hljs-literal">nil</span>&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•-1"><a href="#å•å…ƒæµ‹è¯•-1" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> builder<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span><span class="hljs-string">"github.com/stretchr/testify/require"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestNewResourcePoolConfig</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">type</span> args <span class="hljs-keyword">struct</span> &#123;name <span class="hljs-keyword">string</span>opts []ResourcePoolConfigOptFunc&#125;tests := []<span class="hljs-keyword">struct</span> &#123;name    <span class="hljs-keyword">string</span>args    argswant    *ResourcePoolConfigwantErr <span class="hljs-keyword">bool</span>&#125;&#123;&#123;name: <span class="hljs-string">"name empty"</span>,args: args&#123;name: <span class="hljs-string">""</span>,&#125;,want:    <span class="hljs-literal">nil</span>,wantErr: <span class="hljs-literal">true</span>,&#125;,&#123;name: <span class="hljs-string">"success"</span>,args: args&#123;name: <span class="hljs-string">"test"</span>,opts: []ResourcePoolConfigOptFunc&#123;<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(option *ResourcePoolConfigOption)</span></span> &#123;option.minIdle = <span class="hljs-number">2</span>&#125;,&#125;,&#125;,want: &amp;ResourcePoolConfig&#123;name:     <span class="hljs-string">"test"</span>,maxTotal: <span class="hljs-number">10</span>,maxIdle:  <span class="hljs-number">9</span>,minIdle:  <span class="hljs-number">2</span>,&#125;,wantErr: <span class="hljs-literal">false</span>,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;got, err := NewResourcePoolConfig(tt.args.name, tt.args.opts...)require.Equalf(t, tt.wantErr, err != <span class="hljs-literal">nil</span>, <span class="hljs-string">"error = %v, wantErr %v"</span>, err, tt.wantErr)assert.Equal(t, tt.want, got)&#125;)&#125;&#125;</code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å…¶å®å¯ä»¥çœ‹åˆ°ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨åé¢çš„è¿™ç§æ–¹å¼å°±å¯ä»¥äº†ï¼Œå¹¶ä¸”åœ¨ç¼–å†™å…¬å…±åº“çš„æ—¶å€™ï¼Œ<strong>å¼ºçƒˆå»ºè®®</strong>å…¥å£çš„å‚æ•°éƒ½å¯ä»¥è¿™ä¹ˆä¼ é€’ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦çš„ä¿è¯æˆ‘ä»¬å…¬å…±åº“çš„å…¼å®¹æ€§ï¼Œé¿å…åœ¨åç»­çš„æ›´æ–°çš„æ—¶å€™å‡ºç°ç ´åæ€§çš„æ›´æ–°çš„æƒ…å†µã€‚</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼02-å·¥å‚æ¨¡å¼&amp;DIå®¹å™¨</title>
    <link href="/post/factory.html"/>
    <url>/post/factory.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>æ³¨æ„ï¼šè¿™ç¯‡æ–‡ç« ä»£ç æ¯”è¾ƒå¤šï¼ŒåŒ…å«äº† ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€DI å®¹å™¨çš„å®ç°ï¼Œç”±äºå†…å®¹å…·æœ‰å…³è”æ€§å°±ä¸è¿›è¡Œæ‹†åˆ†äº†</li><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å« 23 ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/197254" target="_blank" rel="noopener">44 | å·¥å‚æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šæˆ‘ä¸ºä»€ä¹ˆè¯´æ²¡äº‹ä¸è¦éšä¾¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºå¯¹è±¡ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 02/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a><br><img src="https://lailin.xyz/images/1599020982679-472ce6a9-cc75-4fd1-b92e-bf643f4b2784.png" srcset="/img/loading.gif" alt></li></ul><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="ç®€å•å·¥å‚"><a href="#ç®€å•å·¥å‚" class="headerlink" title="ç®€å•å·¥å‚"></a>ç®€å•å·¥å‚</h3><p>ç”±äº Go æœ¬èº«æ˜¯æ²¡æœ‰æ„é€ å‡½æ•°çš„ï¼Œä¸€èˆ¬è€Œè¨€æˆ‘ä»¬é‡‡ç”¨ <code>NewName</code> çš„æ–¹å¼åˆ›å»ºå¯¹è±¡/æ¥å£ï¼Œå½“å®ƒè¿”å›çš„æ˜¯æ¥å£çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> factory<span class="hljs-comment">// IRuleConfigParser IRuleConfigParser</span><span class="hljs-keyword">type</span> IRuleConfigParser <span class="hljs-keyword">interface</span> &#123;Parse(data []<span class="hljs-keyword">byte</span>)&#125;<span class="hljs-comment">// jsonRuleConfigParser jsonRuleConfigParser</span><span class="hljs-keyword">type</span> jsonRuleConfigParser <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-comment">// Parse Parse</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(J jsonRuleConfigParser)</span> <span class="hljs-title">Parse</span><span class="hljs-params">(data []<span class="hljs-keyword">byte</span>)</span></span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"implement me"</span>)&#125;<span class="hljs-comment">// yamlRuleConfigParser yamlRuleConfigParser</span><span class="hljs-keyword">type</span> yamlRuleConfigParser <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-comment">// Parse Parse</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(Y yamlRuleConfigParser)</span> <span class="hljs-title">Parse</span><span class="hljs-params">(data []<span class="hljs-keyword">byte</span>)</span></span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"implement me"</span>)&#125;<span class="hljs-comment">// NewIRuleConfigParser NewIRuleConfigParser</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewIRuleConfigParser</span><span class="hljs-params">(t <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">IRuleConfigParser</span></span> &#123;<span class="hljs-keyword">switch</span> t &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">"json"</span>:<span class="hljs-keyword">return</span> jsonRuleConfigParser&#123;&#125;<span class="hljs-keyword">case</span> <span class="hljs-string">"yaml"</span>:<span class="hljs-keyword">return</span> yamlRuleConfigParser&#123;&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> factory<span class="hljs-keyword">import</span> (<span class="hljs-string">"reflect"</span><span class="hljs-string">"testing"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestNewIRuleConfigParser</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">type</span> args <span class="hljs-keyword">struct</span> &#123;t <span class="hljs-keyword">string</span>&#125;tests := []<span class="hljs-keyword">struct</span> &#123;name <span class="hljs-keyword">string</span>args argswant IRuleConfigParser&#125;&#123;&#123;name: <span class="hljs-string">"json"</span>,args: args&#123;t: <span class="hljs-string">"json"</span>&#125;,want: jsonRuleConfigParser&#123;&#125;,&#125;,&#123;name: <span class="hljs-string">"yaml"</span>,args: args&#123;t: <span class="hljs-string">"yaml"</span>&#125;,want: yamlRuleConfigParser&#123;&#125;,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">if</span> got := NewIRuleConfigParser(tt.args.t); !reflect.DeepEqual(got, tt.want) &#123;t.Errorf(<span class="hljs-string">"NewIRuleConfigParser() = %v, want %v"</span>, got, tt.want)&#125;&#125;)&#125;&#125;</code></pre><h3 id="å·¥å‚æ–¹æ³•"><a href="#å·¥å‚æ–¹æ³•" class="headerlink" title="å·¥å‚æ–¹æ³•"></a>å·¥å‚æ–¹æ³•</h3><p>å½“å¯¹è±¡çš„åˆ›å»ºé€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œä¸åªæ˜¯ç®€å•çš„ new ä¸€ä¸‹å°±å¯ä»¥ï¼Œè€Œæ˜¯è¦ç»„åˆå…¶ä»–ç±»å¯¹è±¡ï¼Œåšå„ç§åˆå§‹åŒ–æ“ä½œçš„æ—¶å€™ï¼Œæ¨èä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå°†å¤æ‚çš„åˆ›å»ºé€»è¾‘æ‹†åˆ†åˆ°å¤šä¸ªå·¥å‚ç±»ä¸­ï¼Œè®©æ¯ä¸ªå·¥å‚ç±»éƒ½ä¸è‡³äºè¿‡äºå¤æ‚</p><pre><code class="hljs go"><span class="hljs-comment">// IRuleConfigParserFactory å·¥å‚æ–¹æ³•æ¥å£</span><span class="hljs-keyword">type</span> IRuleConfigParserFactory <span class="hljs-keyword">interface</span> &#123;CreateParser() IRuleConfigParser&#125;<span class="hljs-comment">// yamlRuleConfigParserFactory yamlRuleConfigParser çš„å·¥å‚ç±»</span><span class="hljs-keyword">type</span> yamlRuleConfigParserFactory <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-comment">// CreateParser CreateParser</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(y yamlRuleConfigParserFactory)</span> <span class="hljs-title">CreateParser</span><span class="hljs-params">()</span> <span class="hljs-title">IRuleConfigParser</span></span> &#123;<span class="hljs-keyword">return</span> yamlRuleConfigParser&#123;&#125;&#125;<span class="hljs-comment">// jsonRuleConfigParserFactory jsonRuleConfigParser çš„å·¥å‚ç±»</span><span class="hljs-keyword">type</span> jsonRuleConfigParserFactory <span class="hljs-keyword">struct</span> &#123;&#125;<span class="hljs-comment">// CreateParser CreateParser</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(j jsonRuleConfigParserFactory)</span> <span class="hljs-title">CreateParser</span><span class="hljs-params">()</span> <span class="hljs-title">IRuleConfigParser</span></span> &#123;<span class="hljs-keyword">return</span> jsonRuleConfigParser&#123;&#125;&#125;<span class="hljs-comment">// NewIRuleConfigParserFactory ç”¨ä¸€ä¸ªç®€å•å·¥å‚å°è£…å·¥å‚æ–¹æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewIRuleConfigParserFactory</span><span class="hljs-params">(t <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">IRuleConfigParserFactory</span></span> &#123;<span class="hljs-keyword">switch</span> t &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">"json"</span>:<span class="hljs-keyword">return</span> jsonRuleConfigParserFactory&#123;&#125;<span class="hljs-keyword">case</span> <span class="hljs-string">"yaml"</span>:<span class="hljs-keyword">return</span> yamlRuleConfigParserFactory&#123;&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•-1"><a href="#å•å…ƒæµ‹è¯•-1" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> factory<span class="hljs-keyword">import</span> (<span class="hljs-string">"reflect"</span><span class="hljs-string">"testing"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestNewIRuleConfigParserFactory</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">type</span> args <span class="hljs-keyword">struct</span> &#123;t <span class="hljs-keyword">string</span>&#125;tests := []<span class="hljs-keyword">struct</span> &#123;name <span class="hljs-keyword">string</span>args argswant IRuleConfigParserFactory&#125;&#123;&#123;name: <span class="hljs-string">"json"</span>,args: args&#123;t: <span class="hljs-string">"json"</span>&#125;,want: jsonRuleConfigParserFactory&#123;&#125;,&#125;,&#123;name: <span class="hljs-string">"yaml"</span>,args: args&#123;t: <span class="hljs-string">"yaml"</span>&#125;,want: yamlRuleConfigParserFactory&#123;&#125;,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<span class="hljs-keyword">if</span> got := NewIRuleConfigParserFactory(tt.args.t); !reflect.DeepEqual(got, tt.want) &#123;t.Errorf(<span class="hljs-string">"NewIRuleConfigParserFactory() = %v, want %v"</span>, got, tt.want)&#125;&#125;)&#125;&#125;</code></pre><h3 id="æŠ½è±¡å·¥å‚"><a href="#æŠ½è±¡å·¥å‚" class="headerlink" title="æŠ½è±¡å·¥å‚"></a>æŠ½è±¡å·¥å‚</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> factory<span class="hljs-comment">// IRuleConfigParser IRuleConfigParser</span><span class="hljs-keyword">type</span> IRuleConfigParser <span class="hljs-keyword">interface</span> &#123;Parse(data []<span class="hljs-keyword">byte</span>)&#125;<span class="hljs-comment">// jsonRuleConfigParser jsonRuleConfigParser</span><span class="hljs-keyword">type</span> jsonRuleConfigParser <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Parse Parse</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(j jsonRuleConfigParser)</span> <span class="hljs-title">Parse</span><span class="hljs-params">(data []<span class="hljs-keyword">byte</span>)</span></span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"implement me"</span>)&#125;<span class="hljs-comment">// ISystemConfigParser ISystemConfigParser</span><span class="hljs-keyword">type</span> ISystemConfigParser <span class="hljs-keyword">interface</span> &#123;ParseSystem(data []<span class="hljs-keyword">byte</span>)&#125;<span class="hljs-comment">// jsonSystemConfigParser jsonSystemConfigParser</span><span class="hljs-keyword">type</span> jsonSystemConfigParser <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-comment">// Parse Parse</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(j jsonSystemConfigParser)</span> <span class="hljs-title">ParseSystem</span><span class="hljs-params">(data []<span class="hljs-keyword">byte</span>)</span></span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"implement me"</span>)&#125;<span class="hljs-comment">// IConfigParserFactory å·¥å‚æ–¹æ³•æ¥å£</span><span class="hljs-keyword">type</span> IConfigParserFactory <span class="hljs-keyword">interface</span> &#123;CreateRuleParser() IRuleConfigParserCreateSystemParser() ISystemConfigParser&#125;<span class="hljs-keyword">type</span> jsonConfigParserFactory <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(j jsonConfigParserFactory)</span> <span class="hljs-title">CreateRuleParser</span><span class="hljs-params">()</span> <span class="hljs-title">IRuleConfigParser</span></span> &#123;<span class="hljs-keyword">return</span> jsonRuleConfigParser&#123;&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(j jsonConfigParserFactory)</span> <span class="hljs-title">CreateSystemParser</span><span class="hljs-params">()</span> <span class="hljs-title">ISystemConfigParser</span></span> &#123;<span class="hljs-keyword">return</span> jsonSystemConfigParser&#123;&#125;&#125;</code></pre><h4 id="å•å…ƒæµ‹è¯•-2"><a href="#å•å…ƒæµ‹è¯•-2" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> factory<span class="hljs-keyword">import</span> (<span class="hljs-string">"reflect"</span><span class="hljs-string">"testing"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Test_jsonConfigParserFactory_CreateRuleParser</span><span class="hljs-params">(t *testing.T)</span></span> &#123;tests := []<span class="hljs-keyword">struct</span> &#123;name <span class="hljs-keyword">string</span>want IRuleConfigParser&#125;&#123;&#123;name: <span class="hljs-string">"json"</span>,want: jsonRuleConfigParser&#123;&#125;,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;j := jsonConfigParserFactory&#123;&#125;<span class="hljs-keyword">if</span> got := j.CreateRuleParser(); !reflect.DeepEqual(got, tt.want) &#123;t.Errorf(<span class="hljs-string">"CreateRuleParser() = %v, want %v"</span>, got, tt.want)&#125;&#125;)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Test_jsonConfigParserFactory_CreateSystemParser</span><span class="hljs-params">(t *testing.T)</span></span> &#123;tests := []<span class="hljs-keyword">struct</span> &#123;name <span class="hljs-keyword">string</span>want ISystemConfigParser&#125;&#123;&#123;name: <span class="hljs-string">"json"</span>,want: jsonSystemConfigParser&#123;&#125;,&#125;,&#125;<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;j := jsonConfigParserFactory&#123;&#125;<span class="hljs-keyword">if</span> got := j.CreateSystemParser(); !reflect.DeepEqual(got, tt.want) &#123;t.Errorf(<span class="hljs-string">"CreateSystemParser() = %v, want %v"</span>, got, tt.want)&#125;&#125;)&#125;&#125;</code></pre><h3 id="DI-å®¹å™¨"><a href="#DI-å®¹å™¨" class="headerlink" title="DI å®¹å™¨"></a>DI å®¹å™¨</h3><p>golang ç°æœ‰çš„ä¾èµ–æ³¨å…¥æ¡†æ¶:</p><ul><li>ä½¿ç”¨åå°„å®ç°çš„: <a href="https://github.com/uber-go/dig" target="_blank" rel="noopener">https://github.com/uber-go/dig</a></li><li>ä½¿ç”¨ generate å®ç°çš„: <a href="https://github.com/google/wire" target="_blank" rel="noopener">https://github.com/google/wire</a></li></ul><p>ä¸‹æ–‡å°†é€šè¿‡åå°„å®ç°ä¸€ä¸ªç±»ä¼¼ dig ç®€å•çš„ demoï¼Œåœ¨è¯¾ç¨‹é‡Œé¢çš„ä¾‹å­æ˜¯è¯»å–é…ç½®æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œç”Ÿæˆï¼Œä¸‹é¢æä¾›æ˜¯é€šè¿‡ provider è¿›è¡Œæ„å»ºä¾èµ–å…³ç³»ã€‚</p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> di<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"reflect"</span>)<span class="hljs-comment">// Container DI å®¹å™¨</span><span class="hljs-keyword">type</span> Container <span class="hljs-keyword">struct</span> &#123;<span class="hljs-comment">// å‡è®¾ä¸€ç§ç±»å‹åªèƒ½æœ‰ä¸€ä¸ª provider æä¾›</span>providers <span class="hljs-keyword">map</span>[reflect.Type]provider<span class="hljs-comment">// ç¼“å­˜ä»¥ç”Ÿæˆçš„å¯¹è±¡</span>results <span class="hljs-keyword">map</span>[reflect.Type]reflect.Value&#125;<span class="hljs-keyword">type</span> provider <span class="hljs-keyword">struct</span> &#123;value reflect.Valueparams []reflect.Type&#125;<span class="hljs-comment">// New åˆ›å»ºä¸€ä¸ªå®¹å™¨</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span> *<span class="hljs-title">Container</span></span> &#123;<span class="hljs-keyword">return</span> &amp;Container&#123;providers: <span class="hljs-keyword">map</span>[reflect.Type]provider&#123;&#125;,results:   <span class="hljs-keyword">map</span>[reflect.Type]reflect.Value&#123;&#125;,&#125;&#125;<span class="hljs-comment">// isError åˆ¤æ–­æ˜¯å¦æ˜¯ error ç±»å‹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isError</span><span class="hljs-params">(t reflect.Type)</span> <span class="hljs-title">bool</span></span> &#123;<span class="hljs-keyword">if</span> t.Kind() != reflect.Interface &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>&#125;<span class="hljs-keyword">return</span> t.Implements(reflect.TypeOf(reflect.TypeOf((*error)(<span class="hljs-literal">nil</span>)).Elem()))&#125;<span class="hljs-comment">// Provide å¯¹è±¡æä¾›è€…ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªå¯¹è±¡çš„å·¥å‚æ–¹æ³•ï¼Œåç»­ä¼šç”¨äºå¯¹è±¡çš„åˆ›å»º</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Container)</span> <span class="hljs-title">Provide</span><span class="hljs-params">(constructor <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;v := reflect.ValueOf(constructor)<span class="hljs-comment">// ä»…æ”¯æŒå‡½æ•° provider</span><span class="hljs-keyword">if</span> v.Kind() != reflect.Func &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"constructor must be a func"</span>)&#125;vt := v.Type()<span class="hljs-comment">// è·å–å‚æ•°</span>params := <span class="hljs-built_in">make</span>([]reflect.Type, vt.NumIn())<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; vt.NumIn(); i++ &#123;params[i] = vt.In(i)&#125;<span class="hljs-comment">// è·å–è¿”å›å€¼</span>results := <span class="hljs-built_in">make</span>([]reflect.Type, vt.NumOut())<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; vt.NumOut(); i++ &#123;results[i] = vt.Out(i)&#125;provider := provider&#123;value:  v,params: params,&#125;<span class="hljs-comment">// ä¿å­˜ä¸åŒç±»å‹çš„ provider</span><span class="hljs-keyword">for</span> _, result := <span class="hljs-keyword">range</span> results &#123;<span class="hljs-comment">// åˆ¤æ–­è¿”å›å€¼æ˜¯ä¸æ˜¯ error</span><span class="hljs-keyword">if</span> isError(result) &#123;<span class="hljs-keyword">continue</span>&#125;<span class="hljs-keyword">if</span> _, ok := c.providers[result]; ok &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"%s had a provider"</span>, result)&#125;c.providers[result] = provider&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// Invoke å‡½æ•°æ‰§è¡Œå…¥å£</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Container)</span> <span class="hljs-title">Invoke</span><span class="hljs-params">(function <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;v := reflect.ValueOf(function)<span class="hljs-comment">// ä»…æ”¯æŒå‡½æ•° provider</span><span class="hljs-keyword">if</span> v.Kind() != reflect.Func &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"constructor must be a func"</span>)&#125;vt := v.Type()<span class="hljs-comment">// è·å–å‚æ•°</span><span class="hljs-keyword">var</span> err errorparams := <span class="hljs-built_in">make</span>([]reflect.Value, vt.NumIn())<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; vt.NumIn(); i++ &#123;params[i], err = c.buildParam(vt.In(i))<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err&#125;&#125;v.Call(params)<span class="hljs-comment">// è·å– providers</span><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// buildParam æ„å»ºå‚æ•°</span><span class="hljs-comment">// 1. ä»å®¹å™¨ä¸­è·å– provider</span><span class="hljs-comment">// 2. é€’å½’è·å– provider çš„å‚æ•°å€¼</span><span class="hljs-comment">// 3. è·å–åˆ°å‚æ•°ä¹‹åæ‰§è¡Œå‡½æ•°</span><span class="hljs-comment">// 4. å°†ç»“æœç¼“å­˜å¹¶ä¸”è¿”å›ç»“æœ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Container)</span> <span class="hljs-title">buildParam</span><span class="hljs-params">(param reflect.Type)</span> <span class="hljs-params">(val reflect.Value, err error)</span></span> &#123;<span class="hljs-keyword">if</span> result, ok := c.results[param]; ok &#123;<span class="hljs-keyword">return</span> result, <span class="hljs-literal">nil</span>&#125;provider, ok := c.providers[param]<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">return</span> reflect.Value&#123;&#125;, fmt.Errorf(<span class="hljs-string">"can not found provider: %s"</span>, param)&#125;params := <span class="hljs-built_in">make</span>([]reflect.Value, <span class="hljs-built_in">len</span>(provider.params))<span class="hljs-keyword">for</span> i, p := <span class="hljs-keyword">range</span> provider.params &#123;params[i], err = c.buildParam(p)&#125;results := provider.value.Call(params)<span class="hljs-keyword">for</span> _, result := <span class="hljs-keyword">range</span> results &#123;<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æŠ¥é”™</span><span class="hljs-keyword">if</span> isError(result.Type()) &amp;&amp; !result.IsNil() &#123;<span class="hljs-keyword">return</span> reflect.Value&#123;&#125;, fmt.Errorf(<span class="hljs-string">"%s call err: %+v"</span>, provider, result)&#125;<span class="hljs-keyword">if</span> !isError(result.Type()) &amp;&amp; !result.IsNil() &#123;c.results[result.Type()] = result&#125;&#125;<span class="hljs-keyword">return</span> c.results[param], <span class="hljs-literal">nil</span>&#125;</code></pre><p>æˆ‘ä»¬è¿™é‡Œçš„å®ç°æ¯”è¾ƒç²—ç³™ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ª demo ç†è§£ di å®¹å™¨ä¹Ÿè¶³å¤Ÿäº†ï¼Œå’Œ dig ç›¸æ¯”è¿˜ç¼ºå°‘å¾ˆå¤šä¸œè¥¿ï¼Œå¹¶ä¸”æœ‰è®¸å¤šçš„é—®é¢˜ï¼Œä¾‹å¦‚ ä¾èµ–å…³ç³»ï¼Œä¸€ç§ç±»å‹å¦‚æœæœ‰å¤šä¸ª provider å¦‚ä½•å¤„ç†ç­‰ç­‰ç­‰ç­‰ã€‚<br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ€»å…±å°±ä¸‰ä¸ªå‡½æ•°</p><ul><li>Provide: è·å–å¯¹è±¡å·¥å‚ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€ä¸ª map å°†å¯¹è±¡å·¥å‚ä¿å­˜</li><li>Invoke: æ‰§è¡Œå…¥å£</li><li>buildParam: æ ¸å¿ƒé€»è¾‘ï¼Œæ„å»ºå‚æ•°<ul><li>ä»å®¹å™¨ä¸­è·å– provider</li><li>é€’å½’è·å– provider çš„å‚æ•°å€¼</li><li>è·å–åˆ°å‚æ•°ä¹‹åæ‰§è¡Œå‡½æ•°</li><li>å°†ç»“æœç¼“å­˜å¹¶ä¸”è¿”å›ç»“æœ</li></ul></li></ul><h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span>di <span class="hljs-string">"github.com/mohuishou/go-design-pattern/02_factory/024_di"</span>)<span class="hljs-comment">// A ä¾èµ–å…³ç³» A -&gt; B -&gt; C</span><span class="hljs-keyword">type</span> A <span class="hljs-keyword">struct</span> &#123;B *B&#125;<span class="hljs-comment">// NewA NewA</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewA</span><span class="hljs-params">(b *B)</span> *<span class="hljs-title">A</span></span> &#123;<span class="hljs-keyword">return</span> &amp;A&#123;B: b,&#125;&#125;<span class="hljs-comment">// B B</span><span class="hljs-keyword">type</span> B <span class="hljs-keyword">struct</span> &#123;C *C&#125;<span class="hljs-comment">// NewB NewB</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewB</span><span class="hljs-params">(c *C)</span> *<span class="hljs-title">B</span></span> &#123;<span class="hljs-keyword">return</span> &amp;B&#123;C: c&#125;&#125;<span class="hljs-comment">// C C</span><span class="hljs-keyword">type</span> C <span class="hljs-keyword">struct</span> &#123;Num <span class="hljs-keyword">int</span>&#125;<span class="hljs-comment">// NewC NewC</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewC</span><span class="hljs-params">()</span> *<span class="hljs-title">C</span></span> &#123;<span class="hljs-keyword">return</span> &amp;C&#123;Num: <span class="hljs-number">1</span>,&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;container := di.New()<span class="hljs-keyword">if</span> err := container.Provide(NewA); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;<span class="hljs-keyword">if</span> err := container.Provide(NewB); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;<span class="hljs-keyword">if</span> err := container.Provide(NewC); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;err := container.Invoke(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a *A)</span></span> &#123;fmt.Printf(<span class="hljs-string">"%+v: %d"</span>, a, a.B.C.Num)&#125;)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬”è®°-è®©ä½ æœ€å¿«é€Ÿåœ°æ”¹å–„ä»£ç è´¨é‡çš„20æ¡ç¼–ç¨‹è§„èŒƒ</title>
    <link href="/post/fe1ma9.html"/>
    <url>/post/fe1ma9.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å« 23 ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/188622" target="_blank" rel="noopener">31 | ç†è®ºäº”ï¼šè®©ä½ æœ€å¿«é€Ÿåœ°æ”¹å–„ä»£ç è´¨é‡çš„ 20 æ¡ç¼–ç¨‹è§„èŒƒï¼ˆä¸Šï¼‰</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li></ul><h3 id="å‘½å"><a href="#å‘½å" class="headerlink" title="å‘½å"></a>å‘½å</h3><ul><li>å‘½åçš„å…³é”®æ˜¯èƒ½<strong>å‡†ç¡®è¾¾æ„</strong>ã€‚å¯¹äºä¸åŒä½œç”¨åŸŸçš„å‘½åï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“åœ°é€‰æ‹©ä¸åŒçš„é•¿åº¦ã€‚</li><li>æˆ‘ä»¬<strong>å¯ä»¥å€ŸåŠ©ç±»çš„ä¿¡æ¯æ¥ç®€åŒ–å±æ€§ã€å‡½æ•°çš„å‘½åï¼Œåˆ©ç”¨å‡½æ•°çš„ä¿¡æ¯æ¥ç®€åŒ–å‡½æ•°å‚æ•°çš„å‘½å</strong>ã€‚</li><li><strong>å‘½åè¦å¯è¯»ã€å¯æœç´¢</strong>ã€‚ä¸è¦ä½¿ç”¨ç”Ÿåƒ»çš„ã€ä¸å¥½è¯»çš„è‹±æ–‡å•è¯æ¥å‘½åã€‚å‘½åè¦ç¬¦åˆé¡¹ç›®çš„ç»Ÿä¸€è§„èŒƒï¼Œä¹Ÿä¸è¦ç”¨äº›åç›´è§‰çš„å‘½åã€‚</li><li><strong>æ¥å£æœ‰ä¸¤ç§å‘½åæ–¹å¼ï¼šä¸€ç§æ˜¯åœ¨æ¥å£ä¸­å¸¦å‰ç¼€â€œIâ€ï¼›å¦ä¸€ç§æ˜¯åœ¨æ¥å£çš„å®ç°ç±»ä¸­å¸¦åç¼€â€œImplâ€</strong>ã€‚å¯¹äºæŠ½è±¡ç±»çš„å‘½åï¼Œä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å¸¦ä¸Šå‰ç¼€â€œAbstractâ€ï¼Œä¸€ç§æ˜¯ä¸å¸¦å‰ç¼€ã€‚è¿™ä¸¤ç§å‘½åæ–¹å¼éƒ½å¯ä»¥ï¼Œå…³é”®æ˜¯è¦åœ¨é¡¹ç›®ä¸­ç»Ÿä¸€ã€‚</li></ul><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><ul><li><strong>æ³¨é‡Šçš„å†…å®¹ä¸»è¦åŒ…å«è¿™æ ·ä¸‰ä¸ªæ–¹é¢ï¼šåšä»€ä¹ˆã€ä¸ºä»€ä¹ˆã€æ€ä¹ˆåš</strong>ã€‚å¯¹äºä¸€äº›å¤æ‚çš„ç±»å’Œæ¥å£ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å†™æ˜â€œå¦‚ä½•ç”¨â€ã€‚</li><li><strong>ç±»å’Œå‡½æ•°ä¸€å®šè¦å†™æ³¨é‡Šï¼Œè€Œä¸”è¦å†™å¾—å°½å¯èƒ½å…¨é¢è¯¦ç»†</strong>ã€‚<strong>å‡½æ•°å†…éƒ¨çš„æ³¨é‡Šè¦ç›¸å¯¹å°‘ä¸€äº›</strong>ï¼Œä¸€èˆ¬éƒ½æ˜¯é å¥½çš„å‘½åã€æç‚¼å‡½æ•°ã€è§£é‡Šæ€§å˜é‡ã€æ€»ç»“æ€§æ³¨é‡Šæ¥æé«˜ä»£ç å¯è¯»æ€§ã€‚</li></ul><h3 id="ä»£ç é£æ ¼"><a href="#ä»£ç é£æ ¼" class="headerlink" title="ä»£ç é£æ ¼"></a>ä»£ç é£æ ¼</h3><ul><li>å‡½æ•°ã€ç±»å¤šå¤§æ‰åˆé€‚ï¼Ÿ<strong>å‡½æ•°çš„ä»£ç è¡Œæ•°ä¸è¦è¶…è¿‡ä¸€å±å¹•çš„å¤§å°ï¼Œæ¯”å¦‚ 50 è¡Œ</strong>ã€‚ç±»çš„å¤§å°é™åˆ¶æ¯”è¾ƒéš¾ç¡®å®šã€‚</li><li><strong>ä¸€è¡Œä»£ç å¤šé•¿æœ€åˆé€‚ï¼Ÿæœ€å¥½ä¸è¦è¶…è¿‡ IDE çš„æ˜¾ç¤ºå®½åº¦</strong>ã€‚å½“ç„¶ï¼Œä¹Ÿä¸èƒ½å¤ªå°ï¼Œå¦åˆ™ä¼šå¯¼è‡´å¾ˆå¤šç¨å¾®é•¿ç‚¹çš„è¯­å¥è¢«æŠ˜æˆä¸¤è¡Œï¼Œä¹Ÿä¼šå½±å“åˆ°ä»£ç çš„æ•´æ´ï¼Œä¸åˆ©äºé˜…è¯»ã€‚</li><li><strong>å–„ç”¨ç©ºè¡Œåˆ†å‰²å•å…ƒå—</strong>ã€‚å¯¹äºæ¯”è¾ƒé•¿çš„å‡½æ•°ï¼Œä¸ºäº†è®©é€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œå¯ä»¥ä½¿ç”¨ç©ºè¡Œæ¥åˆ†å‰²å„ä¸ªä»£ç å—ã€‚</li><li>å››æ ¼ç¼©è¿›è¿˜æ˜¯ä¸¤æ ¼ç¼©è¿›ï¼Ÿæˆ‘ä¸ªäººæ¯”è¾ƒæ¨èä½¿ç”¨ä¸¤æ ¼ç¼©è¿›ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœç©ºé—´ï¼Œå°¤å…¶æ˜¯åœ¨ä»£ç åµŒå¥—å±‚æ¬¡æ¯”è¾ƒæ·±çš„æƒ…å†µä¸‹ã€‚ä¸ç®¡æ˜¯ç”¨ä¸¤æ ¼ç¼©è¿›è¿˜æ˜¯å››æ ¼ç¼©è¿›ï¼Œä¸€å®šä¸è¦ç”¨ tab é”®ç¼©è¿›ã€‚<em>(PS: Golang æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œé»˜è®¤ä½¿ç”¨ Tab ç¼©è¿›)</em></li><li>å¤§æ‹¬å·æ˜¯å¦è¦å¦èµ·ä¸€è¡Œï¼Ÿå°†å¤§æ‹¬å·æ”¾åˆ°è·Ÿä¸Šä¸€æ¡è¯­å¥åŒä¸€è¡Œï¼Œå¯ä»¥èŠ‚çœä»£ç è¡Œæ•°ã€‚ä½†æ˜¯å°†å¤§æ‹¬å·å¦èµ·æ–°çš„ä¸€è¡Œçš„æ–¹å¼ï¼Œå·¦å³æ‹¬å·å¯ä»¥å‚ç›´å¯¹é½ï¼Œå“ªäº›ä»£ç å±äºå“ªä¸€ä¸ªä»£ç å—ï¼Œæ›´åŠ ä¸€ç›®äº†ç„¶ã€‚<em>(PS: Golang æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼‰</em></li><li>ç±»ä¸­æˆå‘˜æ€ä¹ˆæ’åˆ—ï¼Ÿåœ¨ Google Java ç¼–ç¨‹è§„èŒƒä¸­ï¼Œ<strong>ä¾èµ–ç±»æŒ‰ç…§å­—æ¯åºä»å°åˆ°å¤§æ’åˆ—ã€‚ç±»ä¸­å…ˆå†™æˆå‘˜å˜é‡åå†™å‡½æ•°ã€‚æˆå‘˜å˜é‡ä¹‹é—´æˆ–å‡½æ•°ä¹‹é—´ï¼Œå…ˆå†™é™æ€æˆå‘˜å˜é‡æˆ–å‡½æ•°ï¼Œåå†™æ™®é€šå˜é‡æˆ–å‡½æ•°ï¼Œå¹¶ä¸”æŒ‰ç…§ä½œç”¨åŸŸå¤§å°ä¾æ¬¡æ’åˆ—</strong>ã€‚</li></ul><h3 id="ç¼–ç æŠ€å·§"><a href="#ç¼–ç æŠ€å·§" class="headerlink" title="ç¼–ç æŠ€å·§"></a>ç¼–ç æŠ€å·§</h3><ul><li><strong>å°†å¤æ‚çš„é€»è¾‘æç‚¼æ‹†åˆ†æˆå‡½æ•°å’Œç±»ã€‚</strong></li><li><strong>é€šè¿‡æ‹†åˆ†æˆå¤šä¸ªå‡½æ•°æˆ–å°†å‚æ•°å°è£…ä¸ºå¯¹è±¡çš„æ–¹å¼ï¼Œæ¥å¤„ç†å‚æ•°è¿‡å¤šçš„æƒ…å†µ</strong>ã€‚</li><li><strong>å‡½æ•°ä¸­ä¸è¦ä½¿ç”¨å‚æ•°æ¥åšä»£ç æ‰§è¡Œé€»è¾‘çš„æ§åˆ¶</strong>ã€‚</li><li><strong>å‡½æ•°è®¾è®¡è¦èŒè´£å•ä¸€</strong>ã€‚</li><li><strong>ç§»é™¤è¿‡æ·±çš„åµŒå¥—å±‚æ¬¡ï¼Œæ–¹æ³•åŒ…æ‹¬ï¼šå»æ‰å¤šä½™çš„ if æˆ– else è¯­å¥ï¼Œä½¿ç”¨ continueã€breakã€return å…³é”®å­—æå‰é€€å‡ºåµŒå¥—ï¼Œè°ƒæ•´æ‰§è¡Œé¡ºåºæ¥å‡å°‘åµŒå¥—ï¼Œå°†éƒ¨åˆ†åµŒå¥—é€»è¾‘æŠ½è±¡æˆå‡½æ•°</strong>ã€‚</li><li>ç”¨å­—é¢å¸¸é‡å–ä»£é­”æ³•æ•°ã€‚</li><li>ç”¨è§£é‡Šæ€§å˜é‡æ¥è§£é‡Šå¤æ‚è¡¨è¾¾å¼ï¼Œä»¥æ­¤æé«˜ä»£ç å¯è¯»æ€§ã€‚</li></ul><h3 id="ç»Ÿä¸€ç¼–ç è§„èŒƒ"><a href="#ç»Ÿä¸€ç¼–ç è§„èŒƒ" class="headerlink" title="ç»Ÿä¸€ç¼–ç è§„èŒƒ"></a>ç»Ÿä¸€ç¼–ç è§„èŒƒ</h3><ul><li>é™¤äº†è¿™ä¸‰èŠ‚è®²åˆ°çš„æ¯”è¾ƒç»†èŠ‚çš„çŸ¥è¯†ç‚¹ä¹‹å¤–ï¼Œæœ€åï¼Œ<strong>è¿˜æœ‰ä¸€æ¡éå¸¸é‡è¦çš„ï¼Œé‚£å°±æ˜¯ï¼Œé¡¹ç›®ã€å›¢é˜Ÿï¼Œç”šè‡³å…¬å¸ï¼Œä¸€å®šè¦åˆ¶å®šç»Ÿä¸€çš„ç¼–ç è§„èŒƒ</strong>ï¼Œå¹¶ä¸”é€šè¿‡ Code Review ç£ä¿ƒæ‰§è¡Œï¼Œè¿™å¯¹æé«˜ä»£ç è´¨é‡æœ‰ç«‹ç«¿è§å½±çš„æ•ˆæœã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»£ç è§„èŒƒå¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯è§ä»è§æ™ºçš„çœ‹æ³•ï¼Œæˆ‘è®¤ä¸ºæœ€ä¸»è¦çš„æ˜¯ç»Ÿä¸€ï¼Œä¸ªäººé£æ ¼è¦ç»Ÿä¸€ï¼Œå›¢é˜Ÿé£æ ¼ä¹Ÿéœ€è¦ç»Ÿä¸€ï¼Œç„¶åä¾é å·¥å…·è¿›è¡Œç®¡ç†ã€‚æˆ‘å¸¸ç”¨çš„ Golang ä»£ç é£æ ¼å·¥å…·ï¼š</p><ul><li>format: <a href="https://godoc.org/golang.org/x/tools/cmd/goimports" target="_blank" rel="noopener">https://godoc.org/golang.org/x/tools/cmd/goimports</a></li><li>lint: <a href="https://github.com/golang/lint" target="_blank" rel="noopener">https://github.com/golang/lint</a></li><li><strong>ci:</strong> <a href="https://golangci-lint.run/" target="_blank" rel="noopener">https://golangci-lint.run/</a> è¿™ä¸ªæ”¯æŒå¤šä¸ªé™æ€æ‰«æå·¥å…·ï¼Œä¸Šé¢ä¸¤ç§ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œä¸åœ¨ ide ç›´æ¥ä½¿ç”¨çš„ä¸»è¦åŸå› æ˜¯ï¼Œæ’ä»¶å¼€å¯è¾ƒå¤šçš„æ—¶å€™ä¼šæ¯”è¾ƒæ…¢ï¼Œä¸å¤ªé€‚åˆéšæ—¶è¿è¡Œï¼Œä½†æ˜¯ ci ä¸Šæ˜¯éœ€è¦çš„</li></ul><h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><h3 id="golangci-lint-gitlab-ci-yml-é…ç½®"><a href="#golangci-lint-gitlab-ci-yml-é…ç½®" class="headerlink" title="golangci-lint .gitlab-ci.yml é…ç½®"></a>golangci-lint .gitlab-ci.yml é…ç½®</h3><pre><code class="hljs yaml"><span class="hljs-attr">lint:</span>  <span class="hljs-attr">stage:</span> <span class="hljs-string">lint</span>  <span class="hljs-attr">image:</span> <span class="hljs-string">$CI_REGISTRY/library/golangci-lint:v1.27-alpine</span>  <span class="hljs-attr">script:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">golangci-lint</span> <span class="hljs-string">run</span> <span class="hljs-string">./...</span>  <span class="hljs-attr">retry:</span>    <span class="hljs-attr">max:</span> <span class="hljs-number">1</span>    <span class="hljs-attr">when:</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">runner_system_failure</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">stuck_or_timeout_failure</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">job_execution_timeout</span>  <span class="hljs-attr">tags:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">test</span></code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè®¾è®¡æ¨¡å¼01-å•ä¾‹æ¨¡å¼</title>
    <link href="/post/singleton.html"/>
    <url>/post/singleton.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><ul><li>Go è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒ…å« 23 ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼å®ç°ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯ <a href="https://time.geekbang.org/column/intro/250" target="_blank" rel="noopener">æå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾</a> çš„ç¬”è®°ï¼Œæºè¯¾ç¨‹é‡‡ç”¨ Java å®ç°ï¼Œæœ¬ç³»åˆ—ä¼šé‡‡ç”¨ Go å®ç°</li><li><strong>è¯¾ç¨‹:</strong> <a href="https://time.geekbang.org/column/article/194035" target="_blank" rel="noopener">41 | å•ä¾‹æ¨¡å¼ï¼ˆä¸Šä¸ºä»€ä¹ˆè¯´æ”¯æŒæ‡’åŠ è½½çš„åŒé‡æ£€æµ‹ä¸æ¯”é¥¿æ±‰å¼æ›´ä¼˜ï¼Ÿ</a></li><li><strong>æœ¬æ–‡ä»£ç ä»“åº“: <a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener">https://github.com/mohuishou/go-design-pattern</a> </strong>ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</li><li><strong>RoadMap: 01/22 </strong>æŒç»­æ›´æ–°ä¸­ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 2 ~ 3 ç§è®¾è®¡æ¨¡å¼ï¼Œé¢„è®¡åˆ° 202010 æœˆåº•å‰æ›´æ–°å®Œæˆ</li><li><strong>è·å–æ›´æ–°: </strong><a href="https://github.com/mohuishou/go-design-pattern" target="_blank" rel="noopener"><strong>Github</strong></a><strong>ã€</strong><a href="https://zhuanlan.zhihu.com/mohuishou" target="_blank" rel="noopener"><strong>çŸ¥ä¹</strong></a><strong>ã€</strong><a href="https://lailin.xyz/atom.xml"><strong>RSS</strong></a><strong>ã€</strong><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener"><strong>å¼€å‘è€…å¤´æ¡</strong></a></li></ul><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><img src="https://lailin.xyz/images/1602256371513-0bcda0e2-68ed-4530-98fd-ecb97bd7f193.png" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>å•ä¾‹æ¨¡å¼é‡‡ç”¨äº† é¥¿æ±‰å¼ å’Œ æ‡’æ±‰å¼ ä¸¤ç§å®ç°ï¼Œä¸ªäººå…¶å®æ›´å€¾å‘äºé¥¿æ±‰å¼çš„å®ç°ï¼Œç®€å•ï¼Œå¹¶ä¸”å¯ä»¥å°†é—®é¢˜åŠæ—©æš´éœ²ï¼Œæ‡’æ±‰å¼è™½ç„¶æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œä½†æ˜¯è¿™åªæ˜¯æŠŠå†·å¯åŠ¨æ—¶é—´æ”¾åˆ°äº†ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šè§£å†³é—®é¢˜ï¼Œå¹¶ä¸”ä¸ºäº†å®ç°æ‡’æ±‰å¼è¿˜ä¸å¯é¿å…çš„éœ€è¦åŠ é”ã€‚</p><h3 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h3><p><strong>ä»£ç å®ç°:</strong></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> singleton<span class="hljs-comment">// Singleton é¥¿æ±‰å¼å•ä¾‹</span><span class="hljs-keyword">type</span> Singleton <span class="hljs-keyword">struct</span>&#123;&#125;<span class="hljs-keyword">var</span> singleton *Singleton<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;singleton = &amp;Singleton&#123;&#125;&#125;<span class="hljs-comment">// GetInstance è·å–å®ä¾‹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span> *<span class="hljs-title">Singleton</span></span> &#123;<span class="hljs-keyword">return</span> singleton&#125;</code></pre><p><strong>å•å…ƒæµ‹è¯•:</strong></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> singleton_test<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span>singleton <span class="hljs-string">"github.com/mohuishou/go-design-pattern/01_singleton"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestGetInstance</span><span class="hljs-params">(t *testing.T)</span></span> &#123;assert.Equal(t, singleton.GetInstance(), singleton.GetInstance())&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkGetInstanceParallel</span><span class="hljs-params">(b *testing.B)</span></span> &#123;b.RunParallel(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pb *testing.PB)</span></span> &#123;<span class="hljs-keyword">for</span> pb.Next() &#123;<span class="hljs-keyword">if</span> singleton.GetInstance() != singleton.GetInstance() &#123;b.Errorf(<span class="hljs-string">"test fail"</span>)&#125;&#125;&#125;)&#125;</code></pre><h3 id="æ‡’æ±‰å¼ï¼ˆåŒé‡æ£€æµ‹ï¼‰"><a href="#æ‡’æ±‰å¼ï¼ˆåŒé‡æ£€æµ‹ï¼‰" class="headerlink" title="æ‡’æ±‰å¼ï¼ˆåŒé‡æ£€æµ‹ï¼‰"></a>æ‡’æ±‰å¼ï¼ˆåŒé‡æ£€æµ‹ï¼‰</h3><p><strong>ä»£ç å®ç°:</strong></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> singleton<span class="hljs-keyword">import</span> <span class="hljs-string">"sync"</span><span class="hljs-keyword">var</span> (lazySingleton *Singletononce          = &amp;sync.Once&#123;&#125;)<span class="hljs-comment">// GetLazyInstance æ‡’æ±‰å¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetLazyInstance</span><span class="hljs-params">()</span> *<span class="hljs-title">Singleton</span></span> &#123;<span class="hljs-keyword">if</span> lazySingleton == <span class="hljs-literal">nil</span> &#123;once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;lazySingleton = &amp;Singleton&#123;&#125;&#125;)&#125;<span class="hljs-keyword">return</span> lazySingleton&#125;</code></pre><p><strong>å•å…ƒæµ‹è¯•:</strong></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> singleton_test<span class="hljs-keyword">import</span> (<span class="hljs-string">"testing"</span>singleton <span class="hljs-string">"github.com/mohuishou/go-design-pattern/01_singleton"</span><span class="hljs-string">"github.com/stretchr/testify/assert"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestGetLazyInstance</span><span class="hljs-params">(t *testing.T)</span></span> &#123;assert.Equal(t, singleton.GetLazyInstance(), singleton.GetLazyInstance())&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkGetLazyInstanceParallel</span><span class="hljs-params">(b *testing.B)</span></span> &#123;b.RunParallel(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pb *testing.PB)</span></span> &#123;<span class="hljs-keyword">for</span> pb.Next() &#123;<span class="hljs-keyword">if</span> singleton.GetLazyInstance() != singleton.GetLazyInstance() &#123;b.Errorf(<span class="hljs-string">"test fail"</span>)&#125;&#125;&#125;)&#125;</code></pre><h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><blockquote><p>æ„Ÿè°¢ <a href="https://github.com/scuplus/blogComment/issues/231#issuecomment-706009469" target="_blank" rel="noopener">@lixianyang</a> çš„æŒ‡æ­£</p></blockquote><p>å¯ä»¥çœ‹åˆ°ç›´æ¥ init è·å–çš„æ€§èƒ½è¦å¥½ä¸€äº›</p><pre><code class="hljs bash">â–¶ C:\Users\laili\sdk\go1.15\bin\go.exe <span class="hljs-built_in">test</span> -benchmem -bench=<span class="hljs-string">"."</span> -v=== RUN   TestGetLazyInstance--- PASS: TestGetLazyInstance (0.00s)=== RUN   TestGetInstance--- PASS: TestGetInstance (0.00s)goos: windowsgoarch: amd64pkg: github.com/mohuishou/go-design-pattern/01_singletonBenchmarkGetLazyInstanceParallelBenchmarkGetLazyInstanceParallel-4      535702941                2.24 ns/op           0 B/op      0 allocs/opBenchmarkGetInstanceParallelBenchmarkGetInstanceParallel-4          1000000000               0.586 ns/op          0 B/op      0 allocs/opPASSok      github.com/mohuishou/go-design-pattern/01_singleton     3.161s</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç‚¹æ‹™è§-å¦‚ä½•å†™å¥½ä¸€ä¸ªæŠ€æœ¯é¢„ç ”æŠ¥å‘Š?</title>
    <link href="/post/how-to-write-a-pre-research-report.html"/>
    <url>/post/how-to-write-a-pre-research-report.html</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åšäº†ä¸€äº›é¢„ç ”çš„å·¥ä½œï¼Œä¸»è¦æ˜¯ä¸€äº›æŠ€æœ¯è°ƒç ”ï¼ŒæŠ¥å‘Šå‘ˆç°çš„è¿‡ç¨‹å½“ä¸­æ”¶åˆ°äº†è®¸å¤šå»ºè®¾æ€§çš„å»ºè®®ï¼ŒåŒæ—¶åŒ…å«ä¸€ç‚¹è‡ªå·±çš„æ‹™è§ï¼Œå¦‚æœèƒ½ç»™ä½ å¸¦æ¥ä¸€äº›æ€è€ƒï¼Œé‚£æœ€å¥½ä¸è¿‡ã€‚</p><h2 id="æ˜ç¡®é¢å‘å¯¹è±¡"><a href="#æ˜ç¡®é¢å‘å¯¹è±¡" class="headerlink" title="æ˜ç¡®é¢å‘å¯¹è±¡"></a>æ˜ç¡®é¢å‘å¯¹è±¡</h2><p>ä¸€ç¯‡å¥½çš„æ–‡ç« ï¼Œä¸€ä»½å¥½çš„æŠ¥å‘Šä¸€å®šè¦è€ƒè™‘ä¸€ä¸‹çš„ä½ é¢å‘å¯¹è±¡ï¼Œå¦‚ä½•èƒ½å¤Ÿè®©ä»–å¯ä»¥éšç€ä½ çš„æ€è·¯å¿«é€Ÿç®€è¦çš„ç†è§£ä½ æƒ³è¦ä¼ è¾¾çš„å†…å®¹ã€‚é‚£ä¹ˆï¼ŒæŠ€æœ¯é¢„ç ”æŠ¥å‘Šä¸€èˆ¬æ˜¯ç»™è°çœ‹çš„å‘¢ï¼Ÿè¯·æ³¨æ„ï¼Œæˆ‘ä»¬è¿™é‡Œè¯´çš„æŠ¥å‘Šæ˜¯<strong>å†…éƒ¨çš„è°ƒç ”æŠ¥å‘Š</strong>ï¼Œè€Œä¸æ˜¯ä¾‹å¦‚ä¸€äº›ä¸“é—¨åšå’¨è¯¢çš„å…¬å¸ï¼Œæä¾›ç»™å¤–éƒ¨å…¬å¸è´­ä¹°ä½¿ç”¨ã€‚è¿™ç§æŠ¥å‘Šçš„é¢å‘å¯¹è±¡ä¸€èˆ¬è€Œè¨€æ˜¯ä½ çš„ä¸Šçº§ï¼Œæˆ–è€…æ˜¯ä¸Šä¸Šçº§ï¼Œæˆ–è€…æ˜¯æ›´é«˜å±‚çº§çš„é¢†å¯¼ã€‚<br>è¿™ä¸ªæ—¶å€™åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œä»–æ‡‚æŠ€æœ¯ï¼Œä½†æ˜¯å¯èƒ½ä¸äº†è§£ç»†èŠ‚ï¼Œéœ€è¦ä¸€äº›æ•°æ®å¸®åŠ©ä»–åšå†³ç­–ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä»–æ²¡æœ‰å¤ªå¤šçš„æŠ€æœ¯èƒŒæ™¯ï¼Œä¸æ˜¯ç‰¹åˆ«äº†è§£ã€‚</p><ul><li>å¦‚æœæ˜¯ä¸å¤ªäº†è§£æŠ€æœ¯çš„é¢†å¯¼ï¼Œè¦æ³¨æ„ä¸èƒ½ç”¨è¿‡å¤šçš„ä¸“ä¸šæœ¯è¯­ï¼Œåœ¨æŠ¥å‘Šé‡Œé¢å¯ä»¥é€‚å½“çš„æ·»åŠ ä¸€äº›è¯´æ˜ï¼Œç±»æ¯”è¾…åŠ©ç†è§£ï¼Œè¿™ä¸ªç¯‡å¹…éœ€è¦æ³¨æ„ï¼Œä¹Ÿä¸èƒ½è¿‡é•¿ã€‚</li><li>å¦‚æœæ˜¯æ¯”è¾ƒäº†è§£çš„ï¼Œå¯ä»¥æ›´å¤šçš„ä»æŠ€æœ¯æ–¹é¢è¿›è¡Œåˆ†æï¼Œå¯ä»¥æ·»åŠ ä¸€äº›æŠ€æœ¯æŒ‡æ ‡çš„å¯¹æ¯”ã€‚å¯¹äºæŠ€æœ¯é¢„ç ”è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬è¿˜æ˜¯è¿™ç§æƒ…å†µå±…å¤šã€‚</li></ul><p>æ¥ä¸‹æ¥æˆ‘å°±ä¼šä»æŠ€æœ¯é¢„ç ”æŠ¥å‘Šçš„ä¸€ä¸ªæœ€åŸºç¡€çš„æ¨¡æ¿è¯´æ˜æ¯ä¸ªéƒ¨åˆ†éœ€è¦æœ‰å“ªäº›å†…å®¹ï¼Œè¿™ä¸ªä¸æ˜¯æ ‡å‡†ç­”æ¡ˆï¼Œè¿™æ˜¯æˆ‘è®¤ä¸ºçš„ä¸€ä¸ªæŠ¥å‘Šå½“ä¸­å¿…è¦çš„ä¸€äº›å…ƒç´ ã€‚</p><h2 id="é¢„ç ”æŠ¥å‘Šæ¨¡æ¿"><a href="#é¢„ç ”æŠ¥å‘Šæ¨¡æ¿" class="headerlink" title="é¢„ç ”æŠ¥å‘Šæ¨¡æ¿"></a>é¢„ç ”æŠ¥å‘Šæ¨¡æ¿</h2><h3 id="ç†æ¸…ç°çŠ¶"><a href="#ç†æ¸…ç°çŠ¶" class="headerlink" title="ç†æ¸…ç°çŠ¶"></a>ç†æ¸…ç°çŠ¶</h3><p>æŠ€æœ¯é¢„ç ”ä¸€èˆ¬æ˜¯ç”¨æ¥è§£å†³å½“ä¸‹æˆ‘ä»¬éœ€è¦è§£å†³çš„ä¸€äº›é—®é¢˜çš„ï¼Œå¯èƒ½è¿™äº›é—®é¢˜ç”¨å·²æœ‰çš„ç³»ç»Ÿæˆ–è€…æŠ€æœ¯æš‚æ—¶æ— æ³•è§£å†³ï¼Œæˆ–è€…æ˜¯è§£å†³æ–¹æ³•ä¸å¤Ÿä¼˜é›…ï¼Œä¸å¤Ÿç®€æ´ç­‰ç­‰ã€‚æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬éœ€è¦çš„æ˜¯ä»ç°çŠ¶å‡ºå‘ï¼Œç†æ¸…éœ€æ±‚æ‰¾å‡†ç›®æ ‡ã€‚é—®é¢˜æ¥äº†æ€ä¹ˆæè¿°ç°çŠ¶å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­<em>ï¼ˆæ³¨æ„æœ¬æ–‡æ‰€æœ‰ç¤ºä¾‹æ•°æ®å‡æ¥æºäºè™šæ„ï¼‰</em>:</p><h4 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­:"></a>ä¸€ä¸ªä¾‹å­:</h4><ul><li><strong>åé¢æ•™æ: </strong>é›†ç¾¤å†…åº”ç”¨çš„èµ„æºè®¾ç½®ä¸åˆç†</li><li><strong>æ­£é¢æ•™æ: </strong>æœ€è¿‘ä¸€ä¸ªæœˆæŸåŒºåŸŸé›†ç¾¤èŠ‚ç‚¹ NotReady å‘Šè­¦æ¬¡æ•°è¶…è¿‡ 200 æ¬¡ï¼Œå¯¼è‡´ 30 å¤šä¸ªåº”ç”¨ POD æ¼‚ç§»ã€‚å…¶åŸå› æ˜¯ç”±äºåº”ç”¨è¶…é…æ¯”ä¾‹è¿‡é«˜ï¼Œé…ç½®ä¸åˆç†<ul><li>æ•°æ®è¯´è¯: æœ€è¿‘ä¸€ä¸ªæœˆæŸåŒºåŸŸé›†ç¾¤èŠ‚ç‚¹ NotReady å‘Šè­¦æ¬¡æ•°è¶…è¿‡ 200 æ¬¡</li><li>å½±å“èŒƒå›´: å¯¼è‡´ 30 å¤šä¸ªåº”ç”¨ POD æ¼‚ç§»</li><li>åŸå› : åº”ç”¨è¶…é…æ¯”ä¾‹è¿‡é«˜ï¼Œé…ç½®ä¸åˆç†</li></ul></li></ul><p>ä¸Šé¢è¿™ä¸ªç¤ºä¾‹æ˜¯ä¸€ä¸ªæœ€å¸¸è§çš„é”™è¯¯æ¡ˆä¾‹ï¼Œåœ¨ç°çŠ¶åˆ†æå½“ä¸­ï¼Œç»å¸¸<strong>å–œæ¬¢ç›´æ¥è¯´é—®é¢˜çš„åŸå› ï¼Œä¸è¯´è¿™ä¸ªé—®é¢˜å¯¼è‡´çš„ç°è±¡ï¼Œä»¥åŠå½±å“èŒƒå›´ã€‚</strong>æˆ‘ä»¬éœ€è¦æ˜ç™½æŸ¥çœ‹æˆ‘ä»¬è°ƒç ”æŠ¥å‘Šçš„è§‚çœ‹å¯¹è±¡æ˜¯è°ï¼Ÿå¾€å¾€æ˜¯æˆ‘ä»¬çš„ä¸Šçº§æˆ–è€…æ˜¯ä¸Šä¸Šçº§é¢†å¯¼ï¼Œä»–ä»¬ç®¡ç†çš„äº§å“æ¯”è¾ƒå¤šï¼Œä¸ä¸€å®šèƒ½å¤Ÿç†è§£åˆ°ååˆ†ç»†èŠ‚ã€‚æ‰€ä»¥æˆ‘ä»¬è¦<strong>ä»åœºæ™¯è§¦å‘ï¼Œé¦–å…ˆé™ä½æ²Ÿé€šæˆæœ¬ï¼Œç½—åˆ—å†å²æ•°æ®ï¼Œå¢å¼ºè¯´æœåŠ›çš„åŒæ—¶å¯ä»¥å¸®åŠ©ä»–ä»¬äº†è§£å½“å‰äº§å“çš„ç°çŠ¶ã€‚</strong></p><h4 id="å¦‚ä½•è¯´æ˜ç°çŠ¶"><a href="#å¦‚ä½•è¯´æ˜ç°çŠ¶" class="headerlink" title="å¦‚ä½•è¯´æ˜ç°çŠ¶?"></a>å¦‚ä½•è¯´æ˜ç°çŠ¶?</h4><ul><li>ä»å®é™…çš„åœºæ™¯å‡ºå‘ï¼Œç®€æ˜æ‰¼è¦çš„è¯´æ˜æ›¾ä»Šå‡ºç°è¿‡æˆ–è€…å½“å‰å­˜åœ¨ç€çš„é—®é¢˜</li><li>ç”¨æ•°æ®è¯´è¯ï¼Œç»Ÿè®¡å†å²æ•°æ®ï¼ŒåŒ…å«ä½†ä¸é™äºï¼Œå½±å“èŒƒå›´ï¼Œå‡ºç°çš„æ¬¡æ•°ï¼Œåé¦ˆç”¨æˆ·äººæ¬¡ç­‰ç­‰</li></ul><h3 id="ç•…æƒ³æœªæ¥"><a href="#ç•…æƒ³æœªæ¥" class="headerlink" title="ç•…æƒ³æœªæ¥"></a>ç•…æƒ³æœªæ¥</h3><p>äº†è§£äº†ç°çŠ¶ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå¿ƒç†é¢„æœŸçš„ç»“æœï¼Œæˆ‘ä»¬æœŸæœ›ç†æƒ³çŠ¶æ€ä¸‹ï¼Œèƒ½å¤Ÿè¾¾åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œè¿™ä¸€éƒ¨åˆ†å¯ä»¥è„‘æ´å¤§ä¸€äº›ï¼ŒæœŸæœ›é«˜ä¸€ç‚¹ï¼Œä¸è¦å±€é™åœ¨çœ¼å‰ã€‚</p><h4 id="ä¸€ä¸ªä¾‹å­-1"><a href="#ä¸€ä¸ªä¾‹å­-1" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h4><ul><li><strong>åé¢æ•™æ: </strong>é›†ç¾¤å†…åº”ç”¨éšæ„æ¼‚ç§»ï¼Œå¯ä»¥å‡å°‘é›†ç¾¤ä¸­èŠ‚ç‚¹æ•…éšœæ¬¡æ•°</li><li><strong>æ­£é¢æ•™æ: </strong>ä¸ºä¸šåŠ¡åº”ç”¨æä¾›å®‰å…¨ã€å¯é ã€ç¨³å®šã€èˆ’å¿ƒçš„æœåŠ¡ï¼Œä¸šåŠ¡é«˜å³°æ—¶èµ„æºåŠæ—¶æ‰©å®¹ï¼Œæ´ªå³°æ¥ä¸´æ—¶ï¼Œä¼˜å…ˆç¡®ä¿æ ¸å¿ƒåº”ç”¨ç¨³å®šï¼ŒåŠ›äº‰åšåˆ°è®©å¼€å‘æ—©ä¸‹ç­ï¼Œè¿ç»´ä¸åŠ ç­ï¼Œå‘¨æœ«æ— å‘Šè­¦ï¼Œå‡æœŸæ— è´Ÿæ‹…ã€‚</li></ul><p>è¿™ä¸¤ä¸ªä¾‹å­é‡Œé¢ï¼Œåé¢æ•™æå¤ªè¿‡äºåŠ¡å®äº†ï¼Œè¿™ä¸ªåªèƒ½è¯´æ˜¯å±…äºç°çŠ¶çš„æ”¹è¿›ï¼Œä¸èƒ½è¯´æ˜¯å¯¹æœªæ¥åœºæ™¯çš„æƒ³è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸€ä¸ªå¸¸è§çš„åœºæ™¯åŠ ä¸Šä¸€äº›å½¢è€Œä¸Šçš„æƒ³è±¡ã€‚</p><h4 id="å¦‚ä½•ç•…äº«æœªæ¥ï¼Ÿ"><a href="#å¦‚ä½•ç•…äº«æœªæ¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç•…äº«æœªæ¥ï¼Ÿ"></a>å¦‚ä½•ç•…äº«æœªæ¥ï¼Ÿ</h4><ul><li>ä»åœºæ™¯å‡ºå‘ï¼Œæç»˜ç†æƒ³çŠ¶æ€ä¸‹å¯ä»¥è¾¾åˆ°çš„çŠ¶æ€</li><li>ç»“åˆç°çŠ¶ï¼Œåˆ‡å¿Œè·‘é¢˜ï¼Œè¿™æ˜¯å±•æœ›æœªæ¥çš„æ—¶å€™ï¼Œæˆ‘æœ€å®¹æ˜“çŠ¯çš„ä¸€ä¸ªé”™è¯¯ï¼Œå…±å‹‰ã€‚</li></ul><h3 id="è¡Œä¸šå®è·µ"><a href="#è¡Œä¸šå®è·µ" class="headerlink" title="è¡Œä¸šå®è·µ"></a>è¡Œä¸šå®è·µ</h3><p>ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šå¯ä»¥è®©æˆ‘ä»¬çœ‹çš„æ›´è¿œï¼Œç»å¤§éƒ¨åˆ†çš„æƒ…å†µä¸‹è°ƒç ”æ—¶å€™çš„éœ€æ±‚éƒ½ä¼šæœ‰ä¸€äº›ä¸šç•Œçš„å®è·µæ¡ˆä¾‹ï¼Œç”šè‡³æœ‰ä¸€äº›å¼€æºçš„ç¤¾åŒºæ–¹æ¡ˆï¼Œä¾‹å¦‚ Googleã€äºšé©¬é€Šã€é˜¿é‡Œã€è…¾è®¯ç­‰ï¼Œè¿™æ˜¯è¯´ä»–ä»¬çš„æ–¹æ¡ˆæ˜¯å¦é€‚åˆæˆ‘ä»¬ï¼Œèƒ½å¦è½åœ°ã€‚<br>å¯¹äºè¡Œä¸šçš„å®è·µè¿™ä¸€å—çš„å†…å®¹ï¼Œå»ºè®®<strong>é‡‡ç”¨è¡¨æ ¼çš„æ–¹å¼è¿›è¡Œå¯¹æ¯”</strong>ï¼Œå¦‚æœå¯ä»¥çš„è¯è¿˜å¯ä»¥åšä¸€äº›<strong>ç°åœºæ¼”ç¤º</strong>ï¼Œæˆ–è€…æ˜¯<strong>å½•åˆ¶è§†é¢‘ã€‚</strong></p><table><thead><tr><th>ç»´åº¦</th><th>ç°çŠ¶</th><th>æ–¹æ¡ˆ A</th><th>æ–¹æ¡ˆ B</th><th>æ–¹æ¡ˆ C</th></tr></thead><tbody><tr><td>ç»´åº¦ 1</td><td>ç°çŠ¶ 1</td><td>âŒ æ–¹æ¡ˆ A</td><td>æ–¹æ¡ˆ B</td><td>âœ… æ–¹æ¡ˆ C</td></tr><tr><td>ç»´åº¦ 2</td><td>ç°çŠ¶ 1</td><td>âœ… æ–¹æ¡ˆ A</td><td>âŒ æ–¹æ¡ˆ B</td><td>æ–¹æ¡ˆ C</td></tr></tbody></table><p>å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œå°±æ˜¯ä¸€ä¸ªååˆ†å¸¸è§çš„ä¸€ä¸ªå¯¹æ¯”è¡¨æ ¼ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€å®š<strong>ä¸è¦å¿˜è®°æˆ‘ä»¬å½“å‰çš„ç°çŠ¶æ˜¯ä»€ä¹ˆ</strong>ï¼Œæœ€åå¯ä»¥æœ‰ä¸€ä¸ªæ€»ç»“ï¼Œè¯´æ˜ä¸åŒæ–¹æ¡ˆçš„ä¼˜åŠ£ä¹‹å¤„ï¼Œå¦‚æœé‡‡ç”¨æŸä¸ªæ–¹æ¡ˆï¼Œåç»­æ˜¯å¦éœ€è¦æ›´åŠ æ·±å…¥çš„è°ƒç ”ç­‰ç­‰ã€‚</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p><strong>è°ƒç ”ä¸€å®šè¦æœ‰ç»“è®º!</strong><br>è¿™é‡Œç»“è®ºä¸æ˜¯å†³ç­–ï¼Œä¹Ÿä¸æ˜¯ä¸€å®šæ˜¯æ–¹æ¡ˆï¼Œç”±äºæ—¶é—´ã€ç²¾åŠ›ä»¥åŠäº†è§£åˆ°çš„ä¿¡æ¯ç­‰ç­‰é™åˆ¶ï¼Œå¯èƒ½å¯¼è‡´æˆ‘ä»¬å½“ä¸‹æ˜¯æ— æ³•å¾—å‡ºä¸€ä¸ªå†³ç­–ï¼Œæ˜¯å¦é‡‡ç”¨æŸä¸ªæ–¹æ¡ˆï¼Œä½†æ˜¯ä¸€å®šè¦æœ‰ç»“è®ºï¼Œè¿™ä¸ªç»“è®ºï¼Œæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªæ–¹å‘ä¸Šçš„å»ºè®®ï¼Œä¹Ÿå¯ä»¥æ˜¯éœ€è¦ç»§ç»­æ·±å…¥è°ƒç ”ã€‚åˆ‡è®°ä¸èƒ½ä»…ä¸ºäº†è°ƒç ”è€Œè°ƒç ”ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>â€œæ²¡æœ‰åæ€å’Œè¿›æ­¥çš„äººç”Ÿä¸å€¼å¾—ä¸€è¿‡â€ï¼Œæœ€è¿‘æŒºå–œæ¬¢è¿™å¥ Sloganï¼Œæˆ‘è§‰å¾—åæ€å’Œæ€»ç»“å¯ä»¥è¿›æ­¥æ›´å¿«ï¼Œæˆ‘çš„ä¸€ç‚¹æ‹™è§æˆ–è®¸ç”±äºæˆ‘çš„è§†é‡åŸå› ï¼Œä¼šæ¯”è¾ƒç‹­éš˜ï¼Œä½†æ˜¯å¦‚æœä½ å¦‚æœçœ‹äº†è¿™ç¯‡æ–‡ç« èƒ½æœ‰ä¸€äº›æ€è€ƒï¼Œæ— è®ºè®¤åŒä¸å¦ï¼Œé‚£éƒ½å¾ˆå€¼å¾—ã€‚</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/22757.html">2018å¹´çš„ä¸€äº›å°ç›®æ ‡</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>æ€»ç»“</tag>
      
      <tag>åæ€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</title>
    <link href="/post/auxvv1.html"/>
    <url>/post/auxvv1.html</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ€è¿‘åœ¨æ›´æ–°å†…éƒ¨çš„å·¥å…·åº“çš„æ—¶å€™å‘ç°ï¼Œå·¥å…·ä»“åº“ä¸­å…¶å®åŒ…å«äº†å¾ˆå¤šçš„æ¨¡å—ï¼Œä½†æ˜¯ç°åœ¨çš„ç‰ˆæœ¬å‘å¸ƒéƒ½æ˜¯åˆå¹¶åœ¨åœ¨ä¸€èµ·å‘çš„ï¼Œä¸ºäº†ç®¡ç†æ›´åŠ ç»†è‡´å’Œç›´è§‚ï¼Œæ‰€ä»¥æƒ³è¦åœ¨ä¸€ä¸ªä»“åº“ä¸­å®ç°å®ç°å¤šä¸ªæ¨¡å—çš„å‘å¸ƒã€‚<a id="more"></a></p><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><ol><li>å•ä¸ªä»“åº“ä¸­åŒ…å«å¤šä¸ª go module æ¨¡å—</li><li>ç‰ˆæœ¬å‘å¸ƒå¯ä»¥æ ¹æ®æ¨¡å—æ¥å‘ç‰ˆï¼Œè€Œä¸æ˜¯æ•´ä¸ªä»“åº“è¿›è¡Œå‘ç‰ˆ</li></ol><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="ä»“åº“ç»“æ„"><a href="#ä»“åº“ç»“æ„" class="headerlink" title="ä»“åº“ç»“æ„"></a>ä»“åº“ç»“æ„</h3><p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªä»“åº“ <code>github.com/mohuishou/go-test-multi-module</code> ç›®å½•ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º</p><pre><code class="hljs bash">.â”œâ”€â”€ aâ”‚   â”œâ”€â”€ a.goâ”‚   â””â”€â”€ go.modâ””â”€â”€ b    â”œâ”€â”€ b.go    â””â”€â”€ go.mod</code></pre><p>å…¶ä¸­ <code>a/go.mod</code> ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ</p><pre><code class="hljs bash">go mod init github.com/mohuishou/go-test-multi-module/a</code></pre><h3 id="ç‰ˆæœ¬å‘å¸ƒ"><a href="#ç‰ˆæœ¬å‘å¸ƒ" class="headerlink" title="ç‰ˆæœ¬å‘å¸ƒ"></a>ç‰ˆæœ¬å‘å¸ƒ</h3><p>å¯¹æ¨¡å—è¿›è¡Œå‘ç‰ˆæ—¶ï¼Œåªéœ€æ‰“ä¸Š <code>[æ¨¡å—å]/ç‰ˆæœ¬å·</code> å³å¯<br>ä»¥æˆ‘ä»¬çš„ç¤ºä¾‹ä¸ºä¾‹ï¼Œå¯¹æ¨¡å— <code>a</code> è¿›è¡Œå‘ç‰ˆæ—¶æˆ‘ä»¬åªéœ€è¦æ‰“ä¸Š tag <code>a/v1.0.0</code> ï¼ŒåŒç†å¯¹æ¨¡å— b è¿›è¡Œå‘ç‰ˆæ—¶ï¼Œéœ€è¦æ‰“ä¸Š tag <code>b/v1.0.0</code> å³å¯</p><h3 id="ç”¨æˆ·ä½¿ç”¨"><a href="#ç”¨æˆ·ä½¿ç”¨" class="headerlink" title="ç”¨æˆ·ä½¿ç”¨"></a>ç”¨æˆ·ä½¿ç”¨</h3><p>ç”¨æˆ·åœ¨å®‰è£…çš„æ—¶å€™åªéœ€è¦å’Œæ™®é€šæ¨¡å—ä¸€æ ·æ‰§è¡Œå‘½ä»¤å³å¯</p><pre><code class="hljs bash">go get -u github.com/mohuishou/go-test-multi-module/a</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¸æ¨èé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œè¿˜æ˜¯ä¸€ä¸ªä»“åº“ä¸€ä¸ªæ¨¡å—æ¯”è¾ƒå¥½ï¼Œä¾¿äºç®¡ç†ï¼Œä½†æ˜¯å¯¹äºä¸€äº›å·¥å…·åº“é‡Œé¢åŒ…å«äº†è¾ƒå¤šçš„å·¥å…·ï¼Œæƒ³è¦ä¸åŒç±»å‹å•ç‹¬å‘ç‰ˆä¹Ÿå¯ä»¥é‡‡ç”¨æœ¬æ–‡æåˆ°çš„æ–¹å¼</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://github.com/mohuishou/go-test-multi-module" target="_blank" rel="noopener">æœ¬æ–‡çš„ç¤ºä¾‹ä»“åº“</a></li><li><a href="https://github.com/golang/tools/releases" target="_blank" rel="noopener">golang/tools</a> [å®˜æ–¹çš„ gopls ä¹Ÿæ˜¯è¿™ä¹ˆå‘å¸ƒç‰ˆæœ¬çš„]</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li><li><a href="https://lailin.xyz/post/38237.html">Go Web å°æŠ€å·§ï¼ˆä¸€ï¼‰ç®€åŒ–Ginæ¥å£ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>å°æŠ€å·§</tag>
      
      <tag>go mod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</title>
    <link href="/post/11996.html"/>
    <url>/post/11996.html</url>
    
    <content type="html"><![CDATA[<h2 id="æ¥”-xie-å­"><a href="#æ¥”-xie-å­" class="headerlink" title="æ¥”(xiÄ“)å­"></a>æ¥”(xiÄ“)å­</h2><p>åœ¨ç¬¬ä¸€ç¯‡æ–‡ç«  <a href="https://lailin.xyz/post/38237.html">ç®€åŒ– Gin æ¥å£ä»£ç </a> å½“ä¸­ä¸ºå¤§å®¶æä¾›äº†ä¸€ç§æŠ½è±¡ <code>gin</code> æ¥å£ä»£ç çš„æ€è·¯ï¼Œè€Œè¿™ç¯‡æ–‡ç« ä¼šä¸ºå¤§å®¶å¸¦æ¥å‚æ•°ç»‘å®šçš„ä¸€äº›æŠ€å·§ã€‚</p><p>åœ¨æˆ‘ä»¬å†™çš„ç»å¤§éƒ¨åˆ†çš„ API ä»£ç å½“ä¸­ï¼Œå…¶å®éƒ½æ˜¯éœ€è¦ä¼ é€’å‚æ•°çš„ï¼Œæ— è®ºæ˜¯é€šè¿‡ <code>path</code>ã€<code>query string</code> è¿˜æ˜¯ <code>body</code>ï¼Œåœ¨ <code>gin</code> å½“ä¸­ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„ <code>binding</code> æ–¹æ³•è®©æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å‚æ•°ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œé€šè¿‡è¿˜å¯ä»¥é€šè¿‡ <code>struct tag</code> æ¥å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œä¸çŸ¥é“åˆ°å¤§å®¶æ›¾ä»Šæ˜¯å¦å’Œé‡åˆ°è¿‡ç›¸åŒçš„å›°æƒ‘ï¼š</p><ul><li>æˆ‘åˆ›å»º/æ›´æ–°æ¥å£æœ‰æ—¶å€™å°±ä»…ä»…åªç›¸å·®ä¸€ä¸ª idï¼Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥å¤ç”¨ä»£ç ï¼Ÿ</li><li>æ˜¯å¦å¯ä»¥ç›´æ¥ç”¨ model å±‚çš„ struct ç»‘å®šå‚æ•°ï¼Ÿ</li></ul><p>æ¥ä¸‹æ¥æœ¬æ–‡å°±ä»è¿™äº›é—®é¢˜å‡ºå‘ï¼Œåˆ©ç”¨ go çš„ç»„åˆç‰¹ç‚¹ï¼Œä»‹ç»ä¸€äº›å‚æ•°ç»‘å®šä¸Šçš„å°æŠ€å·§</p><a id="more"></a><h2 id="å‚æ•°ç»‘å®šæŠ€å·§"><a href="#å‚æ•°ç»‘å®šæŠ€å·§" class="headerlink" title="å‚æ•°ç»‘å®šæŠ€å·§"></a>å‚æ•°ç»‘å®šæŠ€å·§</h2><h3 id="1-å¤ç”¨åˆ›å»º-æ›´æ–°æ—¶çš„å‚æ•°"><a href="#1-å¤ç”¨åˆ›å»º-æ›´æ–°æ—¶çš„å‚æ•°" class="headerlink" title="1. å¤ç”¨åˆ›å»º/æ›´æ–°æ—¶çš„å‚æ•°"></a>1. å¤ç”¨åˆ›å»º/æ›´æ–°æ—¶çš„å‚æ•°</h3><pre><code class="hljs go"><span class="hljs-comment">// UserParams ç”¨æˆ·å‚æ•°</span><span class="hljs-keyword">type</span> UserParams <span class="hljs-keyword">struct</span> &#123;Name     <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"name" binding:"required"`</span>Password <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"password" binding:"required"`</span>&#125;<span class="hljs-comment">// CreateUserParams åˆ›å»ºç”¨æˆ·</span><span class="hljs-keyword">type</span> CreateUserParams <span class="hljs-keyword">struct</span> &#123;UserParams&#125;<span class="hljs-comment">// UpdateUserParams æ›´æ–°ç”¨æˆ·</span><span class="hljs-keyword">type</span> UpdateUserParams <span class="hljs-keyword">struct</span> &#123;UserParamsID <span class="hljs-keyword">uint</span> <span class="hljs-string">`json:"id" binding:"required"`</span>&#125;</code></pre><h3 id="2-ç”¨-model-å±‚çš„-struct-ç»‘å®šå‚æ•°"><a href="#2-ç”¨-model-å±‚çš„-struct-ç»‘å®šå‚æ•°" class="headerlink" title="2. ç”¨ model å±‚çš„ struct ç»‘å®šå‚æ•°"></a>2. ç”¨ model å±‚çš„ struct ç»‘å®šå‚æ•°</h3><p>å¦‚æœæˆ‘ä»¬åœ¨å‚æ•°ç»‘å®šçš„æ—¶å€™ï¼Œå‘ä¸Šé¢é‚£æ ·ï¼Œæ¯ä¸ªå‚æ•°å•ç‹¬åˆ›å»ºä¸€ä¸ªç»‘å®šï¼Œè¿™æ ·åœ¨ Model å±‚åˆ›å»ºæ•°æ®åº“è®°å½•çš„æ—¶å€™å°±éœ€è¦å»æ‰‹åŠ¨çš„è½¬æ¢ä¸€é“äº†ï¼Œå¦‚æœæ¯ä¸ªéƒ½éœ€è¦è¿™ä¹ˆå†™ï¼Œä¼šæ„Ÿè§‰å¾ˆéº»çƒ¦ã€‚</p><p>è¿™æ˜¯åŸæœ¬çš„ <code>user</code> è¡¨</p><pre><code class="hljs go"><span class="hljs-comment">// model/model.go</span><span class="hljs-comment">// Model default model</span><span class="hljs-keyword">type</span> Model <span class="hljs-keyword">struct</span> &#123;ID        <span class="hljs-keyword">uint</span>       <span class="hljs-string">`json:"id" gorm:"primary_key"`</span>CreatedAt time.Time  <span class="hljs-string">`json:"created_at"`</span>UpdatedAt time.Time  <span class="hljs-string">`json:"updated_at"`</span>DeletedAt *time.Time <span class="hljs-string">`json:"deleted_at" sql:"index"`</span>&#125;<span class="hljs-comment">// model/user.go</span><span class="hljs-comment">// User ç”¨æˆ·è¡¨</span><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;    ModelName     <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"name"`</span>Password <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"password"`</span>&#125;</code></pre><p>è¿™æ—¶æˆ‘ä»¬å¯ä»¥ç¨å¾®æ”¹é€ ä¸€ä¸‹, åˆ©ç”¨ <code>binding:&quot;-&quot;</code> å¿½ç•¥å­—æ®µçš„åŠŸèƒ½ï¼Œå’Œ <code>struct</code> ç»„åˆï¼Œå°† api çš„å‚æ•°å’Œ model å…³è”åœ¨ä¸€èµ·ï¼Œå‡å°‘ä¸€äº›ç»“æ„ä½“è½¬æ¢çš„ä»£ç </p><pre><code class="hljs go"><span class="hljs-comment">// model/model.go</span><span class="hljs-comment">// Model default model</span><span class="hljs-keyword">type</span> Model <span class="hljs-keyword">struct</span> &#123;    ID        <span class="hljs-keyword">uint</span>       <span class="hljs-string">`json:"id" gorm:"primary_key"`</span>CreatedAt time.Time  <span class="hljs-string">`json:"created_at" binding:"-"`</span>UpdatedAt time.Time  <span class="hljs-string">`json:"updated_at" binding:"-"`</span>DeletedAt *time.Time <span class="hljs-string">`json:"deleted_at" sql:"index" binding:"-"`</span>&#125;<span class="hljs-comment">// model/user.go</span><span class="hljs-comment">// User ç”¨æˆ·è¡¨</span><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;    ModelName     <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"name" binding:"required"`</span>Password <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"password" binding:"required"`</span>&#125;<span class="hljs-comment">// api/user.go</span><span class="hljs-comment">// UserParams ç”¨æˆ·å‚æ•°</span><span class="hljs-keyword">type</span> UserParams <span class="hljs-keyword">struct</span> &#123;    model.User&#125;<span class="hljs-comment">// CreateUserParams åˆ›å»ºç”¨æˆ·</span><span class="hljs-keyword">type</span> CreateUserParams <span class="hljs-keyword">struct</span> &#123;UserParams    ID    <span class="hljs-keyword">uint</span>    <span class="hljs-string">`json:"id" gorm:"primary_key" binding:"-"`</span>&#125;<span class="hljs-comment">// UpdateUserParams æ›´æ–°ç”¨æˆ·</span><span class="hljs-keyword">type</span> UpdateUserParams <span class="hljs-keyword">struct</span> &#123;UserParams&#125;</code></pre><h3 id="3-ä½¿ç”¨-ShouldBind-è€Œä¸æ˜¯-Bind"><a href="#3-ä½¿ç”¨-ShouldBind-è€Œä¸æ˜¯-Bind" class="headerlink" title="3. ä½¿ç”¨ ShouldBind è€Œä¸æ˜¯ Bind"></a>3. ä½¿ç”¨ <code>ShouldBind</code> è€Œä¸æ˜¯ <code>Bind</code></h3><p><code>Bind</code> æ–¹æ³•ä¼šè‡ªåŠ¨å°† http status è®¾ç½®ä¸º 400, ç„¶åæŠ¥é”™ï¼Œä½†æ˜¯æˆ‘ä»¬å¾€å¾€ä¼šéœ€è¦æºå¸¦æ›´å¤šçš„ä¿¡æ¯è¿”å›ï¼Œæˆ–è€…è¿”å›ä¸åŒçš„ <code>status</code> è¿™æ—¶å€™å¾€å¾€ä¼šå‡ºç°ä¸‹é¢è¿™æ ·çš„è­¦å‘Šï¼Œè€Œä½¿ç”¨ <code>ShouldBind</code> å¯ä»¥é¿å…æ­¤ç±»é—®é¢˜</p><pre><code class="hljs bash">[WARNING] Headers were already written. Wanted to override status code 400 with 200</code></pre><h3 id="4-å¤šæ¬¡ç»‘å®š-request-body-æ•°æ®"><a href="#4-å¤šæ¬¡ç»‘å®š-request-body-æ•°æ®" class="headerlink" title="4. å¤šæ¬¡ç»‘å®š request body æ•°æ®"></a>4. å¤šæ¬¡ç»‘å®š request body æ•°æ®</h3><p>è¿™æ˜¯å®˜æ–¹æ–‡æ¡£çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œä¸€èˆ¬æƒ…å†µç¬¬äºŒæ¬¡è¯»å– request body çš„æ•°æ®å°±ä¼šå‡ºç° EOF çš„é”™è¯¯ï¼Œå› ä¸º <code>c.Request.Body</code> ä¸å¯ä»¥é‡ç”¨</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> formA <span class="hljs-keyword">struct</span> &#123;  Foo <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"foo" binding:"required"`</span>&#125;<span class="hljs-keyword">type</span> formB <span class="hljs-keyword">struct</span> &#123;  Bar <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"bar" binding:"required"`</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SomeHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;  objA := formA&#123;&#125;  objB := formB&#123;&#125;  <span class="hljs-comment">// c.ShouldBind ä½¿ç”¨äº† c.Request.Bodyï¼Œä¸å¯é‡ç”¨ã€‚</span>  <span class="hljs-keyword">if</span> errA := c.ShouldBind(&amp;objA); errA == <span class="hljs-literal">nil</span> &#123;    c.String(http.StatusOK, <span class="hljs-string">`the body should be formA`</span>)  <span class="hljs-comment">// å› ä¸ºç°åœ¨ c.Request.Body æ˜¯ EOFï¼Œæ‰€ä»¥è¿™é‡Œä¼šæŠ¥é”™ã€‚</span>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> errB := c.ShouldBind(&amp;objB); errB == <span class="hljs-literal">nil</span> &#123;    c.String(http.StatusOK, <span class="hljs-string">`the body should be formB`</span>)  &#125; <span class="hljs-keyword">else</span> &#123;    ...  &#125;&#125;</code></pre><p>gin 1.4 ä¹‹åå®˜æ–¹æä¾›äº†ä¸€ä¸ª <code>ShouldBindBodyWith</code> çš„æ–¹æ³•ï¼Œå¯ä»¥æ”¯æŒé‡å¤ç»‘å®šï¼ŒåŸç†å°±æ˜¯å°† body çš„æ•°æ®ç¼“å­˜äº†ä¸‹æ¥ï¼Œä½†æ˜¯äºŒæ¬¡å–æ•°æ®çš„æ—¶å€™è¿˜æ˜¯å¾—ç”¨ <code>ShouldBindBodyWith</code> æ‰è¡Œï¼Œç›´æ¥ç”¨ <code>ShouldBind</code> è¿˜æ˜¯ä¼šæŠ¥é”™çš„ã€‚</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SomeHandler</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;  objA := formA&#123;&#125;  objB := formB&#123;&#125;  <span class="hljs-comment">// è¯»å– c.Request.Body å¹¶å°†ç»“æœå­˜å…¥ä¸Šä¸‹æ–‡ã€‚</span>  <span class="hljs-keyword">if</span> errA := c.ShouldBindBodyWith(&amp;objA, binding.JSON); errA == <span class="hljs-literal">nil</span> &#123;    c.String(http.StatusOK, <span class="hljs-string">`the body should be formA`</span>)  <span class="hljs-comment">// è¿™æ—¶, å¤ç”¨å­˜å‚¨åœ¨ä¸Šä¸‹æ–‡ä¸­çš„ bodyã€‚</span>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> errB := c.ShouldBindBodyWith(&amp;objB, binding.JSON); errB == <span class="hljs-literal">nil</span> &#123;    c.String(http.StatusOK, <span class="hljs-string">`the body should be formB JSON`</span>)  <span class="hljs-comment">// å¯ä»¥æ¥å—å…¶ä»–æ ¼å¼</span>  &#125; <span class="hljs-keyword">else</span> &#123;    ...  &#125;&#125;</code></pre><p>è¿™ç§æ–¹å¼å…¶å®æœ‰ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬ä¼šå»å¤šæ¬¡è¯»å– <code>body</code> çš„æ•°æ®ï¼Œå…¶å®åœ¨ä¸­é—´ä»¶ä¸­æˆ‘ä»¬æ˜¯éœ€è¦ç”¨åˆ°ï¼Œæœ‰çš„ä¸­é—´ä»¶éœ€è¦è¯»å–å‚æ•°åšä¸€äº›å¤„ç†ï¼Œä¾‹å¦‚æƒé™ä¸­é—´ä»¶éœ€è¦è·å–å½“å‰èµ„æºçš„ idï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ç›´æ¥ä½¿ç”¨ <code>ShouldBindBodyWith</code> ä¼šå¯¼è‡´ä¹‹åçš„æ‰€æœ‰çš„æ¥å£éƒ½ä¿®æ”¹æ‰è¡Œï¼Œååˆ†çš„ä¸ä¼˜é›…ï¼Œä¸‹é¢æä¾›ä¸€ç§ä¸ç”¨å½±å“åç»­ä½¿ç”¨çš„æ–¹æ³•</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">startPage</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<span class="hljs-keyword">var</span> (p1 Personp2 Person)buf := &amp;bytes.Buffer&#123;&#125;tea := io.TeeReader(c.Request.Body, buf)body, err := ioutil.ReadAll(tea)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Panicf(<span class="hljs-string">"read body err: %+v"</span>, err)&#125;c.Request.Body = ioutil.NopCloser(buf)<span class="hljs-comment">// read buf ...</span><span class="hljs-keyword">if</span> err := binding.JSON.BindBody(body, &amp;p1); err != <span class="hljs-literal">nil</span> &#123;log.Panic(<span class="hljs-string">"p1"</span>, err)&#125;log.Println(<span class="hljs-string">"p1"</span>, p1)<span class="hljs-comment">// use ShouldBind again ..</span><span class="hljs-keyword">if</span> err := c.ShouldBind(&amp;p2); err != <span class="hljs-literal">nil</span> &#123;log.Panic(<span class="hljs-string">"p2"</span>, err)&#125;log.Println(<span class="hljs-string">"p2"</span>, p2)c.String(<span class="hljs-number">200</span>, <span class="hljs-string">"Success"</span>)&#125;<span class="hljs-comment">// output</span><span class="hljs-comment">// 2019/11/06 23:10:04 p1 &#123;hello world&#125;</span><span class="hljs-comment">// 2019/11/06 23:10:04 p2 &#123;hello world&#125;</span><span class="hljs-comment">// [GIN] 2019/11/06 - 23:10:04 | 200 |   27.0400917s |             ::1 | POST     /testing</span></code></pre><p>è¿™ä¸‰è¡Œä¹Ÿé€‚ç”¨äºå…¶ä»–éœ€è¦å¤šæ¬¡è¯»å– <code>io.Reader</code> çš„æƒ…å†µ</p><pre><code class="hljs go">buf := &amp;bytes.Buffer&#123;&#125;tea := io.TeeReader(c.Request.Body, buf)body, err := ioutil.ReadAll(tea)</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« ä»å‚æ•°ç»‘å®šçš„é—®é¢˜å‡ºå‘ï¼Œä¸ºå¤§å®¶ä»‹ç»äº†ä¸¤ç§ç»„åˆå‚æ•°çš„å°æŠ€å·§ï¼Œæä¾›äº†ä½¿ç”¨å‚æ•°ç»‘å®šçš„æ—¶å€™çš„ä¸€ä¸ªå»ºè®®ï¼Œå¹¶ä¸”æå‡ºäº†éå®˜æ–¹ï¼Œä¾µå…¥æ€§å°çš„çš„å¤šæ¬¡è¯»å– request body çš„æ–¹å¼ã€‚</p><p>ä¸‹ä¸€ç¯‡æ–‡ç« ç»™å¤§å®¶ä»‹ç» gorm äº‹åŠ¡çš„ä¸€äº›å°æŠ€å·§</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><p><a href="https://gin-gonic.com/zh-cn/" target="_blank" rel="noopener">gin å®˜æ–¹æ–‡æ¡£</a></p></li><li><p><a href="https://stackoverflow.com/questions/39791021/how-to-read-multiple-times-from-same-io-reader" target="_blank" rel="noopener">How to read multiple times from same io.Reader</a></p></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li><li><a href="https://lailin.xyz/post/38237.html">Go Web å°æŠ€å·§ï¼ˆä¸€ï¼‰ç®€åŒ–Ginæ¥å£ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>å°æŠ€å·§</tag>
      
      <tag>api</tag>
      
      <tag>gin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</title>
    <link href="/post/17394.html"/>
    <url>/post/17394.html</url>
    
    <content type="html"><![CDATA[<p>ä¸çŸ¥é“å¤§å®¶åœ¨ä½¿ç”¨ Gorm çš„æ—¶å€™ï¼Œæ˜¯å¦æœ‰é‡åˆ°è¿‡å¤æ‚ç±»å‹ ( map, structâ€¦) å¦‚ä½•æ˜ å°„åˆ°æ•°æ®åº“çš„å­—æ®µä¸Šçš„é—®é¢˜ï¼Ÿ</p><p>æœ¬æ–‡åˆ†åˆ«ä»‹ç»é€šè¿‡å®ç°é€šç”¨æ¥å£å’Œ Hook çš„æ–¹å¼ç»‘å®šå¤æ‚çš„æ•°æ®ç±»å‹ã€‚</p><a id="more"></a><h2 id="ä¸€ã€GORM-æ¨¡å‹å®šä¹‰"><a href="#ä¸€ã€GORM-æ¨¡å‹å®šä¹‰" class="headerlink" title="ä¸€ã€GORM æ¨¡å‹å®šä¹‰"></a>ä¸€ã€GORM æ¨¡å‹å®šä¹‰</h2><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;  gorm.Model  Name         <span class="hljs-keyword">string</span>  Age          sql.NullInt64  Birthday     *time.Time  Email        <span class="hljs-keyword">string</span>  <span class="hljs-string">`gorm:"type:varchar(100);unique_index"`</span>  Role         <span class="hljs-keyword">string</span>  <span class="hljs-string">`gorm:"size:255"`</span> <span class="hljs-comment">// è®¾ç½®å­—æ®µå¤§å°ä¸º255</span>  MemberNumber *<span class="hljs-keyword">string</span> <span class="hljs-string">`gorm:"unique;not null"`</span> <span class="hljs-comment">// è®¾ç½®ä¼šå‘˜å·ï¼ˆmember numberï¼‰å”¯ä¸€å¹¶ä¸”ä¸ä¸ºç©º</span>  Num          <span class="hljs-keyword">int</span>     <span class="hljs-string">`gorm:"AUTO_INCREMENT"`</span> <span class="hljs-comment">// è®¾ç½® num ä¸ºè‡ªå¢ç±»å‹</span>  Address      <span class="hljs-keyword">string</span>  <span class="hljs-string">`gorm:"index:addr"`</span> <span class="hljs-comment">// ç»™addresså­—æ®µåˆ›å»ºåä¸ºaddrçš„ç´¢å¼•</span>  IgnoreMe     <span class="hljs-keyword">int</span>     <span class="hljs-string">`gorm:"-"`</span> <span class="hljs-comment">// å¿½ç•¥æœ¬å­—æ®µ</span>&#125;</code></pre><p>è¿™æ˜¯ GORM å®˜æ–¹æ–‡æ¡£å½“ä¸­æ¨¡å‹å®šä¹‰çš„ä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹å½“ä¸­å¾€å¾€ä¼šé‡åˆ°éœ€è¦å¤æ‚ç±»å‹ä¾‹å¦‚ <code>map</code> æˆ–è€…æ˜¯ä¸€äº›è‡ªå®šä¹‰çš„ç±»å‹è¿›è¡Œç»‘å®šã€‚</p><p>æˆ‘ä»¬åœ¨æ–‡æ¡£çš„æè¿°å½“ä¸­å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€æ®µè¯ï¼š</p><blockquote><p>æ¨¡å‹ï¼ˆModelsï¼‰é€šå¸¸åªæ˜¯æ­£å¸¸çš„ golang structsã€åŸºæœ¬çš„ go ç±»å‹æˆ–å®ƒä»¬çš„æŒ‡é’ˆã€‚ åŒæ—¶ä¹Ÿæ”¯æŒ<a href="https://golang.org/pkg/database/sql/#Scanner" target="_blank" rel="noopener"><code>sql.Scanner</code></a>åŠ<a href="https://golang.org/pkg/database/sql/driver/#Valuer" target="_blank" rel="noopener"><code>driver.Valuer</code></a> æ¥å£ï¼ˆinterfacesï¼‰ã€‚</p></blockquote><p>è‡ªå·²çš„æ•°æ®ç±»å‹åªéœ€è¦å®ç°è¿™ä¸¤ä¸ªæ¥å£å°±å¯ä»¥å®ç°æ•°æ®ç»‘å®šäº†ï¼Œæ–‡æ¡£åªæœ‰ä¸€å¥è¯æˆ‘ä»¬çœ‹çœ‹å…·ä½“æ€ä¹ˆåšã€‚</p><h2 id="äºŒã€é€šè¿‡å®ç°-sql-Scanner-driver-Valuer-æ¥å£å®ç°æ•°æ®ç»‘å®š"><a href="#äºŒã€é€šè¿‡å®ç°-sql-Scanner-driver-Valuer-æ¥å£å®ç°æ•°æ®ç»‘å®š" class="headerlink" title="äºŒã€é€šè¿‡å®ç° sql.Scanner,driver.Valuer æ¥å£å®ç°æ•°æ®ç»‘å®š"></a>äºŒã€é€šè¿‡å®ç° <code>sql.Scanner,driver.Valuer</code> æ¥å£å®ç°æ•°æ®ç»‘å®š</h2><h3 id="2-1-æ¥å£æ–‡æ¡£"><a href="#2-1-æ¥å£æ–‡æ¡£" class="headerlink" title="2.1 æ¥å£æ–‡æ¡£"></a>2.1 æ¥å£æ–‡æ¡£</h3><pre><code class="hljs go"><span class="hljs-comment">// sql.Scanner</span><span class="hljs-keyword">type</span> Scanner <span class="hljs-keyword">interface</span> &#123;    <span class="hljs-comment">// Scan assigns a value from a database driver.</span>    <span class="hljs-comment">//</span>    <span class="hljs-comment">// The src value will be of one of the following types:</span>    <span class="hljs-comment">//</span>    <span class="hljs-comment">//    int64</span>    <span class="hljs-comment">//    float64</span>    <span class="hljs-comment">//    bool</span>    <span class="hljs-comment">//    []byte</span>    <span class="hljs-comment">//    string</span>    <span class="hljs-comment">//    time.Time</span>    <span class="hljs-comment">//    nil - for NULL values</span>    <span class="hljs-comment">//</span>    <span class="hljs-comment">// An error should be returned if the value cannot be stored</span>    <span class="hljs-comment">// without loss of information.</span>    <span class="hljs-comment">//</span>    <span class="hljs-comment">// Reference types such as []byte are only valid until the next call to Scan</span>    <span class="hljs-comment">// and should not be retained. Their underlying memory is owned by the driver.</span>    <span class="hljs-comment">// If retention is necessary, copy their values before the next call to Scan.</span>    Scan(src <span class="hljs-keyword">interface</span>&#123;&#125;) error&#125;<span class="hljs-comment">// driver.Valuer</span><span class="hljs-keyword">type</span> Valuer <span class="hljs-keyword">interface</span> &#123;    <span class="hljs-comment">// Value returns a driver Value.</span>    <span class="hljs-comment">// Value must not panic.</span>    Value() (Value, error)&#125;</code></pre><p>æˆ‘ä»¬å¯ä»¥å‘ç° <code>Valuer</code> ç”¨äºä¿å­˜æ•°æ®çš„æ—¶å€™ï¼Œ<code>Scaner</code> ç”¨äºæ•°æ®ä»æ•°æ®åº“æ˜ å°„åˆ° model çš„æ—¶å€™</p><h3 id="2-2-å®ç°æ¥å£"><a href="#2-2-å®ç°æ¥å£" class="headerlink" title="2.2 å®ç°æ¥å£"></a>2.2 å®ç°æ¥å£</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€ä¸ªå®é™…çš„ä¾‹å­</p><pre><code class="hljs go"><span class="hljs-comment">// Args å‚æ•°</span><span class="hljs-keyword">type</span> Args <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span><span class="hljs-comment">// Scan Scanner</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(args Args)</span> <span class="hljs-title">Scan</span><span class="hljs-params">(value <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> value == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;b, ok := value.([]<span class="hljs-keyword">byte</span>)<span class="hljs-keyword">if</span> !ok &#123;<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"value is not []byte, value: %v"</span>, value)&#125;<span class="hljs-keyword">return</span> json.Unmarshal(b, &amp;args)&#125;<span class="hljs-comment">// Value Valuer</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(args Args)</span> <span class="hljs-title">Value</span><span class="hljs-params">()</span> <span class="hljs-params">(driver.Value, error)</span></span> &#123;<span class="hljs-keyword">if</span> args == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>&#125;<span class="hljs-keyword">return</span> json.Marshal(args)&#125;</code></pre><p>åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬åªè¦å†åŠ ä¸Šä¸€ä¸ªæ•°æ®ç±»å‹å°± OK äº†</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Data <span class="hljs-keyword">struct</span> &#123;  Args Args <span class="hljs-string">`json:"args" gorm:"type:text"`</span>&#125;</code></pre><h3 id="2-3-æŠ½è±¡é€šç”¨å·¥å…·å‡½æ•°"><a href="#2-3-æŠ½è±¡é€šç”¨å·¥å…·å‡½æ•°" class="headerlink" title="2.3 æŠ½è±¡é€šç”¨å·¥å…·å‡½æ•°"></a>2.3 æŠ½è±¡é€šç”¨å·¥å…·å‡½æ•°</h3><p>åœ¨å®é™…çš„ä½¿ç”¨ä¸­æˆ‘ä»¬å¯èƒ½ä¼šæœ‰è®¸å¤šçš„ç±»å‹çš„éœ€è¦è¿™æ ·å­˜å‚¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠ½è±¡ä¸€ä¸ªå…¬ç”¨çš„å·¥å…·å‡½æ•°</p><pre><code class="hljs go"><span class="hljs-comment">// scan for scanner helper</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">scan</span><span class="hljs-params">(data <span class="hljs-keyword">interface</span>&#123;&#125;, value <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> value == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-keyword">switch</span> value.(<span class="hljs-keyword">type</span>) &#123;<span class="hljs-keyword">case</span> []<span class="hljs-keyword">byte</span>:<span class="hljs-keyword">return</span> json.Unmarshal(value.([]<span class="hljs-keyword">byte</span>), data)<span class="hljs-keyword">case</span> <span class="hljs-keyword">string</span>:<span class="hljs-keyword">return</span> json.Unmarshal([]<span class="hljs-keyword">byte</span>(value.(<span class="hljs-keyword">string</span>)), data)<span class="hljs-keyword">default</span>:<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"val type is valid, is %+v"</span>, value)&#125;&#125;<span class="hljs-comment">// for valuer helper</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">value</span><span class="hljs-params">(data <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>&#123;&#125;, error)</span></span> &#123;vi := reflect.ValueOf(data)<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸º 0 å€¼</span><span class="hljs-keyword">if</span> vi.IsZero() &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>&#125;<span class="hljs-keyword">return</span> json.Marshal(data)&#125;</code></pre><p>ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦è°ƒç”¨ä¸€ä¸‹</p><pre><code class="hljs go"><span class="hljs-comment">// Args å‚æ•°</span><span class="hljs-keyword">type</span> Args <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span><span class="hljs-comment">// Scan Scanner</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(args Args)</span> <span class="hljs-title">Scan</span><span class="hljs-params">(value <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">return</span> scan(&amp;args, value)&#125;<span class="hljs-comment">// Value Valuer</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(args Args)</span> <span class="hljs-title">Value</span><span class="hljs-params">()</span> <span class="hljs-params">(driver.Value, error)</span></span> &#123;<span class="hljs-keyword">return</span> value(args)&#125;</code></pre><h2 id="ä¸‰ã€é€šè¿‡-hook-å®ç°æ•°æ®ç»‘å®š"><a href="#ä¸‰ã€é€šè¿‡-hook-å®ç°æ•°æ®ç»‘å®š" class="headerlink" title="ä¸‰ã€é€šè¿‡ hook å®ç°æ•°æ®ç»‘å®š"></a>ä¸‰ã€é€šè¿‡ hook å®ç°æ•°æ®ç»‘å®š</h2><p>é™¤äº†ä¸Šé¢çš„è¿™ç§æ–¹æ³•æœ‰æ²¡æœ‰å…¶ä»–çš„å®ç°æ–¹å¼å‘¢ï¼Ÿ</p><p>å½“ç„¶æ˜¯æœ‰çš„ï¼Œä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå®ç°æ–¹å¼å°±æ˜¯ä¿å­˜æ•°æ®çš„æ—¶å€™å°†æ•°æ®è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹ï¼Œç„¶ååœ¨å–å‡ºæ¥ç»‘å®šæ•°æ®çš„æ—¶å€™å†è½¬æ¢ä¸€ä¸‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <a href="http://gorm.io/docs/hooks.html" target="_blank" rel="noopener">GORM çš„ Hook</a> å®ç°ã€‚åˆ©ç”¨ <code>BeforeSave</code> åœ¨æ•°æ®ä¿å­˜å‰è½¬æ¢ï¼Œå†åˆ©ç”¨ <code>AfterFind</code> åœ¨æ•°æ®å–å‡ºæ¥ä¹‹åè½¬æ¢å³å¯ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æˆ‘ä»¬éœ€è¦åœ¨ struct ä¸­å®šä¹‰ä¸€ä¸ªç”¨äºå®é™…æ˜ å°„æ•°æ®åº“æ•°æ®çš„å­—æ®µã€‚</p><pre><code class="hljs go"><span class="hljs-comment">// Data Data</span><span class="hljs-keyword">type</span> Data <span class="hljs-keyword">struct</span> &#123;Args    <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125; <span class="hljs-string">`json:"args" gorm:"-"`</span>ArgsStr <span class="hljs-keyword">string</span>                 <span class="hljs-string">`json:"-" gorm:"column:args"`</span>&#125;<span class="hljs-comment">// BeforeSave æ•°æ®ä¿å­˜å‰</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(data *Data)</span> <span class="hljs-title">BeforeSave</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> data.Args == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;b, err := json.Marshal(&amp;data.Args)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err&#125;data.ArgsStr = <span class="hljs-keyword">string</span>(b)<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">// AfterFind æŸ¥è¯¢ä¹‹å</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(data *Data)</span> <span class="hljs-title">AfterFind</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">if</span> data.ArgsStr == <span class="hljs-string">""</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-keyword">return</span> json.Unmarshal([]<span class="hljs-keyword">byte</span>(data.ArgsStr), &amp;data.Args)&#125;</code></pre><p>è¿™æ ·åŒæ ·å¯ä»¥è¾¾åˆ°ç›¸ä¼¼çš„æ•ˆæœ</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸¤ç§é€šç”¨æ•°æ®ç±»å‹åœ¨ GORM ä¸­çš„ç»‘å®šæ–¹å¼ï¼š</p><ul><li>é€šè¿‡å®ç°ç›¸å…³çš„æ¥å£å®ç°ï¼Œå¹¶ä¸”æŠ½è±¡äº†ä¸€ä¸ªé€šç”¨çš„è¾…åŠ©å‡½æ•°</li><li>é€šè¿‡ hook å®ç°</li></ul><p>ä¸€èˆ¬æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œåªæ˜¯éœ€è¦å•ç‹¬å®šä¹‰æ•°æ®ç±»å‹ï¼Œç¬¬äºŒç§æ–¹æ³•éœ€è¦å¤šä¸€ä¸ªè¾…åŠ©å­—æ®µï¼Œè¿™ç§æ–¹å¼å¦‚æœç›¸å…³çš„å­—æ®µè¿‡å¤šä¼šå¾ˆä¸ä¼˜é›…ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œè¿™æ˜¯ Go Web å°æŠ€å·§ç³»åˆ—çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œä¸‹ä¸€ç¯‡ä¸ºå¤§å®¶ä»‹ç»å‚æ•°ç»‘å®šå½“ä¸­çš„ä¸€äº›å°æŠ€å·§</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/38237.html">Go Web å°æŠ€å·§ï¼ˆä¸€ï¼‰ç®€åŒ–Ginæ¥å£ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>gorm</tag>
      
      <tag>å°æŠ€å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go Web å°æŠ€å·§ï¼ˆä¸€ï¼‰ç®€åŒ–Ginæ¥å£ä»£ç </title>
    <link href="/post/38237.html"/>
    <url>/post/38237.html</url>
    
    <content type="html"><![CDATA[<p>ä¸çŸ¥é“å¤§å®¶åœ¨ä½¿ç”¨ Gin æ„å»º API æœåŠ¡æ—¶æœ‰æ²¡æœ‰è¿™æ ·çš„é—®é¢˜:</p><ol><li>å‚æ•°ç»‘å®šçš„ç¯èŠ‚å¯ä¸å¯ä»¥è‡ªåŠ¨å¤„ç†ï¼Ÿ</li><li>é”™è¯¯å¯ä¸å¯ä»¥ç›´æ¥è¿”å›ï¼Œä¸æƒ³å†™ç©º <code>return</code>, æ¼å†™å°±æ˜¯ <code>bug</code></li></ol><p>æœ¬æ–‡é€šè¿‡ç®€å•åœ°å°è£…ï¼Œåˆ©ç”¨ go çš„æ¥å£ç‰¹æ€§ï¼Œæä¾›ä¸€ä¸ªè§£å†³ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜çš„æ€è·¯</p><a id="more"></a><h2 id="è§£å†³è¿‡ç¨‹"><a href="#è§£å†³è¿‡ç¨‹" class="headerlink" title="è§£å†³è¿‡ç¨‹"></a>è§£å†³è¿‡ç¨‹</h2><h3 id="åˆšå¼€å§‹æ—¶å†™-API-æœåŠ¡æ—¶"><a href="#åˆšå¼€å§‹æ—¶å†™-API-æœåŠ¡æ—¶" class="headerlink" title="åˆšå¼€å§‹æ—¶å†™ API æœåŠ¡æ—¶"></a>åˆšå¼€å§‹æ—¶å†™ API æœåŠ¡æ—¶</h3><p>æˆ‘ä»¬åˆšå¼€å§‹ä½¿ç”¨ Gin å†™ API æœåŠ¡æ—¶ï¼Œä¸€èˆ¬ä¼šæŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä¸Šçš„ ğŸŒ° è¿™ä¹ˆå†™</p><pre><code class="hljs go"><span class="hljs-comment">// User ç”¨æˆ·ç»“æ„</span><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;UserName <span class="hljs-keyword">string</span>&#125;<span class="hljs-comment">// CreateUser åˆ›å»ºç”¨æˆ·</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateUser</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<span class="hljs-keyword">var</span> params User<span class="hljs-keyword">if</span> err := ctx.ShouldBind(&amp;params); err != <span class="hljs-literal">nil</span> &#123;ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>,<span class="hljs-string">"msg"</span>:  <span class="hljs-string">"å‚æ•°é”™è¯¯"</span>,&#125;)logrus.Errorf(<span class="hljs-string">"params err, %v"</span>, params)<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// ä¸€äº›å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ ...</span>ctx.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">"code"</span>: <span class="hljs-number">0</span>,<span class="hljs-string">"msg"</span>:  <span class="hljs-string">"åˆ›å»ºæˆåŠŸ"</span>,&#125;)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;r := gin.Default()r.POST(<span class="hljs-string">"user"</span>, CreateUser)<span class="hljs-keyword">if</span> err := r.Run(<span class="hljs-string">":8080"</span>); err != <span class="hljs-literal">nil</span> &#123;logrus.Fatalf(<span class="hljs-string">"can not start serve: %v"</span>, err)&#125;&#125;</code></pre><h3 id="å°è£…è¿”å›å€¼"><a href="#å°è£…è¿”å›å€¼" class="headerlink" title="å°è£…è¿”å›å€¼"></a>å°è£…è¿”å›å€¼</h3><p>æˆ‘ä»¬å†™äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œä¼šå‘ç°ï¼Œæˆ‘ä»¬çš„è¿”å›å€¼çš„ç»“æ„æ˜¯å›ºå®šçš„ï¼Œä¸ºä»€ä¹ˆä¸æŠ½è±¡ä¸€ä¸‹å‘¢ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“ <code>Resp</code> ï¼Œå¹¶ä¸”å°è£…äº†ä¸¤ä¸ªæ–¹æ³•ç”¨äºæˆåŠŸå’Œå¤±è´¥è¿™ä¸¤ç§çŠ¶æ€çš„è¿”å›</p><pre><code class="hljs go"><span class="hljs-comment">// resp.go</span><span class="hljs-comment">// Resp è¿”å›</span><span class="hljs-keyword">type</span> Resp <span class="hljs-keyword">struct</span> &#123;Code <span class="hljs-keyword">int</span>Msg  <span class="hljs-keyword">string</span>Data <span class="hljs-keyword">interface</span>&#123;&#125;&#125;<span class="hljs-comment">// ErrorResp é”™è¯¯è¿”å›å€¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ErrorResp</span><span class="hljs-params">(ctx *gin.Context, code <span class="hljs-keyword">int</span>, msg <span class="hljs-keyword">string</span>, data ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;resp(ctx, code, msg, data...)&#125;<span class="hljs-comment">// SuccessResp æ­£ç¡®è¿”å›å€¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SuccessResp</span><span class="hljs-params">(ctx *gin.Context, msg <span class="hljs-keyword">string</span>, data ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;resp(ctx, <span class="hljs-number">0</span>, msg, data...)&#125;<span class="hljs-comment">// resp è¿”å›</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">resp</span><span class="hljs-params">(ctx *gin.Context, code <span class="hljs-keyword">int</span>, msg <span class="hljs-keyword">string</span>, data ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;resp := Resp&#123;Code: code,Msg:  msg,Data: data,&#125;<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) == <span class="hljs-number">1</span> &#123;resp.Data = data[<span class="hljs-number">0</span>]&#125;ctx.JSON(http.StatusOK, resp)&#125;</code></pre><p>æ·»åŠ è¿™ä¸ªæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ <code>CreateUser</code> è¿™ä¸ªæ–¹æ³•ï¼ŒæˆåŠŸçš„ä» 16 è¡Œå˜åˆ°äº† 12 è¡Œ</p><pre><code class="hljs go"><span class="hljs-comment">// main.go</span><span class="hljs-comment">// CreateUser åˆ›å»ºç”¨æˆ·</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateUser</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<span class="hljs-keyword">var</span> params User<span class="hljs-keyword">if</span> err := ctx.ShouldBind(&amp;params); err != <span class="hljs-literal">nil</span> &#123;ErrorResp(ctx, <span class="hljs-number">400</span>, <span class="hljs-string">"å‚æ•°é”™è¯¯"</span>)logrus.Errorf(<span class="hljs-string">"params err, %v"</span>, params)<span class="hljs-keyword">return</span>&#125;<span class="hljs-comment">// ä¸€äº›å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ ...</span>SuccessResp(ctx, <span class="hljs-string">"åˆ›å»ºæˆåŠŸ"</span>)&#125;</code></pre><h3 id="ä¸¤ä¸ªç—›ç‚¹"><a href="#ä¸¤ä¸ªç—›ç‚¹" class="headerlink" title="ä¸¤ä¸ªç—›ç‚¹"></a>ä¸¤ä¸ªç—›ç‚¹</h3><p>ä¸Šé¢çš„æ–¹æ³•è¿˜ä¸å¤Ÿå®Œæ•´ï¼Œæˆ‘ä»¬è¿˜æ˜¯æœ‰è®¸å¤šé‡å¤çš„é€»è¾‘ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬åœ¨å†™çš„ç»å¤§å¤šæ•° API å¤§æ¦‚éƒ½æ˜¯è¿™æ ·ï¼š</p><ol><li>å‚æ•°ç»‘å®š &amp; æ ¡éªŒ</li><li>ä¸šåŠ¡é€»è¾‘</li><li>è¿”å›</li></ol><p>è¿™é‡Œé¢æœ‰ä¸¤ä¸ªç—›ç‚¹ï¼š</p><ol><li>å‚æ•°ç»‘å®šçš„ç¯èŠ‚å¯ä¸å¯ä»¥è‡ªåŠ¨å¤„ç†ï¼Ÿ</li><li><p>é”™è¯¯å¯ä¸å¯ä»¥ç›´æ¥è¿”å›ï¼Œä¸æƒ³å†™ç©º <code>return</code>, æ¼å†™å°±æ˜¯ <code>bug</code></p><pre><code class="hljs go"><span class="hljs-comment">// ä¸æƒ³å†™å¤§é‡è¿™ç§é‡å¤çš„ä»£ç </span><span class="hljs-keyword">var</span> params User<span class="hljs-keyword">if</span> err := ctx.ShouldBind(&amp;params); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-comment">// ä¸‹é¢è¿™ä¸‰è¡Œæ˜¯ä¸æ˜¯å¯ä»¥åˆå¹¶æˆä¸€è¡Œ</span>ErrorResp(ctx, <span class="hljs-number">400</span>, <span class="hljs-string">"å‚æ•°é”™è¯¯"</span>)logrus.Errorf(<span class="hljs-string">"params err, %v"</span>, params)<span class="hljs-keyword">return</span>&#125;</code></pre></li></ol><h3 id="ä½¿ç”¨æ¥å£å°è£…è¯·æ±‚"><a href="#ä½¿ç”¨æ¥å£å°è£…è¯·æ±‚" class="headerlink" title="ä½¿ç”¨æ¥å£å°è£…è¯·æ±‚"></a>ä½¿ç”¨æ¥å£å°è£…è¯·æ±‚</h3><p>ä¸Šé¢çš„è¿™ä¸¤ä¸ªç—›ç‚¹æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªè¾…åŠ©å‡½æ•°è§£å†³</p><pre><code class="hljs go"><span class="hljs-comment">// Requester è¯·æ±‚</span><span class="hljs-keyword">type</span> Requester <span class="hljs-keyword">interface</span> &#123;Request(ctx *gin.Context) (*Resp, error)&#125;<span class="hljs-comment">// Handle è¯·æ±‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Handle</span><span class="hljs-params">(r Requester)</span> <span class="hljs-title">gin</span>.<span class="hljs-title">HandlerFunc</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;resp, err := request(r, ctx)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">var</span> code *errcode.Error<span class="hljs-keyword">if</span> !errors.As(err, &amp;code) &#123;code = errcode.Unknown.Wrap(err)&#125;resp = &amp;Resp&#123;Code: code.Code,Msg:  code.String(),&#125;_ = ctx.Error(err)&#125;ctx.JSON(http.StatusOK, resp)&#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">request</span><span class="hljs-params">(r Requester, ctx *gin.Context)</span> <span class="hljs-params">(*controller.Resp, error)</span></span> &#123;<span class="hljs-comment">// å‚æ•°ç»‘å®š</span><span class="hljs-keyword">if</span> err := ctx.ShouldBind(r); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errcode.ErrParams.Wrap(err)&#125;<span class="hljs-keyword">return</span> r.Request(ctx)&#125;</code></pre><p>è¿™æ ·æˆ‘ä»¬åªéœ€è¦å®ç°è¿™ä¸ª <code>Requester</code>, å†™ API æ—¶åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘å°±å¯ä»¥äº†</p><pre><code class="hljs go"><span class="hljs-comment">// CreateUser åˆ›å»ºç”¨æˆ·</span><span class="hljs-keyword">type</span> CreateUser <span class="hljs-keyword">struct</span> &#123;UserName <span class="hljs-keyword">string</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span> <span class="hljs-title">Request</span><span class="hljs-params">(ctx *gin.Context)</span> <span class="hljs-params">(*Resp, error)</span></span> &#123;<span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span><span class="hljs-comment">// è¿”å›æˆåŠŸå€¼</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;r := gin.Default()r.POST(<span class="hljs-string">"user"</span>, Handle(&amp;CreateUser))<span class="hljs-keyword">if</span> err := r.Run(<span class="hljs-string">":8080"</span>); err != <span class="hljs-literal">nil</span> &#123;logrus.Fatalf(<span class="hljs-string">"can not start serve: %v"</span>, err)&#125;&#125;</code></pre><p>ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ª bug ä¸çŸ¥é“å¤§å®¶å‘ç°æ²¡æœ‰ï¼Œæˆ‘ä»¬ä¸Šä¸€æ¬¡è¯·æ±‚çš„å‚æ•°ä¼šè¢«å¸¦åˆ°ä¸‹ä¸€æ¬¡è¯·æ±‚å½“ä¸­</p><pre><code class="hljs go"><span class="hljs-comment">// Handle è¯·æ±‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Handle</span><span class="hljs-params">(r Requester)</span> <span class="hljs-title">gin</span>.<span class="hljs-title">HandlerFunc</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Requester, é¿å…å°†ä¸Šä¸€æ¬¡çš„å‚æ•°å¸¦åˆ°ä¸‹ä¸€æ¬¡å½“ä¸­</span><span class="hljs-keyword">if</span> reflect.TypeOf(r).Kind() != reflect.Ptr &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"must be a pointer"</span>)&#125;req := reflect.New(reflect.ValueOf(r).Elem().Type()).Interface().(Requester)resp, err := request(req, ctx)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">var</span> code *errcode.Error<span class="hljs-keyword">if</span> !errors.As(err, &amp;code) &#123;code = errcode.Unknown.Wrap(err)&#125;resp = &amp;Resp&#123;Code: code.Code,Msg:  code.String(),&#125;_ = ctx.Error(err)&#125;ctx.JSON(http.StatusOK, resp)&#125;&#125;</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¤§æ¦‚è¿™æ ·å·®ä¸å¤šå°± ok äº†ï¼Œè¿˜æœ‰å¾ˆå¤šå¯ä»¥å®Œå–„çš„ç‚¹ï¼Œè¿™é‡Œæœ‰ä¸€äº›æ€è·¯ï¼Œæœ‰çš„å·²ç»åšäº†ï¼Œæœ‰çš„è¿˜åœ¨è·¯ä¸Š</p><ol><li><p>æ¯æ¬¡æ³¨å†Œéƒ½å†™ <code>Handle(&amp;CreateUser)</code> è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦?</p><p>å¯ä»¥å°è£…ä¸€ä¸‹ <code>gin.IRouter</code> è¿™ä¸ªæ¥å£ï¼Œè¿™æ ·æ³¨å†Œæ¥å£å°±å¯ä»¥å’ŒåŸæ¥ä¸€æ ·äº†</p></li><li><p>å‚æ•°ç»‘å®šå¦‚æœæˆ‘éœ€è¦å¤šæ¬¡ç»‘å®šæ€ä¹ˆåŠ?</p><p>å¯ä»¥æ·»åŠ ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœå®ç°äº†è¿™ä¸ªæ¥å£å°±æ‰§è¡Œä»¥ä¸‹ï¼Œå¯¹äºæœ‰ç‰¹æ®Šçš„å‚æ•°æ ¡éªŒä¹‹ç±»çš„ä¹Ÿå¯ä»¥é‡‡ç”¨ç±»ä¼¼çš„æ–¹å¼å¤„ç†</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Binder <span class="hljs-keyword">interface</span> &#123;Bind(ctx *gin.Context) error&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">request</span><span class="hljs-params">(r Requester, ctx *gin.Context)</span> <span class="hljs-params">(*controller.Resp, error)</span></span> &#123;<span class="hljs-comment">// å‚æ•°ç»‘å®š</span><span class="hljs-keyword">if</span> err := ctx.ShouldBind(r); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errcode.ErrParams.Wrap(err)&#125;<span class="hljs-comment">// å…¶ä½™å‚æ•°ç»‘å®š</span><span class="hljs-keyword">if</span> b, ok := r.(Binder); ok &#123;<span class="hljs-keyword">if</span> err := b.Bind(api); err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errcode.ErrParams.Wrap(err)&#125;&#125;<span class="hljs-keyword">return</span> r.Request(ctx)&#125;</code></pre></li><li><p>æ€ä¹ˆè¾“å‡º API æ–‡æ¡£ï¼Ÿ</p><p>å¯ä»¥å’Œ <code>swagger</code> ä¹‹ç±»çš„ API æ–‡æ¡£ç»“åˆ, åˆ©ç”¨ <code>go generate</code> è‡ªåŠ¨ç”Ÿæˆï¼Œé¡ºä¾¿å¯ä»¥è¿æ¥å£æ³¨å†Œéƒ½ä¸ç”¨äº†ï¼Œæ·»åŠ ä¸€è¡Œæ³¨é‡Šï¼Œè‡ªåŠ¨æ³¨å†Œæ¥å£ï¼Œå¹¶ä¸”è¾“å‡ºæ¥å£æ–‡æ¡£</p><pre><code class="hljs go"><span class="hljs-comment">// @Router put /api/v1/user</span><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(u *User)</span> <span class="hljs-title">Request</span><span class="hljs-params">(ctx *gin.Context)</span> <span class="hljs-params">(*Resp, error)</span></span></code></pre></li><li><p>èƒ½ä¸èƒ½å‡å°‘ CURD ä»£ç ?</p><p>å¯ä»¥å®ç°ï¼Œåªéœ€è¦é‡‡ç”¨çº¦å®šçš„é¡¹ç›®æ¥å£ï¼Œå¯ä»¥ åˆ©ç”¨ <code>go generate</code> ç›´æ¥è‡ªåŠ¨ç”Ÿæˆç®€å•çš„ CURD ä»£ç </p></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>å°æŠ€å·§</tag>
      
      <tag>api</tag>
      
      <tag>gin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å–„ç”¨å·¥å…·ä¹‹postmané«˜çº§ç”¨æ³•æ¦‚è¿°</title>
    <link href="/post/45050.html"/>
    <url>/post/45050.html</url>
    
    <content type="html"><![CDATA[<p>POSTMAN æ˜¯æˆ‘åœ¨å¼€å‘è¿‡ç¨‹å½“ä¸­æœ€å¸¸ç”¨åˆ°çš„ API æµ‹è¯•å·¥å…·ä¹‹ä¸€ï¼Œè™½ç„¶å¹¶ä¸å®Œç¾ï¼Œä½†ä¹Ÿæ˜¯ç›®å‰ä¸ªäººè®¤ä¸ºåœ¨ API æµ‹è¯•æ—¶æœ€å¥½ç”¨çš„å®¢æˆ·ç«¯å·¥å…·ä¹‹ä¸€ã€‚</p><p>æœ¬æ–‡é€‚ç”¨äºåç«¯ï¼Œå‰ç«¯ï¼Œç§»åŠ¨ç«¯ä»¥åŠæµ‹è¯•çš„åŒå­¦ï¼Œåˆ†ä¸‰å¤§éƒ¨åˆ†ä»æœ€ç®€å•çš„ç•Œé¢æ“ä½œå¼€è®²ï¼Œç„¶åæ¶‰åŠåˆ°å˜é‡ã€è„šæœ¬ä»¥åŠä¸€äº›äº‘æœåŠ¡ç›¸å…³çš„åŠŸèƒ½ï¼Œæœ€åå°†é€‚é…å‡ ä¸ªæ¡ˆä¾‹è®²è§£æ€ä¹ˆä½¿ç”¨ POSTMAN æé«˜æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚æœ¬æ–‡å‰åŠéƒ¨åˆ†åŒ…å«è¾ƒå¤šåŸºç¡€åŠŸèƒ½è®²è§£ï¼Œå¯¹å·²ç»æ¯”è¾ƒç†Ÿæ‚‰ä½¿ç”¨çš„åŒå­¦ï¼Œå¯ä»¥é€‰æ‹©æ€§çš„è·³è¿‡éƒ¨åˆ†å†…å®¹ã€‚</p><a id="more"></a><blockquote><p>PS: æœ¬æ–‡åŒ…å«å¤§é‡ç¤ºä¾‹å›¾ç‰‡ï¼Œå¤§å±é£Ÿç”¨æ•ˆæœæœ€ä½³ï¼Œpostman çœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿç”¨äº†</p></blockquote><h2 id="é›¶ã€åº"><a href="#é›¶ã€åº" class="headerlink" title="é›¶ã€åº"></a>é›¶ã€åº</h2><p>æˆ‘æ‰€æœ‰çš„æ–‡ç« åŸºæœ¬éƒ½æ¥è‡ªå¹³æ—¶å¼€å‘ä¸­çš„éœ€æ±‚ï¼Œå‰æ®µæ—¶é—´åœ¨å…¬å¸é€šè¿‡ç½‘å…³è°ƒç”¨æ¥å£ï¼Œæµ‹è¯•å¾ˆéº»çƒ¦ï¼Œç„¶åå°±æƒ³ä½¿ç”¨åœ¨æœ¬åœ°ç›´æ¥è°ƒç”¨ï¼Œç”±äºæœ‰ç­¾åæœºåˆ¶ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ SDK è¿›è¡Œè°ƒç”¨ï¼Œåé¢æ¯”è¾ƒå®Œæ•´çš„çœ‹äº†ä¸€ä¸‹<code>postman</code>çš„æ–‡æ¡£ï¼Œæ„Ÿè§‰å‘ç°äº†æ–°å¤§é™†ã€‚</p><blockquote><p>æ³¨: æœ¬æ–‡ä¼šä»‹ç» postman çš„å¸¸ç”¨ä»¥åŠä¸å¤ªå¸¸ç”¨çš„é«˜çº§ç”¨æ³•ï¼Œä½†æ˜¯ä¸ä¼šæ‰€æœ‰æ–¹é¢éƒ½å»åšç»†èŠ‚ä»‹ç»ï¼Œå¸Œæœ›å¯ä»¥èµ·åˆ°çš„æŠ›ç –å¼•ç‰çš„ä½œç”¨</p></blockquote><h2 id="ä¸€ã€ç®€è¦ä»‹ç»"><a href="#ä¸€ã€ç®€è¦ä»‹ç»" class="headerlink" title="ä¸€ã€ç®€è¦ä»‹ç»"></a>ä¸€ã€ç®€è¦ä»‹ç»</h2><p><code>postman</code>æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ API æ¥å£æµ‹è¯•å·¥å…·ï¼Œæœ‰ chrome appã€chrome æ‰©å±•ã€æ¡Œé¢ç‰ˆï¼Œæ¨èä½¿ç”¨æœ€æ–°æœ€å¼ºå¤§çš„æ¡Œé¢ç‰ˆæœ¬ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼Œæœ¬æ–‡ä¹Ÿä¼šå›´ç»•ä»¥ä¸‹åŠŸèƒ½ç‚¹å±•å¼€è®²è§£:</p><blockquote><p>æœ‰ â˜ æ ‡è¯†è¡¨ç¤ºä¸ºäº‘æœåŠ¡</p></blockquote><ol><li>API æµ‹è¯•</li><li>å˜é‡</li><li>ä»£ç ç”Ÿæˆ</li><li><strong>Script</strong></li><li>API ä»£ç†</li><li>â˜ï¸ API æ–‡æ¡£</li><li>â˜ï¸ Mock Server</li><li>â˜ï¸ æ¥å£ç›‘æ§</li><li>â˜ï¸ Postman API</li></ol><h2 id="äºŒã€æ­£æ–‡"><a href="#äºŒã€æ­£æ–‡" class="headerlink" title="äºŒã€æ­£æ–‡"></a>äºŒã€æ­£æ–‡</h2><h3 id="2-1ã€ä½¿ç”¨ç®€ä»‹"><a href="#2-1ã€ä½¿ç”¨ç®€ä»‹" class="headerlink" title="2.1ã€ä½¿ç”¨ç®€ä»‹"></a>2.1ã€ä½¿ç”¨ç®€ä»‹</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œpostman ç•Œé¢ååˆ†ä¸°å¯Œï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰å¸¸ç”¨çš„åŠŸèƒ½éƒ½èƒ½ä¸€è§ˆæ— ä½™</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/Snipaste_2019-06-04_01-25-22.png" srcset="/img/loading.gif" alt></p><h3 id="2-2ã€API-æµ‹è¯•"><a href="#2-2ã€API-æµ‹è¯•" class="headerlink" title="2.2ã€API æµ‹è¯•"></a>2.2ã€API æµ‹è¯•</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒAPI æµ‹è¯•é¡µé¢ååˆ†çš„æ˜“ç”¨ï¼Œæ“ä½œç•Œé¢ä¸€ç›®äº†ç„¶ã€‚</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190605235605.png" srcset="/img/loading.gif" alt></p><h4 id="2-2-1ã€è®¤è¯"><a href="#2-2-1ã€è®¤è¯" class="headerlink" title="2.2.1ã€è®¤è¯"></a>2.2.1ã€è®¤è¯</h4><p>æ¥å£çš„è°ƒç”¨å¸¸å¸¸éœ€è¦é€šè¿‡ç™»å½•ï¼Œpostman é¢„è®¾ä¸€äº›å¸¸è§çš„è®¤è¯æ–¹å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ Basic Auth, OAuth2.0 ç­‰ï¼Œè¿™äº›é¢„è®¾çš„åè®®åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šååˆ†çš„æœ‰ç”¨ã€‚</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190605235911.png" srcset="/img/loading.gif" alt></p><p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé»˜è®¤é€‰é¡¹æ˜¯ä»çˆ¶ç›®å½•ä¸­ç»§æ‰¿ï¼Œæ‰€ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª Collection æˆ–è€…æ˜¯ä¸‹é¢çš„æ–‡ä»¶å¤¹ä¸­è®¾ç½®è®¤è¯æ–¹å¼ï¼Œè¿™æ—¶å€™æ•´ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰çš„ API é»˜è®¤éƒ½å¯ä»¥é€šè¿‡è®¤è¯</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606000414.png" srcset="/img/loading.gif" alt></p><h4 id="2-2-2ã€å‚æ•°"><a href="#2-2-2ã€å‚æ•°" class="headerlink" title="2.2.2ã€å‚æ•°"></a>2.2.2ã€å‚æ•°</h4><p>æ‰€æœ‰ K-V æ¨¡å¼çš„å‚æ•°éƒ½å¯ä»¥æ‰¹é‡ç¼–è¾‘, åŒ…æ‹¬ QueryString, Body, Header, æ‰¹é‡ç¼–è¾‘çš„åŠŸèƒ½å¯ä»¥å¿«é€Ÿå¤åˆ¶æµè§ˆå™¨ä¸­çš„è¯·æ±‚å‚æ•°ä¿¡æ¯åˆ° postman ä¸­</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/1559750920570.png" srcset="/img/loading.gif" alt></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606001204.png" srcset="/img/loading.gif" alt></p><h3 id="2-3ã€å˜é‡"><a href="#2-3ã€å˜é‡" class="headerlink" title="2.3ã€å˜é‡"></a>2.3ã€å˜é‡</h3><p>postman ä¸­ä¸€å…±å­˜åœ¨äº”ç§å˜é‡ç±»å‹ï¼Œ å…¨å±€å˜é‡ï¼ŒCollection/æ–‡ä»¶å¤¹ä¸­çš„å˜é‡ï¼Œç¯å¢ƒå˜é‡ï¼Œæ•°æ®å˜é‡ï¼Œæœ¬åœ°å˜é‡</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606001837.png" srcset="/img/loading.gif" alt></p><p>å¦‚å›¾æ‰€æœ‰å˜é‡å±‚çº§ä»å¤–åˆ°å†…ï¼Œå¦‚æœå‡ºç°é‡å¤çš„å˜é‡åï¼Œé‡Œé¢çš„ä¼šè¦†ç›–å¤–éƒ¨çš„å˜é‡</p><h4 id="2-3-2ã€å˜é‡è®¾ç½®"><a href="#2-3-2ã€å˜é‡è®¾ç½®" class="headerlink" title="2.3.2ã€å˜é‡è®¾ç½®"></a>2.3.2ã€å˜é‡è®¾ç½®</h4><h5 id="2-3-2-1ã€Collection-å˜é‡"><a href="#2-3-2-1ã€Collection-å˜é‡" class="headerlink" title="2.3.2.1ã€Collection å˜é‡"></a>2.3.2.1ã€Collection å˜é‡</h5><p>ç‚¹å‡»ç¼–è¾‘ Collectionï¼Œå¦‚å›¾æ‰€ç¤º</p><p>INITIAL VALUE: è¿™ä¸ªå€¼æ˜¯ç”¨äºåˆ†äº«ç»™å›¢é˜Ÿçš„æˆå‘˜çš„æ—¶å€™å±•ç¤ºçš„å€¼</p><p>CURRENT VALUE: è¡¨ç¤ºå½“å‰å®é™…çš„å€¼</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606002811.png" srcset="/img/loading.gif" alt></p><h5 id="2-3-2-2ã€ç¯å¢ƒå˜é‡-amp-å…¨å±€å˜é‡"><a href="#2-3-2-2ã€ç¯å¢ƒå˜é‡-amp-å…¨å±€å˜é‡" class="headerlink" title="2.3.2.2ã€ç¯å¢ƒå˜é‡ &amp; å…¨å±€å˜é‡"></a>2.3.2.2ã€ç¯å¢ƒå˜é‡ &amp; å…¨å±€å˜é‡</h5><p>ç¯å¢ƒå˜é‡å’Œå…¨å±€å˜é‡çš„è®¾ç½®åœ¨ postman çš„å³ä¸Šè§’ï¼Œè®¾ç½®ç•Œé¢å’Œä¸Šå›¾çš„ Collection ç•Œé¢ç±»ä¼¼</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606003057.png" srcset="/img/loading.gif" alt></p><h4 id="2-3-2ã€å˜é‡çš„ä½¿ç”¨"><a href="#2-3-2ã€å˜é‡çš„ä½¿ç”¨" class="headerlink" title="2.3.2ã€å˜é‡çš„ä½¿ç”¨"></a>2.3.2ã€å˜é‡çš„ä½¿ç”¨</h4><p>å˜é‡é€šè¿‡ <code></code>, åœ¨å®é™…è¯·æ±‚çš„æ—¶å€™å˜é‡å¯ä»¥è®¾ç½®ä¸ºå®é™…çš„å€¼ï¼Œå˜é‡ä¹Ÿå¯ä»¥è¢«è„šæœ¬è®¾ç½®, ä¿®æ”¹, è¯»å–, è¿™ä¸ªç‰¹æ€§èƒ½å¤Ÿè®©æˆ‘ä»¬æœ‰äº†å¾ˆå¤šå¯èƒ½</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606002133.png" srcset="/img/loading.gif" alt></p><h4 id="2-3-3ã€åŠ¨æ€å˜é‡"><a href="#2-3-3ã€åŠ¨æ€å˜é‡" class="headerlink" title="2.3.3ã€åŠ¨æ€å˜é‡"></a>2.3.3ã€åŠ¨æ€å˜é‡</h4><p>postman é¢„è®¾äº†å‡ ä¸ªåŠ¨æ€å˜é‡<code></code>, å¯ä»¥è·å–å½“å‰çš„æ—¶é—´æˆ³ç­‰ä¿¡æ¯</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606002440.png" srcset="/img/loading.gif" alt></p><h3 id="2-4ã€ä»£ç ç”Ÿæˆ"><a href="#2-4ã€ä»£ç ç”Ÿæˆ" class="headerlink" title="2.4ã€ä»£ç ç”Ÿæˆ"></a>2.4ã€ä»£ç ç”Ÿæˆ</h3><p>å¦‚å›¾æ‰€ç¤ºï¼Œpostman æä¾›äº†å¾ˆå¤šè¯­è¨€ä»¥åŠä¸€äº›å¸¸ç”¨æ¡†æ¶çš„ä»£ç ï¼Œæˆ‘ä»¬åœ¨å®é™…ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ä»£ç èŠ‚çº¦è®¸å¤šæ—¶é—´</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190606003416.png" srcset="/img/loading.gif" alt></p><h3 id="2-5ã€Script-åˆ’é‡ç‚¹"><a href="#2-5ã€Script-åˆ’é‡ç‚¹" class="headerlink" title="2.5ã€Script(åˆ’é‡ç‚¹)"></a>2.5ã€Script(åˆ’é‡ç‚¹)</h3><h4 id="2-5-1ã€ç®€ä»‹"><a href="#2-5-1ã€ç®€ä»‹" class="headerlink" title="2.5.1ã€ç®€ä»‹"></a>2.5.1ã€ç®€ä»‹</h4><p>åœ¨ POSTMAN ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ç¼–å†™ JavaScript è„šæœ¬å¢å¼ºå…¶åŠŸèƒ½ï¼ŒPOSTMAN çš„è„šæœ¬è¿è¡Œåœ¨å…¶æä¾›çš„æ²™ç›’ç¯å¢ƒä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç‚¹å‡»å·¦ä¸‹è§’æŒ‰é’®å¯ä»¥å‡ºç°è°ƒè¯•çª—å£ï¼Œä¼šæ˜¾ç¤ºè„šæœ¬çš„ debug ä¿¡æ¯</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190618000158.png" srcset="/img/loading.gif" alt></p><p>åœ¨ postman ä¸­ä¸€å…±æ”¯æŒä¸¤ç§è„šæœ¬ï¼Œåˆ†åˆ«æ˜¯ Pre Request Script, Test Scriptï¼Œè¿™ä¸¤ç§è„šæœ¬åˆ†åˆ«åœ¨è¯·æ±‚å‰ä»¥åŠè¯·æ±‚åç”Ÿæ•ˆï¼Œç¬¬ä¸€ç§æˆ‘å¸¸ç”¨äºç”Ÿæˆå„ç§ç­¾åæˆ–è€…æ˜¯éœ€è¦æå‰è¯·æ±‚è·å–ä¸€äº› tokenï¼Œåé¢ä¸€ç§æ›´å¸¸è§äºé›†æˆæµ‹è¯•ä¸­ï¼Œç”¨äºæ§åˆ¶æµ‹è¯•çš„å‰åé¡ºåºï¼Œä¾‹å¦‚åé¢ä¼šè®²åˆ°çš„æ¡ˆä¾‹ï¼Œåœ¨ CD å‰é›†æˆæ¥å£å›å½’æµ‹è¯•ï¼Œç¡®ä¿ä¸»æµç¨‹æ— è¯¯å†ä¸Šçº¿ç­‰ã€‚</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190618000827.png" srcset="/img/loading.gif" alt></p><h4 id="2-5-2ã€API"><a href="#2-5-2ã€API" class="headerlink" title="2.5.2ã€API"></a>2.5.2ã€API</h4><p>postman æä¾›äº†ä¸€äº› APIï¼Œ<code>pm.*</code>, ä¾‹å¦‚:</p><pre><code class="hljs bash">pm.global.* <span class="hljs-comment"># å…¨å±€å˜é‡ç›¸å…³</span>pm.environment.* <span class="hljs-comment"># ç¯å¢ƒå˜é‡ç›¸å…³</span>pm.request.* <span class="hljs-comment"># è¯·æ±‚ç›¸å…³, æ³¨æ„è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯æ—¶åªè¯»çš„ä¸èƒ½ä¿®æ”¹</span>pm.sendRequest() <span class="hljs-comment"># å‘é€è¯·æ±‚</span><span class="hljs-comment"># ä¸‹é¢è¿™äº›åªèƒ½ç”¨äº test script</span>pm.response.* <span class="hljs-comment"># è¿”å›å€¼ç›¸å…³</span>pm.cookies.* <span class="hljs-comment"># cookies</span>pm.test() <span class="hljs-comment"># æ‰§è¡Œæµ‹è¯•</span>...</code></pre><p>é™¤æ­¤ä¹‹å¤–è¿˜å†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„ npm åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚:</p><pre><code class="hljs bash">ajv â†’ v6.6.2atob â†’ v2.1.2btoa â†’ v1.2.1chai â†’ v4.2.0cheerio â†’ v0.22.0...</code></pre><p>æ›´å¤š API ä¿¡æ¯å¯ä»¥è®¿é—®å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹: <a href="https://learning.getpostman.com/docs/postman/scripts/postman_sandbox_api_reference" target="_blank" rel="noopener">Postman Sandbox API reference</a></p><h4 id="2-5-3ã€Pre-Request-Script"><a href="#2-5-3ã€Pre-Request-Script" class="headerlink" title="2.5.3ã€Pre Request Script"></a>2.5.3ã€Pre Request Script</h4><p>è¯·æ±‚å‰æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä¸€èˆ¬ç”¨äºæå‰è®¾ç½®ä¸€äº›ç­¾åä¿¡æ¯ï¼Œä¸Šæ–‡æåˆ°è¿‡è™½ç„¶ postman å°†è¯·æ±‚çš„ä¿¡æ¯æš´éœ²ç»™äº†æˆ‘ä»¬ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½ä¿®æ”¹ï¼Œé‚£æˆ‘ä»¬è¦å¦‚ä½•æ‰èƒ½å¤Ÿå°†æˆ‘ä»¬ç”Ÿæˆçš„å€¼æ”¾åœ¨è¯·æ±‚ä¹‹ä¸­å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼š å˜é‡ï¼Œå¦‚æœç­¾åä¿¡æ¯ä»…åœ¨ header ä¹‹ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ’å…¥æ–°çš„ header ä¿¡æ¯</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­</p><p>è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ—¶å€™å¾€å¾€éœ€è¦ç”Ÿæˆä¸€ä¸ª Token è¿›è¡Œé‰´æƒï¼Œè¿™ä¸ªç¤ºä¾‹ä¼šåˆ†åˆ«ç”Ÿæˆä¸€ä¸ªæ—¶é—´æˆ³ï¼Œä»¥åŠåˆ©ç”¨è‡ªå¸¦çš„<code>CryptoJS</code>åº“è¿›è¡Œ<code>AES</code>åŠ å¯†ç­¾åï¼Œå¹¶ä¸”åˆ†åˆ«ä½¿ç”¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ–°å¢ header çš„æ–¹å¼æ³¨å…¥åˆ°è¯·æ±‚ä¹‹ä¸­</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710224627.png" srcset="/img/loading.gif" alt></p><pre><code class="hljs javascript"><span class="hljs-comment">// ä»ç¯å¢ƒå˜é‡ä¸­è·å–å¯†é’¥ä¸appid</span><span class="hljs-keyword">let</span> secret = pm.environment.get(<span class="hljs-string">"secret"</span>);<span class="hljs-keyword">let</span> appid = pm.environment.get(<span class="hljs-string">"appid"</span>);<span class="hljs-comment">// è·å–å½“å‰æ—¶é—´æˆ³</span><span class="hljs-keyword">let</span> time = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"time:"</span>, time + <span class="hljs-string">""</span>);<span class="hljs-comment">// ç›´æ¥å‘ Header ä¸­æ’å…¥ä¸€æ¡æ–°çš„è®°å½•</span>pm.request.headers.upsert(&#123; <span class="hljs-attr">key</span>: <span class="hljs-string">"time"</span>, <span class="hljs-attr">value</span>: time &#125;);<span class="hljs-comment">// ç­¾å</span><span class="hljs-keyword">let</span> sign = CryptoJS.AES.encrypt(time + appid, secret);<span class="hljs-comment">// è®¾ç½®ç¯å¢ƒå˜é‡</span>pm.environment.set(<span class="hljs-string">"sign"</span>, sign.ciphertext.toString().toUpperCase());</code></pre><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710224357.png" srcset="/img/loading.gif" alt></p><h4 id="2-5-4ã€Test-Script"><a href="#2-5-4ã€Test-Script" class="headerlink" title="2.5.4ã€Test Script"></a>2.5.4ã€Test Script</h4><p>æµ‹è¯•è„šæœ¬å’Œä¸€åŠçš„å•å…ƒæµ‹è¯•å¤§åŒå°å¼‚ï¼Œè¿™é‡Œç®€è¦ä»‹ç»æ¯”è¾ƒå¸¸ç”¨å’Œé‡è¦çš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œè¯¦ç»†äº†è§£å¯ä»¥<a href="https://learning.getpostman.com/docs/postman/scripts/test_examples/" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹æ–‡æ¡£</a></p><ul><li><p>åŸºæœ¬çš„æµ‹è¯•è¯­å¥</p><pre><code class="hljs javascript">pm.test(<span class="hljs-string">"æµ‹è¯•åç§°"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">// æ–­è¨€</span>  pm.expect(pm.response.responseTime).to.be.below(<span class="hljs-number">200</span>);&#125;);</code></pre></li><li><p>æµç¨‹æ§åˆ¶ï¼Œå¯ä»¥å¯¹ API æµ‹è¯•çš„é¡ºåºè¿›è¡Œæ§åˆ¶</p><pre><code class="hljs javascript"><span class="hljs-comment">// è®¾ç½®ä¸‹ä¸€ä¸ªä¼šè¢«æ‰§è¡Œçš„è¯·æ±‚</span>postman.setNextRequest(<span class="hljs-string">"request_name"</span>);<span class="hljs-comment">// ç»ˆç«¯æµç¨‹</span>postman.setNextRequest(<span class="hljs-literal">null</span>);</code></pre></li></ul><p>è¿è¡Œä¸€å…±æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ Collection Run ä»¥åŠ newman cli æ‰§è¡Œï¼Œ newman ä¼šåœ¨åæ–‡çš„æ¡ˆä¾‹ä¹‹ä¸­æåˆ°</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190712004751.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œç»“æœè¯¦ç»†çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥å¯¼å‡º</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190712005755.png" srcset="/img/loading.gif" alt></p><h3 id="2-6ã€API-ä»£ç†"><a href="#2-6ã€API-ä»£ç†" class="headerlink" title="2.6ã€API ä»£ç†"></a>2.6ã€API ä»£ç†</h3><blockquote><p>è¿™ä¸ªåŠŸèƒ½å¯¹äºå®¢æˆ·ç«¯è°ƒè¯•çš„åŒå­¦ååˆ†æœ‰ç”¨ï¼Œå¯ä»¥é€šè¿‡ POSTMAN æä¾›çš„ä»£ç†åŠŸèƒ½ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚ä¿å­˜åœ¨å†å²è®°å½•æˆ–è€…æ˜¯ä¸€ä¸ª Collection ä¸­</p></blockquote><p>é¦–å…ˆæˆ‘ä»¬åœ¨ POSTMAN è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼Œç‚¹å‡» Filters è¿˜å¯ä»¥å¯¹è¯·æ±‚çš„æ–¹æ³•ï¼ŒURL è¿›è¡Œä¸€äº›è¿‡æ»¤çš„æ“ä½œ</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710225227.png" srcset="/img/loading.gif" alt></p><p>æ¥ä¸‹æ¥ï¼Œä»¥å®‰å“æ‰‹æœºä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å’Œç”µè„‘å¤„äºåŒä¸€ç½‘æ®µï¼Œå¹¶ä¸”åœ¨ WIFI è®¾ç½®é‡ŒåŠ ä¸Šä»£ç†</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/Screenshot_2019-07-11-23-43-13-112_com.android.se.png?x-oss-process=image/resize,h_600" srcset="/img/loading.gif" alt></p><p>ç„¶åå†åˆ°æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„ Collection ä¸­å°±å¯ä»¥çœ‹åˆ°è¯·æ±‚çš„è®°å½•äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºåœ¨æ‰‹æœºä¸Šè®¾ç½®äº†ä»£ç†ä¹‹åè®¿é—®äº†ä¸€ä¸‹ç™¾åº¦ï¼Œæ‰€æœ‰çš„è¯·æ±‚é“¾æ¥ä»¥åŠå‚æ•°éƒ½ä¼šå±•ç¤ºåœ¨ postman ä¸­</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190711234614.png" srcset="/img/loading.gif" alt></p><h3 id="2-7ã€â˜ï¸-API-æ–‡æ¡£"><a href="#2-7ã€â˜ï¸-API-æ–‡æ¡£" class="headerlink" title="2.7ã€â˜ï¸ API æ–‡æ¡£"></a>2.7ã€â˜ï¸ API æ–‡æ¡£</h3><blockquote><p>æ¥ä¸‹æ¥ï¼Œå°†ä¼šæ˜¯äº‘æœåŠ¡ç›¸å…³çš„åŠŸèƒ½ï¼Œå¦‚æœä¸èƒ½ä½¿ç”¨äº‘æœåŠ¡è¿™ä¸€è¶´å¯ä»¥è·³è¿‡</p></blockquote><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710231728.png" srcset="/img/loading.gif" alt></p><p>å¦‚å›¾æ‰€ç¤ºæ–‡æ¡£å‘å¸ƒæˆåŠŸä¹‹åï¼Œå³å¯çœ‹åˆ°æ–‡æ¡£çš„è¯¦æƒ…ï¼Œå·²ç» API è¯¦æƒ…ï¼Œå¹¶ä¸”å³ä¾§æœ‰ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶å¯¹åº”çš„ä»£ç ï¼Œååˆ†æ–¹ä¾¿</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710231917.png" srcset="/img/loading.gif" alt></p><p>è¯¦ç»†ç¤ºä¾‹å¯ä»¥ç‚¹å‡»æŸ¥çœ‹ <a href="https://documenter.getpostman.com/view/364695/RWaGUpsy?version=latest" target="_blank" rel="noopener">We å·å¤§ API</a> ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æˆªæ­¢åˆ°æ–‡ç« å‘å¸ƒæ—¶ï¼Œpostman å¯¹å…è´¹è´¦æˆ·æ–‡æ¡£æœ‰ä¸€å®šçš„é™åˆ¶æ¯æœˆå…¬å¼€æ–‡æ¡£åªèƒ½æœ‰ 1000 çš„è®¿é—®</p><h3 id="2-8ã€â˜ï¸-Mock-Server"><a href="#2-8ã€â˜ï¸-Mock-Server" class="headerlink" title="2.8ã€â˜ï¸ Mock Server"></a>2.8ã€â˜ï¸ Mock Server</h3><p>åŒæ ·ååˆ†çš„ç®€å•ï¼Œå³é”® Collection ç‚¹å‡» mock å¹¶æŒ‰ç…§å¦‚å›¾æ‰€ç¤ºï¼Œè¿›è¡Œä¸€äº›ç®€å•çš„é…ç½®å³å¯ï¼Œæ³¨æ„ mock server çš„æ•°æ®æ˜¯è¯·æ±‚çš„æ—¶å€™ save example çš„æ•°æ®ï¼Œå¹¶ä¸”åŒæ ·å…è´¹è´¦æˆ·ï¼Œä¸€ä¸ªæœˆåªèƒ½è°ƒç”¨ 1000 æ¬¡ APIï¼Œå¯ä»¥ç‚¹å‡»æŸ¥çœ‹ <a href="https://documenter.getpostman.com/view/364695/RWaGUpsy?version=latest" target="_blank" rel="noopener">We å·å¤§ API</a> ï¼Œé‡Œé¢çš„æ–‡æ¡£ç¤ºä¾‹å°±æ˜¯ä½¿ç”¨çš„ Mock Server</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710232547.png" srcset="/img/loading.gif" alt></p><h3 id="2-9ã€â˜ï¸-æ¥å£ç›‘æ§"><a href="#2-9ã€â˜ï¸-æ¥å£ç›‘æ§" class="headerlink" title="2.9ã€â˜ï¸ æ¥å£ç›‘æ§"></a>2.9ã€â˜ï¸ æ¥å£ç›‘æ§</h3><p>åŒæ ·ååˆ†çš„ç®€å•ï¼Œå³é”® Collection ç‚¹å‡» monitor collection å¹¶æŒ‰ç…§å¦‚å›¾æ‰€ç¤ºè¿›è¡Œä¸€äº›é…ç½®ï¼Œå¯ä»¥é€‰æ‹© é¢‘ç‡ï¼Œæ¥å£ç›‘æ§çš„ä½ç½®ï¼Œè§¦å‘æ—¶é—´ç­‰å­—æ®µ</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710232823.png" srcset="/img/loading.gif" alt></p><h3 id="2-10ã€â˜ï¸-Postman-API"><a href="#2-10ã€â˜ï¸-Postman-API" class="headerlink" title="2.10ã€â˜ï¸ Postman API"></a>2.10ã€â˜ï¸ Postman API</h3><p>é™¤æ­¤ä¹‹å¤– POSTMAN è¿˜æä¾›å¼€æ”¾çš„ API ä½¿å…¶æœ‰æ›´å¤šçš„å¯èƒ½ï¼Œå¦‚å›¾æ‰€ç¤ºè·å– API Keyï¼Œå…·ä½“çš„ä½¿ç”¨è¯·ç‚¹<a href="https://docs.api.getpostman.com/?_ga=2.113542607.916957680.1562768130-1454391695.1559579723&amp;version=latest" target="_blank" rel="noopener">å‡»æŸ¥çœ‹ API æ–‡æ¡£</a>ï¼Œ é€šè¿‡ API æˆ‘ä»¬å¯ä»¥å®ç°ä¸€äº›è‡ªåŠ¨åŒ–çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ï¼Œç„¶åç”¨ github pages è¿›è¡Œéƒ¨ç½²ï¼Œä¸å—è´¦æˆ·é™åˆ¶ç­‰ç­‰ï¼Œç”±äºæ–‡ç« ç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®²äº†ã€‚</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190710233355.png" srcset="/img/loading.gif" alt></p><h2 id="ä¸‰ã€ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä¸‰ã€ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä¸‰ã€ä½¿ç”¨æ¡ˆä¾‹"></a>ä¸‰ã€ä½¿ç”¨æ¡ˆä¾‹</h2><h3 id="3-1ã€å’Œ-CI-CD-è”åŠ¨ï¼Œè¿›è¡Œæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#3-1ã€å’Œ-CI-CD-è”åŠ¨ï¼Œè¿›è¡Œæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="3.1ã€å’Œ CI/CD è”åŠ¨ï¼Œè¿›è¡Œæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•"></a>3.1ã€å’Œ CI/CD è”åŠ¨ï¼Œè¿›è¡Œæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•</h3><blockquote><p>postman æä¾›äº†ä¸€ä¸ªå‘½åè¡Œå·¥å…·ï¼Œnewman, é€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ CI /CD çš„æµç¨‹ä¸ŠåŠ å…¥æ¥å£è‡ªåŠ¨åŒ–å›å½’çš„æµç¨‹ï¼Œç¡®ä¿æœåŠ¡çš„ç¨³å®šæ€§</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»¥ gitlab ci/cd ä¸ºä¾‹ï¼Œé…ç½®ä¸€ä¸ªç®€å•çš„æ¥å£å›å½’</p><p>newman å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„æ–‡æ¡£æˆ–è€…æ˜¯<a href="https://github.com/postmanlabs/newman" target="_blank" rel="noopener">github ä»“åº“</a>çš„ä»‹ç», è¿™é‡Œä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸‹ç®€å•çš„ä½¿ç”¨</p><p>é¦–å…ˆæ˜¯ <code>.gitlab-ci.yml</code> çš„é…ç½®</p><pre><code class="hljs yaml"><span class="hljs-attr">stages:</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">test</span><span class="hljs-attr">api_test:</span>  <span class="hljs-attr">stage:</span> <span class="hljs-string">test</span>  <span class="hljs-attr">image:</span> <span class="hljs-string">node:11.15.0</span>  <span class="hljs-attr">before_script:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">newman</span>  <span class="hljs-attr">script:</span>    <span class="hljs-comment"># æ­¤å¤„æ‰§è¡Œçš„æ˜¯å®˜æ–¹çš„ä¸€ä¸ªä¾‹å­ï¼Œrun åé¢å¯ä»¥æ˜¯å¯¼å‡ºçš„Collectionçš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†äº«å‡ºæ¥çš„Collection</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">newman</span> <span class="hljs-string">run</span> <span class="hljs-string">"https://www.getpostman.com/collections/631643-f695cab7-6878-eb55-7943-ad88e1ccfd65-JsLv"</span>  <span class="hljs-attr">tags:</span>    <span class="hljs-bullet">-</span> <span class="hljs-string">gitlab-org</span></code></pre><p>å¦‚ä¸‹å›¾æ‰€ç¤ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…·ä½“çš„æ‰§è¡Œç»“æœï¼Œè¿”å›çš„ä¿¡æ¯ä¹Ÿæ¯”è¾ƒè¯¦ç»†ï¼Œå’Œä¸Šæ–‡çš„ Test Script è„šæœ¬ç»“åˆå°±å¯ä»¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ¥å£å›å½’æµ‹è¯•çš„æ•ˆæœ</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190712002216.png" srcset="/img/loading.gif" alt></p><p><a href="https://gitlab.com/mohuishou/postman-ci/pipelines" target="_blank" rel="noopener">ç‚¹å‡»å¯ä»¥æŸ¥çœ‹è¿™ä¸ª demo</a></p><h3 id="3-2ã€æœ¬åœ°æ¥å£æ–‡æ¡£"><a href="#3-2ã€æœ¬åœ°æ¥å£æ–‡æ¡£" class="headerlink" title="3.2ã€æœ¬åœ°æ¥å£æ–‡æ¡£"></a>3.2ã€æœ¬åœ°æ¥å£æ–‡æ¡£</h3><p>åœ¨ä¸Šæ–‡æˆ‘ä»¬æœ‰æåˆ°è¿‡ï¼Œpostman çš„äº‘æ–‡æ¡£æ¯”è¾ƒå¥½ç”¨ï¼Œä½†æ˜¯å…è´¹è´¦æˆ·çš„é™åˆ¶æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”å¾ˆå¤šæ—¶å€™åœ¨å…¬å¸æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ä¸€äº›äº‘çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¯¼å‡º postman collection å¹¶ä¸”ä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹çš„å·¥å…·ï¼Œæˆ–è€…æ˜¯è‡ªå·±å®ç°ä¸€ä¸ªæ¥å£æ–‡æ¡£çš„ç”ŸæˆåŠŸèƒ½ï¼Œæ¥è¾¾åˆ°è¾“å‡ºæœ¬åœ°æ–‡æ¡£çš„ç›®çš„</p><p>è¿™é‡Œæˆ‘ä»¬å€ŸåŠ© <a href="https://github.com/thedevsaddam/docgen" target="_blank" rel="noopener">docgen</a> è¿™ä¸ªè½®å­æ¥è¾“å‡ºä¸€ä»½æœ¬åœ°çš„æ–‡æ¡£ï¼Œç±»ä¼¼çš„å·¥å…·è¿˜æœ‰è®¸å¤šï¼Œå®ç°ä¸Šä¹Ÿä¸å¤æ‚ï¼Œå¦‚æœæœ‰æ ¼å¼ä¸Šçš„ä¸€äº›éœ€æ±‚å®Œå…¨å¯ä»¥ä¸€ä¸¤ä¸ªå°æ—¶çš„åŠŸå¤«é€ å‡ºä¸€ä¸ªè¿˜èƒ½ç”¨çš„å°å·¥å…·</p><pre><code class="hljs bash"><span class="hljs-comment"># åªéœ€è¦å¯¼å‡ºjsonæ–‡ä»¶ï¼Œå°±å¯ä»¥è¾“å‡ºåœ¨çº¿æ–‡æ¡£ï¼Œæˆ–è€…æ˜¯ç”Ÿæˆhtmlï¼Œmarkdown æ–‡ä»¶äº†</span>$ ./docgen.exe server -f Weå·å¤§.postman_collection.json2019/07/12 00:30:51 Listening on port:  90002019/07/12 00:30:51 Web Server is available at http://localhost:9000/</code></pre><p>ç”Ÿæˆçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190712003222.png" srcset="/img/loading.gif" alt></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« æ‹–çš„ç¨å¾®æœ‰ç‚¹ç‚¹ä¹…ï¼Œå†…å®¹æœ‰ç‚¹è¶…å‡ºæœ€å¼€å§‹çš„é¢„è®¡ï¼Œå†™çš„ç¨ç¨æœ‰ç‚¹ç‚¹å¤šäº†ï¼ŒPOSTMAN è¿˜æœ‰éœ€è¦æœ‰ç”¨çš„ç©æ³•ï¼Œå¤§å®¶å¯ä»¥æ¢ç´¢ä¸€ä¸‹ï¼Œé™¤äº†ä¸Šæ–‡è®²åˆ°çš„ä¹‹å¤–ï¼Œè¯´ä¸€äº›æˆ‘å¸¸ç”¨åˆ°çš„æ–¹å¼</p><ul><li>åˆ©ç”¨ collection run æ‰¹é‡æäº¤è¯·æ±‚ï¼Œåšä¸€äº›æ‰¹å¤„ç†çš„å·¥ä½œ</li><li>åˆ©ç”¨ pre request script è®¾ç½®åœ¨ Collection ä¸­ï¼Œç„¶åç”¨ä¸åŒçš„ç¯å¢ƒå˜é‡åŒºåˆ†ä¸åŒçš„é¡¹ç›®ï¼Œè¿™ç§ç”¨åœ¨ç½‘å…³ç±»çš„æµ‹è¯•ååˆ†æœ‰</li></ul><p>æ–‡ç« æ¯”è¾ƒé•¿ï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://learning.getpostman.com/docs" target="_blank" rel="noopener">Postman å®˜æ–¹æ–‡æ¡£ï¼Œå¾ˆå…¨é¢ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„æ“ä½œéƒ½èƒ½åœ¨ä¸Šé¢æ‰¾åˆ°</a></li><li><a href="https://haofly.net/postman/" target="_blank" rel="noopener">Postman é«˜çº§ç”¨æ³•</a></li><li><a href="https://www.twblogs.net/a/5bddb8542b717720b51ab853/zh-cn" target="_blank" rel="noopener">Postman é«˜çº§åº”ç”¨ï¼ˆ9ï¼‰ï¼šAPI æ”¶é›†ç¥å™¨â€”â€”è¯·æ±‚æ‹¦æˆª</a></li><li><a href="https://documenter.getpostman.com/view/364695/RWaGUpsy?version=latest" target="_blank" rel="noopener">We å·å¤§ API</a></li><li><a href="https://github.com/postmanlabs/newman" target="_blank" rel="noopener">newman</a></li><li><a href="https://gitlab.com/mohuishou/postman-ci/pipelines" target="_blank" rel="noopener">gitlab ci demo</a></li><li><a href="https://github.com/thedevsaddam/docgen" target="_blank" rel="noopener">docgen</a></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/38237.html">Go Web å°æŠ€å·§ï¼ˆä¸€ï¼‰ç®€åŒ–Ginæ¥å£ä»£ç </a></li><li><a href="https://lailin.xyz/post/41140.html">go generate and ast</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>tool</tag>
      
      <tag>postman</tag>
      
      <tag>api</tag>
      
      <tag>rest</tag>
      
      <tag>test</tag>
      
      <tag>gatway</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>go generate and ast</title>
    <link href="/post/41140.html"/>
    <url>/post/41140.html</url>
    
    <content type="html"><![CDATA[<h2 id="æ¥”-xie-å­"><a href="#æ¥”-xie-å­" class="headerlink" title="æ¥”(xiÄ“)å­"></a>æ¥”(xiÄ“)å­</h2><p>æœ€è¿‘å†™<code>API CURD</code>æ¯”è¾ƒå¤šï¼Œä¸ºäº†ç»“æ„æ¸…æ™°ï¼Œè¿”å›å€¼éœ€è¦ç»Ÿä¸€é”™è¯¯ç ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªç»Ÿä¸€çš„<code>errcode</code>åŒ…ä¸­å®šä¹‰é”™è¯¯ç å¸¸é‡ï¼Œä»¥åŠå…¶é”™è¯¯ä¿¡æ¯.</p><a id="more"></a><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”±äºå¸¸é‡æ˜¯å¯¼å‡ºå­—ç¬¦ -&gt; <code>golint</code> æ£€æµ‹éœ€è¦ç¼–å†™æ³¨é‡Š -&gt; æ³¨é‡Šä¿¡æ¯å…¶å®å°±æ˜¯é”™è¯¯ä¿¡æ¯ï¼Œå·²ç»åœ¨ä¸‹æ–‡çš„<code>msg map[int]string</code>ä¸­å®šä¹‰ï¼Œå¦‚æœåœ¨å†™å°±å¾—å†™ä¸¤é</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/assets/20190507235621.png" srcset="/img/loading.gif" alt></p><p>ä¸å†™ï¼Œå°±æ»¡å±æ³¢æµªçº¿ï¼Œä¸èƒ½å¿ï¼</p><p>å†™äº†ï¼Œå°±å¾—<code>Copy</code>ä¸€ä»½ï¼Œè¿˜ä¸åˆ©äºç»´æŠ¤ï¼Œä¸èƒ½å¿ï¼</p><p>èƒ½ä¸èƒ½åªå†™ä¸€ä»½æ³¨é‡Šï¼Œå‰©ä¸‹çš„<code>msg</code>é€šè¿‡è¯»å–æ³¨é‡Šä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆï¼Œå°†æˆ‘ä»¬å®(hua)è´µ(diao)çš„ç”Ÿå‘½ï¼Œä»è¿™äº›é‡å¤ç¹æ‚æ— æ„ä¹‰çš„åŠ³åŠ¨ä¸­è§£æ”¾å‡ºæ¥ã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸ª<del>ä¼Ÿå¤§çš„ç›®æ ‡</del>, éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªå…³é”®çš„æ•°æ®:</p><ol><li>è§£ææºä»£ç è·å–å¸¸é‡ä¸æ³¨é‡Šä¹‹é—´çš„å…³ç³» -&gt; ğŸŒ²Go æŠ½è±¡è¯­æ³•æ ‘: AST<sup><a href="https://golang.org/pkg/go/ast" target="_blank" rel="noopener">[3]</a></sup></li><li>ä» Go æºç ç”Ÿæˆ Go ä»£ç  -&gt; ğŸ‘ go generate<sup><a href="https://blog.golang.org/generate" target="_blank" rel="noopener">[5]</a></sup></li></ol><h2 id="ğŸ‘-go-generate"><a href="#ğŸ‘-go-generate" class="headerlink" title="ğŸ‘ go generate"></a>ğŸ‘ go generate</h2><p><code>golang</code>åœ¨<code>1.4</code>ç‰ˆæœ¬ä¸­å¼•å…¥äº†<code>go generate</code>å‘½ä»¤ï¼Œå¸¸ç”¨äºæ–‡ä»¶ç”Ÿæˆï¼Œä¾‹å¦‚åœ¨ Golang å®˜æ–¹åšå®¢<sup><a href="https://blog.golang.org/generate" target="_blank" rel="noopener">[5]</a></sup>ä¸­ä»‹ç»çš„<a href="https://golang.org/x/tools/cmd/stringer" target="_blank" rel="noopener">Stringer</a>å¯ä»¥ä¸ºæšä¸¾è‡ªåŠ¨å®ç°<code>Stringer</code>çš„æ–¹æ³•ï¼Œä»ä¸šåŠ¡ä»£ç ä¸­è§£æ”¾å‡ºæ¥</p><h3 id="ğŸ’»-å‘½ä»¤æ–‡æ¡£"><a href="#ğŸ’»-å‘½ä»¤æ–‡æ¡£" class="headerlink" title="ğŸ’» å‘½ä»¤æ–‡æ¡£"></a>ğŸ’» å‘½ä»¤æ–‡æ¡£</h3><p>ä½¿ç”¨<code>go help generate</code>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£</p><pre><code class="hljs bash">â–¶ go <span class="hljs-built_in">help</span> generateusage: go generate [-run regexp] [-n] [-v] [-x] [build flags] [file.go... | packages]...</code></pre><p>è§£é‡Šå¾ˆé•¿ï¼Œå°±ä¸è´´ä¸Šæ¥äº†ï¼Œç®€è¦çš„æ¦‚æ‹¬ä¸€ä¸‹:</p><ol><li><p>å‚æ•°è¯´æ˜</p><ul><li>-run æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å‘½ä»¤è¡Œï¼Œä»…æ‰§è¡ŒåŒ¹é…çš„å‘½ä»¤(å’Œ<code>go test -run</code>ç±»ä¼¼)</li><li>-v æ‰“å°  å·²è¢«æ£€ç´¢å¤„ç†çš„æ–‡ä»¶ã€‚</li><li>-n æ‰“å°å‡ºå°†è¢«æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ­¤æ—¶å°†ä¸çœŸå®æ‰§è¡Œå‘½ä»¤</li><li>-x æ‰“å°å·²æ‰§è¡Œçš„å‘½ä»¤</li></ul></li><li><p>ä¸¾ä¸ªæ —å­</p><pre><code class="hljs bash"><span class="hljs-comment"># å¯¹å½“å‰åŒ…ä¸‹çš„Goæ–‡ä»¶è¿›è¡Œå¤„ç†, å¹¶æ‰“å°å·²è¢«æ£€ç´¢å¤„ç†çš„æ–‡ä»¶ã€‚</span>go generate -v<span class="hljs-comment"># æ‰“å°å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸­å°†è¦è¢«æ‰§è¡Œçš„å‘½ä»¤(å®é™…ä¸ä¼šæ‰§è¡Œ)</span>go generate -n ./...</code></pre></li><li><p><code>go generate</code>ä¼šæ‰«æ<code>.go</code>æºç æ–‡ä»¶ä¸­çš„æ³¨é‡Š<code>//go:generate command args...</code>ï¼Œ å¹¶ä¸”æ‰§è¡Œå…¶å‘½ä»¤ï¼Œæ³¨æ„:</p><ul><li>è¿™äº›å‘½ä»¤æ˜¯ä¸ºäº†æ›´æ–°æˆ–è€…åˆ›å»º Go æºæ–‡ä»¶</li><li><code>command</code>å¿…é¡»æ˜¯å¯æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä¾‹å¦‚åœ¨ PATH ä¸­æˆ–è€…ä½¿ç”¨ç»å¯¹è·¯å¾„</li><li><code>arg</code>å¦‚æœå¸¦å¼•å·ä¼šè¢«è¯†åˆ«æˆä¸€ä¸ªå‚æ•°, ä¾‹å¦‚: <code>//go:generate command &quot;x1 x2&quot;</code>, è¿™æ¡è¯­å¥æ‰§è¡Œçš„å‘½ä»¤åªæœ‰ä¸€ä¸ªå‚æ•°</li><li><strong>æ³¨é‡Šä¸­<code>//</code>å’Œ<code>go</code>ä¹‹é—´æ²¡æœ‰ç©ºæ ¼</strong></li></ul></li><li><p><code>go generate</code>å¿…é¡»æ‰‹åŠ¨æ‰§è¡Œï¼Œå¦‚æœæƒ³ç­‰ç€<code>go build</code>, <code>go test</code>, <code>go run</code> å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œï¼Œå¯ä»¥æ´—æ´—ç¡äº†</p></li><li><p>ä¸ºäº†è®©åˆ«äººæˆ–è€…æ˜¯ IDE è¯†åˆ«ä»£ç æ˜¯é€šè¿‡<code>go generate</code>ç”Ÿæˆçš„ï¼Œè¯·åœ¨ç”Ÿæˆçš„ä»£ç ä¸­æ·»åŠ æ³¨é‡Š(ä¸€èˆ¬æ”¾åœ¨æ–‡ä»¶å¼€å¤´)</p><pre><code class="hljs bash"><span class="hljs-comment"># PS: è¿™æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼</span>^// Code generated .* DO NOT EDIT\.$</code></pre><p>ä¸¾ä¸ªæ —å­:</p><pre><code class="hljs go"><span class="hljs-comment">// Code generated by mohuishou DO NOT EDIT</span><span class="hljs-keyword">package</span> painkiller</code></pre></li><li><p><code>go generate</code>åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šè‡ªåŠ¨æ³¨å…¥ä»¥ä¸‹ç¯å¢ƒå˜é‡:</p><pre><code class="hljs bash"><span class="hljs-variable">$GOARCH</span>ç³»ç»Ÿæ¶æ„: arm, amd64 ç­‰<span class="hljs-variable">$GOOS</span>æ“ä½œç³»ç»Ÿ: linux, windows ç­‰<span class="hljs-variable">$GOFILE</span>å½“å‰æ‰§è¡Œçš„å‘½ä»¤æ‰€å¤„çš„æ–‡ä»¶å<span class="hljs-variable">$GOLINE</span>å½“å‰æ‰§è¡Œçš„å‘½ä»¤åœ¨æ–‡ä»¶ä¸­çš„è¡Œå·<span class="hljs-variable">$GOPACKAGE</span>æ‰§è¡Œçš„å‘½ä»¤æ‰€å¤„çš„æ–‡ä»¶çš„åŒ…å<span class="hljs-variable">$DOLLAR</span>$ ç¬¦å·</code></pre></li></ol><h3 id="ğŸŒ°-Go-å®˜æ–¹åšå®¢ä¸­ç»™å‡ºçš„æ —å­"><a href="#ğŸŒ°-Go-å®˜æ–¹åšå®¢ä¸­ç»™å‡ºçš„æ —å­" class="headerlink" title="ğŸŒ° Go å®˜æ–¹åšå®¢ä¸­ç»™å‡ºçš„æ —å­"></a>ğŸŒ° Go å®˜æ–¹åšå®¢ä¸­ç»™å‡ºçš„æ —å­</h3><p>æºæ–‡ä»¶: <code>painkiller.go</code></p><pre><code class="hljs go"><span class="hljs-comment">//go:generate stringer -type=Pill</span><span class="hljs-keyword">package</span> painkiller<span class="hljs-keyword">type</span> Pill <span class="hljs-keyword">int</span><span class="hljs-keyword">const</span> (    Placebo Pill = <span class="hljs-literal">iota</span>    Aspirin    Ibuprofen    Paracetamol    Acetaminophen = Paracetamol)</code></pre><p>æ‰§è¡Œå‘½ä»¤</p><pre><code class="hljs bash">go generate</code></pre><p>ç”Ÿæˆæ–‡ä»¶: <code>painkiller_stringer.go</code></p><pre><code class="hljs go"><span class="hljs-comment">// generated by stringer -type Pill pill.go; DO NOT EDIT</span><span class="hljs-keyword">package</span> painkiller<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span><span class="hljs-keyword">const</span> _Pill_name = <span class="hljs-string">"PlaceboAspirinIbuprofenParacetamol"</span><span class="hljs-keyword">var</span> _Pill_index = [...]<span class="hljs-keyword">uint8</span>&#123;<span class="hljs-number">0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">14</span>, <span class="hljs-number">23</span>, <span class="hljs-number">34</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(i Pill)</span> <span class="hljs-title">String</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;    <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">0</span> || i+<span class="hljs-number">1</span> &gt;= Pill(<span class="hljs-built_in">len</span>(_Pill_index)) &#123;        <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"Pill(%d)"</span>, i)    &#125;    <span class="hljs-keyword">return</span> _Pill_name[_Pill_index[i]:_Pill_index[i+<span class="hljs-number">1</span>]]&#125;</code></pre><p>ä»ä¸Šé¢çš„ ğŸŒ°ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨<code>.go</code>æºæ–‡ä»¶ä¸­ï¼Œæ·»åŠ äº†ä¸€è¡Œæ³¨é‡Š<code>go:generate stringer -type=Pill</code>, æ‰§è¡Œå‘½ä»¤<code>go generate</code>å°±è°ƒç”¨<code>stringer</code>å‘½ä»¤åœ¨åŒç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„<code>_stringer.go</code>çš„æ–‡ä»¶</p><p>å›æƒ³ä¸€ä¸‹ä¸Šæ–‡æåˆ°çš„éœ€æ±‚ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆç±»ä¼¼ï¼Œä» Go æºæ–‡ä»¶ä¸­ï¼Œç”Ÿæˆäº†ä¸€äº›ä¸æƒ³é‡å¤å†™çš„ä¸šåŠ¡é€»è¾‘</p><h2 id="ğŸŒ²-AST"><a href="#ğŸŒ²-AST" class="headerlink" title="ğŸŒ² AST"></a>ğŸŒ² AST</h2><p>å›åˆ°å‰é¢çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä»æºä»£ç ä¸­è·å–å¸¸é‡å’Œæ³¨é‡Šä¹‹å‰çš„å…³ç³»ï¼Œè¿™æ—¶å°±éœ€è¦æˆ‘ä»¬çš„ ğŸŒ²AST éš†é‡ç™»åœºäº†ã€‚</p><p>æœ¬æ–‡ä¸å¯¹ AST è¿‡å¤šä»‹ç»ï¼Œå¯ä»¥é˜…è¯»å‚è€ƒèµ„æ–™ä¸­çš„ AST æ ‡å‡†åº“æ–‡æ¡£<sup><a href="https://golang.org/pkg/go/ast" target="_blank" rel="noopener">[3]</a></sup>ï¼ŒGo çš„ AST(æŠ½è±¡è¯­æ³•æ ‘)<sup><a href="https://zhuanlan.zhihu.com/p/28516587" target="_blank" rel="noopener">[4]</a></sup></p><h3 id="ç®€è¦ä»‹ç»ä¸€ä¸‹-AST-åŒ…"><a href="#ç®€è¦ä»‹ç»ä¸€ä¸‹-AST-åŒ…" class="headerlink" title="ç®€è¦ä»‹ç»ä¸€ä¸‹ AST åŒ…"></a>ç®€è¦ä»‹ç»ä¸€ä¸‹ AST åŒ…</h3><p>åŸºç¡€çš„æ¥å£ç±»å‹</p><pre><code class="hljs go"><span class="hljs-comment">// Node ASTæ ‘èŠ‚ç‚¹</span><span class="hljs-keyword">type</span> Node <span class="hljs-keyword">interface</span> &#123;  Pos() token.Pos  End() token.Pos&#125;<span class="hljs-comment">// Expr æ‰€æœ‰çš„è¡¨è¾¾å¼éƒ½éœ€è¦å®ç°Expræ¥å£</span><span class="hljs-keyword">type</span> Expr <span class="hljs-keyword">interface</span> &#123;  Node  exprNode()&#125;<span class="hljs-comment">// Stmt æ‰€æœ‰çš„è¯­å¥éƒ½éœ€è¦å®ç°Stmtæ¥å£</span><span class="hljs-keyword">type</span> Stmt <span class="hljs-keyword">interface</span> &#123;  Node  stmtNode()&#125;<span class="hljs-comment">// Decl æ‰€æœ‰çš„å£°æ˜éƒ½éœ€è¦å®ç°Declæ¥å£</span><span class="hljs-keyword">type</span> Decl <span class="hljs-keyword">interface</span> &#123;  Node  declNode()&#125;</code></pre><p>ç­‰ä¼šå„¿å¯èƒ½ä¼šç”¨åˆ°çš„<code>ValueSpec</code></p><pre><code class="hljs go"><span class="hljs-comment">// ValueSpec è¡¨ç¤ºå¸¸é‡å£°æ˜æˆ–è€…å˜é‡å£°æ˜</span><span class="hljs-keyword">type</span> ValueSpec <span class="hljs-keyword">struct</span> &#123;        Doc     *CommentGroup <span class="hljs-comment">// associated documentation; or nil</span>        Names   []*Ident      <span class="hljs-comment">// value names (len(Names) &gt; 0)</span>        Type    Expr          <span class="hljs-comment">// value type; or nil</span>        Values  []Expr        <span class="hljs-comment">// initial values; or nil</span>        Comment *CommentGroup <span class="hljs-comment">// line comments; or nil</span>&#125;</code></pre><h3 id="CommentMap"><a href="#CommentMap" class="headerlink" title="CommentMap"></a>CommentMap</h3><p>åœ¨ godoc<sup><a href="https://golang.org/pkg/go/ast" target="_blank" rel="noopener">[3]</a></sup>çš„ Example ä¸­å¯ä»¥å‘ç°æœ‰ä¸€ä¸ª<a href="https://golang.org/pkg/go/ast/#example_CommentMap" target="_blank" rel="noopener">CommentMap</a>ä¾‹å­</p><pre><code class="hljs go"><span class="hljs-comment">// CommentMapæŠŠASTèŠ‚ç‚¹å’Œå…¶å…³è”çš„æ³¨é‡Šåˆ—è¡¨è¿›è¡Œæ˜ å°„</span><span class="hljs-keyword">type</span> CommentMap <span class="hljs-keyword">map</span>[Node][]*CommentGroup</code></pre><ol><li><p>é€šè¿‡<code>parse</code>è¯»å–æºç åˆ›å»ºä¸€ä¸ª AST</p><pre><code class="hljs go">fset := token.NewFileSet() <span class="hljs-comment">// positions are relative to fset</span>f, err := parser.ParseFile(fset, <span class="hljs-string">"src.go"</span>, src, parser.ParseComments)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;</code></pre></li><li><p>ä» AST ä¸­æ–°å»ºä¸€ä¸ª<code>CommentMap</code></p><pre><code class="hljs go">cmap := ast.NewCommentMap(fset, f, f.Comments)</code></pre></li></ol><h2 id="éœ€æ±‚å®ç°"><a href="#éœ€æ±‚å®ç°" class="headerlink" title="éœ€æ±‚å®ç°"></a>éœ€æ±‚å®ç°</h2><h3 id="1-è·å–å¸¸é‡å’Œæ³¨é‡Šçš„å…³è”å…³ç³»"><a href="#1-è·å–å¸¸é‡å’Œæ³¨é‡Šçš„å…³è”å…³ç³»" class="headerlink" title="1. è·å–å¸¸é‡å’Œæ³¨é‡Šçš„å…³è”å…³ç³»"></a>1. è·å–å¸¸é‡å’Œæ³¨é‡Šçš„å…³è”å…³ç³»</h3><pre><code class="hljs go">file := os.Getenv(<span class="hljs-string">"GOFILE"</span>)<span class="hljs-comment">// ä¿å­˜æ³¨é‡Šä¿¡æ¯</span><span class="hljs-keyword">var</span> comments = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)<span class="hljs-comment">// è§£æä»£ç æºæ–‡ä»¶ï¼Œè·å–å¸¸é‡å’Œæ³¨é‡Šä¹‹é—´çš„å…³ç³»</span>fset := token.NewFileSet()f, err := parser.ParseFile(fset, file, <span class="hljs-literal">nil</span>, parser.ParseComments)checkErr(err)<span class="hljs-comment">// Create an ast.CommentMap from the ast.File's comments.</span><span class="hljs-comment">// This helps keeping the association between comments</span><span class="hljs-comment">// and AST nodes.</span>cmap := ast.NewCommentMap(fset, f, f.Comments)<span class="hljs-keyword">for</span> node := <span class="hljs-keyword">range</span> cmap &#123;  <span class="hljs-comment">// ä»…æ”¯æŒä¸€æ¡å£°æ˜è¯­å¥ï¼Œä¸€ä¸ªå¸¸é‡çš„æƒ…å†µ</span>  <span class="hljs-keyword">if</span> spec, ok := node.(*ast.ValueSpec); ok &amp;&amp; <span class="hljs-built_in">len</span>(spec.Names) == <span class="hljs-number">1</span> &#123;    <span class="hljs-comment">// ä»…æå–å¸¸é‡çš„æ³¨é‡Š</span>    ident := spec.Names[<span class="hljs-number">0</span>]    <span class="hljs-keyword">if</span> ident.Obj.Kind == ast.Con &#123;      <span class="hljs-comment">// è·å–æ³¨é‡Šä¿¡æ¯</span>      comments[ident.Name] = getComment(ident.Name, spec.Doc)    &#125;  &#125;&#125;</code></pre><h3 id="2-è·å–æ³¨é‡Šä¿¡æ¯"><a href="#2-è·å–æ³¨é‡Šä¿¡æ¯" class="headerlink" title="2. è·å–æ³¨é‡Šä¿¡æ¯"></a>2. è·å–æ³¨é‡Šä¿¡æ¯</h3><pre><code class="hljs go"><span class="hljs-comment">// getComment è·å–æ³¨é‡Šä¿¡æ¯ï¼Œæ¥è‡ªASTæ ‡å‡†åº“çš„summaryæ–¹æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getComment</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>, group *ast.CommentGroup)</span> <span class="hljs-title">string</span></span> &#123;<span class="hljs-keyword">var</span> buf bytes.Buffer<span class="hljs-keyword">for</span> _, comment := <span class="hljs-keyword">range</span> group.List &#123;    <span class="hljs-comment">// æ³¨é‡Šä¿¡æ¯ä¼šä»¥ // å‚æ•°åï¼Œå¼€å§‹ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨æ—¶ä¸éœ€è¦ï¼Œå»æ‰</span>text := strings.TrimSpace(strings.TrimPrefix(comment.Text, fmt.Sprintf(<span class="hljs-string">"// %s"</span>, name)))buf.WriteString(text)&#125;<span class="hljs-comment">// replace any invisibles with blanks</span>bytes := buf.Bytes()<span class="hljs-keyword">for</span> i, b := <span class="hljs-keyword">range</span> bytes &#123;<span class="hljs-keyword">switch</span> b &#123;<span class="hljs-keyword">case</span> <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-string">'\r'</span>:bytes[i] = <span class="hljs-string">' '</span>&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(bytes)&#125;</code></pre><h3 id="3-ç”Ÿæˆä»£ç "><a href="#3-ç”Ÿæˆä»£ç " class="headerlink" title="3. ç”Ÿæˆä»£ç "></a>3. ç”Ÿæˆä»£ç </h3><pre><code class="hljs go"><span class="hljs-keyword">const</span> suffix = <span class="hljs-string">"_msg_gen.go"</span><span class="hljs-comment">// tpl ç”Ÿæˆä»£ç éœ€è¦ç”¨åˆ°æ¨¡æ¿</span><span class="hljs-keyword">const</span> tpl = <span class="hljs-string">`// Code generated by github.com/mohuishou/gen-const-msg DO NOT EDIT// &#123;&#123;.pkg&#125;&#125; const code comment msgpackage &#123;&#123;.pkg&#125;&#125;// noErrorMsg if code is not found, GetMsg will return thisconst noErrorMsg = "unknown error"// messages get msg from const commentvar messages = map[int]string&#123;&#123;&#123;range $key, $value := .comments&#125;&#125;&#123;&#123;$key&#125;&#125;: "&#123;&#123;$value&#125;&#125;",&#123;&#123;end&#125;&#125;&#125;// GetMsg get error msgfunc GetMsg(code int) string &#123;var (msg stringok  bool)if msg, ok = messages[code]; !ok &#123;msg = noErrorMsg&#125;return msg&#125;`</span><span class="hljs-comment">// gen ç”Ÿæˆä»£ç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">gen</span><span class="hljs-params">(comments <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)</span> <span class="hljs-params">([]<span class="hljs-keyword">byte</span>, error)</span></span> &#123;  <span class="hljs-keyword">var</span> buf = bytes.NewBufferString(<span class="hljs-string">""</span>)  data := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;    <span class="hljs-string">"pkg"</span>:      os.Getenv(<span class="hljs-string">"GOPACKAGE"</span>),    <span class="hljs-string">"comments"</span>: comments,  &#125;  t, err := template.New(<span class="hljs-string">""</span>).Parse(tpl)  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.Wrapf(err, <span class="hljs-string">"template init err"</span>)  &#125;  err = t.Execute(buf, data)  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.Wrapf(err, <span class="hljs-string">"template data err"</span>)  &#125;  <span class="hljs-keyword">return</span> format.Source(buf.Bytes())&#125;</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»ä¸€ä¸ªç®€å•çš„æ•ˆç‡éœ€æ±‚å¼•ç”³åˆ°<code>go generate</code>å’Œ<code>ast</code>çš„ä½¿ç”¨ï¼Œé¡ºä¾¿é˜…è¯»äº†ä¸€ä¸‹<code>ast</code>çš„æºç ï¼ŒèŠ±è´¹çš„æ—¶é—´å…¶å®å¯èƒ½æ˜¯è¿™ä¸ªå·¥å…·èŠ‚çº¦çš„æ—¶é—´çš„å‡ å€äº†ï¼Œä½†æ˜¯æ”¶è·ä¹Ÿæ˜¯ä¹‹å‰æ²¡æœ‰æƒ³åˆ°çš„ã€‚</p><ol><li>ä½¿ç”¨äº†è¿™ä¹ˆä¹…çš„<code>go</code>å‘½ä»¤ï¼Œè¯¦ç»†çš„é˜…è¯»äº†<code>go help command</code>çš„è¯´æ˜ä¹‹åï¼Œå‘ç°ä¹‹å‰å¯èƒ½è¿äº†è§£éƒ½ç®—ä¸ä¸Š</li><li>æ ‡å‡†åº“çš„<code>godoc</code>æ˜¯æœ€å¥½çš„ä½¿ç”¨è¯´æ˜ï¼Œç¬¬äºŒå¥½çš„æ˜¯å®ƒçš„æºä»£ç </li></ol><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><p><a href="https://github.com/mohuishou/go-const-msg" target="_blank" rel="noopener">go-const-msg æœ¬æ–‡å®ç°çš„æºä»£ç </a></p></li><li><p><a href="https://yushuangqi.com/blog/2017/go-command-generate.html" target="_blank" rel="noopener">Golang Generate å‘½ä»¤è¯´æ˜ä¸ä½¿ç”¨</a></p></li><li><p><a href="https://golang.org/pkg/go/ast/" target="_blank" rel="noopener">AST æ ‡å‡†åº“æ–‡æ¡£</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/28516587" target="_blank" rel="noopener">Go çš„ AST(æŠ½è±¡è¯­æ³•æ ‘)</a></p></li><li><p><a href="https://blog.golang.org/generate" target="_blank" rel="noopener">GO å®˜æ–¹åšå®¢: Generating code</a></p></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>tool</tag>
      
      <tag>generate</tag>
      
      <tag>ast</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo-next-algolia-searchå…¨æ–‡æœç´¢</title>
    <link href="/post/27142.html"/>
    <url>/post/27142.html</url>
    
    <content type="html"><![CDATA[<p>åœ¨ hexo ä¸­é€šè¿‡ algolia å®ç°å…¨æ–‡æœç´¢</p><a id="more"></a><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><blockquote><p>The latest version of the Hexo-Algolia plugin removes the content indexing feature, given Algoliaâ€™s free account limitation.</p></blockquote><p>é€šè¿‡ä¸»é¢˜å®˜æ–¹çš„<a href="https://theme-next.org/docs/third-party-services/search-services" target="_blank" rel="noopener">æ–‡æ¡£</a>æˆ‘ä»¬å‘ç°ï¼Œå…¨æ–‡ç´¢å¼•çš„åŠŸèƒ½å·²ç»è¢«ç§»é™¤äº†ï¼ŒåŸå› æ˜¯å› ä¸ºä¼šå‡ºç°<code>Record Too Big</code>çš„æŠ¥é”™ï¼ŒæŸ¥é˜… algolia çš„<a href="https://www.algolia.com/doc/faq/basics/is-there-a-size-limit-for-my-index-records" target="_blank" rel="noopener">æ–‡æ¡£</a>æˆ‘ä»¬å¯ä»¥å‘ç°å…è´¹è´¦å·ï¼Œå•æ¡ç´¢å¼•çš„ä¸Šé™ä¸º<code>10kB</code>, å•†ä¸šç‰ˆç”¨æˆ·çš„ç´¢å¼•ä¸Šé™ä¸º<code>20KB</code></p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><blockquote><p>è¯·å…ˆæŒ‰ç…§ä¸Šæ–‡æåˆ°çš„ä¸»é¢˜é…ç½®è¯´æ˜é…ç½®ä¹‹åè¿›è¡Œå¦‚ä¸‹æ“ä½œ</p></blockquote><ol><li><p>æ›¿æ¢æ’ä»¶</p><p>åœ¨<code>package.json</code>ä¸­æ›¿æ¢ä¸‹é¢è¿™ä¸€è¡Œ</p><pre><code class="hljs json">"hexo-algolia": "https://github.com/mohuishou/hexo-algolia"</code></pre></li><li><p>ä¿®æ”¹ä¸»é¢˜æ–‡ä»¶<code>themes\next\source\js\algolia-search.js</code></p><p>å°†<code>instantsearch.widgets.hits</code>æ–¹æ³•ä¸­, item å¯¹åº”çš„è¿”å›å€¼æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹</p><pre><code class="hljs javascript"><span class="hljs-keyword">return</span> (  <span class="hljs-string">'&lt;a href="'</span> +  link +  <span class="hljs-string">'" class="algolia-hit-item-link"&gt;'</span> +  <span class="hljs-string">'&lt;div class="algolia-hit-item-title"&gt;'</span> +  data._highlightResult.title.value +  <span class="hljs-string">"&lt;/div&gt;"</span> +  <span class="hljs-string">'&lt;div class="algolia-hit-item-content"&gt;'</span> +  data._snippetResult.raw.value +  <span class="hljs-string">"&lt;/div&gt;"</span> +  <span class="hljs-string">"&lt;/a&gt;"</span>);</code></pre><p>è¿™ä¸¤æ­¥åšå®Œå…¶å®å°±å·²ç»å®Œæˆçš„äº†å…¨æ–‡ç´¢å¼•ï¼Œä½†æ˜¯æœç´¢ç»“æœä¼šæŠŠæ‰€æœ‰å†…å®¹è¿”å›ï¼Œæˆ‘ä»¬å…¶å®åªéœ€è¦åŒ¹é…å…³é”®è¯é™„è¿‘çš„ç»“æœ</p></li><li><p>å¼€å¯ Attributes to snippet ç‰¹æ€§</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºç‚¹å‡»ç´¢å¼•-&gt;é…ç½®ï¼Œ ç„¶åå†åˆ°å·¦ä¾§åˆ—è¡¨ä¸­é€‰ä¸­<code>Snippeting</code></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190410234147.png" srcset="/img/loading.gif" alt></p><p>ç„¶åå¦‚å›¾æ‰€ç¤ºæ·»åŠ å­—æ®µ<code>raw</code>, å³ä¾§ä¸ºæ˜¾ç¤ºçš„å­—ç¬¦æ•°ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190410234453.png" srcset="/img/loading.gif" alt></p><p>åˆ°è¿™é‡Œå°±å¤§åŠŸå‘Šæˆäº†ï¼Œä½†æ˜¯å…³é”®è¯è¿˜ä¸å¤Ÿçªå‡ºï¼Œå¯ä»¥å†åšä¸€äº›ç¾åŒ–</p></li><li><p>ç¾åŒ–æœç´¢ç»“æœ</p><p>åœ¨<code>source/_data</code>ä¸­æ–°å¢<code>styles.styl</code>æ–‡ä»¶</p><pre><code class="hljs css"><span class="hljs-selector-tag">em</span> &#123;  <span class="hljs-attribute">color</span>: red;  <span class="hljs-attribute">font-style</span>: normal;&#125;<span class="hljs-selector-class">.algolia-hit-item-title</span> &#123;  <span class="hljs-attribute">font-weight</span>: bold;&#125;<span class="hljs-selector-class">.algolia-hit-item-content</span> &#123;  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8em</span>;  <span class="hljs-attribute">color</span>: <span class="hljs-number">#555</span>;&#125;</code></pre><p>ä¿®æ”¹<code>_config.yml</code></p><pre><code class="hljs yaml"><span class="hljs-attr">theme_config:</span>  <span class="hljs-attr">custom_file_path:</span>    <span class="hljs-attr">styles:</span> <span class="hljs-string">source/_data/styles.styl</span></code></pre><p>ok! å¤§åŠŸå‘Šæˆ</p></li></ol><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><ol><li><p>ä¼˜åŒ–å‰:</p><blockquote><p>éšæ„æ‰¾äº†ä¸€ä¸ªåšå®¢çš„æˆªå›¾ï¼Œæ˜¾ç¤ºåªæœ‰æ ‡é¢˜ï¼Œæ²¡æœ‰çš„é«˜äº®ä»¥åŠè¯¦æƒ…<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190411000323.png" srcset="/img/loading.gif" alt></p></blockquote></li><li><p>ä¼˜åŒ–å:<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190410235215.png" srcset="/img/loading.gif" alt></p></li></ol><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åŸç†å…¶å®å¾ˆç®€å•ï¼Œè·å–æ–‡ç« åŸå§‹<code>markdown</code>å†…å®¹ï¼Œåˆ¤æ–­å¤§å°å¦‚æœè¶…è¿‡æŒ‡å®šå¤§å°(é»˜è®¤ 8K)å°±è¿›è¡Œæˆªæ–­</p><pre><code class="hljs javascript"><span class="hljs-comment">// è·å–åŸå§‹å†…å®¹</span><span class="hljs-keyword">var</span> rawBuf = <span class="hljs-keyword">new</span> Buffer(data.raw);<span class="hljs-comment">// è·å–å¤§å°é™åˆ¶</span><span class="hljs-keyword">var</span> rowSize = options.maxRawSize * <span class="hljs-number">1024</span>;<span class="hljs-keyword">if</span> (rawBuf.length &gt; rowSize) &#123;  <span class="hljs-comment">// è¶…å‡ºé™åˆ¶ï¼Œè¿›è¡Œæˆªæ–­</span>  storedPost.raw = rawBuf.toString(<span class="hljs-string">"utf8"</span>, <span class="hljs-number">0</span>, rowSize);  <span class="hljs-comment">// å»é™¤æœ€åä¸€ä¸ªå­—ç¬¦</span>  <span class="hljs-comment">// ç”±äºæˆªæ–­æ˜¯æŒ‰ç…§å­—èŠ‚æˆªæ–­çš„ï¼Œä½†æ˜¯ä¸€ä¸ªä¸­æ–‡å­—ç¬¦ä¸æ­¢ä¸€ä¸ªå­—èŠ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœ€åä¸€ä¸ªå­—ç¬¦ä¹±ç </span>  storedPost.raw = storedPost.raw.substring(<span class="hljs-number">0</span>, storedPost.raw.length - <span class="hljs-number">1</span>);&#125;</code></pre><p>è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ PR: <a href="https://github.com/oncletom/hexo-algolia/pull/39/files" target="_blank" rel="noopener">Feature/add raw max len</a></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/51252.html">dockeré•œåƒç˜¦èº«&ä¼˜åŒ–</a></li><li><a href="https://lailin.xyz/post/60163.html">GORMé¿å‘æŒ‡å—ä¹‹å«å…³è”å…³ç³»çš„æ›´æ–°</a></li><li><a href="https://lailin.xyz/post/28054.html">Github Actionsä»‹ç»&è‡ªåŠ¨æ„å»ºGithub Pagesåšå®¢</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>blog</tag>
      
      <tag>hexo</tag>
      
      <tag>next</tag>
      
      <tag>algolia</tag>
      
      <tag>search</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockeré•œåƒç˜¦èº«&amp;ä¼˜åŒ–</title>
    <link href="/post/51252.html"/>
    <url>/post/51252.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸ºä»€ä¹ˆåœ¨å­˜å‚¨å¦‚æ­¤ä¾¿å®œçš„ä»Šå¤©æˆ‘ä»¬ä»ç„¶éœ€è¦å¯¹ Docker é•œåƒè¿›è¡Œç˜¦èº«?</p></blockquote><a id="more"></a><blockquote><p>PS: æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œè¯·é…Œæƒ…è§‚çœ‹</p></blockquote><h2 id="å°é•œåƒçš„ä¼˜ç‚¹"><a href="#å°é•œåƒçš„ä¼˜ç‚¹" class="headerlink" title="å°é•œåƒçš„ä¼˜ç‚¹"></a>å°é•œåƒçš„ä¼˜ç‚¹</h2><ol><li><p>åŠ é€Ÿæ„å»º/éƒ¨ç½²</p><p>è™½ç„¶å­˜å‚¨èµ„æºè¾ƒä¸ºå»‰ä»·ï¼Œä½†æ˜¯ç½‘ç»œ IO æ˜¯æœ‰é™çš„ï¼Œåœ¨å¸¦å®½æœ‰é™çš„æƒ…å†µä¸‹ï¼Œéƒ¨ç½²ä¸€ä¸ª 1G çš„é•œåƒå’Œ 10M çš„é•œåƒå¸¦æ¥çš„æ—¶é—´å·®è·å¯èƒ½å°±æ˜¯åˆ†é’Ÿçº§å’Œç§’çº§çš„å·®è·ã€‚ç‰¹åˆ«æ˜¯åœ¨<strong>å‡ºç°æ•…éšœ</strong>ï¼ŒæœåŠ¡è¢«è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹æ—¶ï¼Œè¿™ä¸ªæ—¶é—´å°¤ä¸ºå®è´µã€‚</p></li><li><p>æé«˜å®‰å…¨æ€§ï¼Œå‡å°‘æ”»å‡»é¢ç§¯</p><p>è¶Šå°çš„é•œåƒè¡¨ç¤ºæ— ç”¨çš„ç¨‹åºè¶Šå°‘ï¼Œå¯ä»¥å¤§å¤§çš„å‡å°‘è¢«æ”»å‡»çš„ç›®æ ‡</p></li><li><p>å‡å°‘å­˜å‚¨å¼€é”€</p></li></ol><h2 id="å°é•œåƒçš„åˆ¶ä½œåŸåˆ™"><a href="#å°é•œåƒçš„åˆ¶ä½œåŸåˆ™" class="headerlink" title="å°é•œåƒçš„åˆ¶ä½œåŸåˆ™"></a>å°é•œåƒçš„åˆ¶ä½œåŸåˆ™</h2><ol><li><p>é€‰ç”¨æœ€å°çš„åŸºç¡€é•œåƒ</p></li><li><p>å‡å°‘å±‚ï¼Œå»é™¤éå¿…è¦çš„æ–‡ä»¶</p><p>åœ¨å®é™…åˆ¶ä½œé•œåƒçš„è¿‡ç¨‹ä¸­ï¼Œä¸€å‘³çš„åˆå¹¶å±‚ä¸å¯å–ï¼Œéœ€è¦å­¦ä¼šå……åˆ†çš„åˆ©ç”¨ Docker çš„ç¼“å­˜æœºåˆ¶ï¼Œæå–å…¬å…±å±‚ï¼ŒåŠ é€Ÿæ„å»ºã€‚</p><ul><li><strong>ä¾èµ–æ–‡ä»¶å’Œå®é™…çš„ä»£ç æ–‡ä»¶å•ç‹¬åˆ†å±‚</strong></li><li><strong>å›¢é˜Ÿ/å…¬å¸é‡‡ç”¨å…¬å…±çš„åŸºç¡€é•œåƒç­‰</strong></li></ul></li><li><p>ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</p><p>å¾€å¾€æˆ‘ä»¬åœ¨æ„å»ºé˜¶æ®µå’Œå®é™…è¿è¡Œé˜¶æ®µéœ€è¦çš„ä¾èµ–ç¯å¢ƒæ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚<code>golang</code>ç¼–å†™çš„ç¨‹åºå®é™…è¿è¡Œçš„æ—¶å€™ä»…ä»…éœ€è¦ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å³å¯ï¼Œå¯¹äº<code>Node</code>æ¥è¯´ï¼Œå¯èƒ½æœ€åè¿è¡Œçš„åªæ˜¯ä¸€äº›æ‰“åŒ…ä¹‹åçš„<code>js</code>æ–‡ä»¶è€Œä¸éœ€è¦åŒ…å«<code>node_modules</code>é‡Œæˆåƒä¸Šä¸‡çš„ä¾èµ–</p></li></ol><h2 id="åŸºç¡€é•œåƒ"><a href="#åŸºç¡€é•œåƒ" class="headerlink" title="åŸºç¡€é•œåƒ"></a>åŸºç¡€é•œåƒ</h2><ul><li><p><a href="https://github.com/GoogleCloudPlatform/distroless" target="_blank" rel="noopener">distroless</a></p><blockquote><p>â€œDistrolessâ€ images contain only your application and its runtime dependencies. They do not contain package managers, shells or any other programs you would expect to find in a standard Linux distribution.</p></blockquote><p><code>distroless</code>æ˜¯ Google æ¨å‡ºçš„ä¸€ä¸ªä»…ä»…åŒ…å«è¿è¡Œæ—¶ç¯å¢ƒï¼Œä¸åŒ…å«åŒ…ç®¡ç†å™¨ï¼Œ<code>shell</code>ç­‰å…¶ä»–ç¨‹åºã€‚å¦‚æœä½ çš„ç¨‹åºæ²¡æœ‰å…¶ä»–ä¾èµ–çš„è¯ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©</p></li><li><p><a href="https://hub.docker.com/_/alpine" target="_blank" rel="noopener">alpine</a></p><blockquote><p>Alpine Linux is a security-oriented, lightweight Linux distribution based on musl libc and busybox.</p></blockquote><p>alpine æ˜¯ä¸€ä¸ªåŸºäº<code>musl</code>, <code>busybox</code>çš„å®‰å…¨çš„<code>linux</code>å‘è¡Œç‰ˆã€‚éº»é›€è™½å°äº”è„ä¿±å…¨ï¼Œè™½ç„¶ä¸åˆ° 10M, ä½†æ˜¯åŒ…å«äº†ä¸€ä¸ªåŒ…ç®¡ç†å™¨å’Œ<code>shell</code>ç¯å¢ƒï¼Œè¿™åœ¨æˆ‘ä»¬å®é™…çš„ä½¿ç”¨è°ƒè¯•å½“ä¸­å°†éå¸¸æœ‰ç”¨ã€‚</p><p>ä½†æ˜¯è¯·æ³¨æ„ï¼Œç”±äº<code>alpine</code>ä½¿ç”¨äº†æ›´å°çš„<code>muslc</code>æ›¿ä»£<code>glibc</code>ï¼Œä¼šå¯¼è‡´æŸäº›åº”ç”¨æ— æ³•ä½¿ç”¨ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘</p></li><li><p><a href="https://hub.docker.com/_/scratch" target="_blank" rel="noopener">scratch</a></p><p>scratch æ˜¯ç©ºç™½é•œåƒï¼Œä¸€èˆ¬ç”¨äºåŸºç¡€é•œåƒæ„å»ºï¼Œä¾‹å¦‚<code>alpine</code>é•œåƒçš„<code>dockerfile</code>ä¾¿æ˜¯ä»<code>scratch</code>å¼€å§‹çš„</p><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> scratch<span class="hljs-keyword">ADD</span><span class="bash"> alpine-minirootfs-20190228-x86_64.tar.gz /</span><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">"/bin/sh"</span>]</span></code></pre></li><li><p><a href="https://hub.docker.com/_/busybox" target="_blank" rel="noopener">busybox</a></p></li></ul><p>ä¸€èˆ¬è€Œè¨€ï¼Œ<code>distroless</code>ç›¸å¯¹ä¼šæ›´åŠ çš„å®‰å…¨ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°æ·»åŠ ä¾èµ–ä»¥åŠè°ƒè¯•æ–¹é¢çš„é—®é¢˜ï¼Œ<code>alpine</code>æ›´å°ï¼Œè‡ªå¸¦åŒ…ç®¡ç†å™¨ï¼Œæ›´åŠ è´´åˆä½¿ç”¨ä¹ æƒ¯ï¼Œä½†æ˜¯<code>muslc</code>å¯èƒ½ä¼šå¸¦æ¥å…¼å®¹æ€§çš„é—®é¢˜ï¼Œä¸€èˆ¬è€Œè¨€æˆ‘ä¼šé€‰æ‹©<code>alpine</code>ä½œä¸ºåŸºç¡€é•œåƒä½¿ç”¨ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨<a href="https://hub.docker.com" target="_blank" rel="noopener">Docker Hub</a>å½“ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°å¸¸ç”¨çš„<code>Debian</code>çš„é•œåƒä¹Ÿä¼šæä¾›çš„åªåŒ…å«åŸºç¡€åŠŸèƒ½çš„å°é•œåƒ</p><h3 id="åŸºç¡€é•œåƒå¯¹æ¯”"><a href="#åŸºç¡€é•œåƒå¯¹æ¯”" class="headerlink" title="åŸºç¡€é•œåƒå¯¹æ¯”"></a>åŸºç¡€é•œåƒå¯¹æ¯”</h3><p>æ­¤å¤„ç›´æ¥æ‹‰å–åŸºç¡€é•œåƒï¼ŒæŸ¥çœ‹é•œåƒå¤§å°ï¼Œ é€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<code>alpine</code>åªæœ‰ 5M å·¦å³ä¸º<code>debian</code>çš„ 20 åˆ†ä¹‹ä¸€</p><pre><code class="hljs bash">alpine      latest    5cb3aa00f899        3 weeks ago         5.53MBdebian      latest    0af60a5c6dd0        3 weeks ago         101MBubuntu      18.04     47b19964fb50        7 weeks ago         88.1MBubuntu      latest    47b19964fb50        7 weeks ago         88.1MBalpine      3.8       3f53bb00af94        3 months ago        4.41MB</code></pre><p>ä¼¼ä¹ä»ä¸Šé¢çœ‹ï¼Œæ„Ÿè§‰å·®è·ä¸å¤§ï¼Œå®è·µä¸­ï¼Œä¸åŒè¯­è¨€çš„åŸºç¡€é•œåƒéƒ½ä¼šæä¾›ä¸€äº›é‡‡ç”¨ä¸åŒåŸºç¡€é•œåƒåˆ¶ä½œçš„ tagï¼Œä¸‹é¢æˆ‘ä»¬ä»¥<code>ruby</code>çš„é•œåƒä¸ºä¾‹ï¼ŒæŸ¥çœ‹ä¸åŒåŸºç¡€é•œåƒçš„å·®å¼‚ã€‚å¯ä»¥çœ‹åˆ°é»˜è®¤çš„ latest é•œåƒ<code>881MB</code>è€Œ<code>alpine</code>ä»…ä»…åªæœ‰ä¸åˆ°<code>50MB</code>è¿™ä¸ªå·®è·å°±ååˆ†çš„å¯è§‚äº†</p><pre><code class="hljs bash">ruby   latest   a5d26127d8d0        4 weeks ago         881MBruby   alpine   8d8f7d19d1fa        4 weeks ago         47.8MBruby   slim     58dd4d3c99da        4 weeks ago         125MB</code></pre><h2 id="å‡å°‘å±‚ï¼Œå»é™¤éå¿…è¦çš„æ–‡ä»¶"><a href="#å‡å°‘å±‚ï¼Œå»é™¤éå¿…è¦çš„æ–‡ä»¶" class="headerlink" title="å‡å°‘å±‚ï¼Œå»é™¤éå¿…è¦çš„æ–‡ä»¶"></a>å‡å°‘å±‚ï¼Œå»é™¤éå¿…è¦çš„æ–‡ä»¶</h2><ol><li>åˆ é™¤æ–‡ä»¶ä¸è¦è·¨è¡Œ</li></ol><pre><code class="hljs dockerfile"><span class="hljs-comment"># dockerfile 1</span><span class="hljs-keyword">FROM</span> alpine<span class="hljs-keyword">RUN</span><span class="bash"> wget https://github.com/mohuishou/scuplus-wechat/archive/1.0.0.zip</span><span class="hljs-comment"># dockerfile 2</span><span class="hljs-keyword">FROM</span> alpine<span class="hljs-keyword">RUN</span><span class="bash"> wget https://github.com/mohuishou/scuplus-wechat/archive/1.0.0.zip</span><span class="hljs-keyword">RUN</span><span class="bash"> rm 1.0.0.zip</span><span class="hljs-comment"># dockerfile 3</span><span class="hljs-keyword">FROM</span> alpine<span class="hljs-keyword">RUN</span><span class="bash"> wget https://github.com/mohuishou/scuplus-wechat/archive/1.0.0.zip &amp;&amp;  rm 1.0.0.zip</span></code></pre><pre><code class="hljs bash"><span class="hljs-built_in">test</span>   3  351a80e99c22        5 seconds ago        5.53MB<span class="hljs-built_in">test</span>   2  ad27e625b8e5        49 seconds ago       6.1MB<span class="hljs-built_in">test</span>   1  165e2e0df1d3        About a minute ago   6.1MB</code></pre><p>å¯ä»¥å‘ç° 1ï¼Œ2 ä¸¤ä¸ªå¤§å°ä¸€æ ·ï¼Œä½†æ˜¯ 3 å°äº† 0.5MBï¼Œè¿™æ˜¯å› ä¸º docker å‡ ä¹æ¯ä¸€è¡Œå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå±‚ï¼Œåˆ é™¤æ–‡ä»¶çš„æ—¶å€™ï¼šå› ä¸ºåº•ä¸‹å„å±‚éƒ½æ˜¯åªè¯»çš„ï¼Œå½“éœ€è¦åˆ é™¤è¿™äº›å±‚ä¸­çš„æ–‡ä»¶æ—¶ï¼ŒAUFS ä½¿ç”¨ whiteout æœºåˆ¶ï¼Œå®ƒçš„å®ç°æ˜¯é€šè¿‡åœ¨ä¸Šå±‚çš„å¯å†™çš„ç›®å½•ä¸‹å»ºç«‹å¯¹åº”çš„ whiteout éšè—æ–‡ä»¶æ¥å®ç°çš„ï¼Œæ‰€ä»¥åœ¨å½“å‰å±‚å»åˆ é™¤ä¸Šä¸€å±‚çš„æ–‡ä»¶ï¼Œåªæ˜¯ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶éšè—æ‰ç½¢äº†</p><ol start="2"><li>ä½¿ç”¨å•è¡Œå‘½ä»¤</li></ol><p>é™¤äº†åˆ é™¤è¯­å¥éœ€è¦æ”¾åœ¨ä¸€è¡Œä»¥å¤–ï¼Œç”±äºå±‚çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å®‰è£…ä¾èµ–çš„ä¸€äº›å…¬å…±çš„è¯­å¥æœ€å¥½ä¹Ÿä½¿ç”¨æ¡<code>RUN</code>å‘½ä»¤ç”Ÿæˆï¼Œå‡å°‘æœ€ç»ˆçš„å±‚æ•°</p><ol start="3"><li><p>åˆ†ç¦»ä¾èµ–åŒ…ï¼Œä»¥åŠæºä»£ç ç¨‹åºï¼Œå……åˆ†åˆ©ç”¨å±‚çš„ç¼“å­˜</p><p>è¿™æ˜¯ä¸€ä¸ª<strong>æœ€ä½³å®è·µ</strong>ï¼Œåœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„ä¾èµ–åŒ…å¾€å¾€æ˜¯å˜åŠ¨ä¸å¤§çš„ï¼Œä½†æ˜¯æˆ‘ä»¬æ­£åœ¨å¼€å‘çš„æºç çš„å˜åŠ¨æ˜¯è¾ƒä¸ºé¢‘ç¹ï¼Œå¦‚æœæˆ‘ä»¬å®é™…çš„ä»£ç åªæœ‰<code>10M</code>ï¼Œä½†æ˜¯ä¾èµ–é¡¹æœ‰<code>1G</code>, å¦‚æœåœ¨<code>COPY</code>çš„æ—¶å€™ç›´æ¥<code>COPY . .</code>ä¼šå¯¼è‡´æ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½ä¼šæ—¶è¿™ä¸€å±‚çš„ç¼“å­˜å¤±æ•ˆï¼Œå¯¼è‡´æµªè´¹å¤åˆ¶ä»¥åŠæ¨é€åˆ°é•œåƒä»“åº“çš„æ—¶é—´ï¼Œå°† COPY è¯­å¥åˆ†å¼€ï¼Œæ¯æ¬¡ push å°±å¯ä»¥åªå˜æ›´æˆ‘ä»¬é¢‘ç¹ä¿®æ”¹çš„ä»£ç å±‚ï¼Œè€Œä¸æ˜¯è¿ç€ä¾èµ–ä¸€èµ·</p></li><li><p>ä½¿ç”¨<code>.dockerignore</code></p><p>åœ¨ä½¿ç”¨<code>Git</code>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>.gitignore</code>å¿½ç•¥æ–‡ä»¶ï¼Œåœ¨ docker build çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨<code>.dockerignore</code>åœ¨ Docker ä¸Šä¸‹æ–‡ä¸­å¿½ç•¥æ–‡ä»¶ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥å‡å°‘ä¸€äº›éå¿…è¦æ–‡ä»¶çš„å¯¼å…¥ï¼Œä¹Ÿå¯ä»¥æé«˜å®‰å…¨æ€§ï¼Œé¿å…å°†ä¸€äº›é…ç½®æ–‡ä»¶æ‰“åŒ…åˆ°é•œåƒä¸­</p></li></ol><h2 id="å¤šé˜¶æ®µæ„å»º"><a href="#å¤šé˜¶æ®µæ„å»º" class="headerlink" title="å¤šé˜¶æ®µæ„å»º"></a>å¤šé˜¶æ®µæ„å»º</h2><p>å¤šé˜¶æ®µæ„å»ºå…¶å®ä¹Ÿæ˜¯å‡å°‘å±‚çš„ä¸€ç§ï¼Œé€šè¿‡å¤šé˜¶æ®µæ„å»ºï¼Œæœ€ç»ˆé•œåƒå¯ä»¥ä»…åŒ…å«æœ€åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå’Œå¿…é¡»çš„è¿è¡Œæ—¶ä¾èµ–ï¼Œå¤§å¤§å‡å°‘é•œåƒä½“ç§¯ã€‚</p><p>ä»¥<code>GO</code>è¯­è¨€ä¸ºä¾‹ï¼Œå®é™…è¿è¡Œçš„è¿‡ç¨‹ä¸­åªéœ€è¦æœ€åç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ï¼Œè€Œ<code>GO</code>è¯­è¨€æœ¬çœä»¥åŠæ‰©å±•åŒ…ï¼Œä»£ç æ–‡ä»¶éƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ç¼–è¯‘çš„æ—¶å€™è¿™äº›ä¾èµ–åˆæ˜¯å¿…é¡»çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºçš„æ–¹å¼ï¼Œå‡å°‘æœ€ç»ˆç”Ÿæˆçš„é•œåƒä½“ç§¯</p><pre><code class="hljs dockerfile"><span class="hljs-comment"># ä½¿ç”¨golangé•œåƒä½œä¸ºbuilderé•œåƒ</span><span class="hljs-keyword">FROM</span> golang:<span class="hljs-number">1.12</span> as builder<span class="hljs-keyword">WORKDIR</span><span class="bash"> /go/src/github.com/go/helloworld/</span><span class="hljs-keyword">COPY</span><span class="bash"> app.go .</span><span class="hljs-keyword">RUN</span><span class="bash"> go build -o app .</span><span class="hljs-comment"># ç¼–è¯‘å®Œæˆä¹‹åä½¿ç”¨alpineé•œåƒä½œä¸ºæœ€ç»ˆçš„åŸºç¡€é•œåƒ</span><span class="hljs-keyword">FROM</span> alpine:latest as prod<span class="hljs-keyword">RUN</span><span class="bash"> apk --no-cache add ca-certificates</span><span class="hljs-keyword">WORKDIR</span><span class="bash"> /root/</span><span class="hljs-comment"># ä»builderä¸­å¤åˆ¶ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶</span><span class="hljs-keyword">COPY</span><span class="bash"> --from=builder /go/src/github.com/go/helloworld/app .</span><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">"./app"</span>]</span></code></pre><p>ç”±äºæœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œè¿™é‡Œä¸å¯¹å¤šé˜¶æ®µæ„å»ºå±•å¼€è®²è§£ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ<a href="https://yeasy.gitbooks.io/docker_practice/image/multistage-builds/#%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA" target="_blank" rel="noopener">å¤šé˜¶æ®µæ„å»º</a></p><h2 id="å¥‡æ·«æŠ€å·§"><a href="#å¥‡æ·«æŠ€å·§" class="headerlink" title="å¥‡æ·«æŠ€å·§"></a>å¥‡æ·«æŠ€å·§</h2><ol><li><p>ä½¿ç”¨<a href="https://github.com/wagoodman/dive" target="_blank" rel="noopener">dive</a>æŸ¥çœ‹ docker é•œåƒçš„å±‚ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ†æå‡å°‘é•œåƒä½“ç§¯</p></li><li><p>ä½¿ç”¨<a href="https://github.com/docker-slim/docker-slim" target="_blank" rel="noopener">docker-slim</a> å¯ä»¥è‡ªåŠ¨å¸®åŠ©ä½ å‡å°‘é•œåƒä½“ç§¯ï¼Œå¯¹äº Web åº”ç”¨è¾ƒä¸ºæœ‰ç”¨</p></li><li><p>å®‰è£…è½¯ä»¶æ—¶å»é™¤ä¾èµ–</p></li></ol><pre><code class="hljs bash"><span class="hljs-comment"># ubuntu</span>apt-get install -y â€”â€Šno-install-recommends<span class="hljs-comment">#alpine</span>apk add --no-cache &amp;&amp;  apk del build-dependencies<span class="hljs-comment"># centos</span>yum install -y ... &amp;&amp; yum clean all</code></pre><ol start="4"><li><p>ä½¿ç”¨<code>--flatten</code>å‚æ•°ï¼Œå‡å°‘å±‚(ä¸æ¨è)</p></li><li><p>ä½¿ç”¨<a href="https://github.com/jwilder/docker-squash" target="_blank" rel="noopener">docker-squash</a>å‹ç¼©å±‚</p></li></ol><h2 id="ä¸åŒè¯­è¨€çš„ç¤ºä¾‹"><a href="#ä¸åŒè¯­è¨€çš„ç¤ºä¾‹" class="headerlink" title="ä¸åŒè¯­è¨€çš„ç¤ºä¾‹"></a>ä¸åŒè¯­è¨€çš„ç¤ºä¾‹</h2><blockquote><p>æ·»åŠ ä¸­â€¦â€¦</p></blockquote><h3 id="Ruby-Rails"><a href="#Ruby-Rails" class="headerlink" title="Ruby(Rails)"></a>Ruby(Rails)</h3><ol><li><p>åªå®‰è£…ç”Ÿäº§æ‰€éœ€çš„ä¾èµ–</p></li><li><p>åˆ é™¤ä¸éœ€è¦çš„ä¾èµ–æ–‡ä»¶</p></li></ol><pre><code class="hljs bash">bundle install --without development:<span class="hljs-built_in">test</span>:assets -j4 --retry 3 --path=vendor/bundle \    <span class="hljs-comment"># Remove unneeded files (cached *.gem, *.o, *.c)</span>    &amp;&amp; rm -rf vendor/bundle/ruby/2.5.0/cache/*.gem \    &amp;&amp; find vendor/bundle/ruby/2.5.0/gems/ -name <span class="hljs-string">"*.c"</span> -delete \    &amp;&amp; find vendor/bundle/ruby/2.5.0/gems/ -name <span class="hljs-string">"*.o"</span> -delete</code></pre><ol start="3"><li>åˆ é™¤å‰ç«¯çš„<code>node_modules</code>ä»¥åŠç¼“å­˜æ–‡ä»¶</li></ol><pre><code class="hljs bash">rm -rf node_modules tmp/cache app/assets vendor/assets spec</code></pre><p>ä¸Šè¿°å†…å®¹å¯ä»¥ç»“åˆ<strong>å¤šé˜¶æ®µæ„å»º</strong>å®ç°</p><h3 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h3><p>Golang åœ¨ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºä¹‹åï¼Œåªå‰©ä¸‹äº†ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™æ—¶å€™å†è¦ä¼˜åŒ–ï¼Œå°±åªæœ‰ä½¿ç”¨<code>upx</code>ä¹‹ç±»çš„å·¥å…·å‹ç¼©äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½“ç§¯äº†</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="http://dockone.io/article/8174" target="_blank" rel="noopener">Docker å®¹å™¨é•œåƒç˜¦èº«çš„ä¸‰ä¸ªå°çªé—¨</a></li><li><a href="https://liulantao.com/docker-base-images.html" target="_blank" rel="noopener">åŸºç¡€é•œåƒ | å†è°ˆ Docker ç˜¦èº«</a></li><li><a href="https://legacy.gitbook.com/book/yeasy/docker_practice/details" target="_blank" rel="noopener">Docker â€”â€” ä»å…¥é—¨åˆ°å®è·µ</a>è¿™æ˜¯ä¸€æœ¬å¾ˆä¸é”™çš„ Docker å¼€æºä¹¦</li><li><a href="https://jingwei.link/2018/07/18/docker-namespace-cgroups-aufs.html#aufs" target="_blank" rel="noopener">Docker åŸºæœ¬åŸç†ç®€æ</a></li><li><a href="https://medium.com/@lemuelbarango/ruby-on-rails-smaller-docker-images-bff240931332" target="_blank" rel="noopener">Ruby on Railsâ€Šâ€”â€ŠSmaller docker images</a></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/27142.html">hexo-next-algolia-searchå…¨æ–‡æœç´¢</a></li><li><a href="https://lailin.xyz/post/60163.html">GORMé¿å‘æŒ‡å—ä¹‹å«å…³è”å…³ç³»çš„æ›´æ–°</a></li><li><a href="https://lailin.xyz/post/28054.html">Github Actionsä»‹ç»&è‡ªåŠ¨æ„å»ºGithub Pagesåšå®¢</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>blog</tag>
      
      <tag>docker</tag>
      
      <tag>cloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GORMé¿å‘æŒ‡å—ä¹‹å«å…³è”å…³ç³»çš„æ›´æ–°</title>
    <link href="/post/60163.html"/>
    <url>/post/60163.html</url>
    
    <content type="html"><![CDATA[<p>åœ¨ GORM çš„<a href="http://gorm.io/docs/update.html" target="_blank" rel="noopener">æ–‡æ¡£</a>å½“ä¸­æœ‰è¯´æ˜ï¼Œä½¿ç”¨<code>Update</code>, <code>Updates</code>æ—¶åªä¼šæ›´æ–°æ”¹å˜çš„å­—æ®µï¼Œä½†æ˜¯å‡ºç°å…³è”å…³ç³»çš„æ—¶å€™æƒ…å†µä¼¼ä¹æœ‰äº†ä¸€äº›å¾®å¦™çš„å˜åŒ–</p><blockquote><p>If you only want to update changed Fields, you could use <code>Update</code>, <code>Updates</code></p></blockquote><a id="more"></a><h2 id="å…ˆè¯´ç»“è®º"><a href="#å…ˆè¯´ç»“è®º" class="headerlink" title="å…ˆè¯´ç»“è®º"></a>å…ˆè¯´ç»“è®º</h2><p><code>db.Model(&amp;user).Update(&quot;name&quot;, &quot;hello&quot;)</code>å¦‚æœ<code>user</code>åŒ…å«å…³è”å…³ç³»ï¼Œ<code>user</code>çš„å…³è”å…³ç³»å°†è¢«è‡ªåŠ¨æ›´æ–°</p><h2 id="é¿å‘"><a href="#é¿å‘" class="headerlink" title="é¿å‘"></a>é¿å‘</h2><p><strong>1.å¦‚æœç¡®è®¤ä¸ä¼šä½¿ç”¨åˆ°å…³è”ç›¸å…³çš„å›è°ƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>UpdateColumn</code>,<code>UpdateColumns</code>æ–¹æ³•</strong></p><p>ä¸‹é¢æ˜¯æ¥è‡ª<a href="http://gorm.io/docs/update.html#Update-Columns-w-o-Hooks" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>çš„ä¾‹å­:</p><pre><code class="hljs go"><span class="hljs-comment">// Update single attribute, similar with `Update`</span>db.Model(&amp;user).UpdateColumn(<span class="hljs-string">"name"</span>, <span class="hljs-string">"hello"</span>)<span class="hljs-comment">//// UPDATE users SET name='hello' WHERE id = 111;</span><span class="hljs-comment">// Update multiple attributes, similar with `Updates`</span>db.Model(&amp;user).UpdateColumns(User&#123;Name: <span class="hljs-string">"hello"</span>, Age: <span class="hljs-number">18</span>&#125;)<span class="hljs-comment">//// UPDATE users SET name='hello', age=18 WHERE id = 111;</span></code></pre><p><strong>2.å¦‚æœéœ€è¦ç”¨åˆ°ç›¸å…³çš„å›è°ƒï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®š<code>Model</code>é‡Œé¢çš„ç»“æ„ä½“</strong></p><pre><code class="hljs go">db.Model(&amp;User&#123;Model: Model&#123;ID: <span class="hljs-number">1</span>&#125;&#125;).UpdateColumn(<span class="hljs-string">"name"</span>, <span class="hljs-string">"hello"</span>)</code></pre><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><p>ä¸‹é¢è¿™ä¸€æ®µæ˜¯å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼Œåªä¼šæ›´æ–°æ›´æ–°<code>users</code>è¡¨çš„<code>name</code>å­—æ®µ</p><pre><code class="hljs go"><span class="hljs-comment">// Update single attribute if it is changed</span>db.Model(&amp;user).Update(<span class="hljs-string">"name"</span>, <span class="hljs-string">"hello"</span>)<span class="hljs-comment">//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111;</span></code></pre><p>ä½†æ˜¯å¦‚æœ<code>Model(&amp;struct)</code>,<code>struct</code>åŒ…å«å…³è”å…³ç³»æ—¶ï¼Œ<code>struct</code>å…³è”å…³ç³»å°†è¢«æ›´æ–°ï¼Œå¦‚ä»¥ä¸‹æ‰€ç¤º:</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> Product <span class="hljs-keyword">struct</span> &#123;gorm.ModelCode         <span class="hljs-keyword">string</span>Price        <span class="hljs-keyword">uint</span>Applications []Application&#125;<span class="hljs-keyword">type</span> Application <span class="hljs-keyword">struct</span> &#123;gorm.ModelName      <span class="hljs-keyword">string</span>ProductID <span class="hljs-keyword">uint</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">// Migrate the schema</span>db.AutoMigrate(&amp;Product&#123;&#125;, &amp;Application&#123;&#125;)<span class="hljs-comment">// Create</span>db.Create(&amp;Product&#123;Code: <span class="hljs-string">"L1212"</span>, Price: <span class="hljs-number">1000</span>&#125;)<span class="hljs-comment">// Read</span><span class="hljs-keyword">var</span> product Productdb.First(&amp;product, <span class="hljs-number">1</span>) <span class="hljs-comment">// find product with id 1</span>product.Applications = []Application&#123;&#123;Name: <span class="hljs-string">"test"</span>,&#125;,&#125;<span class="hljs-comment">// Update - update product's price to 2000</span>db.Model(&amp;product).Update(<span class="hljs-string">"Price"</span>, <span class="hljs-number">1000</span>)    <span class="hljs-comment">// UPDATE products SET price = '1000', updated_at = '2019-01-29 21:58:52'  WHERE products.deleted_at IS NULL</span><span class="hljs-comment">// INSERT INTO applications (created_at,updated_at,deleted_at,name,product_id) VALUES ('2019-01-29 21:58:52','2019-01-29 21:58:52',NULL,'test','0')</span>&#125;</code></pre><h2 id="æº¯æº"><a href="#æº¯æº" class="headerlink" title="æº¯æº"></a>æº¯æº</h2><blockquote><p>è¯¥éƒ¨åˆ†é»˜è®¤å¯¹ GORM çš„æºç æœ‰ä¸€å®šçš„äº†è§£</p></blockquote><p>æŸ¥çœ‹<code>Model</code>ç›¸å…³çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°<code>Model</code>å…¶å®å°±æ˜¯<code>clone</code>äº†ä¸€ä¸ª<code>DB</code>å¯¹è±¡ç„¶åå°†ä¼ å…¥çš„æŒ‡é’ˆèµ‹å€¼ç»™<code>Value</code></p><pre><code class="hljs go"><span class="hljs-comment">// Model specify the model you would like to run db operations</span><span class="hljs-comment">//    // update all users's name to `hello`</span><span class="hljs-comment">//    db.Model(&amp;User&#123;&#125;).Update("name", "hello")</span><span class="hljs-comment">//    // if user's primary key is non-blank, will use it as condition, then will only update the user's name to `hello`</span><span class="hljs-comment">//    db.Model(&amp;user).Update("name", "hello")</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *DB)</span> <span class="hljs-title">Model</span><span class="hljs-params">(value <span class="hljs-keyword">interface</span>&#123;&#125;)</span> *<span class="hljs-title">DB</span></span> &#123;c := s.clone()c.Value = value<span class="hljs-keyword">return</span> c&#125;</code></pre><p>æŸ¥çœ‹<code>Update/Updates</code>ç›¸å…³çš„æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™é‡Œè®²éœ€è¦æ›´æ–°çš„å­—æ®µé€šè¿‡<code>InstanceSet(&quot;gorm:update_interface&quot;, values)</code>ä¿å­˜äº†ä¸‹æ¥</p><pre><code class="hljs go"><span class="hljs-comment">// Update update attributes with callbacks, refer: https://jinzhu.github.io/gorm/crud.html#update</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *DB)</span> <span class="hljs-title">Update</span><span class="hljs-params">(attrs ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> *<span class="hljs-title">DB</span></span> &#123;<span class="hljs-keyword">return</span> s.Updates(toSearchableMap(attrs...), <span class="hljs-literal">true</span>)&#125;<span class="hljs-comment">// Updates update attributes with callbacks, refer: https://jinzhu.github.io/gorm/crud.html#update</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *DB)</span> <span class="hljs-title">Updates</span><span class="hljs-params">(values <span class="hljs-keyword">interface</span>&#123;&#125;, ignoreProtectedAttrs ...<span class="hljs-keyword">bool</span>)</span> *<span class="hljs-title">DB</span></span> &#123;<span class="hljs-keyword">return</span> s.NewScope(s.Value).Set(<span class="hljs-string">"gorm:ignore_protected_attrs"</span>, <span class="hljs-built_in">len</span>(ignoreProtectedAttrs) &gt; <span class="hljs-number">0</span>).InstanceSet(<span class="hljs-string">"gorm:update_interface"</span>, values).callCallbacks(s.parent.callbacks.updates).db&#125;</code></pre><p>å†çœ‹çœ‹å…³è”å…³ç³»æ›´æ–°çš„ä»£ç ï¼Œ åªæœ‰ä¸€ä¸ªå‚æ•°<code>scope</code>,<code>scope</code>å“ªå„¿æ¥çš„å‘¢ï¼Œä¸Šé¢çš„<code>s.NewScope(s.Value)</code>,è¿™ä¸ªåœ°æ–¹å…¶å®ä¹Ÿæ˜¯å°†æœ€å¼€å§‹<code>Model</code>ä¸­çš„ <code>value</code>æ‹·è´äº†ä¸€ä»½</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveAfterAssociationsCallback</span><span class="hljs-params">(scope *Scope)</span></span> &#123;    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨å…³ç³»å…³ç³»ç„¶åæ›´æ–°bala bala...</span>    <span class="hljs-keyword">for</span> _, field := <span class="hljs-keyword">range</span> scope.Fields() &#123;autoUpdate, autoCreate, saveReference, relationship := saveAssociationCheck(scope, field)        <span class="hljs-comment">//...</span>    &#125;    <span class="hljs-comment">//...</span>&#125;</code></pre><p>çœ‹åˆ°è¿™ä¸ªäº†å·®ä¸å¤šå°±å¯æ˜ç™½äº†ï¼Œä¸»è¦åŸå› æ˜¯å› ä¸º<code>Model</code>çš„<code>value</code>ä¸€ç›´è·Ÿéšåˆ°äº†æœ€åï¼Œå¯¼è‡´æœ€åæ‰§è¡Œå…³è”å…³ç³»æ›´æ–°å›è°ƒçš„æ—¶å€™ï¼Œæ£€æµ‹åˆ°æœ‰å…³è”æ•°æ®æ•°æ®è¡¨ä¸­ä¸å­˜åœ¨ï¼Œå°±ä¼šè‡ªç„¶çš„æ ¹æ®å…³è”å…³ç³»æ’å…¥è¿›å»</p><h2 id="ç›¸å…³èµ„æº"><a href="#ç›¸å…³èµ„æº" class="headerlink" title="ç›¸å…³èµ„æº"></a>ç›¸å…³èµ„æº</h2><ol><li>ç›®å‰è¿˜ä¸æ¸…æ¥šè¿™æ˜¯ä¸€ä¸ª bug è¿˜æ˜¯ä¸€ä¸ª featureï¼Œå…ˆæäº¤äº†ä¸€ä¸ª issue: <a href="https://github.com/jinzhu/gorm/issues/2278" target="_blank" rel="noopener">https://github.com/jinzhu/gorm/issues/2278</a></li><li><a href="https://lailin.xyz/post/notes/%E4%B8%80%E4%B8%AA%E5%8D%81%E5%88%86%E8%BE%B9%E7%BC%98%E7%9A%84gorm%E7%9A%84bug/">ä¸€ä¸ªååˆ†è¾¹ç¼˜çš„ gorm çš„ bug</a></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>blog</tag>
      
      <tag>go</tag>
      
      <tag>note</tag>
      
      <tag>gorm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Github Actionsä»‹ç»&amp;è‡ªåŠ¨æ„å»ºGithub Pagesåšå®¢</title>
    <link href="/post/28054.html"/>
    <url>/post/28054.html</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å°†ä¸»è¦è®²è¿°å¦‚ä½•åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Github Actionsï¼Œ å¹¶ä¸”ä½¿ç”¨ Github Actions å®Œæˆ CI/CD çš„æ“ä½œ</p><a id="more"></a><blockquote><p>æ•…äº‹çš„èµ·å› å°±æ˜¯ï¼Œgithub çš„ç§æœ‰ä»“åº“å…è´¹äº†, æ‰“ç®—å°† blog ä»“åº“åˆ‡æ¢ä¸ºç§æœ‰ä»“åº“ï¼Œè¿™æ ·å¯ä»¥åŒæ—¶å°†ç¬”è®°å’Œåšå®¢æ”¾åœ¨ä¸€å—ï¼Œåˆ©ç”¨ hugo çš„ draft åŠŸèƒ½ï¼Œå°†ä¸æƒ³å‘å¸ƒçš„æ–‡ç« è®¾ç½® true å³å¯ã€‚</p><p>ä¿®æ”¹ä¹‹åç”±äºä¹‹å‰ä½¿ç”¨ Travis CI è‡ªåŠ¨æ„å»ºåšå®¢çš„é™æ€é¡µé¢ï¼Œè€Œ Travis CI å¯¹äºç§æœ‰ä»“åº“åªèƒ½è¯•ç”¨ 100 æ¬¡ï¼Œæ­£å¥½ä¹‹å‰è·å¾—äº† Github Actions çš„æµ‹è¯•èµ„æ ¼ï¼Œä½†æ˜¯ä¸€ç›´éƒ½è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œæœ¬æ¬¡è®°å½•ä¸€ä¸‹ Github Actions çš„ä½¿ç”¨è¿‡ç¨‹</p></blockquote><h2 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h2><p>actions å¯ä»¥ç”¨æ¥ä½œä¸º CI/CD ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒä¸åªæ˜¯ CI/CDï¼Œå› ä¸ºå®ƒå…¶å®æ˜¯ä¸€ç»„ docker å®¹å™¨æ‰€ç»„æˆçš„ Workflowï¼ŒWorkflow çš„è§¦å‘æ¡ä»¶ï¼Œå…¬å…±ä»“åº“ç›®å‰ä»…æ”¯æŒ pushï¼Œç§æœ‰ä»“åº“åˆ™æ”¯æŒ check_runã€createã€deleteã€issue commentï¼Œ commit comment, pull request ç­‰è®¸å¤šäº‹ä»¶, é€šè¿‡è¿™äº›äº‹ä»¶ï¼Œå¯ä»¥å®Œæˆé™¤äº† CI/CD ä¹‹å¤–çš„è®¸å¤šè‡ªåŠ¨åŒ–æ“ä½œï¼Œä¾‹å¦‚æ¥æ”¶åˆ° issue comment ä¹‹åä½¿ç”¨ telegram bot å‘é€é€šçŸ¥ç­‰ç­‰</p><h3 id="åˆ›å»ºä¸€ä¸ª-Workflow"><a href="#åˆ›å»ºä¸€ä¸ª-Workflow" class="headerlink" title="åˆ›å»ºä¸€ä¸ª Workflow"></a>åˆ›å»ºä¸€ä¸ª Workflow</h3><p>å¦‚æœä½ æœ‰æƒé™çš„è¯ï¼Œåœ¨ä½ çš„ä»“åº“ä¸‹åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ª Actions çš„èœå•</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190115223805.png" srcset="/img/loading.gif" alt></p><h3 id="Workflow-GUI"><a href="#Workflow-GUI" class="headerlink" title="Workflow GUI"></a>Workflow GUI</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤º</p><ol><li>åˆ‡æ¢è§†å›¾ï¼Œä»å·¦åˆ°å³åˆ†åˆ«æ˜¯ï¼ŒGUI çš„æ–¹å¼ç¼–è¾‘ï¼Œç›´æ¥ç¼–è¾‘æ–‡ä»¶ï¼ŒæŸ¥çœ‹å˜åŠ¨</li><li>workflow åŒºåŸŸï¼Œä¸€ä¸ª main.workflow æ–‡ä»¶ä¸‹å¯ä»¥åŒ…å«å¤šä¸ª workflowï¼Œæ¯ä¸€ä¸ª workflow</li><li>æ¯ä¸ª workflow å…·ä½“çš„ç¼–è¾‘åŒºåŸŸï¼Œæ¯ä¸ª workflow å¯ä»¥å…³è”å¤šä¸ª actionï¼Œæ¯ä¸ª action éƒ½æœ‰å¤´å°¾ä¸¤ä¸ªç‚¹ï¼Œç‚¹å‡»ä¸‹æ‹‰å³å¯è¿æ¥èµ·æ¥</li><li>ä¿å­˜æäº¤æŒ‰é’®</li></ol><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190115224518.png" srcset="/img/loading.gif" alt></p><h4 id="Workflow-edit"><a href="#Workflow-edit" class="headerlink" title="Workflow edit"></a>Workflow edit</h4><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œworkflow åªæœ‰ä¸¤ä¸ªå¯é€‰çš„ä¿®æ”¹é¡¹ï¼Œåˆ†åˆ«æ˜¯ Name ä»¥åŠè§¦å‘æ¡ä»¶ï¼Œè§¦å‘æ¡ä»¶å…¬å…±ä»“åº“ç›®å‰ä»…æ”¯æŒ pushï¼Œç§æœ‰ä»“åº“åˆ™æ”¯æŒ check_runã€createã€deleteã€issue commentï¼Œ commit comment, pull request ç­‰è®¸å¤šäº‹ä»¶ã€‚å®Œæ•´çš„è§¦å‘æ¡ä»¶å¯ä»¥æŸ¥çœ‹ <a href="https://developer.github.com/actions/creating-workflows/workflow-configuration-options/#events-supported-in-workflow-files" target="_blank" rel="noopener">Events supported in workflow files</a></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190115230105.png" srcset="/img/loading.gif" alt></p><h4 id="action-edit"><a href="#action-edit" class="headerlink" title="action edit"></a>action edit</h4><p>å¦‚ä¸‹å›¾æ‰€ç¤º</p><ol><li>uses ä½¿ç”¨çš„ docker é•œåƒ, åœ¨ <a href="https://github.com/actions" target="_blank" rel="noopener">https://github.com/actions</a> æä¾›äº†ä¸€äº›å¸¸ç”¨çš„ actions å¯ä»¥ç›´æ¥ä½¿ç”¨<ol><li><code>{user}/{repo}/{path}@{ref}</code> ç›´æ¥ä½¿ç”¨å…¬å¼€çš„ä»“åº“ï¼Œä»“åº“é‡Œå¿…é¡»åŒ…å« dockerfile, path ä¸ºå¯é€‰é¡¹ï¼Œæ²¡æœ‰ path é»˜è®¤ä¸ºæ ¹è·¯å¾„ï¼Œe.g <code>actions/heroku@master</code>, <a href="mailto:`actions/aws/ec2@v2.0.1" target="_blank" rel="noopener">`actions/aws/ec2@v2.0.1</a>`</li><li><code>./path/to/dir</code>å½“å‰ä»“åº“çš„ç›¸å¯¹è·¯å¾„</li><li><code>docker://{host}/{image}:{tag}</code> docker é•œåƒåœ°å€ï¼Œhost ä¸ºå¯é€‰é¡¹ï¼Œä¸å¡« host é»˜è®¤ä» dockerhub æ‹‰å–ï¼Œe.g <code>docker://mohuishou/hugo:0.53</code>, <code>docker://gcr.io/cloud-builders/gradle</code></li></ol></li><li>label å°±æ˜¯æ ‡ç­¾</li><li>runs è¦†ç›– dockerfile ä¸­çš„ entrypoint</li><li>args è¦†ç›– dockerfile ä¸­çš„ cmd</li><li>secret è¯»å–è¯¥ä»“åº“ä¿å­˜çš„ç§˜å¯†å˜é‡ï¼Œå°†ä»¥ç¯å¢ƒå˜é‡çš„å½¢å¼æ³¨å…¥åˆ°è¿è¡Œçš„å®¹å™¨ä¸­</li><li>env æ³¨å…¥åˆ°è¿è¡Œçš„å®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œæ˜¯å¯è§çš„</li></ol><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/20190116000345.png" srcset="/img/loading.gif" alt></p><h3 id="åˆ›å»º-Action"><a href="#åˆ›å»º-Action" class="headerlink" title="åˆ›å»º Action"></a>åˆ›å»º Action</h3><p>Action å…¶å®å°±æ˜¯ Docker é•œåƒï¼ŒæŒ‰ç…§ Docker é•œåƒçš„å†™æ³•å³å¯ï¼Œéœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ç‚¹</p><h4 id="1-Dockerfile-Lables"><a href="#1-Dockerfile-Lables" class="headerlink" title="1. Dockerfile Lables"></a>1. Dockerfile Lables</h4><p>github actions ä¼šè¯»å– dockerfile çš„ label åœ¨ Workflow GUI ä¸Šåšä¸€äº›å±•ç¤º</p><pre><code class="hljs dockerfile"><span class="hljs-keyword">LABEL</span><span class="bash"> <span class="hljs-string">"com.github.actions.name"</span>=<span class="hljs-string">""</span> <span class="hljs-comment">#Github action çš„åå­—</span></span><span class="hljs-keyword">LABEL</span><span class="bash"> <span class="hljs-string">"com.github.actions.description"</span>=<span class="hljs-string">"desc"</span> <span class="hljs-comment">#è¯´æ˜</span></span><span class="hljs-keyword">LABEL</span><span class="bash"> <span class="hljs-string">"com.github.actions.icon"</span>=<span class="hljs-string">"mic"</span> <span class="hljs-comment">#GUIä¸Šå±•ç¤ºçš„å›¾æ ‡</span></span><span class="hljs-keyword">LABEL</span><span class="bash"> <span class="hljs-string">"com.github.actions.color"</span>=<span class="hljs-string">"purple"</span> <span class="hljs-comment"># GUIä¸Šå±•ç¤ºçš„é¢œè‰²</span></span><span class="hljs-keyword">LABEL</span><span class="bash"> <span class="hljs-string">"repository"</span>=<span class="hljs-string">"http://github.com/mohuishou/hugo-action"</span> <span class="hljs-comment"># ä»“åº“åœ°å€</span></span><span class="hljs-keyword">LABEL</span><span class="bash"> <span class="hljs-string">"homepage"</span>=<span class="hljs-string">"http://github.com/mohuishou"</span> <span class="hljs-comment"># ä¸»é¡µ</span></span><span class="hljs-keyword">LABEL</span><span class="bash"> <span class="hljs-string">"maintainer"</span>=<span class="hljs-string">"mohuishou &lt;1@lailin.xyz&gt;"</span> <span class="hljs-comment"># ä½œè€…</span></span></code></pre><h4 id="2-Env"><a href="#2-Env" class="headerlink" title="2. Env"></a>2. Env</h4><p>é»˜è®¤çš„ç¯å¢ƒå˜é‡ï¼Œä»¥åŠå¦‚ä½•è¯»å–</p><h5 id="é»˜è®¤ç¯å¢ƒå˜é‡"><a href="#é»˜è®¤ç¯å¢ƒå˜é‡" class="headerlink" title="é»˜è®¤ç¯å¢ƒå˜é‡"></a>é»˜è®¤ç¯å¢ƒå˜é‡</h5><p>æ‰€æœ‰çš„é»˜è®¤å€¼å¯ä»¥å‚è€ƒè¿™é‡Œ <a href="https://developer.github.com/actions/creating-github-actions/accessing-the-runtime-environment/#environment-variables" target="_blank" rel="noopener">Environment variables</a></p><p>å¸¸ç”¨çš„ä¸»è¦æœ‰</p><table><thead><tr><th>Environment variable</th><th>Description</th></tr></thead><tbody><tr><td><code>GITHUB_ACTOR</code></td><td>ç”¨æˆ·çš„åå­—</td></tr><tr><td><code>GITHUB_REPOSITORY</code></td><td>ç”¨æˆ·å’Œä»“åº“çš„åœ°å€ ä¾‹å¦‚ <code>mohuishou/hugo-action</code></td></tr><tr><td><code>GITHUB_WORKSPACE</code></td><td>github çš„å·¥ä½œåŒºï¼Œ é»˜è®¤å€¼ä¸º <code>/github/workspace</code></td></tr><tr><td><code>GITHUB_TOKEN</code></td><td>workflow çš„ github token å¯ä»¥ç”¨æ¥ clone æ‹‰å–æ•°æ®ï¼Œä½†æ˜¯æ²¡æœ‰ push çš„æƒé™</td></tr></tbody></table><h5 id="è¯»å–ç¯å¢ƒå˜é‡"><a href="#è¯»å–ç¯å¢ƒå˜é‡" class="headerlink" title="è¯»å–ç¯å¢ƒå˜é‡"></a>è¯»å–ç¯å¢ƒå˜é‡</h5><p>è¯»å–ç¯å¢ƒå˜é‡æ—¶éœ€è¦æ³¨æ„ï¼Œç¯å¢ƒå˜é‡æ˜¯åœ¨å®¹å™¨è¿è¡Œæ—¶æ³¨å…¥çš„ï¼Œæ‰€ä»¥åœ¨ dockerfile é‡Œé¢æ²¡æœ‰åŠæ³•ç›´æ¥ä½¿ç”¨</p><h2 id="ä½¿ç”¨-hugo-action-è‡ªåŠ¨-build-amp-push-åšå®¢"><a href="#ä½¿ç”¨-hugo-action-è‡ªåŠ¨-build-amp-push-åšå®¢" class="headerlink" title="ä½¿ç”¨ hugo-action è‡ªåŠ¨ build&amp;push åšå®¢"></a>ä½¿ç”¨ hugo-action è‡ªåŠ¨ build&amp;push åšå®¢</h2><p><a href="https://github.com/mohuishou/hugo-action" target="_blank" rel="noopener">https://github.com/mohuishou/hugo-action</a></p><h3 id="éµå¾ªä»¥ä¸‹çº¦å®š"><a href="#éµå¾ªä»¥ä¸‹çº¦å®š" class="headerlink" title="éµå¾ªä»¥ä¸‹çº¦å®š"></a>éµå¾ªä»¥ä¸‹çº¦å®š</h3><ol><li>ä½ çš„åšå®¢æºä»£ç åœ°å€å’Œ github pages åœ°å€ä¸åŒ</li><li>github pages ä»“åº“åœ°å€ä¸º <code>youname.github.io</code></li></ol><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>åˆ›å»ºæ–‡ä»¶ <code>.github/main.workflow</code></p><pre><code class="hljs bash">workflow <span class="hljs-string">"blog ci/cd"</span> &#123;  on = <span class="hljs-string">"push"</span>  resolves = [<span class="hljs-string">"hugo"</span>]&#125;action <span class="hljs-string">"hugo"</span> &#123;  uses = <span class="hljs-string">"docker://mohuishou/hugo-action:0.53"</span>  secrets = [    <span class="hljs-string">"TOKEN"</span>,  ]  env = &#123;    EMAIL = <span class="hljs-string">"1@lailin.xyz"</span>  &#125;&#125;</code></pre><h3 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3><table><thead><tr><th>Key</th><th>Value</th><th>Must</th></tr></thead><tbody><tr><td>TOKEN</td><td>ä½ çš„ github tokenï¼Œéœ€è¦æœ‰ push æƒé™ï¼Œä¿å­˜åœ¨å¯†ç å˜é‡ä¸­</td><td>yes</td></tr><tr><td>EMAIL</td><td>ä½ çš„é‚®ç®±</td></tr></tbody></table><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol><li><a href="https://developer.github.com/actions/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://github.com/xitu/gold-miner/blob/master/TODO1/introducing-github-actions.md" target="_blank" rel="noopener">GitHub Actions ä»‹ç»ï¼Œäº†è§£ä¸€ä¸‹ï¼Ÿ</a></li><li><a href="https://github.com/actions" target="_blank" rel="noopener">Github Actions Repo</a></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/27142.html">hexo-next-algolia-searchå…¨æ–‡æœç´¢</a></li><li><a href="https://lailin.xyz/post/51252.html">dockeré•œåƒç˜¦èº«&ä¼˜åŒ–</a></li><li><a href="https://lailin.xyz/post/60163.html">GORMé¿å‘æŒ‡å—ä¹‹å«å…³è”å…³ç³»çš„æ›´æ–°</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>blog</tag>
      
      <tag>notes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨blogä¸­å†…åµŒåœ¨çº¿PPT</title>
    <link href="/post/7944.html"/>
    <url>/post/7944.html</url>
    
    <content type="html"><![CDATA[<p>æœ‰æ—¶æˆ‘ä»¬ä¼šåšä¸€äº›åˆ†äº«ï¼Œåˆ†äº«ä¹‹åå¯ä»¥æŠŠ PPT è„±æ•ä¹‹åæ”¾åœ¨åšå®¢ä¸Šé¢ï¼Œå¯ä»¥ä½¿ç”¨ office online ç›´æ¥å†…åµŒ PPT, å·¨ç¡¬å¤§æ³•å¥½</p><a id="more"></a><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><ol><li>åœ¨çº¿æ’­æ”¾</li><li>æ”¯æŒåŠ¨ç”»</li><li>æ”¯æŒæ’­æ”¾å†…åµŒè§†é¢‘</li><li>è‡ªé€‚åº”</li></ol><p>ä¸Šé¢çš„éœ€æ±‚, WPS äº‘æ–‡æ¡£æ”¯æŒ 1, ä»¥åŠä¸€äº›ç®€å•çš„åŠ¨ç”»ï¼ŒOffice online æ”¯æŒ 1,2,3 ç¬¬å››ç‚¹æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å• js è„šæœ¬è§£å†³</p><h2 id="è·å–åˆ†äº«é“¾æ¥"><a href="#è·å–åˆ†äº«é“¾æ¥" class="headerlink" title="è·å–åˆ†äº«é“¾æ¥"></a>è·å–åˆ†äº«é“¾æ¥</h2><p>1.ç™»å½• <a href="https://onedrive.live.com" target="_blank" rel="noopener">https://onedrive.live.com</a> ä¸Šä¼ éœ€è¦åˆ†äº«çš„ PPT 2.å¦‚ä¸‹å›¾æ‰€ç¤º æ‰“å¼€åˆšåˆšä¸Šä¼ çš„ PPT æ–‡ä»¶<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/assets/20181208165037.png?x-oss-process=image/resize,w_800" srcset="/img/loading.gif" alt></p><p>3.ç‚¹å‡»å³ä¸Šè§’çš„æ–‡ä»¶ -&gt; å…±äº« -&gt; åµŒå…¥<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/assets/20181208170149.png?x-oss-process=image/resize,w_800" srcset="/img/loading.gif" alt></p><p>4.è·å–åˆ†äº«é“¾æ¥ï¼Œå°†ä»£ç ä¸­çš„åˆ†äº«é“¾æ¥å¤åˆ¶<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/assets/20181208170334.png?x-oss-process=image/resize,w_800" srcset="/img/loading.gif" alt></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"è¿™é‡Œæ˜¯ä½ çš„åˆ†äº«é“¾æ¥"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"350px"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"221px"</span> <span class="hljs-attr">frameborder</span>=<span class="hljs-string">"0"</span>  &gt;</span>è¿™æ˜¯åµŒå…¥  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://office.com"</span>&gt;</span>Microsoft Office<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> æ¼”ç¤ºæ–‡ç¨¿ï¼Œç”±  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://office.com/webapps"</span>&gt;</span>Office Online<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  æ”¯æŒã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span></code></pre><p>5.ä¿®æ”¹ä»£ç è‡ªé€‚åº”ï¼Œå°†ä¸Šä¸€æ­¥è·å–åˆ°çš„é“¾æ¥æ›¿æ¢åˆ°ä¸‹æ–¹ä»£ç ä¸­ï¼Œå¤åˆ¶ç²˜è´´åˆ°åšå®¢ä¸­å³å¯</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span>  <span class="hljs-attr">id</span>=<span class="hljs-string">"ppt"</span>  <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span>  <span class="hljs-attr">onload</span>=<span class="hljs-string">"autoChange()"</span>  <span class="hljs-attr">src</span>=<span class="hljs-string">"åœ¨æ­¤å¤„æ›¿æ¢ä¸ºä½ çš„PPTé“¾æ¥"</span>  <span class="hljs-attr">frameborder</span>=<span class="hljs-string">"0"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autoChange</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">let</span> ifm = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"ppt"</span>);    ifm.height = (ifm.clientWidth / <span class="hljs-number">16</span>) * <span class="hljs-number">9</span> + <span class="hljs-number">24</span>;  &#125;  <span class="hljs-built_in">window</span>.onresize = autoChange;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p><a href="https://lailin.xyz/post/notes/pprof-go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/">https://lailin.xyz/post/notes/pprof-go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Office Online å¯¹äº PPT æ”¯æŒç›¸å½“çš„å¥½ï¼Œå”¯ä¸€çš„ç¼ºç‚¹å¯èƒ½å°±æ˜¯åœ¨å›½å†…æœ‰äº›çš„ç¡®è¢«å¢™ï¼Œå¯èƒ½éœ€è¦ FQ æ‰èƒ½è®¿é—®</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/27142.html">hexo-next-algolia-searchå…¨æ–‡æœç´¢</a></li><li><a href="https://lailin.xyz/post/51252.html">dockeré•œåƒç˜¦èº«&ä¼˜åŒ–</a></li><li><a href="https://lailin.xyz/post/60163.html">GORMé¿å‘æŒ‡å—ä¹‹å«å…³è”å…³ç³»çš„æ›´æ–°</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡net httpå†…å­˜æ³„æ¼</title>
    <link href="/post/44107.html"/>
    <url>/post/44107.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä½¿ç”¨ gin ä½œä¸ºæ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ï¼Œå†…å­˜å ç”¨çªç„¶ä»å‡ å M åˆ°äº† 10G ä»¥ä¸Šï¼Œå¯¼è‡´æœåŠ¡è¢« kill é‡å¯</p></blockquote><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><p><code>server.go</code></p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;r := gin.Default()r.GET(<span class="hljs-string">"/download"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(context *gin.Context)</span></span> &#123;f, err := os.Open(<span class="hljs-string">"./win7.iso"</span>)log.Println(err)<span class="hljs-keyword">defer</span> f.Close()info, _ := f.Stat()b := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, info.Size())f.Read(b)context.Data(<span class="hljs-number">200</span>, <span class="hljs-string">"application/octet-stream"</span>, b)&#125;)<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;log.Println(http.ListenAndServe(<span class="hljs-string">"localhost:6060"</span>, <span class="hljs-literal">nil</span>))&#125;()<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> &#123;time.Sleep(time.Second * <span class="hljs-number">30</span>)runtime.GC()log.Println(<span class="hljs-string">"gc"</span>)&#125;&#125;()runtime.MemProfileRate = <span class="hljs-number">16</span> * <span class="hljs-number">1024</span>r.Run(<span class="hljs-string">":8080"</span>)&#125;</code></pre><p><code>client.go</code></p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;resp, _ := http.Get(<span class="hljs-string">"http://localhost:8080/download"</span>)resp.Body.Close()log.Println(<span class="hljs-string">"ok"</span>)<span class="hljs-keyword">select</span> &#123;&#125;&#125;</code></pre><p>ä½¿ç”¨<code>pprof</code>æˆ‘ä»¬å¯ä»¥å‘ç°å†…å­˜å ç”¨é«˜è¾¾<code>3GB</code>, å³ä½¿æˆ‘ä¸»åŠ¨è°ƒç”¨äº† GC è¿™ä¸ªå†…å­˜ä»æœªé‡Šæ”¾</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/assets/profile001.gif" srcset="/img/loading.gif" alt></p><h2 id="è¿½æº¯"><a href="#è¿½æº¯" class="headerlink" title="è¿½æº¯"></a>è¿½æº¯</h2><p>é€šè¿‡æŸ¥çœ‹ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°è¯·æ±‚å·²ç»ç»“æŸï¼Œä»£ç å¹¶æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯¹<code>[]byte</code>å¼•ç”¨ï¼Œä¸€ç›´è¿½æº¯åˆ°æœ€ä½å±‚ä¹Ÿä¸è§å…¶ä»–å¼•ç”¨ã€‚</p><p>ä½†æ˜¯ç»“æŸ<code>client</code>è¿›ç¨‹ä¹‹åä¼šæœ‰ä¸€ä¸ªç¥å¥‡çš„å‘ç°ï¼Œç»“æŸ client ä¹‹åè¿™ä¸€å—å†…å­˜å°±å¯ä»¥è¢« GC æ‰</p><p>é€šè¿‡è¿™ä¸ªç°è±¡è‡ªç„¶è€Œç„¶çš„å°±æƒ³åˆ°å¯èƒ½æ˜¯ TCP é“¾æ¥æ²¡æœ‰æ–­å¼€ï¼Œå¯¼è‡´è¿™ä¸€å—å†…å­˜çš„å¼•ç”¨å¹¶æ²¡æœ‰è¢«é‡Šæ”¾æ‰</p><p>http æ˜¯ä¸€ä¸ªæœ¬èº«æ˜¯çŸ­è¿æ¥ï¼Œä½†æ˜¯ä¸ºäº†å¤ç”¨ TCP è¿æ¥æ‰€ä»¥æœ‰äº†<code>keep-alive</code>ï¼Œä½†æ˜¯å¯¹äºä¸‹è½½æœåŠ¡æ¥è¯´æˆ‘ä»¬å…¶å®ä¸ç”¨å¤ç”¨ TCP è¿æ¥ï¼Œåªéœ€è¦åœ¨æ–‡ä»¶ä¸‹è½½å®Œæ¯•ä¹‹åä¸»åŠ¨å…³é—­è¿™ä¸ªè¿æ¥å³å¯ï¼Œæ‰€ä»¥æˆ‘åˆ†åˆ«åœ¨ client åŠ ä¸Šäº†ä¸€ä¸ª header</p><pre><code class="hljs undefined">Connection: <span class="hljs-built_in">close</span></code></pre><p>å†æ¬¡é€šè¿‡<code>pprof</code>æŸ¥çœ‹å†…å­˜å ç”¨å‘ç°å†…å­˜ä»æœªå¾—åˆ°é‡Šæ”¾</p><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>é€šè¿‡ rfc æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è§„èŒƒå¹¶æ²¡æœ‰è§„å®šç”±è°æ¥å…³é—­é“¾æ¥ï¼ŒGo net/http å¸Œæœ›å®¢æˆ·ç«¯å…³é—­é“¾æ¥</p><p><a href="https://tools.ietf.org/html/rfc2616#page-117" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc2616#page-117</a></p><blockquote><p>HTTP/1.1 defines the â€œcloseâ€ connection option for the sender to signal that the connection will be closed after completion of the response.</p></blockquote><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><ol><li>ä½¿ç”¨æµè€Œä¸æ˜¯ç›´æ¥è¯»å†…å­˜ï¼Œåœ¨<code>gin</code>ä¸­ä¸è¦ç›´æ¥ä½¿ç”¨<code>c.Data</code>è€Œæ˜¯ä½¿ç”¨<code>c.DataFromReader</code></li><li>ä½¿ç”¨ AWS S3 ç­‰å­˜å‚¨æœåŠ¡ä¸‹å‘æ–‡ä»¶ï¼Œå‡è½»æœåŠ¡å‹åŠ›</li><li>å°½é‡ä¸ä½¿ç”¨å®˜æ–¹çš„<code>net/http</code>å¤„ç†æ–‡ä»¶</li><li><a href="https://jiajunhuang.com" target="_blank" rel="noopener">@jiajun è€å¸ˆ</a> å·²ç»ç»™ Go å®˜æ–¹æäº†ä¸€ä¸ª <a href="https://github.com/golang/go/pull/28936" target="_blank" rel="noopener">PR</a>ï¼Œç­‰å¾… PR Merge</li></ol><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://jiajunhuang.com/articles/2018_11_24-memory_leak_in_net_http.md.html" target="_blank" rel="noopener">https://jiajunhuang.com/articles/2018_11_24-memory_leak_in_net_http.md.html</a></li><li><a href="https://tools.ietf.org/html/rfc2616" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc2616</a></li><li><a href="https://lailin.xyz/post/notes/pprof-go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/">https://lailin.xyz/post/notes/pprof-go%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/</a></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>notes</tag>
      
      <tag>å†…å­˜æ³„æ¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pprof goæ€§èƒ½åˆ†æå·¥å…·</title>
    <link href="/post/40393.html"/>
    <url>/post/40393.html</url>
    
    <content type="html"><![CDATA[<p>PPT åˆ†äº«(å¯èƒ½éœ€è¦ FQ æ–¹èƒ½è®¿é—®ï¼Œéœ€è¦å¯ä»¥è®¿é—®, onedrive.live.com)</p><a id="more"></a><iframe id="ppt" width="100%" onload="changeFrameHeight()" src="https://onedrive.live.com/embed?cid=9B44A0E26836C4FF&amp;resid=9B44A0E26836C4FF%211837&amp;authkey=AAoxyFlzZ39JQvM&amp;em=2&amp;wdAr=1.7777777777777777" frameborder="0">è¿™æ˜¯åµŒå…¥ <a target="_blank" href="https://office.com">Microsoft Office</a> æ¼”ç¤ºæ–‡ç¨¿ï¼Œç”± <a target="_blank" href="https://office.com/webapps">Office Online</a> æ”¯æŒã€‚</iframe><script>function changeFrameHeight(){var e=document.getElementById("ppt");console.log(e.width),e.height=e.clientWidth/16*9+24}window.onresize=changeFrameHeight</script><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/27142.html">hexo-next-algolia-searchå…¨æ–‡æœç´¢</a></li><li><a href="https://lailin.xyz/post/51252.html">dockeré•œåƒç˜¦èº«&ä¼˜åŒ–</a></li><li><a href="https://lailin.xyz/post/60163.html">GORMé¿å‘æŒ‡å—ä¹‹å«å…³è”å…³ç³»çš„æ›´æ–°</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨TravisCIè‡ªåŠ¨éƒ¨ç½²Blog</title>
    <link href="/post/52061.html"/>
    <url>/post/52061.html</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åšå®¢çš„æ›´æ–°ä¸€ç›´éƒ½æ˜¯åœ¨æœ¬åœ°è¿è¡Œ<code>hugo</code>ç„¶åæ‰‹åŠ¨ push åˆ° github ä»“åº“ï¼Œè™½ç„¶å†™äº†ä¸€ä¸ªå°è„šæœ¬ï¼Œä½†æ˜¯æœ¬åœ°è¿˜æ˜¯å¤šäº†ä¸€ä¸ª public æ–‡ä»¶å¤¹ï¼Œæœ€è¿‘çœ‹äº† travis ci å¯ä»¥å’Œ github å®Œç¾çš„ç»“åˆã€‚å…³äº travis ci ä¸è¿‡å¤šä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå†™çš„éå¸¸è¯¦ç»†</p><pre><code class="hljs yaml"><span class="hljs-comment"># æŒ‡å®šè¿è¡Œè¯­è¨€ä¸ºgo</span><span class="hljs-attr">language:</span> <span class="hljs-string">go</span><span class="hljs-comment"># æŒ‡å®šgoè¯­è¨€ç‰ˆæœ¬</span><span class="hljs-attr">go:</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">"1.10.x"</span><span class="hljs-comment"># å®‰è£…ä¾èµ–ï¼Œå®‰è£…hugo</span><span class="hljs-attr">install:</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">wget</span> <span class="hljs-string">https://github.com/gohugoio/hugo/releases/download/v0.49/hugo_0.49_Linux-64bit.tar.gz</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">tar</span> <span class="hljs-string">-xzvf</span> <span class="hljs-string">hugo_0.49_Linux-64bit.tar.gz</span><span class="hljs-comment"># åœ¨scriptæ‰§è¡Œå‰æ‰§è¡Œï¼Œè®¾ç½®gitç”¨æˆ·åï¼Œé‚®ç®±ï¼Œä»githubæŠŠblogæ–‡ä»¶æ‹‰ä¸‹æ¥</span><span class="hljs-attr">before_script:</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">--global</span> <span class="hljs-string">user.email</span> <span class="hljs-string">"1@lailin.xyz"</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">--global</span> <span class="hljs-string">user.name</span> <span class="hljs-string">"mohuishou"</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">git</span> <span class="hljs-string">clone</span> <span class="hljs-string">https://$GITHUB_TOKEN@github.com/mohuishou/mohuishou.github.io.git</span> <span class="hljs-string">public</span>  <span class="hljs-comment"># clone ä¸»é¢˜</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">git</span> <span class="hljs-string">clone</span> <span class="hljs-string">https://github.com/laozhu/hugo-nuo</span> <span class="hljs-string">themes/hugo-nuo</span><span class="hljs-comment"># ç”Ÿæˆé™æ€ç½‘é¡µ</span><span class="hljs-attr">script:</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">./hugo</span><span class="hljs-comment"># è¿è¡ŒæˆåŠŸä¹‹åå°†é¡µé¢æ¨é€åˆ°githubä¸Š</span><span class="hljs-attr">after_success:</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">cd</span> <span class="hljs-string">public</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">git</span> <span class="hljs-string">add</span> <span class="hljs-string">.</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">git</span> <span class="hljs-string">commit</span> <span class="hljs-string">-m</span> <span class="hljs-string">'travis auto update'</span>  <span class="hljs-bullet">-</span> <span class="hljs-string">git</span> <span class="hljs-string">push</span> <span class="hljs-string">-u</span> <span class="hljs-string">origin</span> <span class="hljs-string">master</span></code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/28054.html">Github Actionsä»‹ç»&è‡ªåŠ¨æ„å»ºGithub Pagesåšå®¢</a></li><li><a href="https://lailin.xyz/post/44107.html">è®°ä¸€æ¬¡net httpå†…å­˜æ³„æ¼</a></li><li><a href="https://lailin.xyz/post/37449.html">ä¸€ä¸ªååˆ†è¾¹ç¼˜çš„gormçš„bug</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>notes</tag>
      
      <tag>ci</tag>
      
      <tag>hugo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨Golandè°ƒè¯•Goç¨‹åº</title>
    <link href="/post/37623.html"/>
    <url>/post/37623.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ä¸Šä¸€ç¯‡ Blog å½“ä¸­å‘ç°äº†ä¸€ä¸ªååˆ†è¾¹ç¼˜çš„ GORM çš„ bugï¼Œç”±äºä¸ç†Ÿæ‚‰å·¥å…·ï¼Œbug çš„è°ƒè¯•è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™ä¸€ç¯‡è®²ä¸€è®²å¦‚ä½•ä½¿ç”¨ Goland å¼ºå¤§çš„ debug åŠŸèƒ½è°ƒè¯• Go ç¨‹åº</p></blockquote><a id="more"></a><h2 id="Goland"><a href="#Goland" class="headerlink" title="Goland"></a>Goland</h2><p>Goland æ˜¯ jb å…¬å¸çš„ Go è¯­è¨€ IDEï¼Œå’Œ jb å®¶æ—çš„å…¶ä»– IDE ä¸€æ ·çš„å¼ºå¤§å¹¶ä¸”åƒå†…å­˜</p><p>ä¸‹è½½åœ°å€: <a href="https://www.jetbrains.com/go" target="_blank" rel="noopener">https://www.jetbrains.com/go</a></p><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨<code>main</code>å‡½æ•°æˆ–è€…æ˜¯å•å…ƒæµ‹è¯•å‡½æ•°çš„æ—è¾¹ä¼šå‡ºç°ä¸€ä¸ªæ‰§è¡Œçš„æŒ‰é’®<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141140.jpg" srcset="/img/loading.gif" alt><br>åœ¨å±å¹•çš„å³ä¸Šè§’ä¹Ÿå¯ä»¥çœ‹è§ä¸€ä¸ªå°è™«å­çš„æŒ‰é’®ï¼Œç‚¹å‡»å°±å¯ä»¥å¼€å§‹ debug<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141151.jpg" srcset="/img/loading.gif" alt></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç‚¹å‡» Edit æ‰“å¼€é…ç½®çª—å£<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141152.jpg" srcset="/img/loading.gif" alt><br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥å¯¹å½“å‰çš„è¿è¡Œå‘½ä»¤è¿›è¡Œé…ç½®ï¼Œæˆ–è€…ç‚¹å‡»ä¸‹æ–¹ templatesï¼Œå¯¹æ¨¡æ¿é…ç½®ï¼Œä¿®æ”¹æ¨¡æ¿é…ç½®ï¼Œåœ¨å½“å‰é¡¹ç›®ä¹‹åå†ç‚¹å‡» go run æ—¶ï¼Œä¼šè‡ªåŠ¨é‡‡ç”¨æ¨¡æ¿çš„é…ç½®<br>é…ç½®å¯ä»¥å¯¹æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡ï¼Œè¿è¡Œå‘½ä»¤ç­‰è¿›è¡Œé…ç½®ï¼Œä¸€èˆ¬ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯ç¯å¢ƒå˜é‡<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141153.jpg" srcset="/img/loading.gif" alt></p><h3 id="æ–­ç‚¹"><a href="#æ–­ç‚¹" class="headerlink" title="æ–­ç‚¹"></a>æ–­ç‚¹</h3><p>å¦‚å›¾æ‰€ç¤ºç‚¹å‡»è¡Œå·å’Œä»£ç ä¹‹é—´çš„ç©ºç™½å³å¯æ·»åŠ æ–­ç‚¹<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141154.jpg" srcset="/img/loading.gif" alt><br>å¦‚å›¾æ‰€ç¤ºï¼Œå³é”®ç‚¹å‡»çº¢ç‚¹ï¼Œå¯ä»¥å¯¹æ–­ç‚¹è¿›è¡Œä¸€äº›é«˜çº§çš„è®¾å®š<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141155.jpg" srcset="/img/loading.gif" alt><br>ç‚¹å‡» more ä¼šå‡ºç°å¦‚ä¸‹å¼¹çª—<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141156.jpg" srcset="/img/loading.gif" alt></p><h3 id="çª—å£"><a href="#çª—å£" class="headerlink" title="çª—å£"></a>çª—å£</h3><p>ç‚¹å‡» Debug å¼€å§‹è¿è¡Œä¹‹åï¼Œä¼šå‡ºç°ä¸€ä¸ª debug çª—å£ï¼Œå½“å‰çš„çª—å£æ˜¯ console çª—å£<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141157.jpg" srcset="/img/loading.gif" alt><br>ç‚¹å‡» debugger å¯ä»¥çœ‹åˆ°æ•´ä¸ªç¨‹åºçš„è°ƒç”¨æ ˆï¼Œç‚¹å‡»ç›¸åº”çš„è°ƒç”¨æ ˆå¯ä»¥è°ƒè½¬çš„ç›¸åº”çš„ä»£ç ï¼Œå¹¶ä¸”æ˜¾ç¤ºå½“å‰çš„å˜é‡ä¿¡æ¯<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141158.jpg" srcset="/img/loading.gif" alt><br>å¦‚å›¾æ‰€ç¤ºå¯ä»¥åœ¨å½“å‰æ ˆï¼Œæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ï¼Œä½†æ˜¯æš‚æ—¶è¿˜ä¸æ”¯æŒæ‰§è¡Œæ–¹æ³•ï¼Œåªèƒ½æŸ¥çœ‹å˜é‡æˆ–è€…æ˜¯è°ƒç”¨å˜é‡çš„å±æ€§<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141159.jpg" srcset="/img/loading.gif" alt></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>tool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ä¸ªååˆ†è¾¹ç¼˜çš„gormçš„bug</title>
    <link href="/post/37449.html"/>
    <url>/post/37449.html</url>
    
    <content type="html"><![CDATA[<p>[toc]</p><h2 id="å¤ç°ä»£ç "><a href="#å¤ç°ä»£ç " class="headerlink" title="å¤ç°ä»£ç "></a>å¤ç°ä»£ç </h2><p>è¿™ä¸ªä»£ç çš„è§¦å‘æ¡ä»¶æ¯”è¾ƒä¸¥è‹›ï¼Œé¦–å…ˆå¿…é¡»è¦ä¿è¯ gorm æ‰§è¡Œçš„ä¸€è¡Œå¿…é¡»ä¸º<code>updates</code>è¯­å¥ï¼Œå¹¶ä¸”åœ¨<code>updates(struct)</code>,å¹¶ä¸”ä¼ å…¥çš„è¿™ä¸ª<code>struct</code>å¿…é¡»è¦åŒ…å«ä¸€ä¸ªç›´æ¥æˆ–è€…é—´æ¥å…³è”çš„ä¸€ä¸ªå¤šæ€è¡¨ï¼Œè¿™äº›æ¡ä»¶ç¼ºä¸€ä¸å¯</p><a id="more"></a><pre><code class="hljs go"><span class="hljs-keyword">type</span> A <span class="hljs-keyword">struct</span> &#123;gorm.ModelName <span class="hljs-keyword">string</span>B    B <span class="hljs-string">`gorm:"polymorphic:Owner"`</span>&#125;<span class="hljs-keyword">type</span> B <span class="hljs-keyword">struct</span> &#123;gorm.ModelOwnerID   <span class="hljs-keyword">uint</span>OwnerType <span class="hljs-keyword">string</span>&#125;a := A&#123;Name: <span class="hljs-string">"test"</span>&#125;db = db.Model(&amp;a)db.Where(a)db.Updates(A&#123;Name: <span class="hljs-string">"test2"</span>&#125;) <span class="hljs-comment">// panic</span></code></pre><h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><p>å…ˆè¯´ç°è±¡ï¼Œåœ¨ä¸€æ¬¡ä»£ç è”è°ƒçš„è¿‡ç¨‹å½“ä¸­ï¼Œå‘ç°è°ƒç”¨ä¸€ä¸ªæ›´æ–°æ¥å£çš„æ—¶å€™ä¼šæŠ¥ 500 é”™è¯¯ï¼ˆpanicï¼‰ï¼Œä½†æ˜¯åœ¨ä»€ä¹ˆéƒ½ä¸ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡è°ƒç”¨æ¥å£ï¼Œæ›´æ–°æˆåŠŸ</p><p>é”™è¯¯æ—¥å¿—å¦‚ä¸‹ï¼Œæ˜¯ç”±äºä¸€ä¸ªç©ºæŒ‡é’ˆçš„è°ƒç”¨:</p><pre><code class="hljs go"><span class="hljs-built_in">panic</span>: runtime error: invalid memory address or <span class="hljs-literal">nil</span> pointer dereferencegithub.com/jinzhu/gorm.(*DB).clone(<span class="hljs-number">0x0</span>, <span class="hljs-number">0x0</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">715</span> +<span class="hljs-number">0x4e</span>github.com/jinzhu/gorm.(*DB).Model(<span class="hljs-number">0x0</span>, <span class="hljs-number">0x6cb460</span>, <span class="hljs-number">0xc00017c160</span>, <span class="hljs-number">0x0</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">445</span> +<span class="hljs-number">0x32</span>github.com/jinzhu/gorm.(*Scope).TableName(<span class="hljs-number">0xc000172100</span>, <span class="hljs-number">0xc00016c3c0</span>, <span class="hljs-number">0x6f894a</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/scope.<span class="hljs-keyword">go</span>:<span class="hljs-number">325</span> +<span class="hljs-number">0x133</span>github.com/jinzhu/gorm.(*Scope).GetModelStruct.func2(<span class="hljs-number">0xc000170010</span>, <span class="hljs-number">0xc000172100</span>, <span class="hljs-number">0xc00017a050</span>, <span class="hljs-number">0xc0001749c0</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/model_struct.<span class="hljs-keyword">go</span>:<span class="hljs-number">420</span> +<span class="hljs-number">0x24c7</span>github.com/jinzhu/gorm.(*Scope).GetModelStruct(<span class="hljs-number">0xc000172100</span>, <span class="hljs-number">0xc00017a050</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/model_struct.<span class="hljs-keyword">go</span>:<span class="hljs-number">574</span> +<span class="hljs-number">0x140c</span>github.com/jinzhu/gorm.(*Scope).Fields(<span class="hljs-number">0xc000172100</span>, <span class="hljs-number">0xc000172100</span>, <span class="hljs-number">0x2030000</span>, <span class="hljs-number">0x2030000</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/scope.<span class="hljs-keyword">go</span>:<span class="hljs-number">115</span> +<span class="hljs-number">0xaf</span>github.com/jinzhu/gorm.convertInterfaceToMap(<span class="hljs-number">0x6cb460</span>, <span class="hljs-number">0xc00017c160</span>, <span class="hljs-number">0xc00017c001</span>, <span class="hljs-number">0x199</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/scope.<span class="hljs-keyword">go</span>:<span class="hljs-number">860</span> +<span class="hljs-number">0x4f8</span>github.com/jinzhu/gorm.(*Scope).updatedAttrsWithValues(<span class="hljs-number">0xc000172080</span>, <span class="hljs-number">0x6cb460</span>, <span class="hljs-number">0xc00017c160</span>, <span class="hljs-number">0x6cb460</span>, <span class="hljs-number">0xc00017c160</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/scope.<span class="hljs-keyword">go</span>:<span class="hljs-number">877</span> +<span class="hljs-number">0x8b</span>github.com/jinzhu/gorm.assignUpdatingAttributesCallback(<span class="hljs-number">0xc000172080</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/callback_update.<span class="hljs-keyword">go</span>:<span class="hljs-number">25</span> +<span class="hljs-number">0x81</span>github.com/jinzhu/gorm.(*Scope).callCallbacks(<span class="hljs-number">0xc000172080</span>, <span class="hljs-number">0xc00012ff00</span>, <span class="hljs-number">0x9</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xc00017c160</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/scope.<span class="hljs-keyword">go</span>:<span class="hljs-number">831</span> +<span class="hljs-number">0x5c</span>github.com/jinzhu/gorm.(*DB).Updates(<span class="hljs-number">0xc00017e090</span>, <span class="hljs-number">0x6cb460</span>, <span class="hljs-number">0xc00017c160</span>, <span class="hljs-number">0x0</span>, <span class="hljs-number">0x0</span>, <span class="hljs-number">0x0</span>, <span class="hljs-number">0xc00017e090</span>)E:/SoftFile/GOPATH/src/github.com/jinzhu/gorm/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">383</span> +<span class="hljs-number">0x13b</span>main.main()E:/SoftFile/GOPATH/src/github.com/mohuishou/test/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">34</span> +<span class="hljs-number">0x269</span></code></pre><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>é¦–å…ˆä» panic çš„å †æ ˆé¡¶ç«¯å¾€ä¸‹çœ‹, æ˜¯è°ƒç”¨<code>s.db</code>çš„æ—¶å€™æŠ¥çš„é”™ï¼Œæ¨æ–­åº”è¯¥æ˜¯<code>s</code>çš„å€¼ä¸º<code>nil</code>å¯¼è‡´çš„é”™è¯¯</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *DB)</span> <span class="hljs-title">clone</span><span class="hljs-params">()</span> *<span class="hljs-title">DB</span></span> &#123;db := &amp;DB&#123;db:                s.db, <span class="hljs-comment">// ä»è¿™ä¸€è¡Œå¼€å§‹panic</span>    &#125;&#125;</code></pre><p>æ¥ç€å¾€ä¸‹çœ‹ï¼Œè¿™é‡Œçš„<code>s</code>åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ª<code>nil</code></p><pre><code class="hljs go"><span class="hljs-comment">// Model specify the model you would like to run db operations</span><span class="hljs-comment">//    // update all users's name to `hello`</span><span class="hljs-comment">//    db.Model(&amp;User&#123;&#125;).Update("name", "hello")</span><span class="hljs-comment">//    // if user's primary key is non-blank, will use it as condition, then will only update the user's name to `hello`</span><span class="hljs-comment">//    db.Model(&amp;user).Update("name", "hello")</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *DB)</span> <span class="hljs-title">Model</span><span class="hljs-params">(value <span class="hljs-keyword">interface</span>&#123;&#125;)</span> *<span class="hljs-title">DB</span></span> &#123;c := s.clone() <span class="hljs-comment">// ä»è¿™é‡Œè°ƒç”¨</span>c.Value = value<span class="hljs-keyword">return</span> c&#125;</code></pre><p>æ¥ç€èµ°, åœ¨è·å–è¡¨åçš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨<code>scope.db.Model</code>ï¼Œ è¿™é‡Œçš„ db åº”è¯¥æ˜¯ä¸€ä¸ª<code>nil</code>å¯¼è‡´è°ƒç”¨å¤±è´¥</p><pre><code class="hljs go"><span class="hljs-comment">// TableName return table name</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(scope *Scope)</span> <span class="hljs-title">TableName</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;    <span class="hljs-comment">// ...</span><span class="hljs-keyword">return</span> scope.GetModelStruct().TableName(scope.db.Model(scope.Value))&#125;</code></pre><p>ä»ä¸‹é¢çš„è°ƒç”¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå®åœ¨è·å–<code>Struct</code>çš„ç»“æ„çš„æ—¶å€™ï¼Œç”±äºæœ‰å¤šæ€å…³è”(<code>polymorphic</code>)çš„ tagï¼Œæ‰€ä»¥éœ€è¦è·å–å¤šæ€è¡¨çš„<code>TableName</code></p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(scope *Scope)</span> <span class="hljs-title">GetModelStruct</span><span class="hljs-params">()</span> *<span class="hljs-title">ModelStruct</span></span> &#123;    <span class="hljs-comment">// ...</span>    <span class="hljs-keyword">if</span> polymorphic := field.TagSettings[<span class="hljs-string">"POLYMORPHIC"</span>]; polymorphic != <span class="hljs-string">""</span> &#123;        <span class="hljs-keyword">if</span> value, ok := field.TagSettings[<span class="hljs-string">"POLYMORPHIC_VALUE"</span>]; ok &#123;            relationship.PolymorphicValue = value        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">// è¿™é‡Œè°ƒç”¨</span>            relationship.PolymorphicValue = scope.TableName()        &#125;    &#125;&#125;</code></pre><p>è°ƒç”¨<code>GetModelStruct</code>çš„åŸå› æ˜¯å› ä¸ºéœ€è¦è·å–<code>value</code>çš„æ‰€æœ‰å­—æ®µï¼Œå­—æ®µç­‰äº nil çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨<code>GetModelStruct</code>å»è·å–</p><pre><code class="hljs go"><span class="hljs-comment">// Fields get value's fields</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(scope *Scope)</span> <span class="hljs-title">Fields</span><span class="hljs-params">()</span> []*<span class="hljs-title">Field</span></span> &#123;<span class="hljs-keyword">if</span> scope.fields == <span class="hljs-literal">nil</span> &#123;<span class="hljs-comment">// ...</span><span class="hljs-keyword">for</span> _, structField := <span class="hljs-keyword">range</span> scope.GetModelStruct().StructFields &#123;            <span class="hljs-comment">// ...</span>        &#125;    &#125;&#125;</code></pre><p>çœ‹è¿™ä¸ªå‡½æ•°å¯ä»¥å‘ç°ï¼Œä¼šæŠŠ<code>interface</code>è½¬ä¸º<code>map</code>, ç”±äºæˆ‘ä»¬æœ€å¼€å§‹ä¼ å…¥çš„æ˜¯<code>db.Updates(A{Name: &quot;test2&quot;})</code>æ¡ä»¶æ˜¯ä¸€ä¸ª struct æ‰€ä»¥ä¼šæ‰§è¡Œä¸‹é¢<code>case interface{} -&gt; default</code>åˆ†æ”¯ã€‚æ­¤æ—¶ä¼šè°ƒç”¨<code>(&amp;Scope{Value: values}).Fields()</code>ï¼Œè¿™æ—¶å€™å¯ä»¥å‘ç°<code>Scope</code>è¿™ä¸ªå¯¹è±¡åœ¨åˆå§‹è¯çš„æ—¶å€™æ˜¯æ²¡æœ‰<code>db</code>è¿™ä¸ªå­—æ®µçš„ï¼Œæ‰€ä»¥åœ¨è·å– table name çš„æ—¶å€™éœ€è¦è°ƒç”¨åˆ°<code>scope.db</code>è¿™æ—¶å€™å°±ä¼š panic</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">convertInterfaceToMap</span><span class="hljs-params">(values <span class="hljs-keyword">interface</span>&#123;&#125;, withIgnoredField <span class="hljs-keyword">bool</span>)</span> <span class="hljs-title">map</span>[<span class="hljs-title">string</span>]<span class="hljs-title">interface</span></span>&#123;&#125; &#123;<span class="hljs-keyword">var</span> attrs = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;&#125;<span class="hljs-keyword">switch</span> value := values.(<span class="hljs-keyword">type</span>) &#123;<span class="hljs-keyword">case</span> <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;:<span class="hljs-keyword">return</span> value<span class="hljs-keyword">case</span> []<span class="hljs-keyword">interface</span>&#123;&#125;:<span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> value &#123;<span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> convertInterfaceToMap(v, withIgnoredField) &#123;attrs[key] = value&#125;&#125;<span class="hljs-keyword">case</span> <span class="hljs-keyword">interface</span>&#123;&#125;:reflectValue := reflect.ValueOf(values)<span class="hljs-keyword">switch</span> reflectValue.Kind() &#123;<span class="hljs-keyword">case</span> reflect.Map:<span class="hljs-keyword">for</span> _, key := <span class="hljs-keyword">range</span> reflectValue.MapKeys() &#123;attrs[ToDBName(key.Interface().(<span class="hljs-keyword">string</span>))] = reflectValue.MapIndex(key).Interface()&#125;<span class="hljs-keyword">default</span>:<span class="hljs-comment">// åœ¨è¿™é‡Œè°ƒç”¨</span><span class="hljs-keyword">for</span> _, field := <span class="hljs-keyword">range</span> (&amp;Scope&#123;Value: values&#125;).Fields() &#123;<span class="hljs-keyword">if</span> !field.IsBlank &amp;&amp; (withIgnoredField || !field.IsIgnored) &#123;attrs[field.DBName] = field.Field.Interface()&#125;&#125;&#125;&#125;<span class="hljs-keyword">return</span> attrs&#125;</code></pre><p>åˆ°è¿™é‡Œè¿™ä¸ª bug å°±ç®—ç»“æ¡ˆäº†ï¼Œä½†æ˜¯æ¥ç€çœ‹çœ‹ï¼Œä¸ºä»€ä¹ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°.</p><p>è¿™ä¸ªå‡½æ•°ä¼šè·å–éœ€è¦æ›´æ–°çš„å­—æ®µ<code>map</code>,å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ª<code>struct</code>ï¼Œä¼šè½¬æ¢ä¸º<code>map</code></p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(scope *Scope)</span> <span class="hljs-title">updatedAttrsWithValues</span><span class="hljs-params">(value <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-params">(results <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;, hasUpdate <span class="hljs-keyword">bool</span>)</span></span> &#123;<span class="hljs-keyword">if</span> scope.IndirectValue().Kind() != reflect.Struct &#123;<span class="hljs-keyword">return</span> convertInterfaceToMap(value, <span class="hljs-literal">false</span>), <span class="hljs-literal">true</span>&#125;results = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;&#125;<span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> convertInterfaceToMap(value, <span class="hljs-literal">true</span>) &#123;&#125;&#125;</code></pre><p>è¿™ä¸ªæ–¹æ³•ä¼šæŠŠè·å–åˆ°éœ€è¦æ›´æ–°çš„ map ä¿å­˜ä¸‹æ¥</p><pre><code class="hljs go"><span class="hljs-comment">// assignUpdatingAttributesCallback assign updating attributes to model</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">assignUpdatingAttributesCallback</span><span class="hljs-params">(scope *Scope)</span></span> &#123;<span class="hljs-keyword">if</span> attrs, ok := scope.InstanceGet(<span class="hljs-string">"gorm:update_interface"</span>); ok &#123;<span class="hljs-keyword">if</span> updateMaps, hasUpdate := scope.updatedAttrsWithValues(attrs); hasUpdate &#123;scope.InstanceSet(<span class="hljs-string">"gorm:update_attrs"</span>, updateMaps)&#125; <span class="hljs-keyword">else</span> &#123;scope.SkipLeft()&#125;&#125;&#125;</code></pre><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p><a href="https://github.com/jinzhu/gorm/pull/2105" target="_blank" rel="noopener">https://github.com/jinzhu/gorm/pull/2105</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="GORMï¼Œä½¿ç”¨-map-è€Œä¸æ˜¯-struct"><a href="#GORMï¼Œä½¿ç”¨-map-è€Œä¸æ˜¯-struct" class="headerlink" title="GORMï¼Œä½¿ç”¨ map è€Œä¸æ˜¯ struct"></a>GORMï¼Œä½¿ç”¨ map è€Œä¸æ˜¯ struct</h3><p>åœ¨ä½¿ç”¨çš„ GORM çš„æ—¶å€™ï¼Œéœ€è¦æ›´æ–°ä¸€äº›å­—æ®µçš„æ—¶å€™<strong>æœ€å¥½ä½¿ç”¨ map è€Œä¸æ˜¯ struct</strong>ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨ structï¼Œgorm æœ€ç»ˆä¼šæŠŠè¿™ä¸ª struct è½¬æ¢ä¸º mapï¼Œå¹¶ä¸”å¦‚æœè¿™ä¸ª struct åŒ…å«ä¸€äº›å…³è”å…³ç³»ï¼Œgorm ä¼šä¸€ç›´é€’å½’çš„æŸ¥æ‰¾è½¬æ¢ä¸‹å»ï¼Œå¦‚æœæ•´ä¸ªè¡¨çš„å…³è”å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œä¼šå¯¼è‡´æ•ˆç‡æ¯”è¾ƒä½ä¸‹</p><h3 id="ä¸ºä»€ä¹ˆä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œç¬¬äºŒæ¬¡è¿è¡Œå°±ä¸ä¼š-panic"><a href="#ä¸ºä»€ä¹ˆä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œç¬¬äºŒæ¬¡è¿è¡Œå°±ä¸ä¼š-panic" class="headerlink" title="ä¸ºä»€ä¹ˆä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œç¬¬äºŒæ¬¡è¿è¡Œå°±ä¸ä¼š panic"></a>ä¸ºä»€ä¹ˆä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œç¬¬äºŒæ¬¡è¿è¡Œå°±ä¸ä¼š panic</h3><p>è¿™æ˜¯ç”±äº GORM ä¼šå¯¹ struct çš„ç»“æ„æœ‰ä¸€ä¸ªå…¨å±€çš„ç¼“å­˜<code>modelStructsMap</code>ï¼Œç”±äºè¿™ä¸ªæ˜¯å› ä¸ºæŸ¥æ‰¾å…³è”å…³ç³»çš„æ—¶å€™æŠ¥é”™ï¼Œå…¶æœ¬èº«å·²ç»æ–°å»ºäº†ä¸€ä¸ª<code>modelstruct</code>å¹¶ä¸”ç¼“å­˜äº†ä¸‹æ¥ï¼Œæ‰€ä»¥å†æ¬¡è°ƒç”¨çš„æ—¶å€™å°±ä¸ä¼šæ‰§è¡Œåé¢çš„ä»£ç äº†</p><pre><code class="hljs go"><span class="hljs-comment">// GetModelStruct get value's model struct, relationships based on struct and tag definition</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(scope *Scope)</span> <span class="hljs-title">GetModelStruct</span><span class="hljs-params">()</span> *<span class="hljs-title">ModelStruct</span></span> &#123;<span class="hljs-comment">//...</span><span class="hljs-comment">// Get Cached model struct</span><span class="hljs-keyword">if</span> value := modelStructsMap.Get(reflectType); value != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> value&#125;<span class="hljs-comment">// ...</span>&#125;</code></pre><h3 id="è°ƒè¯•æ€»ç»“"><a href="#è°ƒè¯•æ€»ç»“" class="headerlink" title="è°ƒè¯•æ€»ç»“"></a>è°ƒè¯•æ€»ç»“</h3><p>è°ƒè¯•çš„è¿‡ç¨‹æ¯”å†™æ¥çš„è¦è‰°è¾›å¾ˆå¤šï¼Œç”±äºè°ƒè¯•çš„æ—¶å€™æ˜¯ä»è‡ªèº«çš„ä»£ç å¼€å§‹ï¼Œé€šè¿‡<code>Goland</code>çš„ debug ä¸æ–­çš„æ‰“æ–­ç‚¹ï¼Œä¸€éä¸€éçš„æ‰§è¡Œï¼ŒæŸ¥æ‰¾æ•´ä¸ªæ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå¯¼è‡´å¿½ç•¥äº†æœ€ç›´æ¥æ‰¾åˆ°é”™è¯¯ä»£ç çš„æ–¹å¼ã€‚</p><p>ä¸è¿‡è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå®è´µçš„ç»å†ï¼Œè¿™ä¸ª Bug è°ƒè¯•ç»“æŸä¹‹åï¼Œ<code>Goland</code>å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½å·²ç»å¯ä»¥ç©çš„æ¯”è¾ƒ 6 äº†</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>gorm</tag>
      
      <tag>notes</tag>
      
      <tag>bug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Httprouterä»‹ç»åŠæºç é˜…è¯»</title>
    <link href="/post/44029.html"/>
    <url>/post/44029.html</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å½“ä¸­é˜…è¯»äº† Go è¯­è¨€çš„ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æ¡†æ¶ Ginï¼ŒWeb æ¡†æ¶å½“ä¸­æœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯è·¯ç”±ï¼ŒGin çš„è·¯ç”±å°±æ˜¯ç”± httprouter è¿™ä¸ªåŒ…å®ç°çš„</p><h2 id="åœ°å€"><a href="#åœ°å€" class="headerlink" title="åœ°å€"></a>åœ°å€</h2><ul><li><a href="https://github.com/julienschmidt/httprouter" target="_blank" rel="noopener">https://github.com/julienschmidt/httprouter</a></li><li><a href="https://godoc.org/github.com/julienschmidt/httprouter" target="_blank" rel="noopener">https://godoc.org/github.com/julienschmidt/httprouter</a></li></ul><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>åŸºäºåŸºæ•°æ ‘å®ç°çš„é«˜æ€§èƒ½è·¯ç”±æ¡†æ¶</li><li>ä»…æ”¯æŒç²¾ç¡®åŒ¹é…</li><li>ä¸å¿…å…³å¿ƒ URL ç»“å°¾çš„æ–œçº¿</li><li>è·¯å¾„è‡ªåŠ¨æ ¡æ­£ï¼Œä¾‹å¦‚åœ¨ url è·¯å¾„å½“ä¸­æœ‰<code>../</code>,<code>//</code>çš„æ—¶å€™</li><li>å¯ä»¥åœ¨ URL å½“ä¸­è®¾ç½®å‚æ•°ï¼Œä¾‹å¦‚<code>/user/:id</code></li><li>é›¶å†…å­˜åˆ†é…</li><li>ä¸å­˜åœ¨æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥é€šè¿‡è®¾ç½®<code>panic handler</code>ä½¿æœåŠ¡å™¨ä» panic å½“ä¸­æ¢å¤</li><li>é€‚åˆ API æ„å»º</li></ul><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><h3 id="ä¸¤ä¸ªé—®é¢˜"><a href="#ä¸¤ä¸ªé—®é¢˜" class="headerlink" title="ä¸¤ä¸ªé—®é¢˜"></a>ä¸¤ä¸ªé—®é¢˜</h3><p>è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼Œå°±åŸºæœ¬æ˜ç™½äº†è¿™ä¸ªè·¯ç”±æ¡†æ¶</p><ul><li>è·¯ç”±æ˜¯æ˜¯å¦‚ä½•æ³¨å†Œï¼Ÿå¦‚ä½•ä¿å­˜çš„ï¼Ÿ</li><li>å½“è¯·æ±‚åˆ°æ¥ä¹‹åï¼Œè·¯ç”±æ˜¯å¦‚ä½•åŒ¹é…ï¼Œå¦‚ä½•æŸ¥æ‰¾çš„ï¼Ÿ</li></ul><h3 id="ä¸€ä¸ª-Demo"><a href="#ä¸€ä¸ª-Demo" class="headerlink" title="ä¸€ä¸ª Demo"></a>ä¸€ä¸ª Demo</h3><p>è¿˜æ˜¯ä»ä¸€ä¸ª<code>Hello World</code>è®²èµ·</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;r := httprouter.New()r.GET(<span class="hljs-string">"/:name"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(writer http.ResponseWriter, request *http.Request, params httprouter.Params)</span></span> &#123;        fmt.Fprintf(writer, <span class="hljs-string">"hello, %s!\n"</span>, params.ByName(<span class="hljs-string">"name"</span>))&#125;)http.ListenAndServe(<span class="hljs-string">":8080"</span>,r)&#125;</code></pre><p><code>httprouter.New()</code>åˆå§‹åŒ–äº†ä¸€ä¸ª Routerï¼Œä¸‹é¢ç›´æ¥çœ‹ä¸€ä¸‹ Router çš„ç»“æ„</p><h3 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h3><p>åœ¨ Router çš„æºç å½“ä¸­æœ‰ååˆ†è¯¦å°½çš„æ³¨é‡Šï¼Œè¿™é‡ŒæŒ‰ç…§æˆ‘ä¸ªäººçš„ç†è§£æ³¨é‡Šä¸€ä¸‹</p><pre><code class="hljs go"><span class="hljs-comment">// Routerå®ç°äº†Http.Handleræ¥å£ï¼Œç”¨äºæ³¨å†Œåˆ†å‘è·¯ç”±</span><span class="hljs-keyword">type</span> Router <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// trees æ˜¯ä¸€ä¸ªåŸºæ•°æ ‘é›†åˆï¼Œæ¯ä¸€ä¸ªHTTPæ–¹æ³•å¯¹åº”ä¸€æ£µå•ç‹¬çš„è·¯ç”±æ ‘</span>    <span class="hljs-comment">// nodeæ˜¯åŸºæ•°æ ‘çš„æ ¹èŠ‚ç‚¹</span>trees <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*node    <span class="hljs-comment">// ç”¨äºå¼€å¯ä¸Šæ–‡æåˆ°çš„è‡ªåŠ¨å¤„ç†URLå°¾éƒ¨æ–œæ†çš„ç‰¹æ€§</span>    <span class="hljs-comment">// è¿™ä¸ªå€¼ä¸ºtrueæ—¶ï¼Œå¦‚æœ/foo/æ²¡æœ‰è¢«åŒ¹é…åˆ°ï¼Œä¼šå°è¯•åŒ¹é…/foo</span>RedirectTrailingSlash <span class="hljs-keyword">bool</span><span class="hljs-comment">// ç”¨äºå¼€å¯ä¸Šæ–‡æåˆ°çš„è·¯ç”±æ ¡æ­£çš„ç‰¹æ€§</span>    <span class="hljs-comment">// è¿™ä¸ªå€¼ä¸ºtrueæ—¶ï¼Œä¼šå¯¹../å’Œ//è¿™ç§è·¯å¾„è¿›è¡Œæ ¡æ­£</span>RedirectFixedPath <span class="hljs-keyword">bool</span>    <span class="hljs-comment">// è¿™ä¸ªå€¼ä¸ºtrueæ—¶ï¼Œå¦‚æœå½“å‰æ–¹æ³•çš„è·¯ç”±æ²¡æœ‰è¢«åŒ¹é…åˆ°ï¼Œä¼šå°è¯•åŒ¹é…å…¶ä»–æ–¹æ³•çš„è·¯ç”±ï¼Œ</span>    <span class="hljs-comment">// å¦‚æœåŒ¹é…åˆ°äº†åˆ™è¿”å›405ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±äº¤ç»™NotFound Handlerå¤„ç†</span>HandleMethodNotAllowed <span class="hljs-keyword">bool</span><span class="hljs-comment">// è¿™ä¸ªå€¼ä¸ºtrueæ—¶ï¼Œå°†å¼€å¯OPTIONSè‡ªåŠ¨åŒ¹é…ï¼Œæ³¨æ„: æ‰‹åŠ¨åŒ¹é…ä¼˜å…ˆçº§æ›´é«˜</span>HandleOPTIONS <span class="hljs-keyword">bool</span>    <span class="hljs-comment">// æ²¡æœ‰åŒ¹é…åˆ°ç›¸åº”è·¯ç”±çš„æ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span>    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ³¨å†Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å› NotFound</span>NotFound http.Handler<span class="hljs-comment">// æ²¡æœ‰åŒ¹é…åˆ°ç›¸åº”è·¯ç”±å¹¶ä¸”HandleMethodNotAllowedä¸ºtrueæ—¶ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span>MethodNotAllowed http.Handler    <span class="hljs-comment">// ç”¨äºä»panicå½“ä¸­æ¢å¤</span>    <span class="hljs-comment">// éœ€è¦è¿”å›500é”™è¯¯ï¼Œå¹¶ä¸”æ¸²æŸ“ç›¸åº”çš„é”™è¯¯é¡µé¢</span>PanicHandler <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(http.ResponseWriter, *http.Request, <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span>&#125;</code></pre><p>åˆå§‹åŒ– Router ä¹‹åçœ‹çœ‹è·¯ç”±æ˜¯å¦‚ä½•ä¿å­˜å¹¶ä¸”æ³¨å†Œçš„</p><h3 id="è·¯ç”±æ˜¯å¦‚ä½•ä¿å­˜çš„"><a href="#è·¯ç”±æ˜¯å¦‚ä½•ä¿å­˜çš„" class="headerlink" title="è·¯ç”±æ˜¯å¦‚ä½•ä¿å­˜çš„?"></a>è·¯ç”±æ˜¯å¦‚ä½•ä¿å­˜çš„?</h3><p>è¿™é‡Œä»¥å®˜æ–¹ Readme å½“ä¸­çš„ä¾‹å­è¯´æ˜ï¼š<br>å¦‚æœæ³¨å†Œäº†ä»¥ä¸‹è·¯ç”±</p><pre><code class="hljs go">r.GET(<span class="hljs-string">"/"</span>, f1)r.GET(<span class="hljs-string">"/search/"</span>, f2)r.GET(<span class="hljs-string">"/support/"</span>, f3)r.GET(<span class="hljs-string">"/blog/"</span>, f4)r.GET(<span class="hljs-string">"/blog/:post/"</span>, f5)r.GET(<span class="hljs-string">"/about_us/"</span>, f6)r.GET(<span class="hljs-string">"/about_us/team/"</span>, f7)r.GET(<span class="hljs-string">"/contact/"</span>, f8)</code></pre><p>é‚£ä¹ˆè¿™äº›è·¯ç”±ä¼šå¦‚ä¸‹æ–¹æ‰€ç¤ºï¼Œä»¥ä¸€é¢—æ ‘çš„å½¢å¼ä¿å­˜ï¼Œå¹¶ä¸”è¿™äº›è·¯ç”±çš„å…¬å…±å‰ç¼€ä¼šè¢«æŠ½ç¦»å¹¶ä¸”å˜ä¸ºä¸Šä¸€å±‚èŠ‚ç‚¹<br>Priority è¡¨ç¤ºåŠ ä¸Šè‡ªèº«ä¸€å…±æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹<br>Path è¡¨ç¤ºè·¯å¾„<br>Handle è¡¨ç¤ºè·¯ç”±æ³¨å†Œçš„æ–¹æ³•</p><pre><code class="hljs undefined"><span class="hljs-string">Priority</span>   <span class="hljs-string">Path</span>             <span class="hljs-string">Handle</span><span class="hljs-number">9</span>          <span class="hljs-string">\</span>                <span class="hljs-string">*&lt;1&gt;</span><span class="hljs-number">3</span>          <span class="hljs-string">â”œs</span>               <span class="hljs-string">nil</span><span class="hljs-number">2</span>          <span class="hljs-string">|â”œearch\</span>         <span class="hljs-string">*&lt;2&gt;</span><span class="hljs-number">1</span>          <span class="hljs-string">|â””upport\</span>        <span class="hljs-string">*&lt;3&gt;</span><span class="hljs-number">2</span>          <span class="hljs-string">â”œblog\</span>           <span class="hljs-string">*&lt;4&gt;</span><span class="hljs-number">1</span>          <span class="hljs-string">|</span>    <span class="hljs-string">â””:post</span>      <span class="hljs-string">nil</span><span class="hljs-number">1</span>          <span class="hljs-string">|</span>         <span class="hljs-string">â””\</span>     <span class="hljs-string">*&lt;5&gt;</span><span class="hljs-number">2</span>          <span class="hljs-string">â”œabout-us\</span>       <span class="hljs-string">*&lt;6&gt;</span><span class="hljs-number">1</span>          <span class="hljs-string">|</span>        <span class="hljs-string">â””team\</span>  <span class="hljs-string">*&lt;7&gt;</span><span class="hljs-number">1</span>          <span class="hljs-string">â””contact\</span>        <span class="hljs-string">*&lt;8&gt;</span></code></pre><h3 id="r-Handle"><a href="#r-Handle" class="headerlink" title="r.Handle"></a>r.Handle</h3><p><code>r.Get</code>, <code>r.Post</code>ç­‰æ–¹æ³•å®è´¨éƒ½æ˜¯é€šè¿‡è°ƒç”¨ r.Handle å®ç°çš„</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Router)</span> <span class="hljs-title">Handle</span><span class="hljs-params">(method, path <span class="hljs-keyword">string</span>, handle Handle)</span></span> &#123;    <span class="hljs-comment">// è·¯å¾„æ³¨å†Œå¿…é¡»ä»/å¼€å§‹ï¼Œå¦åˆ™ç›´æ¥æŠ¥é”™</span><span class="hljs-keyword">if</span> path[<span class="hljs-number">0</span>] != <span class="hljs-string">'/'</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"path must begin with '/' in path '"</span> + path + <span class="hljs-string">"'"</span>)&#125;    <span class="hljs-comment">// è·¯ç”±æ ‘mapä¸å­˜åœ¨éœ€è¦æ–°å»º</span><span class="hljs-keyword">if</span> r.trees == <span class="hljs-literal">nil</span> &#123;r.trees = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*node)&#125;    <span class="hljs-comment">// è·å–å½“å‰æ–¹æ³•æ‰€å¯¹åº”æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºä¸€ä¸ª</span>root := r.trees[method]<span class="hljs-keyword">if</span> root == <span class="hljs-literal">nil</span> &#123;root = <span class="hljs-built_in">new</span>(node)r.trees[method] = root&#125;    <span class="hljs-comment">// å‘è·¯ç”±æ ‘å½“ä¸­æ·»åŠ ä¸€æ¡ä¸€æ¡è·¯ç”±</span>root.addRoute(path, handle)&#125;</code></pre><h3 id="node"><a href="#node" class="headerlink" title="node"></a>node</h3><p>è·¯ç”±æ˜¯æ³¨å†Œåˆ°ä¸€é¢—è·¯ç”±æ ‘å½“ä¸­çš„ï¼Œå…ˆçœ‹çœ‹èŠ‚ç‚¹çš„æºç ï¼Œå†æ¥åˆ†æï¼Œæ˜¯å¦‚ä½•æ·»åŠ è·¯ç”±çš„</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> node <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹çš„è·¯å¾„</span>    path      <span class="hljs-keyword">string</span>    <span class="hljs-comment">// æ˜¯å¦ä¸ºå‚æ•°èŠ‚ç‚¹ï¼Œå‚æ•°èŠ‚ç‚¹ç”¨:nameè¡¨ç¤º</span>    wildChild <span class="hljs-keyword">bool</span>    <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹ç±»å‹ï¼Œ ä¸€å…±æœ‰4ç§</span>    <span class="hljs-comment">// static: é™æ€èŠ‚ç‚¹ï¼Œé»˜è®¤ç±»å‹</span><span class="hljs-comment">// root: æ ¹èŠ‚ç‚¹</span><span class="hljs-comment">// param: å…¶ä»–èŠ‚ç‚¹</span><span class="hljs-comment">// catchAll: å¸¦æœ‰*çš„èŠ‚ç‚¹ï¼Œè¿™é‡Œ*çš„ä½œç”¨å’Œæ­£åˆ™å½“ä¸­çš„*ä¸€æ ·</span>    nType     nodeType    <span class="hljs-comment">// å½“å‰è·¯å¾„ä¸Šæœ€å¤§å‚æ•°çš„ä¸ªæ•°ï¼Œä¸èƒ½è¶…è¿‡255</span>    maxParams <span class="hljs-keyword">uint8</span>    <span class="hljs-comment">// ä»£è¡¨åˆ†æ”¯çš„é¦–å­—æ¯</span>    <span class="hljs-comment">// ä¸Šé¢çš„ä¾‹å­ï¼Œå½“å‰èŠ‚ç‚¹ä¸ºs</span>    <span class="hljs-comment">// é‚£ä¹ˆindices = eu</span>    <span class="hljs-comment">// â”œs               nil</span>    <span class="hljs-comment">// |â”œearch\         *&lt;2&gt;</span>    <span class="hljs-comment">// |â””upport\        *&lt;3&gt;</span>    indices   <span class="hljs-keyword">string</span>    <span class="hljs-comment">// å­©å­èŠ‚ç‚¹</span>    children  []*node    <span class="hljs-comment">// æ³¨å†Œçš„è·¯ç”±</span>    handle    Handle    <span class="hljs-comment">// æƒé‡ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹åŠ ä¸Šæ‰€æœ‰å­èŠ‚ç‚¹çš„æ•°ç›®</span>priority  <span class="hljs-keyword">uint32</span>&#125;</code></pre><h3 id="è·¯ç”±æ ‘æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ"><a href="#è·¯ç”±æ ‘æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ" class="headerlink" title="è·¯ç”±æ ‘æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ"></a>è·¯ç”±æ ‘æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ</h3><p>æœªå®Œå¾…ç»­</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>è·¯ç”±</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ginæºç é˜…è¯» ä»0.1å¼€å§‹</title>
    <link href="/post/12338.html"/>
    <url>/post/12338.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘æ‰“ç®—å¼€å§‹å­¦ä¹ ä¸€ä¸‹ Gin çš„æºä»£ç ï¼Œç°åœ¨ Gin å·²ç»æ˜¯ä¸€ä¸ªååˆ†æˆç†Ÿçš„æ¡†æ¶äº†ï¼Œä»£ç é‡ä¹Ÿä¸å°‘ï¼Œé˜…è¯»èµ·æ¥è¿˜æ˜¯æœ‰ä¸€å®šçš„éš¾åº¦ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—ä» 0.1 ç‰ˆæœ¬å¼€å§‹é˜…è¯»å­¦ä¹ ï¼Œä¸€ç›´åˆ°æœ€æ–°çš„ä¸€ä¸ªç‰ˆæœ¬ã€‚è·Ÿéšç€ Gin çš„æºç ä¸€æ­¥ä¸€æ­¥çš„å­¦ä¹ æˆé•¿ã€‚</p></blockquote><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>Gin 0.1 çš„ä»£ç é‡ååˆ†çš„å°‘, ä¸»è¦ä»£ç ä¸€å…±ä¹Ÿåªæœ‰äº”ä¸ªæ–‡ä»¶ï¼Œä»£ç ä¸­çš„æ³¨é‡Šä¹Ÿæ¯”è¾ƒè¯¦ç»†</p><pre><code class="hljs undefined">â”‚  <span class="hljs-selector-tag">auth</span><span class="hljs-selector-class">.go</span>â”‚  <span class="hljs-selector-tag">gin</span><span class="hljs-selector-class">.go</span>â”‚  <span class="hljs-selector-tag">logger</span><span class="hljs-selector-class">.go</span>â”‚  <span class="hljs-selector-tag">README</span><span class="hljs-selector-class">.md</span>â”‚  <span class="hljs-selector-tag">recovery</span><span class="hljs-selector-class">.go</span>â”‚  <span class="hljs-selector-tag">validation</span><span class="hljs-selector-class">.go</span></code></pre><h2 id="è·‘èµ·æ¥"><a href="#è·‘èµ·æ¥" class="headerlink" title="è·‘èµ·æ¥"></a>è·‘èµ·æ¥</h2><p>Gin 0.1 çš„ä»£ç é‡ååˆ†çš„å°‘ï¼Œä½†æ˜¯è¿˜æ˜¯å…ˆä»<code>readme</code>çš„ç¤ºä¾‹å¼€å§‹è¯´èµ·</p><p>é¦–å…ˆä¸‹é¢è¿™ä¸€æ®µä»£ç æ˜¯ç›´æ¥è·‘ä¸èµ·æ¥çš„ï¼Œä¸çŸ¥é“æ˜¯ä»£ç æœ¬èº«çš„ bug è¿˜æ˜¯å› ä¸º Go è¯­è¨€çš„ç‰ˆæœ¬å˜åŒ–å¯¼è‡´çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹å‡ ä¸ªåœ°æ–¹</p><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/gin-gonic/gin"</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    r := gin.Default()    r.GET(<span class="hljs-string">"ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span>&#123;        c.String(<span class="hljs-string">"pong"</span>)    &#125;)    <span class="hljs-comment">// Listen and server on 0.0.0.0:8080</span>    r.Run(<span class="hljs-string">":80"</span>)&#125;</code></pre><h3 id="ç¬¬ä¸€æ¬¡ä¿®æ”¹"><a href="#ç¬¬ä¸€æ¬¡ä¿®æ”¹" class="headerlink" title="ç¬¬ä¸€æ¬¡ä¿®æ”¹"></a>ç¬¬ä¸€æ¬¡ä¿®æ”¹</h3><p><code>main.go</code></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"github.com/gin-gonic/gin"</span><span class="hljs-string">"net/http"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;    r := gin.Default()    <span class="hljs-comment">// åœ¨è¿™å„¿å¿…é¡»åœ¨pingï¼Œå‰åŠ ä¸Š/ï¼Œä¸ç„¶ä¼šå¯¼è‡´panic</span>r.GET(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span>&#123;        <span class="hljs-comment">// String æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä½†æ˜¯å®ä¾‹åªå†™äº†ä¸€ä¸ª</span>c.String(http.StatusOK,<span class="hljs-string">"pong"</span>)&#125;)<span class="hljs-comment">// Listen and server on 0.0.0.0:8080</span>r.Run(<span class="hljs-string">":80"</span>)&#125;</code></pre><p><code>gin.go</code></p><pre><code class="hljs go"><span class="hljs-comment">// Returns a new blank Engine instance without any middleware attached.</span><span class="hljs-comment">// The most basic configuration</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span> *<span class="hljs-title">Engine</span></span> &#123;engine := &amp;Engine&#123;&#125;engine.RouterGroup = &amp;RouterGroup&#123;<span class="hljs-literal">nil</span>, <span class="hljs-string">""</span>, <span class="hljs-literal">nil</span>, engine&#125;    engine.router = httprouter.New()    <span class="hljs-comment">// NotFound æ˜¯ä¸€ä¸ªhttp.Handlerçš„æ¥å£ï¼Œä½†æ˜¯æºç å½“ä¸­èµ‹å€¼äº†ä¸€ä¸ªæ–¹æ³•ç»™ä»–</span>    engine.router.NotFound = engine    <span class="hljs-comment">// engine.router.NotFound = engine.handle404</span><span class="hljs-keyword">return</span> engine&#125;</code></pre><p>å¥½äº†ä¿®æ”¹å®Œæˆä¹‹åå°±å¯ä»¥è¿è¡Œ, <code>go run main.go</code>æˆåŠŸè¿è¡Œäº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ª bugï¼Œåªèƒ½è®¿é—®ä¸€æ¬¡ï¼Œå°±ä¼šå› ä¸º<code>stack overflow</code>é€€å‡º</p><p>æŸ¥çœ‹ä¸€ä¸‹<code>gin.go</code>, <code>ServeHTTP</code>å¯ä»¥å‘ç°ï¼Œgin æ˜¯ç›´æ¥è°ƒç”¨äº†<code>httprouter</code>çš„<code>ServeHTTP</code>æ–¹æ³•</p><pre><code class="hljs go"><span class="hljs-comment">// ServeHTTP makes the router implement the http.Handler interface.</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span> <span class="hljs-title">ServeHTTP</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;engine.router.ServeHTTP(w, req)&#125;</code></pre><p>ç»§ç»­è¿½è¸ªï¼Œå¯ä»¥å‘ç°åœ¨<code>httprouter</code>çš„<code>ServeHTTP</code>æ–¹æ³•æœ€åæœ‰ä¸€æ®µåˆ¤å®š 404 çš„ä»£ç ï¼Œè¿™æ—¶å€™å°±å¯ä»¥å‘ç°è¿™æ˜¯ä¹‹å‰ä¿®æ”¹<code>gin.go`</code> engine.router.NotFound = engine <code>è¿™æ®µä»£ç é€ æˆçš„ï¼Œç”±äº Chrome æµè§ˆå™¨è®¿é—®çš„æ—¶å€™ä¼šå°è¯•è®¿é—®</code>/favicon.ico<code>è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶è€Œæˆ‘ä»¬åœ¨è·¯ç”±å½“ä¸­å¹¶æ²¡æœ‰å®šä¹‰ï¼Œæ­¤æ—¶å°±æ˜¯ 404ï¼Œè¿™æ—¶å€™ç”±äºä¹‹å‰æˆ‘ä»¬åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç»™</code>router<code>ä¼ é€’çš„</code>NotFound<code>ä¸º</code>engine<code>ï¼Œè€Œ</code>engine.ServeHTTP<code>è°ƒç”¨äº†</code>router.ServeHTTP`è¿™æ—¶å€™å°±é€ æˆäº†æ— é™é€’å½’ï¼Œå¯¼è‡´æœ€åé€€å‡º</p><pre><code class="hljs go"><span class="hljs-comment">// Handle 404</span><span class="hljs-keyword">if</span> r.NotFound != <span class="hljs-literal">nil</span> &#123;r.NotFound.ServeHTTP(w, req)&#125; <span class="hljs-keyword">else</span> &#123;http.NotFound(w, req)&#125;</code></pre><h3 id="ç¬¬äºŒæ¬¡ä¿®æ”¹"><a href="#ç¬¬äºŒæ¬¡ä¿®æ”¹" class="headerlink" title="ç¬¬äºŒæ¬¡ä¿®æ”¹"></a>ç¬¬äºŒæ¬¡ä¿®æ”¹</h3><p><code>gin.go</code></p><pre><code class="hljs go"><span class="hljs-comment">// Returns a new blank Engine instance without any middleware attached.</span><span class="hljs-comment">// The most basic configuration</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span> *<span class="hljs-title">Engine</span></span> &#123;engine := &amp;Engine&#123;&#125;engine.RouterGroup = &amp;RouterGroup&#123;<span class="hljs-literal">nil</span>, <span class="hljs-string">""</span>, <span class="hljs-literal">nil</span>, engine&#125;    engine.router = httprouter.New()    <span class="hljs-comment">// NotFound æ˜¯ä¸€ä¸ªhttp.Handlerçš„æ¥å£ï¼Œä½†æ˜¯æºç å½“ä¸­èµ‹å€¼äº†ä¸€ä¸ªæ–¹æ³•ç»™ä»–</span>    <span class="hljs-comment">// æ³¨é‡Šæ‰å³å¯</span>    <span class="hljs-comment">// engine.router.NotFound = engine.handle404</span><span class="hljs-keyword">return</span> engine&#125;</code></pre><p><code>go run main.go</code>æˆåŠŸè¿è¡Œï¼Œå°±æ²¡æœ‰é—®é¢˜äº†</p><h2 id="Gin-æºç åˆ†æ"><a href="#Gin-æºç åˆ†æ" class="headerlink" title="Gin æºç åˆ†æ"></a>Gin æºç åˆ†æ</h2><p>è·‘èµ·æ¥ä¹‹åå°±å…·ä½“çœ‹çœ‹æºç ,åˆå§‹ç‰ˆæœ¬çš„ Gin å½“ä¸­æ‹¥æœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„<code>struct</code>ï¼Œä¹Ÿæ˜¯æ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†</p><p><code>Context</code></p><pre><code class="hljs go"><span class="hljs-comment">// Contextæ˜¯ginå½“ä¸­æœ€ä¸ºé‡è¦çš„ä¸€éƒ¨åˆ†</span><span class="hljs-comment">// å®ƒç”¨äºåœ¨ä¸­é—´ä»¶å½“ä¸­ä¼ é€’å˜é‡ï¼Œç®¡ç†æµç¨‹ã€‚ä¾‹å¦‚æ¥å—jsonè¯·æ±‚ï¼Œå¹¶è¿”å›json</span><span class="hljs-comment">// Context is the most important part of gin. It allows us to pass variables between middleware,</span><span class="hljs-comment">// manage the flow, validate the JSON of a request and render a JSON response for example.</span>Context <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// ServeHTTP ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯·æ±‚ä½“</span>    Req      *http.Request    <span class="hljs-comment">// ServeHTTP ç¬¬ä¸€æ¬¡å‚æ•°ï¼Œå“åº”</span>    Writer   http.ResponseWriter    <span class="hljs-comment">// å¯ä»¥è®¾ç½®çš„å€¼</span>    Keys     <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;    <span class="hljs-comment">// é”™è¯¯ä¿¡æ¯</span>    Errors   []ErrorMsg    <span class="hljs-comment">// è¯·æ±‚å‚æ•°</span>    Params   httprouter.Params    <span class="hljs-comment">// = ä¸­é—´ä»¶ + è¯·æ±‚å¤„ç†å‡½æ•°(æœ€åä¸€ä¸ª)</span>    handlers []HandlerFunc    <span class="hljs-comment">// Engine å®ä¾‹</span>    engine   *Engine    <span class="hljs-comment">// å½“å‰å¤„ç†åˆ°çš„Handlerä¸‹æ ‡</span>    index    <span class="hljs-keyword">int8</span>&#125;<span class="hljs-comment">// ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>Next()<span class="hljs-comment">// ç»ˆæ­¢å¤„ç†ï¼Œç›´æ¥è¿”å›</span>Abort(code <span class="hljs-keyword">int</span>)<span class="hljs-comment">// æ·»åŠ é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”ç»ˆæ­¢å¤„ç†</span>Fail(code <span class="hljs-keyword">int</span>, err error)<span class="hljs-comment">// æ·»åŠ é”™è¯¯ä¿¡æ¯</span>Error(err error, meta <span class="hljs-keyword">interface</span>&#123;&#125;)<span class="hljs-comment">// ç»™Context.Keysæ·»åŠ å€¼</span>Set(key <span class="hljs-keyword">string</span>, item <span class="hljs-keyword">interface</span>&#123;&#125;)<span class="hljs-comment">// è·å–Context.Keysçš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šå¯¼è‡´panic</span>Get(key <span class="hljs-keyword">string</span>) <span class="hljs-keyword">interface</span>&#123;&#125;<span class="hljs-comment">// å°†è¯·æ±‚ä½“çš„å‚æ•°ä½œä¸ºjsonè§£æ</span>ParseBody(item <span class="hljs-keyword">interface</span>&#123;&#125;) error<span class="hljs-comment">// åŒParseBodyï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯ä¸€ä¸ªå¯è§£æçš„jsonä¼šè°ƒç”¨Fail(400)ç»ˆæ­¢è¯·æ±‚</span>EnsureBody(item <span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-keyword">bool</span><span class="hljs-comment">// ä¸‹é¢æ˜¯å’Œè¿”å›ç›¸å…³çš„å‡½æ•°ï¼Œcode å‚æ•°å‡è¡¨ç¤ºhttp status</span><span class="hljs-comment">// è¿”å›json</span>JSON(code <span class="hljs-keyword">int</span>, obj <span class="hljs-keyword">interface</span>&#123;&#125;)<span class="hljs-comment">// è¿”å›xml</span>XML(code <span class="hljs-keyword">int</span>, obj <span class="hljs-keyword">interface</span>&#123;&#125;)<span class="hljs-comment">// HTMLæ¨¡æ¿æ¸²æŸ“ï¼Œä½¿ç”¨golangæ ‡å‡†åº“çš„æ¨¡æ¿åº“</span>HTML(code <span class="hljs-keyword">int</span>, name <span class="hljs-keyword">string</span>, data <span class="hljs-keyword">interface</span>&#123;&#125;)<span class="hljs-comment">// è¿”å›å­—ç¬¦ä¸²</span>String(code <span class="hljs-keyword">int</span>, msg <span class="hljs-keyword">string</span>)<span class="hljs-comment">// è¿”å›æµæ•°æ®</span>Data(code <span class="hljs-keyword">int</span>, data []<span class="hljs-keyword">byte</span>)</code></pre><p><code>RouterGroup</code></p><pre><code class="hljs go"><span class="hljs-comment">// RouterGroupç”¨äºç®¡ç†è·¯ç”±ï¼Œä¸€ä¸ªRouterGroupå’Œä¸€ä¸ªå‰ç¼€ä»¥åŠä¸€ç»„ä¸­é—´ä»¶å…³è”</span><span class="hljs-comment">// Used internally to configure router, a RouterGroup is associated with a prefix</span><span class="hljs-comment">// and an array of handlers (middlewares)</span>RouterGroup <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// ä¸­é—´ä»¶</span>    Handlers []HandlerFunc    <span class="hljs-comment">// è·¯å¾„å‰ç¼€</span>    prefix   <span class="hljs-keyword">string</span>    parent   *RouterGroup    <span class="hljs-comment">// Engine å®ä¾‹</span>    engine   *Engine&#125;<span class="hljs-comment">// æ–°å»ºä¸€ä¸ªContextï¼Œç”¨äºä¼ é€’è¿™ä¸ªè·¯ç”±ç»„çš„æ•°æ®</span>createContext(w http.ResponseWriter, req *http.Request, params httprouter.Params, handlers []HandlerFunc) *Context<span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªä¸­é—´ä»¶åˆ°è¿™ä¸ªè·¯ç”±ç»„</span>Use(middlewares ...HandlerFunc)<span class="hljs-comment">// æ–°å»ºä¸€ä¸ªè·¯ç”±ç»„</span>Group(component <span class="hljs-keyword">string</span>, handlers ...HandlerFunc) *RouterGroup<span class="hljs-comment">// æ³¨å†Œä¸€ä¸ªè·¯ç”±</span>Handle(method, p <span class="hljs-keyword">string</span>, handlers []HandlerFunc)<span class="hljs-comment">// è°ƒç”¨Handleæ–¹æ³•æ³¨å†Œä¸€ä¸ªPOSTè·¯ç”±</span>POST(path <span class="hljs-keyword">string</span>, handlers ...HandlerFunc)<span class="hljs-comment">// è°ƒç”¨Handleæ–¹æ³•æ³¨å†Œä¸€ä¸ªGETè·¯ç”±</span>GET(path <span class="hljs-keyword">string</span>, handlers ...HandlerFunc)<span class="hljs-comment">// è°ƒç”¨Handleæ–¹æ³•æ³¨å†Œä¸€ä¸ªDELETEè·¯ç”±</span>DELETE(path <span class="hljs-keyword">string</span>, handlers ...HandlerFunc)<span class="hljs-comment">// è°ƒç”¨Handleæ–¹æ³•æ³¨å†Œä¸€ä¸ªPATCHè·¯ç”±</span>PATCH(path <span class="hljs-keyword">string</span>, handlers ...HandlerFunc)<span class="hljs-comment">// è°ƒç”¨Handleæ–¹æ³•æ³¨å†Œä¸€ä¸ªPUTè·¯ç”±</span>PUT(path <span class="hljs-keyword">string</span>, handlers ...HandlerFunc)<span class="hljs-comment">// ç»„åˆä¸­é—´ä»¶ï¼Œå°†ä¼ å…¥çš„Handlersæ”¾åœ¨å·²æœ‰çš„Handlersåé¢</span>combineHandlers(handlers []HandlerFunc) []HandlerFunc</code></pre><p><code>Engine</code></p><pre><code class="hljs go"><span class="hljs-comment">// ç”¨äºè¡¨ç¤ºWebæ¡†æ¶ï¼ŒåŒ…å«äº†fast HTTProuterå’Œä¸€ä¸ªå…¨å±€çš„ä¸­é—´ä»¶åˆ—è¡¨</span><span class="hljs-comment">// Represents the web framework, it wrappers the blazing fast httprouter multiplexer and a list of global middlewares.</span>Engine <span class="hljs-keyword">struct</span> &#123;    <span class="hljs-comment">// è·¯ç”±ç»„</span>    *RouterGroup    <span class="hljs-comment">// 404 å¤„ç†</span>    handlers404   []HandlerFunc    <span class="hljs-comment">// http router å®ä¾‹</span>    router        *httprouter.Router    <span class="hljs-comment">// æ¨¡æ¿</span>    HTMLTemplates *template.Template&#125;<span class="hljs-comment">// åŠ è½½HTMLæ¨¡æ¿</span>LoadHTMLTemplates(pattern <span class="hljs-keyword">string</span>)<span class="hljs-comment">// è®¾ç½®404æ–¹æ³•</span>NotFound404(handlers ...HandlerFunc)<span class="hljs-comment">// é»˜è®¤çš„404æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªç‰ˆæœ¬å¹¶æ²¡æœ‰ä½¿ç”¨ä¸Š</span>handle404(w http.ResponseWriter, req *http.Request)<span class="hljs-comment">// ä¿å­˜æ–‡ä»¶</span>ServeFiles(path <span class="hljs-keyword">string</span>, root http.FileSystem)<span class="hljs-comment">// å®ç°http.Handleræ¥å£</span>ServeHTTP(w http.ResponseWriter, req *http.Request)<span class="hljs-comment">// è°ƒç”¨http.ListenAndServeå¯åŠ¨æœåŠ¡å™¨</span>Run(addr <span class="hljs-keyword">string</span>)</code></pre><p>0.1 ç‰ˆæœ¬çš„ gin åªæ˜¯ä¸€ä¸ªæå°ï¼Œæä¸ºç®€å•çš„å·¥å…·ç®±ï¼Œä¸»è¦æä¾›äº†ä¸€ä¸ªç®€å•çš„è·¯ç”±å’Œç®€å•çš„ä¸­é—´ä»¶å®ç°ï¼Œææ¸…æ¥šä¸‹é¢è¿™ä¸¤ä¸ªé—®é¢˜è¿™ä¸ªæ¡†æ¶çš„ä¹Ÿå°±æ˜ç™½äº†ã€‚</p><ol><li><p>ä¸€ä¸ªä½¿ç”¨äº†<code>Gin</code>çš„ Web åº”ç”¨ï¼Œä»åˆå§‹åŒ–åˆ°å¯åŠ¨çš„æµç¨‹ï¼Ÿ</p></li><li><p>ä¸€ä¸ªè¯·æ±‚ä»æ¥æ”¶åˆ°è¿”å›ç»å†äº†ä»€ä¹ˆï¼Ÿ</p></li></ol><h3 id="åº”ç”¨æµç¨‹"><a href="#åº”ç”¨æµç¨‹" class="headerlink" title="åº”ç”¨æµç¨‹"></a>åº”ç”¨æµç¨‹</h3><p>1.é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª<code>engine</code>å®ä¾‹ï¼Œæ³¨å†Œäº†ä¸¤ä¸ªä¸¤ä¸ªåŸºæœ¬çš„ä¸­é—´ä»¶</p><pre><code class="hljs go">gin.Default() -&gt; gin.New() -&gt; engine.Use(Recovery(), Logger())</code></pre><p>2.ç„¶åä½¿ç”¨<code>group.Handle</code>æ–¹æ³•æ³¨å†Œè·¯ç”±, å…³é”®ä»£ç å¦‚ä¸‹ï¼Œå°†è·¯ç”±æ·»åŠ åˆ° http router çš„æ ‘ä¸­ï¼Œå½“æ‰§è¡Œ handler æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ª<code>Context</code>å¹¶ä¸”ä»å¤´å¼€å§‹æ‰§è¡Œ</p><pre><code class="hljs go">group.engine.router.Handle(method, p,<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request, params httprouter.Params)</span></span> &#123;    group.createContext(w, req, params, handlers).Next()&#125;)</code></pre><p>3.è°ƒç”¨<code>http.ListenAndServe</code>ç›‘å¬æŒ‡å®šç«¯å£ï¼Œå¯åŠ¨æœåŠ¡å™¨</p><h3 id="è¯·æ±‚æµç¨‹"><a href="#è¯·æ±‚æµç¨‹" class="headerlink" title="è¯·æ±‚æµç¨‹"></a>è¯·æ±‚æµç¨‹</h3><ol><li>å½“æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šè°ƒç”¨ä¹‹å‰æ³¨å†Œçš„<code>engine.ServeHTTP</code>æ–¹æ³•ï¼ŒæŸ¥æ‰¾è·¯ç”±</li><li><code>engine.ServeHTTP</code>æ–¹æ³•ä½¿ç”¨äº†<code>httprouter</code>çš„<code>ServeHTTP</code>æ–¹æ³•ï¼Œè¿™æ˜¯ä¼šé€šè¿‡è¯·æ±‚çš„ path ä»å·²æ³¨å†Œçš„è·¯ç”±æ ‘ä¸Šè·å–å¯¹åº”çš„è·¯ç”±ï¼Œå¹¶ä¸”æ‰§è¡Œå…¶ handler æ–¹æ³•ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œhandler æ–¹æ³•å†…éƒ¨é€šè¿‡åˆ›å»ºä¸€ä¸ª router group å¯¹åº”çš„ Context ä»å¤´å¼€å§‹æ‰§è¡Œæ‰€æœ‰çš„ä¸­é—´ä»¶ä»¥åŠæ³¨å†Œè·¯ç”±æ—¶æ³¨å†Œçš„è¯·æ±‚å¤„ç†å‡½æ•°</li><li>ä»è¯·æ±‚å¤„ç†å‡½æ•°ä¸­è¿”å›ä¿¡æ¯</li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>gin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¯æŠ€æœ¯äººå‘˜å’ŒæŠ•èµ„è€…çš„ä¸€äº›åŒºåˆ«</title>
    <link href="/post/61686.html"/>
    <url>/post/61686.html</url>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹éƒ½æ˜¯æµæ°´è´¦ï¼Œæ„Ÿæ…¨ä¸€ä¸‹â€¦</p><p>ä»Šå¤©æœ‰å¹¸å‚åŠ äº†ä¸€ä½å¸ˆå…„çš„æ ¡å‹èšä¼šï¼Œä¹Ÿå¾ˆå·§åˆï¼Œå’Œå¾ˆå¤šå¤§ä½¬ä¸€èµ·åƒäº†ä¸€ä¸ªé¥­ï¼Œå¬å¤§ä½¬ä»¬èŠå¤©å—ç›Šé¢‡å¤šã€‚</p><p>ä»Šå¤©æœ‰ä¸€ä½åšæŠ€æœ¯å¾ˆå‰å®³çš„ï¼Œä¸“å®¶çº§çš„å¸ˆå…„æƒ³åˆ›ä¸šï¼ŒèŠèµ·äº†ä»–çš„é¡¹ç›®ï¼Œå¦å¤–å‡ ä¸ªåšä¼ä¸šçš„å¸ˆå…„åœ¨æ—è¾¹å¬å¹¶ä¸”ç»™å‡ºå»ºè®®ã€‚è®©æˆ‘äº§ç”Ÿä¸€ç§å¾ˆå¼ºçƒˆçš„å¯¹æ¯”ï¼ŒåšæŠ€æœ¯çš„å¸ˆå…„è€ƒè™‘çš„æœ€å¤šçš„æ˜¯æŠ€æœ¯ååˆ†çš„ç‰›ï¼ŒæŠ€æœ¯æ‹¥æœ‰ä¸å¯å¤åˆ¶ï¼Œæˆ–è€…è¯´å¾ˆé«˜çš„å¤åˆ¶æˆæœ¬ã€‚ä½†æ˜¯æ²¡æœ‰è¯´åˆ°å…·ä½“çš„ç‰›åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œè€Œå…¶ä»–å‡ ä¸ªå¸ˆå…„åœ¨å¸®å¿™ç†æ¸…é¡¹ç›®çš„æ€è·¯ï¼Œæœ‰æ²¡æœ‰åšè¿‡å¸‚åœºè°ƒæŸ¥ï¼Œæœ‰æ²¡æœ‰æˆå‹çš„äº§å“ï¼Œäº§å“å…·ä½“çš„æŠ€æœ¯æŒ‡æ ‡ç­‰ç­‰ã€‚</p><p>ä¸åŒä½ç½®çš„äººçœ‹é—®é¢˜çš„è§’åº¦ä¸ä¸€æ ·ï¼Œæˆ–è®¸åªæœ‰é‚£ä¸ªæŠ€æœ¯å¾ˆç‰›çš„å¸ˆå…„ä¸€æ ·æ‰èƒ½æŠŠä¸€é—¨æŠ€æœ¯åšåˆ°æè‡´ã€‚</p><p>ä½†æ˜¯åè¿‡æ¥æ€è€ƒä¸€ä¸‹åšæŠ€æœ¯éœ€ä¸éœ€è¦æœ‰ä¸€å®šçš„äº§å“æ€ç»´ï¼Œéœ€ä¸éœ€è¦äº†è§£å¸‚åœºåŠ¨æ€ï¼Œéœ€ä¸éœ€è¦è‰¯å¥½çš„ä¸€ä¸ªè¯­è¨€è¡¨è¿°å’Œç»„ç»‡èƒ½åŠ›ï¼Œè™½ç„¶è¿™äº›è‚¯å®šä¸æ˜¯æœ€é‡è¦çš„ï¼Œä½†æ˜¯åº”è¯¥ä¹Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„å§ã€‚</p><p>è‡ªå‹‰</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/28054.html">Github Actionsä»‹ç»&è‡ªåŠ¨æ„å»ºGithub Pagesåšå®¢</a></li><li><a href="https://lailin.xyz/post/44107.html">è®°ä¸€æ¬¡net httpå†…å­˜æ³„æ¼</a></li><li><a href="https://lailin.xyz/post/52061.html">ä½¿ç”¨TravisCIè‡ªåŠ¨éƒ¨ç½²Blog</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>notes</tag>
      
      <tag>æ‚è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018å¹´çš„ä¸€äº›å°ç›®æ ‡</title>
    <link href="/post/22757.html"/>
    <url>/post/22757.html</url>
    
    <content type="html"><![CDATA[<p>æ—¶é—´è¿‡å¾—å¾ˆå¿«ï¼Œä»ä¸€ä¸ªå­¦ç”Ÿåˆ°ä¸€ä¸ªç¤¾ä¼šäººåªéœ€è¦é‚£ä¹ˆä¸€ç¬é—´ï¼Œä¸€ä¸ªæ¥ä¸åŠååº”çš„ç¬é—´ã€‚è™½ç„¶ä¹‹å‰ç»å†è¿‡å¤§é‡çš„å®ä¹ å·¥ä½œï¼Œä¹Ÿä¸æ˜¯ç¬¬ä¸€æ¬¡åªèº«ä¸€äººåƒé‡Œè¿¢è¿¢æ¥åˆ°è¿™ä¸ªé™Œç”Ÿçš„åŸå¸‚ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰é‚£ä¹ˆä¸€äº›çš„ä¸é€‚åº”ã€‚</p><p>å¼€å§‹å·¥ä½œäº†ï¼Œæ—¶é—´å˜å¾—å°‘äº†ï¼Œä½†æ˜¯å­¦ä¹ çš„ç´§è¿«æ€§å´æ˜¯å˜å¾—æ›´é«˜äº†</p><p>åˆ—ä¸€åˆ—å‰©ä¸‹ä¸åˆ°åŠå¹´æ—¶é—´æƒ³è¦å­¦ä¹ çš„ä¸œè¥¿å§ï¼Œæƒå½“æ˜¯ä¸€ä¸ªå¤‡å¿˜å½•</p><ul><li>é˜…è¯»å­¦ä¹ è‡³å°‘ä¸¤ä¸ª Go Web æ¡†æ¶ <code>ä¸ƒå…«æœˆ</code><ul><li>Echo</li><li>Gin</li><li>Iris</li><li>Beego</li><li>â€¦</li></ul></li><li>å­¦ä¹  Golang è°ƒåº¦æºç  <code>ä¸ƒå…«æœˆ or ä¹æœˆ</code></li><li>ä»é›¶å¼€å§‹ç¼–å†™è‡ªå·±çš„ç¬¬ä¸€ä¸ª Go Web æ¡†æ¶ <code>å…«ä¹æœˆ</code></li><li>æœªå®Œå¾…ç»­â€¦</li></ul><p>å¸Œæœ›èƒ½å¤Ÿå…»æˆè®°å½•å­¦ä¹ è¿‡ç¨‹çš„ä¹ æƒ¯ï¼Œ<code>å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´</code></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/how-to-write-a-pre-research-report.html">ä¸€ç‚¹æ‹™è§-å¦‚ä½•å†™å¥½ä¸€ä¸ªæŠ€æœ¯é¢„ç ”æŠ¥å‘Š?</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>è§„åˆ’æ€»ç»“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ€»ç»“</tag>
      
      <tag>è§„åˆ’</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goæ ‡å‡†åº“â€”â€”ioutil.ReadAllçš„å®ç°</title>
    <link href="/post/47700.html"/>
    <url>/post/47700.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><blockquote><p>æœ€è¿‘å‡†å¤‡å­¦ä¹ ä¸€ä¸‹ golang çš„æ ‡å‡†åº“ï¼Œè¯¦ç»†çš„é˜…è¯»éƒ¨åˆ†æºç ï¼Œè¿™ä¸ªç›®å½•è®°å½•ä¸€ä¸‹å­¦ä¹ çš„è¿‡ç¨‹å’Œå¿ƒå¾—</p></blockquote><p>go è¯­è¨€çš„<code>ioutil</code>åŒ…æä¾›äº†å¾ˆå¤šæ–¹ä¾¿çš„ io æ“ä½œçš„å·¥å…·é›†ï¼Œæœ¬æ–‡ä¸»è¦è¯¦ç»†åˆ†æ<code>ReadAll</code>æ–¹æ³•çš„æºç å®ç°ã€‚</p><p><code>ReadAll</code>æ˜¯å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥ä¸€æ¬¡æ€§çš„è¯»å–<code>io.Reader</code>å½“ä¸­çš„æ•°æ®ã€‚</p><h2 id="æºç å®ç°"><a href="#æºç å®ç°" class="headerlink" title="æºç å®ç°"></a>æºç å®ç°</h2><h5 id="1-ReadAll"><a href="#1-ReadAll" class="headerlink" title="1. ReadAll"></a>1. ReadAll</h5><p>é˜…è¯»ä¸‹æ–¹çš„æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<code>ReadAll</code>å…¶å®è°ƒç”¨äº†ä¸€ä¸ªéå¯¼å‡ºçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„è¿½è¸ª</p><pre><code class="hljs go"><span class="hljs-comment">// ReadAll reads from r until an error or EOF and returns the data it read.</span><span class="hljs-comment">// A successful call returns err == nil, not err == EOF. Because ReadAll is</span><span class="hljs-comment">// defined to read from src until EOF, it does not treat an EOF from Read</span><span class="hljs-comment">// as an error to be reported.</span><span class="hljs-comment">// ReadAllä»rè¯»å–æ•°æ®ç›´åˆ°EOFæˆ–é‡åˆ°errorï¼Œè¿”å›è¯»å–çš„æ•°æ®å’Œé‡åˆ°çš„é”™è¯¯ã€‚</span><span class="hljs-comment">// æˆåŠŸçš„è°ƒç”¨è¿”å›çš„errä¸ºnilè€ŒéEOFã€‚</span><span class="hljs-comment">// å› ä¸ºæœ¬å‡½æ•°å®šä¹‰ä¸ºè¯»å–rç›´åˆ°EOFï¼Œå®ƒä¸ä¼šå°†è¯»å–è¿”å›çš„EOFè§†ä¸ºåº”æŠ¥å‘Šçš„é”™è¯¯ã€‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadAll</span><span class="hljs-params">(r io.Reader)</span> <span class="hljs-params">([]<span class="hljs-keyword">byte</span>, error)</span></span> &#123;<span class="hljs-keyword">return</span> readAll(r, bytes.MinRead)&#125;</code></pre><h5 id="2-readAll"><a href="#2-readAll" class="headerlink" title="2. readAll"></a>2. readAll</h5><p>é˜…è¯»è¿™ä¸ªå‡½æ•°ä»£ç ï¼Œå¯ä»¥å‘ç°ï¼Œ<code>ioutil.ReadAll</code>å®è´¨ä¸Šæ˜¯ä½¿ç”¨<code>bytes.buffer</code>å®ç°çš„ï¼Œåœ¨è¿™é‡Œé¢è°ƒç”¨äº†ä¸¤ä¸ª<code>bytes.buffer</code>çš„æ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥åˆå§‹åŒ–<code>buffer</code>çš„å®¹é‡ï¼Œä¸€ä¸ªç”¨äºè¯»å–æ‰€æœ‰çš„<code>io.Reader</code>æ•°æ®</p><p>é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥å­¦ä¹ åˆ° go å½“ä¸­ panic recover çš„ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨<code>buffer</code>å½“ä¸­ï¼Œå¦‚æœæ— æ³•åˆ†é…è¶³å¤Ÿçš„å†…å­˜çš„æ—¶å€™ï¼Œä¼šç›´æ¥<code>panic bytes.ErrTooLarge</code>çš„é”™è¯¯ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬æœŸæœ›æŠŠè¿™ä¸ªé”™è¯¯ç»™è¿”å›å›æ¥ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨<code>defer recover</code>ä»<code>panic</code>å½“ä¸­æ¢å¤å›æ¥</p><pre><code class="hljs go"><span class="hljs-comment">// readAll reads from r until an error or EOF and returns the data it read</span><span class="hljs-comment">// from the internal buffer allocated with a specified capacity.</span><span class="hljs-comment">// readAllä»rè¯»å–åˆ°ä¸€ä¸ªé”™è¯¯æˆ–EOFï¼Œå¹¶è¿”å›ä»æŒ‡å®šå®¹é‡åˆ†é…çš„å†…éƒ¨ç¼“å†²åŒºä¸­è¯»å–çš„æ•°æ®ã€‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readAll</span><span class="hljs-params">(r io.Reader, capacity <span class="hljs-keyword">int64</span>)</span> <span class="hljs-params">(b []<span class="hljs-keyword">byte</span>, err error)</span></span> &#123;    <span class="hljs-comment">// æ–°å»ºäº†ä¸€ä¸ªbuffer</span><span class="hljs-keyword">var</span> buf bytes.Buffer<span class="hljs-comment">// If the buffer overflows, we will get bytes.ErrTooLarge.</span>    <span class="hljs-comment">// Return that as an error. Any other panic remains.</span>    <span class="hljs-comment">// å¦‚æœbufferæº¢å‡ºäº†ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªbytes.ErrTooLargeçš„é”™è¯¯</span>    <span class="hljs-comment">// å¦‚æœå¾—åˆ°çš„æ˜¯bytes.ErrTooLargeé”™è¯¯ï¼Œå°†å…¶è¿”å›ï¼Œå…¶ä»–panicé”™è¯¯ï¼Œä»ç„¶panic</span><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;e := <span class="hljs-built_in">recover</span>()<span class="hljs-keyword">if</span> e == <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span>&#125;<span class="hljs-keyword">if</span> panicErr, ok := e.(error); ok &amp;&amp; panicErr == bytes.ErrTooLarge &#123;err = panicErr&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-built_in">panic</span>(e)&#125;    &#125;()    <span class="hljs-comment">// åˆ¤æ–­capacityçš„å€¼æ˜¯å¦è¶…è¿‡äº†intç±»å‹çš„ä¸Šé™</span><span class="hljs-keyword">if</span> <span class="hljs-keyword">int64</span>(<span class="hljs-keyword">int</span>(capacity)) == capacity &#123;<span class="hljs-comment">// å‘bufferå½“ä¸­å¢åŠ capacityçš„å®¹é‡</span>buf.Grow(<span class="hljs-keyword">int</span>(capacity))    &#125;    <span class="hljs-comment">// ä½¿ç”¨buffer ReadFrom æ–¹æ³•è¯»å–æ‰€æœ‰çš„io.Readeræ•°æ®</span>_, err = buf.ReadFrom(r)<span class="hljs-keyword">return</span> buf.Bytes(), err&#125;</code></pre><h5 id="3-buffer"><a href="#3-buffer" class="headerlink" title="3. buffer"></a>3. buffer</h5><p>è¦çœ‹<code>buffer</code>ç›¸å…³å‡½æ•°çš„å®ç°ï¼Œå…ˆçœ‹çœ‹<code>buffer</code>çš„å®šä¹‰ï¼Œä¸ç„¶åˆ°æ—¶å€™å¯èƒ½ä¼šæ‡µ B</p><p>ä¸»è¦ä¼šç”¨åˆ°ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯<code>buf</code>,<code>buf</code>çš„å†…å®¹æ˜¯ç”¨<code>off</code>åˆ°<code>len(buf)</code>çš„ï¼Œ<code>off</code>ä¹‹å‰çš„è¡¨ç¤ºå·²ç»è¯»å–äº†æ•°æ®ï¼Œ<code>off</code>è¡¨ç¤ºå½“å‰ä½ç½®ï¼Œ<code>buffer</code>çš„<code>writeå’Œread</code>æ–¹æ³•éƒ½ä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹</p><pre><code class="hljs go"><span class="hljs-comment">// A Buffer is a variable-sized buffer of bytes with Read and Write methods.</span><span class="hljs-comment">// The zero value for Buffer is an empty buffer ready to use.</span><span class="hljs-comment">// Bufferæ˜¯ä¸€ä¸ªå®ç°äº†è¯»å†™æ–¹æ³•çš„å¯å˜å¤§å°çš„å­—èŠ‚ç¼“å†²ã€‚</span><span class="hljs-comment">// æœ¬ç±»å‹çš„é›¶å€¼æ˜¯ä¸€ä¸ªç©ºçš„å¯ç”¨äºè¯»å†™çš„ç¼“å†²ã€‚</span><span class="hljs-keyword">type</span> Buffer <span class="hljs-keyword">struct</span> &#123;buf      []<span class="hljs-keyword">byte</span> <span class="hljs-comment">// contents are the bytes buf[off : len(buf)]</span>off      <span class="hljs-keyword">int</span>    <span class="hljs-comment">// read at &amp;buf[off], write at &amp;buf[len(buf)]</span>lastRead readOp <span class="hljs-comment">// last read operation, so that Unread* can work correctly.</span><span class="hljs-comment">// <span class="hljs-doctag">FIXME:</span> lastRead can fit in a single byte</span><span class="hljs-comment">// memory to hold first slice; helps small buffers avoid allocation.</span><span class="hljs-comment">// <span class="hljs-doctag">FIXME:</span> it would be advisable to align Buffer to cachelines to avoid false</span><span class="hljs-comment">// sharing.</span>bootstrap [<span class="hljs-number">64</span>]<span class="hljs-keyword">byte</span>&#125;</code></pre><h5 id="4-buffer-Grow"><a href="#4-buffer-Grow" class="headerlink" title="4. buffer.Grow"></a>4. buffer.Grow</h5><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥å¢åŠ ç¼“å†²åŒºçš„å†…å­˜ï¼Œå®é™…è¿˜æ˜¯è°ƒç”¨äº†éå¯¼å‡ºçš„<code>grow</code>æ–¹æ³•</p><pre><code class="hljs go"><span class="hljs-comment">// Grow grows the buffer's capacity, if necessary, to guarantee space for</span><span class="hljs-comment">// another n bytes. After Grow(n), at least n bytes can be written to the</span><span class="hljs-comment">// buffer without another allocation.</span><span class="hljs-comment">// If n is negative, Grow will panic.</span><span class="hljs-comment">// If the buffer can't grow it will panic with ErrTooLarge.</span><span class="hljs-comment">// å¿…è¦æ—¶ä¼šå¢åŠ ç¼“å†²çš„å®¹é‡ï¼Œä»¥ä¿è¯nå­—èŠ‚çš„å‰©ä½™ç©ºé—´ã€‚</span><span class="hljs-comment">// è°ƒç”¨Grow(n)åè‡³å°‘å¯ä»¥å‘ç¼“å†²ä¸­å†™å…¥nå­—èŠ‚æ•°æ®è€Œæ— éœ€ç”³è¯·å†…å­˜ã€‚</span><span class="hljs-comment">// å¦‚æœnå°äºé›¶æˆ–è€…ä¸èƒ½å¢åŠ å®¹é‡éƒ½ä¼španic ErrTooLarge é”™è¯¯ã€‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *Buffer)</span> <span class="hljs-title">Grow</span><span class="hljs-params">(n <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-built_in">panic</span>(<span class="hljs-string">"bytes.Buffer.Grow: negative count"</span>)&#125;m := b.grow(n)b.buf = b.buf[<span class="hljs-number">0</span>:m]&#125;</code></pre><h5 id="5-buffer-ReadFrom"><a href="#5-buffer-ReadFrom" class="headerlink" title="5. buffer.ReadFrom"></a>5. buffer.ReadFrom</h5><p>ä¸»è¦çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œå®ç°äº†ä»<code>io.Reader</code>è¯»å–æ‰€æœ‰æ•°æ®ã€‚</p><p>ç¤ºæ„å›¾:<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142743.png" srcset="/img/loading.gif" alt="ç¤ºæ„å›¾"></p><pre><code class="hljs go"><span class="hljs-comment">// ReadFrom reads data from r until EOF and appends it to the buffer, growing</span><span class="hljs-comment">// the buffer as needed. The return value n is the number of bytes read. Any</span><span class="hljs-comment">// error except io.EOF encountered during the read is also returned. If the</span><span class="hljs-comment">// buffer becomes too large, ReadFrom will panic with ErrTooLarge.</span><span class="hljs-comment">// ReadFromä»rä¸­è¯»å–æ•°æ®ç›´åˆ°ç»“æŸå¹¶å°†è¯»å–çš„æ•°æ®å†™å…¥ç¼“å†²ä¸­ï¼Œå¦‚å¿…è¦ä¼šå¢åŠ ç¼“å†²å®¹é‡ã€‚</span><span class="hljs-comment">// è¿”å›å€¼nä¸ºä»rè¯»å–å¹¶å†™å…¥bçš„å­—èŠ‚æ•°ï¼›ä¼šè¿”å›è¯»å–æ—¶é‡åˆ°çš„é™¤äº†io.EOFä¹‹å¤–çš„é”™è¯¯ã€‚</span><span class="hljs-comment">// å¦‚æœç¼“å†²å¤ªå¤§ï¼ŒReadFromä¼šé‡‡ç”¨é”™è¯¯å€¼ErrTooLargeå¼•å‘panicã€‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *Buffer)</span> <span class="hljs-title">ReadFrom</span><span class="hljs-params">(r io.Reader)</span> <span class="hljs-params">(n <span class="hljs-keyword">int64</span>, err error)</span></span> &#123;    <span class="hljs-comment">// const opInvalid = 0  // Non-read operation. è¡¨ç¤ºä¹‹å‰æ²¡æœ‰è¯»æ“ä½œ</span>b.lastRead = opInvalid    <span class="hljs-comment">// If buffer is empty, reset to recover space.</span>    <span class="hljs-comment">// å¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œé‡ç½®ä¸ºæ¢å¤ç©ºé—´ã€‚</span><span class="hljs-keyword">if</span> b.off &gt;= <span class="hljs-built_in">len</span>(b.buf) &#123;b.Reset()    &#125;    <span class="hljs-comment">// å¾ªç¯è¯»å–io.Reader çš„æ•°æ®</span><span class="hljs-keyword">for</span> &#123;        <span class="hljs-comment">// åˆ¤æ–­å½“å‰å‰©ä½™ç©ºé—´æ˜¯å¦å°äºMinReadï¼ŒMinRead = 512</span><span class="hljs-keyword">if</span> free := <span class="hljs-built_in">cap</span>(b.buf) - <span class="hljs-built_in">len</span>(b.buf); free &lt; MinRead &#123;            <span class="hljs-comment">// not enough space at end</span>            <span class="hljs-comment">// ç©ºé—´ä¸è¶³</span>            <span class="hljs-comment">// æ–°å»ºä¸€ä¸ªbuf</span>            newBuf := b.buf            <span class="hljs-comment">// åˆ¤æ–­å®é™…å‰©ä½™å®¹é‡æ˜¯å¦å°äºMinRead = 512</span><span class="hljs-keyword">if</span> b.off+free &lt; MinRead &#123;<span class="hljs-comment">// not enough space using beginning of buffer;</span>                <span class="hljs-comment">// double buffer capacity</span>                <span class="hljs-comment">// å®é™…å‰©ä½™ç©ºé—´ä¸è¶³ï¼Œåˆ†é…åŒå€çš„ç¼“å†²ç©ºé—´ï¼Œç¼“å†²çš„æœ€å°å€¼ä¸ºMinReadæ‰€ä»¥åŠ ä¸Šä¸€ä¸ªMinReadï¼Œé¿å…åŒå€ä¹‹åä»ç„¶æ¯”MinReadå°</span>                <span class="hljs-comment">// makeSliceå‡½æ•°ç”¨äºåˆ†é…ç¼“å†²ç©ºé—´ï¼Œå¦‚æœåˆ†é…å¤±è´¥ä¼španic ErrTooLarge é”™è¯¯</span>newBuf = makeSlice(<span class="hljs-number">2</span>*<span class="hljs-built_in">cap</span>(b.buf) + MinRead)            &#125;            <span class="hljs-comment">// å°†åŸæœ‰bufæ•°æ®å¤åˆ¶åˆ°æ–°çš„buf</span>            <span class="hljs-built_in">copy</span>(newBuf, b.buf[b.off:])            <span class="hljs-comment">// len(b.buf)-b.off å°±ç­‰äºbufå½“å‰å†…å®¹çš„é•¿åº¦</span>            <span class="hljs-comment">// ä¾‹å­: a:=make([]byte,20)</span>            <span class="hljs-comment">//      b:=a[:10]</span>            <span class="hljs-comment">//      len(b) // 10</span>            <span class="hljs-comment">//      cap(b) //20</span>            b.buf = newBuf[:<span class="hljs-built_in">len</span>(b.buf)-b.off]            <span class="hljs-comment">// å°†offç½®0</span>b.off = <span class="hljs-number">0</span>        &#125;        <span class="hljs-comment">// ä»io.Readerå½“ä¸­è¯»å–æ•°æ®ï¼Œä¼ å…¥bufçš„å‰©ä½™ç©ºé—´</span>        <span class="hljs-comment">// ç¬¬ä¸€ç§æƒ…å†µï¼Œæ•°æ®è¯»å–å®Œæ¯•ï¼Œè¿”å›è¯»å–é•¿åº¦mä»¥åŠ,io.EOFé”™è¯¯</span>        <span class="hljs-comment">// ç¬¬äºŒç§æƒ…å†µ, æ•°æ®æœªè¯»å®Œï¼Œé‡åˆ°é”™è¯¯</span>        <span class="hljs-comment">// ç¬¬ä¸‰ç§æƒ…å†µï¼Œæ•°æ®æœªè¯»å®Œï¼Œç¼“å†²åŒºå®¹é‡ä¸å¤Ÿï¼Œè¿”å›è¯»å–æ•°æ®é•¿åº¦mä»¥åŠnil</span>        m, e := r.Read(b.buf[<span class="hljs-built_in">len</span>(b.buf):<span class="hljs-built_in">cap</span>(b.buf)])        <span class="hljs-comment">// åªè·å–æœ‰æ•°æ®çš„bufï¼Œæ— æ•°æ®çš„ç©ºé—´è½¬åŒ–ä¸ºcap</span>b.buf = b.buf[<span class="hljs-number">0</span> : <span class="hljs-built_in">len</span>(b.buf)+m]        n += <span class="hljs-keyword">int64</span>(m)        <span class="hljs-comment">// æ•°æ®è¯»å–å®Œæ¯•è·³å‡ºå¾ªç¯</span><span class="hljs-keyword">if</span> e == io.EOF &#123;<span class="hljs-keyword">break</span>        &#125;        <span class="hljs-comment">// é‡åˆ°é”™è¯¯è¿”å›</span><span class="hljs-keyword">if</span> e != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> n, e&#125;&#125;<span class="hljs-keyword">return</span> n, <span class="hljs-literal">nil</span> <span class="hljs-comment">// err is EOF, so return nil explicitly</span>&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>goæ ‡å‡†åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨chromedpè§£å†³åçˆ¬è™«é—®é¢˜</title>
    <link href="/post/5431.html"/>
    <url>/post/5431.html</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘ We å·å¤§ä¸Šçš„æ•™åŠ¡å¤„å…¬å‘Šæ–°é—»å·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ï¼Œæƒ³åˆ°å¯èƒ½æ˜¯ ip è¢«å°äº†ï¼ŒæŸ¥äº†ä¸€ä¸‹ logï¼Œå‘ç°å¹¶ä¸æ˜¯ï¼Œè€Œæ˜¯è·å–åˆ°çš„é¡µé¢å…¨å˜æˆäº†æ··æ·†è¿‡çš„ jsï¼Œä¸‹é¢æ”¾ä¸¤ä¸ªæ ¼å¼åŒ–çš„å‡½æ•°</p><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_$Es</span>(<span class="hljs-params">_$Cu</span>) </span>&#123;  _$Cu[<span class="hljs-number">14</span>] = _$v9();  _$Cu[_$yf(_$ox(), <span class="hljs-number">16</span>)] = _$Dn();  <span class="hljs-keyword">var</span> _$cR = _$CR();  _$cR = _$iT();  <span class="hljs-keyword">return</span> _$DA();&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_$Dk</span>(<span class="hljs-params">_$Cu</span>) </span>&#123;  <span class="hljs-keyword">var</span> _$x5 = _$Dv();  <span class="hljs-keyword">var</span> _$x5 = _$EB();  <span class="hljs-keyword">if</span> (_$Ex()) &#123;    _$w9 = _$Dw();  &#125;  _$Cu[_$yf(_$EJ(), <span class="hljs-number">16</span>)] = _$ED();  _$Cu[_$yf(_$Ep(), <span class="hljs-number">16</span>)] = _$EP();  _$w9 = _$EB();  <span class="hljs-keyword">return</span> _$Cu[_$yf(_$v9(), <span class="hljs-number">16</span>)];&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_$rK</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">var</span> _$aJ = _$c0(_$DN());  _$aJ = _$BC(_$aJ, <span class="hljs-number">2</span>);  <span class="hljs-keyword">var</span> _$Ce = _$yr(_$qt());  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _$Cu = <span class="hljs-number">0</span>; _$Cu &lt; _$aJ[_$gX()]; _$Cu++) &#123;    _$aJ[_$Cu] = _$Ce + _$aJ[_$Cu];  &#125;  <span class="hljs-keyword">return</span> _$aJ;&#125;</code></pre><p>çœ‹ç€è¿™ä¸€å †å°±å¤´å¤§ï¼Œä½†æ˜¯æœ¬ç€åªè¦æ˜¯æµè§ˆå™¨èƒ½å¤Ÿæ¸²æŸ“å‡ºæ¥çš„é¡µé¢çˆ¬è™«å°±å¯ä»¥çˆ¬åˆ°çš„åŸåˆ™ï¼Œä¸€æ­¥ä¸€æ­¥çš„è§£å†³</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ol><li>å…ˆä½¿ç”¨ postman å‘é€äº†ä¸€ä¸‹è¯·æ±‚ï¼Œå‘ç°è¿”å›äº†ä¸Šé¢ä¸€å †ä¹±ç </li><li>å¤åˆ¶äº†æ­£å¸¸æ¸²æŸ“é¡µé¢ request header é‡æ–°å‘é€è¯·æ±‚ï¼Œå¯ä»¥å¾—åˆ°æ­£å¸¸çš„é¡µé¢ã€‚è€ƒè™‘ä¸¤ä¸ªå¯èƒ½ä¸€ä¸ªæ˜¯ header æœ‰ä»€ä¹ˆç‰¹æ®Šçš„å¤„ç†ï¼Œä¸€ä¸ªæ˜¯ cookie ä¸Šçš„é—®é¢˜ã€‚</li><li>header å…¶ä»–å†…å®¹ä¸å˜ï¼Œå»æ‰ cookie é‡æ–°å‘é€è¯·æ±‚ï¼Œå†ä¸€æ¬¡å¾—åˆ°ä¸€å †ä¹±ç ã€‚é—®é¢˜å®šä½æˆåŠŸï¼Œåº”è¯¥å°±æ˜¯ cookie çš„é—®é¢˜äº†</li><li>æ¸…ç©º chrome çš„ç¼“å­˜ï¼Œé‡æ–°åŠ è½½é¡µé¢ï¼ŒæŸ¥çœ‹è¯·æ±‚è®°å½•ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢ä¸€å…±åŠ è½½äº†ä¸¤æ¬¡<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141634.png" srcset="/img/loading.gif" alt="ç¬¬ä¸€æ¬¡åŠ è½½"><br>ç¬¬ä¸€æ¬¡åŠ è½½æ²¡æœ‰è¿”å› cookie<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141635.png" srcset="/img/loading.gif" alt="ç¬¬äºŒæ¬¡åŠ è½½"><br>ç¬¬äºŒæ¬¡åŠ è½½è¿”å›äº†ä¸€ä¸ª<code>JSESSIONID</code>ï¼Œè¿™ä¸ªåº”è¯¥å°±æ˜¯æœ€ç»ˆéœ€è¦çš„ cookie äº†</li><li>è§‚å¯Ÿä¸¤æ¬¡è¯·æ±‚çš„ä¸­é—´ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿˜æœ‰ä¸¤ä¸ªè¯·æ±‚ï¼Œè¿™ä¸¤ä¸ªè¯·æ±‚åº”è¯¥å°±æ˜¯ç¬¬äºŒæ¬¡è¿”å› cookie çš„åŸå› äº†ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚æ˜¯é¡µé¢å†…çš„å¤–é“¾ js æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªè¯·æ±‚åº”è¯¥å°±æ˜¯æ··æ·†è¿‡çš„ js å‘å‡ºçš„è¯·æ±‚äº†ã€‚</li><li>å› ä¸ºå®åŠ›æœ‰é™ï¼Œåˆ†æäº†å‡ ä¸ªå°æ—¶éƒ½æ²¡æœ‰åˆ†æå‡ºæ¥è¿™ä¸ªé€»è¾‘æ˜¯æ€ä¹ˆåŠ è½½çš„ã€‚ä½†æ˜¯æƒ³åˆ°äº†ç›´æ¥ä»æµè§ˆå™¨æŠŠ cookie å¤åˆ¶ä¸‹æ¥ç»™çˆ¬è™«ä½¿ç”¨ä¸å°±å¯ä»¥äº†ï¼Ÿä½†æ˜¯è¿™æ ·ä¹Ÿè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸å¯èƒ½æ¯ä¸€æ¬¡éƒ½æ‰‹åŠ¨çš„å»è·å– cookie è¿™æ ·è¾¾ä¸åˆ°æƒ³è¦çš„æ•ˆæœã€‚ç„¶åçœ‹åˆ° Python æœ‰ä½¿ç”¨<code>Selenium</code>æ¥å®Œå…¨æ¨¡æ‹Ÿæµè§ˆå™¨æ¸²æŸ“ç„¶åè§£æé¡µé¢çš„çˆ¬è™«æ¡ˆä¾‹ï¼Œæ‰¾äº†ä¸€ä¸‹ golang æœ‰æ²¡æœ‰ç±»ä¼¼çš„æµè§ˆå™¨æ¸²æŸ“æ–¹æ¡ˆï¼Œåœ¨ä¸‡èƒ½çš„ gayhub ä¸Šæ‰¾åˆ°äº†<code>chromedp</code>ã€‚ä¸‹é¢ä½¿ç”¨ chromedp æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li></ol><h2 id="chromedp"><a href="#chromedp" class="headerlink" title="chromedp"></a>chromedp</h2><blockquote><p>Package chromedp is a faster, simpler way to drive browsers (Chrome, Edge, Safari, Android, etc) without external dependencies (ie, Selenium, PhantomJS, etc) using the Chrome Debugging Protocol.</p></blockquote><h5 id="1-installï¼ˆå»ºè®®ä½¿ç”¨æ¢¯å­ï¼‰"><a href="#1-installï¼ˆå»ºè®®ä½¿ç”¨æ¢¯å­ï¼‰" class="headerlink" title="1.installï¼ˆå»ºè®®ä½¿ç”¨æ¢¯å­ï¼‰"></a>1.installï¼ˆå»ºè®®ä½¿ç”¨æ¢¯å­ï¼‰</h5><pre><code class="hljs bash">go get -u github.com/chromedp/chromedp</code></pre><h5 id="2-code"><a href="#2-code" class="headerlink" title="2.code"></a>2.code</h5><p>è¿è¡Œä¸‹é¢è¿™ä¸€æ®µä»£ç å¯ä»¥çœ‹åˆ° chrome ä¼šå¼¹å‡ºä¸€ä¸ªçª—å£å¹¶ä¸”è¿è¡Œç½‘é¡µï¼Œæœ€ååœ¨ console è¾“å‡ºæœŸæœ›çš„ htmlï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®åªéœ€è¦å¾—åˆ°æ­£ç¡®çš„ cookieï¼Œç”¨æ¥ä¹‹åçˆ¬å–ç½‘é¡µä½¿ç”¨ã€‚å¦‚æœæ‰€æœ‰çš„é¡µé¢éƒ½éœ€è¦ç­‰å¾… chrome æ¸²æŸ“ç»“æŸä¹‹åçˆ¬å–ï¼Œé‚£ä¹ˆæ•ˆç‡å®åœ¨æ˜¯å¤ªä½äº†</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"context"</span><span class="hljs-string">"fmt"</span><span class="hljs-string">"io/ioutil"</span><span class="hljs-string">"log"</span><span class="hljs-string">"time"</span><span class="hljs-string">"github.com/chromedp/cdproto/cdp"</span><span class="hljs-string">"github.com/chromedp/chromedp"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> err error<span class="hljs-comment">// create context</span>ctxt, cancel := context.WithCancel(context.Background())<span class="hljs-keyword">defer</span> cancel()<span class="hljs-comment">// create chrome instance</span>c, err := chromedp.New(ctxt, chromedp.WithLog(log.Printf))<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;<span class="hljs-comment">// run task list</span><span class="hljs-keyword">var</span> res <span class="hljs-keyword">string</span>err = c.Run(ctxt, chromedp.Tasks&#123;        <span class="hljs-comment">// è®¿é—®æ•™åŠ¡å¤„é¡µé¢</span>chromedp.Navigate(<span class="hljs-string">`http://jwc.scu.edu.cn/jwc/moreNotice.action`</span>),        <span class="hljs-comment">// ç­‰å¾…tableæ¸²æŸ“æˆåŠŸï¼ŒæˆåŠŸåˆ™è¯´æ˜å·²ç»è·å–åˆ°äº†æ­£ç¡®çš„é¡µé¢</span>        chromedp.WaitVisible(<span class="hljs-string">`table`</span>, chromedp.ByQuery),        <span class="hljs-comment">// è·å–bodyæ ‡ç­¾çš„htmlå­—ç¬¦</span>chromedp.OuterHTML(<span class="hljs-string">"body"</span>, &amp;res),&#125;)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;<span class="hljs-comment">// å…³é—­chromeå®ä¾‹</span>err = c.Shutdown(ctxt)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;<span class="hljs-comment">// ç­‰å¾…chromeå®ä¾‹å…³é—­</span>err = c.Wait()<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;    <span class="hljs-comment">// è¾“å‡ºhtmlå­—ç¬¦ä¸²</span>log.Printf(res)&#125;</code></pre><h5 id="3-è·å–-cookie"><a href="#3-è·å–-cookie" class="headerlink" title="3.è·å– cookie"></a>3.è·å– cookie</h5><p>ä¿®æ”¹ç¬¬ 2 æ­¥å½“ä¸­ task list çš„ä»£ç è·å– cookieï¼Œä¿®æ”¹ä¹‹åå¯ä»¥çœ‹åˆ° console å½“ä¸­è¾“å‡ºäº†ä¸€æ®µ cookie å­—ç¬¦ä¸²ï¼Œä½¿ç”¨è¿™ä¸ª cookie åœ¨ postman å½“ä¸­æµ‹è¯•å¯ä»¥å‘ç°ï¼Œå¯ä»¥è·å–åˆ°æ­£ç¡®çš„é¡µé¢ã€‚åˆ°äº†è¿™ä¸€æ­¥å…¶å®å°±åº”è¯¥ç®—åŸºæœ¬å®Œæˆäº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šæ¯æ¬¡è¿è¡Œçš„æ—¶å€™éƒ½ä¼šå¼¹å‡ºä¸€ä¸ª chrome çª—å£ï¼Œçˆ¬è™«åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæ˜¯æ²¡æœ‰ gui é¡µé¢çš„ï¼Œå¹¶ä¸”æ¯æ¬¡æ‰“å¼€ä¸€ä¸ª chrome å®ä¾‹çš„æ—¶é—´å¼€é”€ä¹Ÿæ¯”è¾ƒå¤§ã€‚</p><pre><code class="hljs go"><span class="hljs-comment">// å°†chromedp.OuterHTML("body", &amp;res) æ›¿æ¢ä¸ºä¸‹é¢çš„ä»£ç </span>chromedp.ActionFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, h cdp.Executor)</span> <span class="hljs-title">error</span></span> &#123;    <span class="hljs-comment">// è·å–cookie</span>    cookies, err := network.GetAllCookies().Do(ctx, h)    <span class="hljs-comment">// å°†cookieæ‹¼æ¥æˆheaderè¯·æ±‚ä¸­cookieå­—æ®µçš„æ¨¡å¼</span>    <span class="hljs-keyword">var</span> c <span class="hljs-keyword">string</span>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> cookies &#123;        c = c + v.Name + <span class="hljs-string">"="</span> + v.Value + <span class="hljs-string">";"</span>    &#125;    log.Println(c)    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">return</span> err    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;),</code></pre><h5 id="5-ä½¿ç”¨-chrome-çš„-headless-æ¨¡å¼"><a href="#5-ä½¿ç”¨-chrome-çš„-headless-æ¨¡å¼" class="headerlink" title="5.ä½¿ç”¨ chrome çš„ headless æ¨¡å¼"></a>5.ä½¿ç”¨ chrome çš„ headless æ¨¡å¼</h5><p>a.ä½¿ç”¨ docker è¿è¡Œä¸€ä¸ª headless æ¨¡å¼çš„ chrome</p><pre><code class="hljs bash">docker run -d -p 9222:9222 --rm --name chrome-headless knqz/chrome-headless</code></pre><p>b.ä¿®æ”¹ä»£ç </p><p>å¯ä»¥çœ‹åˆ°ä¸»è¦çš„åŒºåˆ«å°±åœ¨åˆ›å»º chrome å®ä¾‹çš„æ—¶å€™æ²¡æœ‰å»å¯åŠ¨ä¸€ä¸ª chromeï¼Œå½“ç„¶æœ€åä¹Ÿä¸éœ€è¦å»å…³é—­å®ƒ</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"context"</span><span class="hljs-string">"log"</span><span class="hljs-string">"github.com/chromedp/chromedp/client"</span><span class="hljs-string">"github.com/chromedp/cdproto/network"</span><span class="hljs-string">"github.com/chromedp/cdproto/cdp"</span><span class="hljs-string">"github.com/chromedp/chromedp"</span>)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">var</span> err error<span class="hljs-comment">// create context</span>ctxt, cancel := context.WithCancel(context.Background())<span class="hljs-keyword">defer</span> cancel()<span class="hljs-comment">// create chrome instance</span>c, err := chromedp.New(ctxt, chromedp.WithTargets(client.New().WatchPageTargets(ctxt)), chromedp.WithLog(log.Printf))<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;<span class="hljs-comment">// run task list</span>err = c.Run(ctxt, chromedp.Tasks&#123;        <span class="hljs-comment">// è®¿é—®æ•™åŠ¡å¤„é¡µé¢</span>chromedp.Navigate(<span class="hljs-string">`http://jwc.scu.edu.cn/jwc/moreNotice.action`</span>),        <span class="hljs-comment">// ç­‰å¾…tableæ¸²æŸ“æˆåŠŸï¼ŒæˆåŠŸåˆ™è¯´æ˜å·²ç»è·å–åˆ°äº†æ­£ç¡®çš„é¡µé¢</span>        chromedp.WaitVisible(<span class="hljs-string">`table`</span>, chromedp.ByQuery),        <span class="hljs-comment">// è·å–bodyæ ‡ç­¾çš„htmlå­—ç¬¦</span>chromedp.ActionFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, h cdp.Executor)</span> <span class="hljs-title">error</span></span> &#123;            <span class="hljs-comment">// è·å–cookie</span>            cookies, err := network.GetAllCookies().Do(ctx, h)            <span class="hljs-comment">// å°†cookieæ‹¼æ¥æˆheaderè¯·æ±‚ä¸­cookieå­—æ®µçš„æ¨¡å¼</span>            <span class="hljs-keyword">var</span> c <span class="hljs-keyword">string</span>            <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> cookies &#123;                c = c + v.Name + <span class="hljs-string">"="</span> + v.Value + <span class="hljs-string">";"</span>            &#125;            log.Println(c)            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;                <span class="hljs-keyword">return</span> err            &#125;            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>        &#125;),&#125;)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;log.Fatal(err)&#125;&#125;</code></pre><p>åˆ°è¿™é‡ŒåŸºæœ¬å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œè·å–åˆ° cookie ä¹‹åå¯ä»¥ä½¿ç”¨å–œæ¬¢çš„æ–¹å¼å»è·å–é¡µé¢</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/auxvv1.html">Go Webå°æŠ€å·§ï¼ˆå››ï¼‰åœ¨å•ä¸ªä»“åº“ä¸­æ”¯æŒå¤šä¸ª go mod æ¨¡å—</a></li><li><a href="https://lailin.xyz/post/11996.html">Go Web å°æŠ€å·§ï¼ˆä¸‰ï¼‰Gin å‚æ•°ç»‘å®š</a></li><li><a href="https://lailin.xyz/post/17394.html">Go Web å°æŠ€å·§ï¼ˆäºŒï¼‰GORM ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>çˆ¬è™«</tag>
      
      <tag>chromedp</tag>
      
      <tag>å››å·å¤§å­¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Weå·å¤§å¼€å‘ç¬”è®°@0.2.0</title>
    <link href="/post/62925.html"/>
    <url>/post/62925.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><p>å¯ä»¥æœç´¢å°ç¨‹åº<code>weå·å¤§</code>ç›´æ¥ä½“éªŒ</p><p>è¿™ä¸æ˜¯åˆšåˆšå‘å®Œ 0.1.0 çš„ç¬”è®°ä¹ˆï¼Ÿæ€ä¹ˆ 0.2.0 éƒ½å‡ºæ¥äº†ï¼Ÿ</p><p>æ²¡æœ‰çœ‹é”™ï¼Œæ•ˆç‡å°±æ˜¯é‚£ä¹ˆé«˜ï¼Œä¸Šä¸€ç¯‡ä¹Ÿæåˆ°äº† 0.1.0 å®¡æ ¸é€šè¿‡çš„æ—¶å€™ 0.2.0 å°±åŸºæœ¬å·²ç»å®Œæˆäº†ï¼Œè€Œä¸”ç°åœ¨å·²ç»ä¸Šçº¿äº†(å‡†ç¡®çš„è¯´æ˜¯ 0.2.1 ç‰ˆæœ¬)ï¼Œè¿™ä¸€æ¬¡çš„å®¡æ ¸å¿«äº†è®¸å¤šï¼Œåªç”¨äº†ä¸åˆ°ä¸¤å¤©å°±å·²ç»å®¡æ ¸é€šè¿‡äº†</p><h2 id="åŠŸèƒ½é¢„è§ˆ"><a href="#åŠŸèƒ½é¢„è§ˆ" class="headerlink" title="åŠŸèƒ½é¢„è§ˆ"></a>åŠŸèƒ½é¢„è§ˆ</h2><p>è¿™ä¸€ç‰ˆä¸»è¦æ–°å¢ä¸‰ä¸ªåŠŸèƒ½ï¼Œç„¶åå°±æ˜¯ä¸€äº›ä¼˜åŒ–ï¼š</p><p><strong>1.åé¦ˆ</strong></p><p>å‚è€ƒ we é‡é‚®ï¼Œç›´æ¥å’Œ github çš„ issue å…³è”ï¼Œæ‰€æœ‰æäº¤çš„åé¦ˆä¿¡æ¯ï¼Œéƒ½ä¼šæ–°å»ºä¸€æ¡ issueï¼Œä¸ºäº†é˜²æ­¢æ»¥ç”¨ï¼Œæ¯å¤©çš„åé¦ˆæ¬¡æ•°åšäº†ä¸€å®šçš„é™åˆ¶</p><p>è¿™ä¸ªåç«¯ä¸Šç›´æ¥é‡‡ç”¨äº† Google çš„ go-github åŒ…ï¼Œå¼€å‘èµ·æ¥ååˆ†çš„æ–¹ä¾¿ï¼Œåªæ˜¯æ–‡æ¡£èµ„æ–™ä¸æ˜¯ç‰¹åˆ«çš„ä¸°å¯Œï¼Œä¹‹åä¼šä¸“é—¨æ€»ç»“ä¸€ä¸‹</p><p><strong>2.ç©ºé—²æ•™å®¤æŸ¥è¯¢</strong></p><p>å­¦æ ¡çš„ç©ºé—²æ•™å®¤æŸ¥è¯¢é¡µé¢ï¼š<a href="http://cir.scu.edu.cn/cir/index.html" target="_blank" rel="noopener">http://cir.scu.edu.cn/cir/index.html</a></p><p>è¿™æ˜¯å­¦æ ¡éš¾å¾—åšçš„æ¯”è¾ƒå‹å¥½çš„ç«™ç‚¹ï¼Œå¯¹äºè¿™ä¸ªéœ€è¦åç«¯åšä¸€æ¬¡æ¥å£ä¸­è½¬å³å¯</p><p><strong>3.æ–°é—» Tag åˆ—è¡¨</strong></p><p>è¿™ä¸€ç‰ˆå¯ä»¥ç›´æ¥é€šè¿‡ç‚¹å‡»åˆ—è¡¨çš„ tagï¼ŒæŸ¥çœ‹å‰ 20 æ¡åŒ…å«è¯¥ tag çš„æ–°é—»ï¼Œ è‡³äºä¸ºä»€ä¹ˆæ˜¯ 20 æ¡ï¼Œå› ä¸ºä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ bug ç°åœ¨è¿˜æ²¡æœ‰è§£å†³ã€‚</p><p>ä¸¤ä¸ªé¡µé¢ï¼ŒAï¼ŒB åŒ…å«äº†åŒä¸€ä¸ªæ¨¡å— Cï¼Œåœ¨æ¨¡å— C å½“ä¸­å¯ä»¥ç‚¹å‡»è·³è½¬åˆ° Bï¼Œç°åœ¨çš„é—®é¢˜å°±æ˜¯åœ¨ A é¡µé¢çš„ C æ¨¡å—å½“ä¸­ç‚¹å‡»è·³è½¬åˆ° B é¡µé¢ä¹‹åï¼ŒB é¡µé¢çš„ C æ¨¡å—çš„ scroll-view ç»‘å®šçš„æ‰€æœ‰äº‹ä»¶éƒ½ä¼šæ¶ˆå¤±</p><h2 id="å›¾ç‰‡é¢„è§ˆ"><a href="#å›¾ç‰‡é¢„è§ˆ" class="headerlink" title="å›¾ç‰‡é¢„è§ˆ"></a>å›¾ç‰‡é¢„è§ˆ</h2><p><img src="https://user-images.githubusercontent.com/15172509/35327035-66a31fb8-0133-11e8-9694-862bb9580b95.png" srcset="/img/loading.gif" alt="screenshot_2018-01-24-18-19-17-192_com tencent mm"><br><img src="https://user-images.githubusercontent.com/15172509/35327038-672fd782-0133-11e8-821d-5e280bade960.png" srcset="/img/loading.gif" alt="screenshot_2018-01-24-18-18-56-360_com tencent mm"><br><img src="https://user-images.githubusercontent.com/15172509/35327040-67727a4c-0133-11e8-9173-7fcd92ff5c0a.png" srcset="/img/loading.gif" alt="screenshot_2018-01-24-18-19-02-187_com tencent mm"></p><h2 id="åšå®¢åŸæ–‡-amp-amp-å¼€æºåœ°å€"><a href="#åšå®¢åŸæ–‡-amp-amp-å¼€æºåœ°å€" class="headerlink" title="åšå®¢åŸæ–‡&amp;&amp;å¼€æºåœ°å€"></a>åšå®¢åŸæ–‡&amp;&amp;å¼€æºåœ°å€</h2><p><a href="https://github.com/mohuishou/scuplus-wechat" target="_blank" rel="noopener">https://github.com/mohuishou/scuplus-wechat</a><br><a href="http://lailin.xyz/post/Weå·å¤§å¼€å‘ç¬”è®°@0.2.0/">http://lailin.xyz/post/We å·å¤§å¼€å‘ç¬”è®°@0.2.0/</a></p><p>å¯ä»¥å…³æ³¨å¼€å‘è¿›åº¦æˆ–è€…æäº¤åé¦ˆæˆ–è€…æ˜¯ PRï¼Œstar å¤šå¤šç›Šå–„</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/62781.html">Weå·å¤§å¼€å‘ç¬”è®°@0.1.0</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>weå·å¤§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Weå·å¤§å¼€å‘ç¬”è®°@0.1.0</title>
    <link href="/post/62781.html"/>
    <url>/post/62781.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><p>å¾®ä¿¡å°ç¨‹åºå·²ç»å‡ºæ¥ä¸€å¹´å·¦å³äº†ï¼Œç„¶åä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ä¸ª scuplus çš„ web é¡¹ç›®ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ­£å¼ä¸Šçº¿å°±æ— ç–¾è€Œç»ˆäº†ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯ä¸€ç‚¹ç”¨å¤„éƒ½æ²¡æœ‰ï¼Œæ‹†åˆ†å‡ºæ¥äº†ä¸¤ä¸ªå°çš„åŠŸèƒ½æ¨¡å—ï¼Œä¸€ä¸ªæ˜¯ç»©ç‚¹è®¡ç®—å™¨ï¼Œä¸€ä¸ªå¿«æ·è¯„æ•™ï¼Œç»©ç‚¹è®¡ç®—å™¨çš„æ—¥ PV å¿«è¦ç ´ 3W äº†ï¼ŒUV å·²ç»ç ´ 1W äº†ï¼Œå¤§å®¶æœŸæœ«çœ‹æˆç»©çš„å¿ƒæƒ…ä¾æ—§æ˜¯é‚£ä¹ˆçš„æ€¥è¿«ã€‚</p><p>æŒ‰ç†æ¥è¯´ï¼Œæˆ‘å³å°†æ¯•ä¸šåšè¿™äº›å…¶å®ä¸å¤ªå¥½ï¼Œæ¯•ä¸šä¹‹åä»£ç çš„ç»´æŠ¤ä»¥åŠè¿è¥éƒ½æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œä½†æ˜¯å·å¤§ä¸€ç›´ç¼ºå°‘ä¸€ä¸ªç»¼åˆå‹çš„ APP æˆ–è€…ç½‘ç«™ï¼Œå­¦æ ¡å®˜æ–¹çš„ç½‘ç«™åšçš„éƒ½åŠå…¶çš„ä¸å‹å¥½ï¼Œè€Œä¸”ååˆ†çš„åˆ†æ•£ï¼Œæ‰€ä»¥ä¸€ç›´æœ‰è¿™ä¸ªæƒ³æ³•ï¼Œæƒ³åšä¸€ä¸ªé›†æ–°é—»èµ„è®¯ã€æ¯”èµ›èµ„è®¯/æ‰¾é˜Ÿå‹/æ‹‰ç¥¨ï¼Œæ•™åŠ¡æŸ¥è¯¢ï¼Œè¯¾ç¨‹æ¨è/æ’å/è¯„ä»·/é€‰è¯¾ï¼Œä¹¦ç±æŸ¥è¯¢/å€Ÿé˜…äºä¸€ä½“çš„ä¸€ä¸ªç»¼åˆå‹ç½‘ç«™ã€‚å½“ç„¶è¿™ä¸ªæƒ³æ³•æ¶‰åŠåˆ°çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œå¸å–ä¹‹å‰çš„æ•™è®­ï¼Œè¿™æ¬¡æ‰“ç®—ä¸€æ­¥ä¸€æ­¥çš„æ¥ï¼Œå‰æœŸåšåŠŸèƒ½ï¼ŒåæœŸåšä¼˜åŒ–ï¼Œåˆ†æ¨¡å—ä¸Šçº¿</p><p>ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºå¼€å‘å¥½å¤„æ˜¯ä¸ç”¨è€ƒè™‘æµè§ˆå™¨çš„å…¼å®¹æ€§ä¹Ÿä¸ç”¨è€ƒè™‘å»åšä¸¤ä¸ª APPï¼Œä»¥åŠå„ç§å‹å·çš„æ‰‹æœºï¼Œä½†æ˜¯ä¸å¥½çš„åœ°æ–¹å°±æ˜¯æ‰€æœ‰çš„ç•Œé¢éƒ½åªèƒ½é è‡ªå·±å»å®ç°ï¼ŒåŸºæœ¬æ²¡æœ‰ç°æˆçš„ ui æ¡†æ¶ï¼Œæœ‰æ—¶å€™å†™çš„æœ‰ç‚¹è›‹ç–¼(PS æˆ‘æ˜¯ä¸€ä¸ªåç«¯)ã€‚ç„¶åå°±æ˜¯å®¡æ ¸ï¼Œå¾®ä¿¡çš„å®¡æ ¸ 0.1.0 ç‰ˆæœ¬ç”¨äº† 5 å¤©æ‰å®Œæˆï¼Œè¿™ä¸ªæ—¶é—´æˆ‘çš„ 0.2.0 ç‰ˆæœ¬å·²ç»åŸºæœ¬å¼€å‘å®Œæˆäº†</p><p>é¡¹ç›®å·²ç»å¼€æºï¼Œå¯ä»¥å…³æ³¨å¼€å‘è¿›åº¦æˆ–è€…æäº¤åé¦ˆæˆ–è€…æ˜¯ PRï¼Œstar å¤šå¤šç›Šå–„<br><a href="https://github.com/mohuishou/scuplus-wechat" target="_blank" rel="noopener">https://github.com/mohuishou/scuplus-wechat</a></p><h2 id="æ‰«ç ä½“éªŒ"><a href="#æ‰«ç ä½“éªŒ" class="headerlink" title="æ‰«ç ä½“éªŒ"></a>æ‰«ç ä½“éªŒ</h2><p><img src="https://scuplus.oss-cn-shenzhen.aliyuncs.com/qcode.jpg" srcset="/img/loading.gif" alt></p><h2 id="åŠŸèƒ½é¢„è§ˆ"><a href="#åŠŸèƒ½é¢„è§ˆ" class="headerlink" title="åŠŸèƒ½é¢„è§ˆ"></a>åŠŸèƒ½é¢„è§ˆ</h2><p>0.1.0 ç‰ˆæœ¬åªæ˜¯å®Œæˆäº†åŸºæœ¬çš„æ¡†æ¶ï¼Œä»¥åŠç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¸¸ç”¨çš„åŠŸèƒ½ï¼š</p><ul><li>æœ€æ–°èµ„è®¯ï¼ˆé’æ˜¥å·å¤§/scuinfo/æ•™åŠ¡å¤„/å­¦å·¥éƒ¨ç­‰ï¼‰</li><li>æˆç»©/GPA æŸ¥è¯¢</li><li>è¯¾è¡¨æŸ¥è¯¢</li></ul><h2 id="å›¾ç‰‡é¢„è§ˆ"><a href="#å›¾ç‰‡é¢„è§ˆ" class="headerlink" title="å›¾ç‰‡é¢„è§ˆ"></a>å›¾ç‰‡é¢„è§ˆ</h2><p><img src="https://user-images.githubusercontent.com/15172509/34929988-07a91c84-fa02-11e7-9a67-c2399232f820.png" srcset="/img/loading.gif" alt="index"><br><img src="https://user-images.githubusercontent.com/15172509/34929987-07640356-fa02-11e7-8197-6dbeb5ac1dc1.jpg" srcset="/img/loading.gif" alt="grade"><br><img src="https://user-images.githubusercontent.com/15172509/34929989-07e6f7fc-fa02-11e7-9143-b7d9737b432d.png" srcset="/img/loading.gif" alt="news"><br><img src="https://user-images.githubusercontent.com/15172509/34929990-08246a24-fa02-11e7-832c-fa3be2681ba9.png" srcset="/img/loading.gif" alt="newslist"><br><img src="https://user-images.githubusercontent.com/15172509/34929991-085ae856-fa02-11e7-9fba-3355071ea3b5.png" srcset="/img/loading.gif" alt="schedule"></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/62925.html">Weå·å¤§å¼€å‘ç¬”è®°@0.2.0</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>weå·å¤§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‹›é“¶ç½‘ç»œé¢è¯•æ€»ç»“</title>
    <link href="/post/1358.html"/>
    <url>/post/1358.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸‰é¢åŒæ—¶è¿›è¡Œï¼Œæ¯ä¸€é¢é—´éš”ä¸è¶…è¿‡äº”åˆ†é’Ÿï¼Œå‰é¢ä¸¤é¢æŠ€æœ¯é¢æœ€åä¸€é¢ HRï¼Œå®Œå…¨ä¸ä¼š JAVAï¼Œç»“æœä¸€ç›´é—® JAVA å¿ƒæ€çˆ†ç‚¸</p></blockquote><h2 id="ä¸€é¢-20min"><a href="#ä¸€é¢-20min" class="headerlink" title="ä¸€é¢(20min)"></a>ä¸€é¢(20min)</h2><h3 id="1-è‡ªæˆ‘ä»‹ç»"><a href="#1-è‡ªæˆ‘ä»‹ç»" class="headerlink" title="1. è‡ªæˆ‘ä»‹ç»"></a>1. è‡ªæˆ‘ä»‹ç»</h3><h3 id="2-JAVA-ç”¨è¿‡ä¹ˆï¼Ÿå‡†å¤‡å»ä»€ä¹ˆåœ°æ–¹ï¼Ÿ"><a href="#2-JAVA-ç”¨è¿‡ä¹ˆï¼Ÿå‡†å¤‡å»ä»€ä¹ˆåœ°æ–¹ï¼Ÿ" class="headerlink" title="2. JAVA ç”¨è¿‡ä¹ˆï¼Ÿå‡†å¤‡å»ä»€ä¹ˆåœ°æ–¹ï¼Ÿ"></a>2. JAVA ç”¨è¿‡ä¹ˆï¼Ÿå‡†å¤‡å»ä»€ä¹ˆåœ°æ–¹ï¼Ÿ</h3><p>ç”¨è¿‡ä¸€å¤©å†™äº†ä¸€ä¸ªå° APP</p><h3 id="3-JAVA-çš„-HashMap-æ€ä¹ˆå®ç°ï¼ŸPUT-ä¸€æ¬¡åšäº†ä»€ä¹ˆæ“ä½œ"><a href="#3-JAVA-çš„-HashMap-æ€ä¹ˆå®ç°ï¼ŸPUT-ä¸€æ¬¡åšäº†ä»€ä¹ˆæ“ä½œ" class="headerlink" title="3. JAVA çš„ HashMap æ€ä¹ˆå®ç°ï¼ŸPUT ä¸€æ¬¡åšäº†ä»€ä¹ˆæ“ä½œ"></a>3. JAVA çš„ HashMap æ€ä¹ˆå®ç°ï¼ŸPUT ä¸€æ¬¡åšäº†ä»€ä¹ˆæ“ä½œ</h3><p>ä¸ä¼š</p><h3 id="4-JAVA-çš„-GC-æ€ä¹ˆå®ç°"><a href="#4-JAVA-çš„-GC-æ€ä¹ˆå®ç°" class="headerlink" title="4. JAVA çš„ GC æ€ä¹ˆå®ç°"></a>4. JAVA çš„ GC æ€ä¹ˆå®ç°</h3><p>ä¸ä¼šï¼Œå¼ºè¡Œè¯´äº†ä¸€æ³¢ PHP çš„ GC</p><h3 id="5-Mysql-çš„é”"><a href="#5-Mysql-çš„é”" class="headerlink" title="5. Mysql çš„é”"></a>5. Mysql çš„é”</h3><p>Innodb æ”¯æŒåˆ°è¡Œçº§é”ï¼ŒMyISAM åªæ”¯æŒåˆ°è¡¨</p><h3 id="6-æ±‚ä¸€ä¸ªäºŒå‰æ ‘ä»»æ„ä¸¤èŠ‚ç‚¹çš„è·ç¦»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"><a href="#6-æ±‚ä¸€ä¸ªäºŒå‰æ ‘ä»»æ„ä¸¤èŠ‚ç‚¹çš„è·ç¦»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="6. æ±‚ä¸€ä¸ªäºŒå‰æ ‘ä»»æ„ä¸¤èŠ‚ç‚¹çš„è·ç¦»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"></a>6. æ±‚ä¸€ä¸ªäºŒå‰æ ‘ä»»æ„ä¸¤èŠ‚ç‚¹çš„è·ç¦»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</h3><h3 id="7-è®¾è®¡æ¨¡å¼äº†è§£ä¸ï¼Ÿè£…é¥°å™¨æ¨¡å¼è§£é‡Šä¸€ä¸‹ï¼Œå†™ä¸€ä¸ª"><a href="#7-è®¾è®¡æ¨¡å¼äº†è§£ä¸ï¼Ÿè£…é¥°å™¨æ¨¡å¼è§£é‡Šä¸€ä¸‹ï¼Œå†™ä¸€ä¸ª" class="headerlink" title="7. è®¾è®¡æ¨¡å¼äº†è§£ä¸ï¼Ÿè£…é¥°å™¨æ¨¡å¼è§£é‡Šä¸€ä¸‹ï¼Œå†™ä¸€ä¸ª"></a>7. è®¾è®¡æ¨¡å¼äº†è§£ä¸ï¼Ÿè£…é¥°å™¨æ¨¡å¼è§£é‡Šä¸€ä¸‹ï¼Œå†™ä¸€ä¸ª</h3><p>è§£é‡Šäº†ä¸€ä¸‹ï¼Œæ²¡æœ‰å†™ï¼Œåé¢è®©å†™äº†ä¸€ä¸ªå·¥å‚</p><blockquote><p>è¿˜æœ‰ä¸€äº›å¿˜äº†</p></blockquote><h2 id="äºŒé¢-15min"><a href="#äºŒé¢-15min" class="headerlink" title="äºŒé¢(15min)"></a>äºŒé¢(15min)</h2><h3 id="1-è‡ªæˆ‘ä»‹ç»-1"><a href="#1-è‡ªæˆ‘ä»‹ç»-1" class="headerlink" title="1. è‡ªæˆ‘ä»‹ç»"></a>1. è‡ªæˆ‘ä»‹ç»</h3><h3 id="2-JAVA-çš„-GC-æ€ä¹ˆå®ç°ã€‚ã€‚ã€‚åˆæ¥äº†"><a href="#2-JAVA-çš„-GC-æ€ä¹ˆå®ç°ã€‚ã€‚ã€‚åˆæ¥äº†" class="headerlink" title="2. JAVA çš„ GC æ€ä¹ˆå®ç°ã€‚ã€‚ã€‚åˆæ¥äº†"></a>2. JAVA çš„ GC æ€ä¹ˆå®ç°ã€‚ã€‚ã€‚åˆæ¥äº†</h3><h3 id="3-Mysql-å»é™¤é‡å¤é¡¹"><a href="#3-Mysql-å»é™¤é‡å¤é¡¹" class="headerlink" title="3. Mysql å»é™¤é‡å¤é¡¹"></a>3. Mysql å»é™¤é‡å¤é¡¹</h3><h3 id="4-Mysql-è§¦å‘å™¨æœºåˆ¶"><a href="#4-Mysql-è§¦å‘å™¨æœºåˆ¶" class="headerlink" title="4. Mysql è§¦å‘å™¨æœºåˆ¶"></a>4. Mysql è§¦å‘å™¨æœºåˆ¶</h3><h3 id="5-è®¾è®¡ä¸€ä¸ªæ— é™æåˆ†ç±»çš„æ•°æ®åº“è¡¨"><a href="#5-è®¾è®¡ä¸€ä¸ªæ— é™æåˆ†ç±»çš„æ•°æ®åº“è¡¨" class="headerlink" title="5. è®¾è®¡ä¸€ä¸ªæ— é™æåˆ†ç±»çš„æ•°æ®åº“è¡¨"></a>5. è®¾è®¡ä¸€ä¸ªæ— é™æåˆ†ç±»çš„æ•°æ®åº“è¡¨</h3><h3 id="6-æ€ä¹ˆæŠŠå»å¤„æ¥çš„æ•°æ®æ ‘å‹ç»“æ„åŒ–"><a href="#6-æ€ä¹ˆæŠŠå»å¤„æ¥çš„æ•°æ®æ ‘å‹ç»“æ„åŒ–" class="headerlink" title="6. æ€ä¹ˆæŠŠå»å¤„æ¥çš„æ•°æ®æ ‘å‹ç»“æ„åŒ–"></a>6. æ€ä¹ˆæŠŠå»å¤„æ¥çš„æ•°æ®æ ‘å‹ç»“æ„åŒ–</h3><h2 id="ä¸‰é¢-35min"><a href="#ä¸‰é¢-35min" class="headerlink" title="ä¸‰é¢(35min)"></a>ä¸‰é¢(35min)</h2><h3 id="1-æ‹¿äº†ä¸€æ³¢ç®€å†ï¼Œæˆç»©å•ï¼Œè‡ªæˆ‘ä»‹ç»"><a href="#1-æ‹¿äº†ä¸€æ³¢ç®€å†ï¼Œæˆç»©å•ï¼Œè‡ªæˆ‘ä»‹ç»" class="headerlink" title="1. æ‹¿äº†ä¸€æ³¢ç®€å†ï¼Œæˆç»©å•ï¼Œè‡ªæˆ‘ä»‹ç»"></a>1. æ‹¿äº†ä¸€æ³¢ç®€å†ï¼Œæˆç»©å•ï¼Œè‡ªæˆ‘ä»‹ç»</h3><h3 id="2-ä¸ºä»€ä¹ˆä¸æƒ³ç•™åœ¨æˆéƒ½"><a href="#2-ä¸ºä»€ä¹ˆä¸æƒ³ç•™åœ¨æˆéƒ½" class="headerlink" title="2. ä¸ºä»€ä¹ˆä¸æƒ³ç•™åœ¨æˆéƒ½"></a>2. ä¸ºä»€ä¹ˆä¸æƒ³ç•™åœ¨æˆéƒ½</h3><h3 id="3-æˆç»©å•ä¸Šå¾ˆå¤š-60-åˆ†ï¼Œé£˜è¿‡è¿˜æ˜¯é‡ä¿®"><a href="#3-æˆç»©å•ä¸Šå¾ˆå¤š-60-åˆ†ï¼Œé£˜è¿‡è¿˜æ˜¯é‡ä¿®" class="headerlink" title="3. æˆç»©å•ä¸Šå¾ˆå¤š 60 åˆ†ï¼Œé£˜è¿‡è¿˜æ˜¯é‡ä¿®"></a>3. æˆç»©å•ä¸Šå¾ˆå¤š 60 åˆ†ï¼Œé£˜è¿‡è¿˜æ˜¯é‡ä¿®</h3><p>é£˜è¿‡</p><h3 id="4-ç°åœ¨é¢è¯•äº†å“ªäº›å…¬å¸ï¼Œæœ‰æ²¡æœ‰æ”¶åˆ°-offer-æ„å‘"><a href="#4-ç°åœ¨é¢è¯•äº†å“ªäº›å…¬å¸ï¼Œæœ‰æ²¡æœ‰æ”¶åˆ°-offer-æ„å‘" class="headerlink" title="4. ç°åœ¨é¢è¯•äº†å“ªäº›å…¬å¸ï¼Œæœ‰æ²¡æœ‰æ”¶åˆ° offer æ„å‘"></a>4. ç°åœ¨é¢è¯•äº†å“ªäº›å…¬å¸ï¼Œæœ‰æ²¡æœ‰æ”¶åˆ° offer æ„å‘</h3><h3 id="5-ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®"><a href="#5-ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="5. ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®"></a>5. ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®</h3><h3 id="6-ä»‹ç»äº†ç¤¾å›¢ç ”å‘éƒ¨éƒ¨é•¿å’Œå­¦é™¢å›¢å‰¯ç»å†"><a href="#6-ä»‹ç»äº†ç¤¾å›¢ç ”å‘éƒ¨éƒ¨é•¿å’Œå­¦é™¢å›¢å‰¯ç»å†" class="headerlink" title="6. ä»‹ç»äº†ç¤¾å›¢ç ”å‘éƒ¨éƒ¨é•¿å’Œå­¦é™¢å›¢å‰¯ç»å†"></a>6. ä»‹ç»äº†ç¤¾å›¢ç ”å‘éƒ¨éƒ¨é•¿å’Œå­¦é™¢å›¢å‰¯ç»å†</h3><blockquote><p>è¿˜æœ‰ä¸€äº›è®°ä¸ä½äº†</p></blockquote><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/56757.html">ç™¾åº¦é¢è¯•æ€»ç»“</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
      <tag>ç§‹æ‹›</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shellæ’åº</title>
    <link href="/post/27243.html"/>
    <url>/post/27243.html</url>
    
    <content type="html"><![CDATA[<h1 id="Shell-æ’åº"><a href="#Shell-æ’åº" class="headerlink" title="Shell æ’åº"></a>Shell æ’åº</h1><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å¸Œå°”æ’åºé€šè¿‡å°†æ¯”è¾ƒçš„å…¨éƒ¨å…ƒç´ åˆ†ä¸ºå‡ ä¸ªåŒºåŸŸæ¥æå‡æ’å…¥æ’åºçš„æ€§èƒ½ã€‚è¿™æ ·å¯ä»¥è®©ä¸€ä¸ªå…ƒç´ å¯ä»¥ä¸€æ¬¡æ€§åœ°æœæœ€ç»ˆä½ç½®å‰è¿›ä¸€å¤§æ­¥ã€‚ç„¶åç®—æ³•å†å–è¶Šæ¥è¶Šå°çš„æ­¥é•¿è¿›è¡Œæ’åºï¼Œç®—æ³•çš„æœ€åä¸€æ­¥å°±æ˜¯æ™®é€šçš„æ’å…¥æ’åºï¼Œä½†æ˜¯åˆ°äº†è¿™æ­¥ï¼Œéœ€æ’åºçš„æ•°æ®å‡ ä¹æ˜¯å·²æ’å¥½çš„äº†ï¼ˆæ­¤æ—¶æ’å…¥æ’åºè¾ƒå¿«ï¼‰ã€‚</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ol><li>è®¾ç½®é—´éš”ï¼ˆä¼ ç»Ÿé—´éš”ä¸º N/2ï¼‰</li><li>æ’å…¥æ’åº</li></ol><h2 id="å›¾ç‰‡ç¤ºä¾‹"><a href="#å›¾ç‰‡ç¤ºä¾‹" class="headerlink" title="å›¾ç‰‡ç¤ºä¾‹"></a>å›¾ç‰‡ç¤ºä¾‹</h2><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142753.gif" srcset="/img/loading.gif" alt></p><h2 id="ç¨‹åºç¤ºä¾‹"><a href="#ç¨‹åºç¤ºä¾‹" class="headerlink" title="ç¨‹åºç¤ºä¾‹"></a>ç¨‹åºç¤ºä¾‹</h2><h3 id="ä¼ ç»Ÿå®ç°"><a href="#ä¼ ç»Ÿå®ç°" class="headerlink" title="ä¼ ç»Ÿå®ç°"></a>ä¼ ç»Ÿå®ç°</h3><pre><code class="hljs go"><span class="hljs-comment">//SortInt ä¼ ç»Ÿshellæ’åº,é—´éš”ä¸ºN/2</span><span class="hljs-comment">//ç›¸é‚»é—´éš”å¯èƒ½ä¸äº’è´¨ï¼Œå¯èƒ½ä¼šå‡ºç°å‰ç½®æ’åºæ— ç”¨çš„æƒ…å†µ</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SortInt</span><span class="hljs-params">(a []<span class="hljs-keyword">int</span>)</span> <span class="hljs-params">([]<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>)</span></span> &#123;n := <span class="hljs-number">0</span>aLen := <span class="hljs-built_in">len</span>(a)<span class="hljs-comment">//å®šä¹‰é—´éš”</span><span class="hljs-keyword">for</span> i := aLen / <span class="hljs-number">2</span>; i &gt; <span class="hljs-number">0</span>; i = i / <span class="hljs-number">2</span> &#123;<span class="hljs-comment">//æ’å…¥æ’åº</span><span class="hljs-keyword">for</span> j := i; j &lt; aLen; j++ &#123;tmp := a[j]k := j<span class="hljs-keyword">for</span> ; k &gt;= i &amp;&amp; tmp &lt; a[k-i]; k = k - i &#123;a[k] = a[k-i]n++&#125;a[k] = tmp&#125;&#125;<span class="hljs-keyword">return</span> a, n&#125;</code></pre><h3 id="Hibbard-ç®—æ³•"><a href="#Hibbard-ç®—æ³•" class="headerlink" title="Hibbard ç®—æ³•"></a>Hibbard ç®—æ³•</h3><pre><code class="hljs go"><span class="hljs-comment">//SortHibbardInt Hibbardç®—æ³•ï¼Œé—´éš”ä¸º2^k-1</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SortHibbardInt</span><span class="hljs-params">(a []<span class="hljs-keyword">int</span>)</span> <span class="hljs-params">([]<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>)</span></span> &#123;n, i := <span class="hljs-number">0</span>, <span class="hljs-number">0</span>aLen := <span class="hljs-built_in">len</span>(a)<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>; i &lt;= aLen<span class="hljs-number">-1</span>; i = i*<span class="hljs-number">2</span> + <span class="hljs-number">1</span> &#123;&#125;<span class="hljs-comment">//å®šä¹‰é—´éš”</span><span class="hljs-keyword">for</span> ; i &gt; <span class="hljs-number">0</span>; i = (i - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span> &#123;<span class="hljs-comment">// println(i)</span><span class="hljs-comment">//æ’å…¥æ’åº</span><span class="hljs-keyword">for</span> j := i; j &lt; aLen; j++ &#123;tmp := a[j]k := j<span class="hljs-keyword">for</span> ; k &gt;= i &amp;&amp; tmp &lt; a[k-i]; k = k - i &#123;a[k] = a[k-i]n++&#125;a[k] = tmp&#125;&#125;<span class="hljs-keyword">return</span> a, n&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ’åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€‰æ‹©æ’åº</title>
    <link href="/post/51203.html"/>
    <url>/post/51203.html</url>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://github.com/mohuishou/go-sort" target="_blank" rel="noopener">https://github.com/mohuishou/go-sort</a></p></blockquote><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>é€‰æ‹©æ’åº(Selection sort)æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†å¦‚ä¸‹ã€‚é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°å…ƒç´ ï¼Œç„¶åæ”¾åˆ°æ’åºåºåˆ—æœ«å°¾ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141643.gif" srcset="/img/loading.gif" alt="ç¤ºä¾‹å›¾ç‰‡"></p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><pre><code class="hljs go"><span class="hljs-keyword">package</span> selection<span class="hljs-comment">//Sort é€‰æ‹©æ’åº</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Sort</span><span class="hljs-params">(arr []<span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">var</span> LEN = <span class="hljs-built_in">len</span>(arr)minIndex := <span class="hljs-number">0</span><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; LEN; i++ &#123;minIndex = i<span class="hljs-keyword">for</span> j := i; j &lt; LEN; j++ &#123;<span class="hljs-keyword">if</span> arr[minIndex] &gt; arr[j] &#123;minIndex = j&#125;&#125;<span class="hljs-keyword">if</span> minIndex != i &#123;arr[minIndex], arr[i] = arr[i], arr[minIndex]&#125;&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ’åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ’å…¥æ’åº</title>
    <link href="/post/50190.html"/>
    <url>/post/50190.html</url>
    
    <content type="html"><![CDATA[<h1 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h1><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æ’å…¥æ’åºçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ol><li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åº</li><li>å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æ</li><li>å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®</li><li>é‡å¤æ­¥éª¤ 3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®</li><li>å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®å</li><li>é‡å¤æ­¥éª¤ 2~5</li></ol><h2 id="å›¾ç‰‡ç¤ºä¾‹"><a href="#å›¾ç‰‡ç¤ºä¾‹" class="headerlink" title="å›¾ç‰‡ç¤ºä¾‹"></a>å›¾ç‰‡ç¤ºä¾‹</h2><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141645.gif" srcset="/img/loading.gif" alt></p><h2 id="ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰"><a href="#ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰" class="headerlink" title="ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰"></a>ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰</h2><pre><code class="hljs go"><span class="hljs-comment">//SortInt æ’å…¥æ’åº</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SortInt</span><span class="hljs-params">(a []<span class="hljs-keyword">int</span>)</span> <span class="hljs-params">([]<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>)</span></span> &#123;n := <span class="hljs-number">0</span>aLen := <span class="hljs-built_in">len</span>(a)<span class="hljs-comment">//ä»i=1å¼€å§‹ï¼Œç¬¬ä¸€ä¸ªæ•°ä¸ç”¨æ’åºï¼Œä¸€ä¸ªæ•°ç›¸å½“äºå·²ç»æœ‰åºäº†</span><span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt; aLen; i++ &#123;<span class="hljs-comment">//å–å‡ºæ–°æ•°ï¼ˆç±»ä¼¼æ‘¸ç‰Œï¼‰</span>tmp := a[i]<span class="hljs-comment">//å°†æ–°æ•°å’Œä¹‹å‰çš„æ•°ä»åå¾€å‰ï¼ˆä»å¤§åˆ°å°ï¼‰ä¸€æ¬¡æ¯”è¾ƒï¼Œå¦‚æœæ–°æ•°æ›´å°,å°±å°†ä»¥å‰çš„æ•°å¾€åç§»ä¸€ä½</span>j := i<span class="hljs-keyword">for</span> ; (j &gt; <span class="hljs-number">0</span>) &amp;&amp; (tmp &lt; a[j<span class="hljs-number">-1</span>]); j-- &#123;n++a[j] = a[j<span class="hljs-number">-1</span>] <span class="hljs-comment">//åç§»ä¸€ä½</span>&#125;<span class="hljs-comment">//æ–°æ•°æ’å…¥</span>a[j] = tmp&#125;<span class="hljs-keyword">return</span> a, n&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ’åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¿«é€Ÿæ’åº</title>
    <link href="/post/11306.html"/>
    <url>/post/11306.html</url>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://github.com/mohuishou/go-sort" target="_blank" rel="noopener">https://github.com/mohuishou/go-sort</a></p></blockquote><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å¿«é€Ÿæ’åºæ˜¯ç”±ä¸œå°¼Â·éœå°”æ‰€å‘å±•çš„ä¸€ç§æ’åºç®—æ³•ã€‚åœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åº n ä¸ªé¡¹ç›®è¦ ÎŸ(n log n)æ¬¡æ¯”è¾ƒã€‚åœ¨æœ€åçŠ¶å†µä¸‹åˆ™éœ€è¦ ÎŸ(n2)æ¬¡æ¯”è¾ƒï¼Œä½†è¿™ç§çŠ¶å†µå¹¶ä¸å¸¸è§ã€‚äº‹å®ä¸Šï¼Œå¿«é€Ÿæ’åºé€šå¸¸æ˜æ˜¾æ¯”å…¶ä»– ÎŸ(n log n) ç®—æ³•æ›´å¿«ï¼Œå› ä¸ºå®ƒçš„å†…éƒ¨å¾ªç¯ï¼ˆinner loopï¼‰å¯ä»¥åœ¨å¤§éƒ¨åˆ†çš„æ¶æ„ä¸Šå¾ˆæœ‰æ•ˆç‡åœ°è¢«å®ç°å‡ºæ¥ï¼Œä¸”åœ¨å¤§éƒ¨åˆ†çœŸå®ä¸–ç•Œçš„æ•°æ®ï¼Œå¯ä»¥å†³å®šè®¾è®¡çš„é€‰æ‹©ï¼Œå‡å°‘æ‰€éœ€æ—¶é—´çš„äºŒæ¬¡æ–¹é¡¹ä¹‹å¯èƒ½æ€§ã€‚</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ul><li>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰ï¼Œ</li><li>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œã€‚</li><li>é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚</li></ul><p><em>æ³¨æ„: åŸºå‡†ç‚¹é‡‡ç”¨ä¸‰å…ƒç´ åŸåˆ™æ³•ï¼Œä¸‰å…ƒç´ é€‰æ‹©ä¹‹åä¸€å¤´ä¸€å°¾å°±å·²ç»æœ‰åºäº†</em></p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141632.gif" srcset="/img/loading.gif" alt="ç¤ºä¾‹å›¾ç‰‡"></p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><pre><code class="hljs go"><span class="hljs-keyword">package</span> quik<span class="hljs-comment">//Sort å¿«é€Ÿæ’åº</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Sort</span><span class="hljs-params">(arr []<span class="hljs-keyword">int</span>)</span></span> &#123;Quik(arr, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(arr)<span class="hljs-number">-1</span>)&#125;<span class="hljs-comment">//Quik å¿«é€Ÿæ’åºé€’å½’å®ç°</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Quik</span><span class="hljs-params">(arr []<span class="hljs-keyword">int</span>, left <span class="hljs-keyword">int</span>, right <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">if</span> right-left &lt; <span class="hljs-number">2</span> &#123;<span class="hljs-keyword">return</span>&#125;p := middle3(arr, left, right)i := left + <span class="hljs-number">1</span>j := right - <span class="hljs-number">2</span><span class="hljs-keyword">for</span> &#123;<span class="hljs-keyword">for</span> arr[i] &lt; p &#123;i++&#125;<span class="hljs-keyword">for</span> arr[j] &gt; p &#123;j--&#125;<span class="hljs-keyword">if</span> i &lt; j &#123;arr[i], arr[j] = arr[j], arr[i]&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">break</span>&#125;&#125;arr[i], arr[right<span class="hljs-number">-1</span>] = arr[right<span class="hljs-number">-1</span>], arr[i]Quik(arr, left, i<span class="hljs-number">-1</span>)Quik(arr, i+<span class="hljs-number">1</span>, right)&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">middle3</span><span class="hljs-params">(arr []<span class="hljs-keyword">int</span>, left <span class="hljs-keyword">int</span>, right <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;center := (right + left) / <span class="hljs-number">2</span><span class="hljs-keyword">if</span> arr[left] &gt; arr[center] &#123;arr[left], arr[center] = arr[center], arr[left]&#125;<span class="hljs-keyword">if</span> arr[left] &gt; arr[right] &#123;arr[left], arr[right] = arr[right], arr[left]&#125;<span class="hljs-keyword">if</span> arr[center] &gt; arr[right] &#123;arr[center], arr[right] = arr[right], arr[center]&#125;arr[center], arr[right<span class="hljs-number">-1</span>] = arr[right<span class="hljs-number">-1</span>], arr[center]<span class="hljs-keyword">return</span> arr[right<span class="hljs-number">-1</span>]&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ’åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å½’å¹¶æ’åº</title>
    <link href="/post/63711.html"/>
    <url>/post/63711.html</url>
    
    <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å½’å¹¶æ’åº:æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ul><li>ç”³è¯·ç©ºé—´ï¼Œä½¿å…¶å¤§å°ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—ä¹‹å’Œï¼Œè¯¥ç©ºé—´ç”¨æ¥å­˜æ”¾åˆå¹¶åçš„åºåˆ—</li><li>è®¾å®šä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€åˆä½ç½®åˆ†åˆ«ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®</li><li>æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œé€‰æ‹©ç›¸å¯¹å°çš„å…ƒç´ æ”¾å…¥åˆ°åˆå¹¶ç©ºé—´ï¼Œå¹¶ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä½ç½®</li><li>é‡å¤æ­¥éª¤ 3 ç›´åˆ°æŸä¸€æŒ‡é’ˆè¾¾åˆ°åºåˆ—å°¾</li><li>å°†å¦ä¸€åºåˆ—å‰©ä¸‹çš„æ‰€æœ‰å…ƒç´ ç›´æ¥å¤åˆ¶åˆ°åˆå¹¶åºåˆ—å°¾</li></ul><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141633.gif" srcset="/img/loading.gif" alt="ç¤ºä¾‹å›¾ç‰‡"></p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><pre><code class="hljs go"><span class="hljs-keyword">package</span> merge<span class="hljs-comment">//INFINITY ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ç”¨ä½œå“¨å…µ</span><span class="hljs-keyword">const</span> INFINITY = <span class="hljs-number">0xffff</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">merge</span><span class="hljs-params">(arr []<span class="hljs-keyword">int</span>, start, end <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-keyword">if</span> start &lt; end &#123;<span class="hljs-comment">//ä»ä¸­é—´åˆ’åˆ†ï¼Œåˆ†åˆ«å·¦å³ä¸¤è¾¹æ’åº</span>mid := (end + start) / <span class="hljs-number">2</span>merge(arr, start, mid)merge(arr, mid+<span class="hljs-number">1</span>, end)<span class="hljs-comment">//ä¸‹é¢è¿›è¡Œå½’å¹¶æ“ä½œï¼Œå°†ä¸¤ä¸ªé•¿åº¦è¾ƒå°ä½†æ˜¯å·²ç»æ’åºå®Œæˆçš„æ•°ç»„åˆå¹¶æˆä¸€ä¸ªè¾ƒé•¿é•¿åº¦çš„æ’åºæ•°ç»„</span><span class="hljs-comment">//æ–°å»ºä¸€ä¸ªæ•°ç»„ç”¨äºå­˜æ”¾å·¦è¾¹çš„å€¼</span>arr1 := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, mid-start+<span class="hljs-number">2</span>)<span class="hljs-built_in">copy</span>(arr1, arr[start:mid+<span class="hljs-number">1</span>])arr1[mid-start+<span class="hljs-number">1</span>] = INFINITY<span class="hljs-comment">//æ–°å»ºä¸€ä¸ªæ•°ç»„ç”¨äºå­˜æ”¾å³è¾¹çš„å€¼</span>arr2 := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, end-mid+<span class="hljs-number">1</span>)<span class="hljs-built_in">copy</span>(arr2, arr[mid+<span class="hljs-number">1</span>:end+<span class="hljs-number">1</span>])arr2[end-mid] = INFINITY<span class="hljs-comment">//æ¯”è¾ƒå¤§å°</span>j, k := <span class="hljs-number">0</span>, <span class="hljs-number">0</span><span class="hljs-keyword">for</span> i := start; i &lt;= end; i++ &#123;<span class="hljs-keyword">if</span> arr1[j] &lt;= arr2[k] &#123;arr[i] = arr1[j]j++&#125; <span class="hljs-keyword">else</span> &#123;arr[i] = arr2[k]k++&#125;&#125;&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ’åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å †æ’åº</title>
    <link href="/post/46698.html"/>
    <url>/post/46698.html</url>
    
    <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å †ç§¯æ’åºï¼š æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ul><li>å»ºå †ï¼Œå»ºå †æ˜¯ä¸æ–­è°ƒæ•´å †çš„è¿‡ç¨‹ï¼Œä» len/2 å¤„å¼€å§‹è°ƒæ•´ï¼Œä¸€ç›´åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ­¤å¤„ len æ˜¯å †ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚å»ºå †çš„è¿‡ç¨‹æ˜¯çº¿æ€§çš„è¿‡ç¨‹ï¼Œä» len/2 åˆ° 0 å¤„ä¸€ç›´è°ƒç”¨è°ƒæ•´å †çš„è¿‡ç¨‹ï¼Œç›¸å½“äº o(h1)+o(h2)â€¦+o(hlen/2) å…¶ä¸­ h è¡¨ç¤ºèŠ‚ç‚¹çš„æ·±åº¦ï¼Œlen/2 è¡¨ç¤ºèŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ±‚å’Œçš„è¿‡ç¨‹ï¼Œç»“æœæ˜¯çº¿æ€§çš„ O(n)ã€‚</li><li>è°ƒæ•´å †ï¼šè°ƒæ•´å †åœ¨æ„å»ºå †çš„è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°ï¼Œè€Œä¸”åœ¨å †æ’åºè¿‡ç¨‹ä¸­ä¹Ÿä¼šç”¨åˆ°ã€‚åˆ©ç”¨çš„æ€æƒ³æ˜¯æ¯”è¾ƒèŠ‚ç‚¹ i å’Œå®ƒçš„å­©å­èŠ‚ç‚¹ left(i),right(i)ï¼Œé€‰å‡ºä¸‰è€…æœ€å¤§(æˆ–è€…æœ€å°)è€…ï¼Œå¦‚æœæœ€å¤§ï¼ˆå°ï¼‰å€¼ä¸æ˜¯èŠ‚ç‚¹ i è€Œæ˜¯å®ƒçš„ä¸€ä¸ªå­©å­èŠ‚ç‚¹ï¼Œé‚£è¾¹äº¤äº’èŠ‚ç‚¹ i å’Œè¯¥èŠ‚ç‚¹ï¼Œç„¶åå†è°ƒç”¨è°ƒæ•´å †è¿‡ç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚è°ƒæ•´å †çš„è¿‡ç¨‹æ—¶é—´å¤æ‚åº¦ä¸å †çš„æ·±åº¦æœ‰å…³ç³»ï¼Œæ˜¯ lgn çš„æ“ä½œï¼Œå› ä¸ºæ˜¯æ²¿ç€æ·±åº¦æ–¹å‘è¿›è¡Œè°ƒæ•´çš„ã€‚</li><li>å †æ’åºï¼šå †æ’åºæ˜¯åˆ©ç”¨ä¸Šé¢çš„ä¸¤ä¸ªè¿‡ç¨‹æ¥è¿›è¡Œçš„ã€‚é¦–å…ˆæ˜¯æ ¹æ®å…ƒç´ æ„å»ºå †ã€‚ç„¶åå°†å †çš„æ ¹èŠ‚ç‚¹å–å‡º(ä¸€èˆ¬æ˜¯ä¸æœ€åä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œäº¤æ¢)ï¼Œå°†å‰é¢ len-1 ä¸ªèŠ‚ç‚¹ç»§ç»­è¿›è¡Œå †è°ƒæ•´çš„è¿‡ç¨‹ï¼Œç„¶åå†å°†æ ¹èŠ‚ç‚¹å–å‡ºï¼Œè¿™æ ·ä¸€ç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½å–å‡ºã€‚å †æ’åºè¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlgn)ã€‚å› ä¸ºå»ºå †çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼ˆè°ƒç”¨ä¸€æ¬¡ï¼‰ï¼›è°ƒæ•´å †çš„æ—¶é—´å¤æ‚åº¦æ˜¯ lgnï¼Œè°ƒç”¨äº† n-1 æ¬¡ï¼Œæ‰€ä»¥å †æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlgn)[2]</li></ul><p><em>æ³¨æ„: æ ¹èŠ‚ç‚¹åœ¨æ•°ç»„å½“ä¸­å­˜æ”¾çš„ä½ç½®æ˜¯ 0ï¼Œæ‰€ä»¥ç¬¬ i ä¸ªèŠ‚ç‚¹çš„å·¦å­©å­æ˜¯ 2i+1,å³å­©å­æ˜¯ 2i+2</em></p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141622.gif" srcset="/img/loading.gif" alt="ç¤ºä¾‹å›¾ç‰‡"></p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><pre><code class="hljs go"><span class="hljs-keyword">package</span> HeapSort<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span>)<span class="hljs-comment">//HeapSort å †æ’åº</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HeapSort</span><span class="hljs-params">(arr []<span class="hljs-keyword">int</span>)</span></span> &#123;LEN := <span class="hljs-built_in">len</span>(arr)<span class="hljs-keyword">for</span> i := LEN/<span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- &#123;HeapAjust(arr, i, LEN)&#125;<span class="hljs-keyword">for</span> i := LEN - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i-- &#123;arr[i], arr[<span class="hljs-number">0</span>] = arr[<span class="hljs-number">0</span>], arr[i]HeapAjust(arr, <span class="hljs-number">0</span>, i)&#125;&#125;<span class="hljs-comment">//HeapAjust å †è°ƒæ•´</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HeapAjust</span><span class="hljs-params">(arr []<span class="hljs-keyword">int</span>, start <span class="hljs-keyword">int</span>, length <span class="hljs-keyword">int</span>)</span></span> &#123;tmp := arr[start]<span class="hljs-keyword">for</span> i := <span class="hljs-number">2</span>*start + <span class="hljs-number">1</span>; i &lt; length; i = i * <span class="hljs-number">2</span> &#123;<span class="hljs-keyword">if</span> i+<span class="hljs-number">1</span> &lt; length &amp;&amp; arr[i] &lt; arr[i+<span class="hljs-number">1</span>] &#123;i++&#125;<span class="hljs-keyword">if</span> tmp &gt; arr[i] &#123;<span class="hljs-keyword">break</span>&#125;arr[start] = arr[i]start = i&#125;arr[start] = tmp&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ’åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç™¾åº¦é¢è¯•æ€»ç»“</title>
    <link href="/post/56757.html"/>
    <url>/post/56757.html</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€é¢-40min"><a href="#ä¸€é¢-40min" class="headerlink" title="ä¸€é¢(40min)"></a>ä¸€é¢(40min)</h2><h3 id="0-è‡ªæˆ‘ä»‹ç»"><a href="#0-è‡ªæˆ‘ä»‹ç»" class="headerlink" title="0. è‡ªæˆ‘ä»‹ç»"></a>0. è‡ªæˆ‘ä»‹ç»</h3><h3 id="1-ä»‹ç»-ImageOCR-çš„é¡¹ç›®"><a href="#1-ä»‹ç»-ImageOCR-çš„é¡¹ç›®" class="headerlink" title="1. ä»‹ç» ImageOCR çš„é¡¹ç›®"></a>1. ä»‹ç» ImageOCR çš„é¡¹ç›®</h3><h3 id="2-çŸ¥é“æœ‰å“ªäº›æ’åºç®—æ³•ï¼Ÿ"><a href="#2-çŸ¥é“æœ‰å“ªäº›æ’åºç®—æ³•ï¼Ÿ" class="headerlink" title="2. çŸ¥é“æœ‰å“ªäº›æ’åºç®—æ³•ï¼Ÿ"></a>2. çŸ¥é“æœ‰å“ªäº›æ’åºç®—æ³•ï¼Ÿ</h3><p>å†’æ³¡ã€æ’å…¥ã€shellã€å½’å¹¶ã€å¿«æ’ã€å †æ’åºã€é€‰æ‹©æ’åºç­‰ç­‰</p><blockquote><p>æœ‰æ²¡æœ‰ä¸ä¼šå†™çš„ï¼Œæ’é›·æ’æ‰äº†å †æ’åº</p></blockquote><h3 id="3-æ‰‹å†™æ’å…¥æ’åºå¹¶è§£é‡Š"><a href="#3-æ‰‹å†™æ’å…¥æ’åºå¹¶è§£é‡Š" class="headerlink" title="3. æ‰‹å†™æ’å…¥æ’åºå¹¶è§£é‡Š"></a>3. æ‰‹å†™æ’å…¥æ’åºå¹¶è§£é‡Š</h3><h3 id="4-ä¸Šé¢çš„æ’åºç®—æ³•å“ªäº›æ˜¯ç¨³å®šçš„ï¼Œå“ªäº›æ˜¯ä¸ç¨³å®šçš„"><a href="#4-ä¸Šé¢çš„æ’åºç®—æ³•å“ªäº›æ˜¯ç¨³å®šçš„ï¼Œå“ªäº›æ˜¯ä¸ç¨³å®šçš„" class="headerlink" title="4. ä¸Šé¢çš„æ’åºç®—æ³•å“ªäº›æ˜¯ç¨³å®šçš„ï¼Œå“ªäº›æ˜¯ä¸ç¨³å®šçš„"></a>4. ä¸Šé¢çš„æ’åºç®—æ³•å“ªäº›æ˜¯ç¨³å®šçš„ï¼Œå“ªäº›æ˜¯ä¸ç¨³å®šçš„</h3><h3 id="è¿˜æœ‰ä¸€äº›å¿˜äº†"><a href="#è¿˜æœ‰ä¸€äº›å¿˜äº†" class="headerlink" title="è¿˜æœ‰ä¸€äº›å¿˜äº†"></a>è¿˜æœ‰ä¸€äº›å¿˜äº†</h3><h2 id="äºŒé¢-1-2h"><a href="#äºŒé¢-1-2h" class="headerlink" title="äºŒé¢(1.2h)"></a>äºŒé¢(1.2h)</h2><h3 id="0-ä»‹ç»ç®€å†ä¸Šçš„å¦å¤–ä¸€ä¸ªé¡¹ç›®"><a href="#0-ä»‹ç»ç®€å†ä¸Šçš„å¦å¤–ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="0. ä»‹ç»ç®€å†ä¸Šçš„å¦å¤–ä¸€ä¸ªé¡¹ç›®"></a>0. ä»‹ç»ç®€å†ä¸Šçš„å¦å¤–ä¸€ä¸ªé¡¹ç›®</h3><h3 id="1-PHP-çš„åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠåŸºæœ¬æ•°æ®ç±»å‹å†…æ ¸å¦‚ä½•å®ç°"><a href="#1-PHP-çš„åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠåŸºæœ¬æ•°æ®ç±»å‹å†…æ ¸å¦‚ä½•å®ç°" class="headerlink" title="1. PHP çš„åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠåŸºæœ¬æ•°æ®ç±»å‹å†…æ ¸å¦‚ä½•å®ç°?"></a>1. PHP çš„åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠåŸºæœ¬æ•°æ®ç±»å‹å†…æ ¸å¦‚ä½•å®ç°?</h3><p><strong>åŸºæœ¬æ•°æ®ç±»å‹</strong></p><pre><code class="hljs undefined"><span class="hljs-built_in">boolean</span>(å¸ƒå°”å‹)å¸ƒå°”å‹æ˜¯æœ€ç®€å•çš„æ•°æ®ç±»å‹ï¼Œåªæœ‰ä¸¤ä¸ªå€¼ <span class="hljs-literal">false</span>(å‡) å’Œ<span class="hljs-literal">true</span>(çœŸ)<span class="hljs-built_in">string</span>(å­—ç¬¦ä¸²å‹)å­—ç¬¦ä¸²å°±æ˜¯è¿ç»­çš„å­—ç¬¦åºåˆ—ï¼Œå¦‚ ehco <span class="hljs-string">"string"</span>;<span class="hljs-built_in">integer</span>(æ•´å‹)    æ•´å‹æ•°æ®ç±»å‹åªèƒ½åŒ…å«æ•´æ•°ï¼Œè¿™äº›æ•°æ®ç±»å‹å¯ä»¥æ˜¯è´Ÿæ•°æˆ–è€…æ­£æ•°folat(æµ®ç‚¹å‹)æµ®ç‚¹å‹ç±»å‹ç”¨äºå­˜å‚¨æ•°å­—ï¼Œå’Œæ•´å‹ä¸åŒçš„æ˜¯æµ®ç‚¹å‹å¯ä»¥æœ‰å°æ•°ç‚¹<span class="hljs-built_in">array</span>ï¼ˆæ•°ç»„ï¼‰ä¸€ç»„ç›¸åŒç±»å‹çš„é›†åˆobjectï¼ˆå¯¹è±¡ï¼‰å¯¹è±¡æ˜¯ä¸€ä¸ªå®åŠ›ï¼Œä½¿ç”¨<span class="hljs-literal">new</span>å‘½ä»¤åˆ›å»ºä¸€ä¸ªå¯¹è±¡resourceï¼ˆèµ„æºï¼‰èµ„æºæ˜¯ä¸€ç§ç‰¹æ®Šçš„å˜é‡ï¼Œä¿å­˜åœ¨å¤–éƒ¨èµ„æºçš„ä¸€ä¸ªåº”ç”¨ï¼Œèµ„æºæ˜¯é€šè¿‡å‡½æ•°æ¥è¿›è¡Œå»ºç«‹çš„<span class="hljs-built_in">null</span>ï¼ˆ ç©ºç™½ï¼‰ç‰¹æ®Šçš„å€¼ï¼Œè¡¨ç¤ºå˜é‡æ²¡æœ‰å€¼ï¼Œä»»ä½•å˜é‡çš„åˆå§‹å€¼éƒ½æ˜¯<span class="hljs-built_in">null</span></code></pre><p><strong>å˜é‡çš„åœ¨å†…æ ¸å½“ä¸­çš„ä¿å­˜æ–¹å¼ï¼š</strong></p><ul><li>php5.3: <a href="http://blog.csdn.net/qq_28602957/article/details/52959132" target="_blank" rel="noopener">http://blog.csdn.net/qq_28602957/article/details/52959132</a></li></ul><pre><code class="hljs C"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">union</span> _zvalue_value &#123;    <span class="hljs-keyword">long</span> lval;                  <span class="hljs-comment">/* long value */</span>    <span class="hljs-keyword">double</span> dval;                <span class="hljs-comment">/* double value */</span>    <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span>        <span class="hljs-keyword">char</span> *val;        <span class="hljs-keyword">int</span> len;    &#125; str;    HashTable *ht;              <span class="hljs-comment">/* hash table value */</span>    zend_object_value obj;    zend_ast *ast;&#125; zvalue_value;<span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">zval_struct</span> &#123;</span>    <span class="hljs-comment">/* Variable information */</span>    zvalue_value value;     <span class="hljs-comment">/* value */</span>    zend_uint refcount__gc;    zend_uchar type;    <span class="hljs-comment">/* active type */</span>    zend_uchar is_ref__gc;&#125;;</code></pre><table><thead><tr><th style="text-align:center">PHP è¯­è¨€å±‚ç±»å‹</th><th style="text-align:center">å­˜åœ¨ zvalue_value çš„æˆå‘˜å˜é‡</th></tr></thead><tbody><tr><td style="text-align:center">long,bool,resoure</td><td style="text-align:center">lval</td></tr><tr><td style="text-align:center">double</td><td style="text-align:center">dval</td></tr><tr><td style="text-align:center">string</td><td style="text-align:center">str(len ä¿å­˜å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œval ä¿å­˜å­—ç¬¦ä¸²çš„å€¼)</td></tr><tr><td style="text-align:center">array</td><td style="text-align:center">htï¼ˆå“ˆå¸Œè¡¨ï¼‰</td></tr><tr><td style="text-align:center">object</td><td style="text-align:center">obj</td></tr></tbody></table><ul><li>php7: <a href="https://yq.aliyun.com/articles/27359" target="_blank" rel="noopener">https://yq.aliyun.com/articles/27359</a></li></ul><pre><code class="hljs C"><span class="hljs-comment">//å­˜å‚¨å˜é‡çš„ç»“æ„</span><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">zval_struct</span> &#123;</span>    zend_value        value;            <span class="hljs-comment">/* value */</span>    <span class="hljs-keyword">union</span> &#123;        <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span>            ZEND_ENDIAN_LOHI_4(                zend_uchar    type,         <span class="hljs-comment">/* active type */</span>                zend_uchar    type_flags,                zend_uchar    const_flags,                zend_uchar    reserved)     <span class="hljs-comment">/* call info for EX(This) */</span>        &#125; v;        <span class="hljs-keyword">uint32_t</span> type_info;    &#125; u1;    <span class="hljs-keyword">union</span> &#123;        <span class="hljs-keyword">uint32_t</span>     var_flags;        <span class="hljs-keyword">uint32_t</span>     next;                 <span class="hljs-comment">/* hash collision chain */</span>        <span class="hljs-keyword">uint32_t</span>     cache_slot;           <span class="hljs-comment">/* literal cache slot */</span>        <span class="hljs-keyword">uint32_t</span>     lineno;               <span class="hljs-comment">/* line number (for ast nodes) */</span>        <span class="hljs-keyword">uint32_t</span>     num_args;             <span class="hljs-comment">/* arguments number for EX(This) */</span>        <span class="hljs-keyword">uint32_t</span>     fe_pos;               <span class="hljs-comment">/* foreach position */</span>        <span class="hljs-keyword">uint32_t</span>     fe_iter_idx;          <span class="hljs-comment">/* foreach iterator index */</span>    &#125; u2;&#125;;<span class="hljs-comment">//å˜é‡çš„å€¼</span><span class="hljs-comment">//é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ã€‚å˜é‡æ˜¯é€šè¿‡ä¸€ä¸ª_zval_structç»“æ„ä½“æ–¹å¼å­˜å‚¨çš„ã€‚å…¶ä¸­ç»“æ„ä½“ä¸­çš„valueå­˜å‚¨çš„æ˜¯å˜é‡çš„å€¼ã€‚è¿™ä¸ªæˆå‘˜æ˜¯zend_valueç±»å‹çš„ã€‚zend_valueç±»å‹çš„å®šä¹‰å¦‚ä¸‹ï¼š</span><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">union</span> _zend_value &#123;    zend_long         lval;             <span class="hljs-comment">/* long value */</span>    <span class="hljs-keyword">double</span>            dval;             <span class="hljs-comment">/* double value */</span>    zend_refcounted  *counted;    zend_string      *str;    zend_array       *arr;    zend_object      *obj;    zend_resource    *res;    zend_reference   *ref;    zend_ast_ref     *ast;    zval             *zv;    <span class="hljs-keyword">void</span>             *ptr;    zend_class_entry *ce;    zend_function    *func;    <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span>        <span class="hljs-keyword">uint32_t</span> w1;        <span class="hljs-keyword">uint32_t</span> w2;    &#125; ww;&#125; zend_value;</code></pre><h3 id="2-PHP-å¦‚ä½•ä¸-nginx-é€šä¿¡ï¼Œé€šä¿¡æ–¹å¼æœ‰ä»€ä¹ˆå¼‚åŒ"><a href="#2-PHP-å¦‚ä½•ä¸-nginx-é€šä¿¡ï¼Œé€šä¿¡æ–¹å¼æœ‰ä»€ä¹ˆå¼‚åŒ" class="headerlink" title="2. PHP å¦‚ä½•ä¸ nginx é€šä¿¡ï¼Œé€šä¿¡æ–¹å¼æœ‰ä»€ä¹ˆå¼‚åŒ"></a>2. PHP å¦‚ä½•ä¸ nginx é€šä¿¡ï¼Œé€šä¿¡æ–¹å¼æœ‰ä»€ä¹ˆå¼‚åŒ</h3><ul><li><a href="https://vsxen.github.io/2017/05/30/phpcgi-socks-vs-tcp/" target="_blank" rel="noopener">https://vsxen.github.io/2017/05/30/phpcgi-socks-vs-tcp/</a></li></ul><h4 id="CGI-æ¨¡å¼"><a href="#CGI-æ¨¡å¼" class="headerlink" title="CGI æ¨¡å¼"></a>CGI æ¨¡å¼</h4><p>CGI CGIï¼ˆcommon gateway interfaceï¼‰é€šå¸¸ç¿»è¯‘ä¸ºå…±åŒç½‘å…³æ¥å£ï¼Œæ˜¯ HTTP æœåŠ¡å™¨ä¸æœºå™¨ä¸Šçš„å…¶ä»–ç¨‹åºè¿›è¡Œé€šä¿¡çš„ä¸€ä¸ªæ¥å£ï¼Œè®© Web æœåŠ¡å™¨å¿…è¦æ—¶å¯åŠ¨é¢å¤–çš„ç¨‹åºå¤„ç†åŠ¨æ€å†…å®¹ã€‚CGI æ˜¯ä¸€ç§åè®®ï¼Œå®ƒå®šä¹‰äº† Webserver ä¸ CGI ç¨‹åºçš„é€šä¿¡æ–¹å¼ã€‚Webserver æ¥å—å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œç„¶åå»ºç«‹è¿›ç¨‹æ‰§è¡Œ CGI ç¨‹åºï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚è¢«ä¼ é€’ç»™ CGI ç¨‹åºï¼ŒCGI æ‰§è¡Œåç»“æœå†è¿”å› Webserverã€‚ CGI çš„å‡ºç°è®© WEB ä»é™æ€å˜ä¸ºä¸ºåŠ¨æ€ï¼Œéšç€ Web çš„è¶Šæ¥è¶Šæ™®åŠï¼Œå¾ˆå¤šçš„ç½‘ç«™çš„éƒ½éœ€è¦æœ‰åŠ¨æ€çš„é¡µé¢ï¼Œä»¥ä¾¿ä¸æµè§ˆè€…äº’äº¤ã€‚éšç€ç½‘ç»œæŠ€æœ¯çš„å‘å±•ï¼ŒCGI æ–¹å¼çš„ç¼ºç‚¹ä¹Ÿè¶Šæ¥è¶Šçªå‡ºã€‚æ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚éƒ½éœ€è¦å»ºç«‹å’Œé”€æ¯è¿›ç¨‹ã€‚å› ä¸º HTTP è¦ç”Ÿæˆä¸€ä¸ªåŠ¨æ€é¡µé¢ï¼Œç³»ç»Ÿå°±å¿…é¡»å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ä»¥è¿è¡Œ CGI ç¨‹åºï¼Œä¸æ–­åœ° fork æ˜¯ä¸€é¡¹å¾ˆæ¶ˆè€—æ—¶é—´å’Œèµ„æºçš„å·¥ä½œã€‚</p><h4 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒCGI è§£é‡Šå™¨çš„åå¤åŠ è½½æ˜¯ CGI æ€§èƒ½ä½ä¸‹çš„ä¸»è¦åŸå› ï¼Œå¦‚æœ CGI è§£é‡Šå™¨ä¿æŒåœ¨å†…å­˜ä¸­ å¹¶æ¥å— FastCGI è¿›ç¨‹ç®¡ç†å™¨è°ƒåº¦ï¼Œåˆ™å¯ä»¥æä¾›è‰¯å¥½çš„æ€§èƒ½ã€ä¼¸ç¼©æ€§ã€Fail-Over ç‰¹æ€§ç­‰ç­‰ã€‚</p><p>FastCGI æ˜¯ä¸€ä¸ªå¸¸é©»å‹çš„ CGIï¼Œå¯ä»¥ä¸€ç›´æ‰§è¡Œï¼Œåªè¦æ¿€æ´»åï¼Œä¸ä¼šæ¯æ¬¡éƒ½èŠ±æ—¶é—´å» fork ä¸€æ¬¡ï¼Œè€Œä¸”è¿˜æ”¯æŒåˆ†å¸ƒå¼è¿ç®—ï¼ˆä½¿å¾— php ç¨‹åºè§£é‡Šæ‰§è¡Œå¯ä»¥å•ç‹¬äº¤ç»™ php æœåŠ¡å™¨ï¼‰ï¼Œå³å¯ä»¥åœ¨ç½‘ç«™æœåŠ¡å™¨ä»¥å¤–çš„ä¸»æœºä¸Šæ‰§è¡Œå¹¶ä¸”æ¥å—æ¥è‡ªå…¶å®ƒç½‘ç«™æœåŠ¡å™¨æ¥çš„è¯·æ±‚ã€‚</p><p>1ã€Web Server å¯åŠ¨æ—¶è½½å…¥ FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼ˆIIS ISAPI æˆ– Apache Moduleï¼‰;<br>2ã€FastCGI è¿›ç¨‹ç®¡ç†å™¨è‡ªèº«åˆå§‹åŒ–ï¼Œå¯åŠ¨å¤šä¸ª CGI è§£é‡Šå™¨è¿›ç¨‹ (åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­å¯è§å¤šä¸ª php-cgi.exe)å¹¶ç­‰å¾…æ¥è‡ª Web Server çš„è¿æ¥ã€‚<br>3ã€å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ Web Server æ—¶ï¼ŒFastCGI è¿›ç¨‹ç®¡ç†å™¨é€‰æ‹©å¹¶è¿æ¥åˆ°ä¸€ä¸ª CGI è§£é‡Šå™¨ã€‚Web server å°† CGI ç¯å¢ƒå˜é‡å’Œæ ‡å‡†è¾“å…¥å‘é€åˆ° FastCGI å­è¿›ç¨‹ php-cgi.exeã€‚<br>4ã€FastCGI å­è¿›ç¨‹å®Œæˆå¤„ç†åå°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ä»åŒä¸€è¿æ¥è¿”å› Web Serverã€‚å½“ FastCGI å­è¿›ç¨‹å…³é—­è¿æ¥æ—¶ï¼Œè¯·æ±‚ä¾¿å‘Šå¤„ç†å®Œæˆã€‚FastCGI å­è¿›ç¨‹æ¥ç€ç­‰å¾…å¹¶å¤„ç†æ¥è‡ª FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼ˆè¿è¡Œåœ¨ WebServer ä¸­ï¼‰çš„ä¸‹ä¸€ä¸ªè¿æ¥ã€‚ åœ¨æ­£å¸¸çš„ CGI æ¨¡å¼ä¸­ï¼Œphp-cgi.exe åœ¨æ­¤ä¾¿é€€å‡ºäº†</p><h4 id="Apache-æ¨¡å—"><a href="#Apache-æ¨¡å—" class="headerlink" title="Apache æ¨¡å—"></a>Apache æ¨¡å—</h4><p>MPM Multi Path Modules ï¼ˆå¤šé“å¤„ç†æ¨¡å—ï¼‰ç”¨äºå®šä¹‰ apache åœ¨å“åº”å¤šä¸ªç”¨æˆ·è¯·æ±‚æ—¶æ‰€å·¥ä½œçš„æ¨¡å‹ã€‚æœ‰ä¸‰ç§ MPM æ¨¡å¼ï¼š</p><p>preforkï¼ˆä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªè¿›ç¨‹å“åº”ï¼‰</p><p>workerï¼ˆä¸€ä¸ªè¯·æ±‚ç”¨ä¸€ä¸ªçº¿ç¨‹å“åº”ï¼Œå¯åŠ¨å¤šä¸ªè¿›ç¨‹æ¯ä¸ªè¿›ç¨‹ç”Ÿæˆå¤šä¸ªçº¿ç¨‹ï¼‰</p><p>eventï¼ˆä¸€ä¸ªè¿›ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚ï¼‰</p><p>ä»¥æ¨¡å—å®‰è£…çš„ php æ²¡æœ‰ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œæ˜¯ä½œä¸º apache çš„æ¨¡å—å’Œ apache ä¸€èµ·å¯åŠ¨çš„ã€‚</p><p>ä»¥ä¸Šä¸‰ç§ MPM æ¨¡å¼ï¼Œworker æ¨¡å¼ä¼šæ¯” prefork æ¨¡å¼å æ®æ›´å°‘çš„å†…å­˜ï¼Œé«˜å¹¶å‘ä¸‹çš„è¡¨ç°æ›´å¥½ã€‚è€Œä¸”ä½¿ç”¨å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æ··åˆæ¨¡å¼ï¼Œå³ä½¿æœ‰ä¸€ä¸ªçº¿ç¨‹æŒ‚äº†ï¼Œä¹Ÿåªå½±å“å’Œè¯¥çº¿ç¨‹åŒè¿›ç¨‹çš„å…¶ä»–çº¿ç¨‹ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„è¿›ç¨‹ã€‚ä½†æ˜¯å¦‚æœæœ‰ç‰¹åˆ«å¤šçš„çº¿ç¨‹éƒ½ä½¿ç”¨ keep-alive çš„é•¿è¿æ¥æ–¹å¼ï¼Œåˆ™çº¿ç¨‹ä¼šä¸€ç›´è¢«å æ®ç›´åˆ°è¶…æ—¶æ‰é‡Šæ”¾ï¼Œå¯¼è‡´åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ— å¯ç”¨çº¿ç¨‹ã€‚è€Œ event æ¨¡å¼ä½¿ç”¨äº†ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº› keep-alive ç±»çº¿ç¨‹ï¼Œè¾ƒå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><p>Nginx å¤„ç† PHP æ–‡ä»¶ åªæœ‰ FastCGI ä¸€ç§<br>ä¸è¿‡ Nginx è¿æ¥ fastcgi çš„æ–¹å¼æœ‰ 2 ç§ï¼šTCP å’Œ unix domain socket<br>Unix domain socket æˆ–è€… IPC socket æ˜¯ä¸€ç§ç»ˆç«¯ï¼Œå¯ä»¥ä½¿åŒä¸€å°æ“ä½œç³»ç»Ÿä¸Šçš„ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹è¿›è¡Œæ•°æ®é€šä¿¡ã€‚ä¸ç®¡é“ç›¸æ¯”ï¼ŒUnix domain sockets æ—¢å¯ä»¥ä½¿ç”¨å­—èŠ‚æµå’Œæ•°æ®é˜Ÿåˆ—ï¼Œè€Œç®¡é“é€šä¿¡åˆ™åªèƒ½é€šè¿‡å­—èŠ‚æµã€‚Unix domain sockets çš„æ¥å£å’Œ Internet socket å¾ˆåƒï¼Œä½†å®ƒä¸ä½¿ç”¨ç½‘ç»œåº•å±‚åè®®æ¥é€šä¿¡ã€‚Unix domain socket çš„åŠŸèƒ½æ˜¯ POSIX æ“ä½œç³»ç»Ÿé‡Œçš„ä¸€ç§ç»„ä»¶ã€‚<br>Unix domain sockets ä½¿ç”¨ç³»ç»Ÿæ–‡ä»¶çš„åœ°å€æ¥ä½œä¸ºè‡ªå·±çš„èº«ä»½ã€‚å®ƒå¯ä»¥è¢«ç³»ç»Ÿè¿›ç¨‹å¼•ç”¨ã€‚æ‰€ä»¥ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶æ‰“å¼€ä¸€ä¸ª Unix domain sockets æ¥è¿›è¡Œé€šä¿¡ã€‚ä¸è¿‡è¿™ç§é€šä¿¡æ–¹å¼æ˜¯å‘ç”Ÿåœ¨ç³»ç»Ÿå†…æ ¸é‡Œè€Œä¸ä¼šåœ¨ç½‘ç»œé‡Œä¼ æ’­ã€‚<br>TCP å’Œ unix domain socket æ–¹å¼å¯¹æ¯”<br>TCP æ˜¯ä½¿ç”¨ TCP ç«¯å£è¿æ¥ 127.0.0.1:9000<br>Socket æ˜¯ä½¿ç”¨ unix domain socket è¿æ¥å¥—æ¥å­—/dev/shm/php-cgi.sockï¼ˆå¾ˆå¤šæ•™ç¨‹ä½¿ç”¨è·¯å¾„/tmpï¼Œè€Œè·¯å¾„/dev/shm æ˜¯ä¸ª tmpfsï¼Œé€Ÿåº¦æ¯”ç£ç›˜å¿«å¾—å¤šï¼‰<br>æµ‹è¯•æœºæ˜¯ä¸ª 1 æ ¸çš„ centos5.4ï¼Œ2 ç”¨æˆ·å¹¶å‘æ—¶ç³»ç»Ÿèµ„æºæ¶ˆè€— 50%å·¦å³ï¼Œ10 ç”¨æˆ·èµ„æºå°±è·‘å¾—å¾ˆæ»¡äº†</p><p>ç»“è®ºæ˜¯åœ¨æœåŠ¡å™¨å‹åŠ›ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œtcp å’Œ socket å·®åˆ«ä¸å¤§ï¼Œä½†åœ¨å‹åŠ›æ¯”è¾ƒæ»¡çš„æ—¶å€™ï¼Œç”¨å¥—æ¥å­—æ–¹å¼ï¼Œæ•ˆæœç¡®å®æ¯”è¾ƒå¥½ã€‚<br>ä¸‹é¢æ˜¯ php 5.3 ä»¥ä¸Šç‰ˆæœ¬å°† TCP æ”¹æˆ socket æ–¹å¼çš„é…ç½®æ–¹æ³•ï¼š<br>ä¿®æ”¹ php-fpm.confï¼ˆ/usr/local/php/etc/php-fpm.confï¼‰<br>;listen = 127.0.0.1:9000<br>listen = /dev/shm/php-cgi.sock<br>ä¿®æ”¹ nginx é…ç½®æ–‡ä»¶ server æ®µçš„é…ç½®ï¼Œå°† http çš„æ–¹å¼æ”¹ä¸º socket æ–¹å¼</p><p>ä»åŸç†ä¸Šæ¥è¯´ï¼Œunix socket æ–¹å¼è‚¯å®šè¦æ¯” tcp çš„æ–¹å¼å¿«è€Œä¸”æ¶ˆè€—èµ„æºå°‘ï¼Œå› ä¸º socket ä¹‹é—´åœ¨ nginx å’Œ php-fpm çš„è¿›ç¨‹ä¹‹é—´é€šä¿¡ï¼Œè€Œ tcp éœ€è¦ç»è¿‡æœ¬åœ°å›ç¯é©±åŠ¨ï¼Œè¿˜è¦ç”³è¯·ä¸´æ—¶ç«¯å£å’Œ tcp ç›¸å…³èµ„æºã€‚<br>å½“ç„¶è¿˜æ˜¯ä»åŸç†ä¸Šæ¥è¯´ï¼Œunix socket ä¼šæ˜¾å¾—ä¸æ˜¯é‚£ä¹ˆç¨³å®šï¼Œå½“å¹¶å‘è¿æ¥æ•°çˆ†å‘æ—¶ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„é•¿æ—¶ç¼“å­˜ï¼Œåœ¨æ²¡æœ‰é¢å‘è¿æ¥åè®®æ”¯æ’‘çš„æƒ…å†µä¸‹ï¼Œå¤§æ•°æ®åŒ…å¾ˆæœ‰å¯èƒ½å°±ç›´æ¥å‡ºé”™å¹¶ä¸ä¼šè¿”å›å¼‚å¸¸ã€‚è€Œ TCP è¿™æ ·çš„é¢å‘è¿æ¥çš„åè®®ï¼Œå¤šå°‘å¯ä»¥ä¿è¯é€šä¿¡çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚</p><h3 id="3-PHP-çš„æ‰§è¡Œæ¨¡å¼æœ‰å“ªäº›"><a href="#3-PHP-çš„æ‰§è¡Œæ¨¡å¼æœ‰å“ªäº›" class="headerlink" title="3. PHP çš„æ‰§è¡Œæ¨¡å¼æœ‰å“ªäº›"></a>3. PHP çš„æ‰§è¡Œæ¨¡å¼æœ‰å“ªäº›</h3><ul><li><a href="http://blog.csdn.net/xujingzhong0077/article/details/53316767" target="_blank" rel="noopener">http://blog.csdn.net/xujingzhong0077/article/details/53316767</a></li></ul><h4 id="è¿è¡Œæ¨¡å¼"><a href="#è¿è¡Œæ¨¡å¼" class="headerlink" title="è¿è¡Œæ¨¡å¼"></a>è¿è¡Œæ¨¡å¼</h4><p>å…³äº PHP ç›®å‰æ¯”è¾ƒå¸¸è§çš„äº”å¤§è¿è¡Œæ¨¡å¼ï¼š<br>1ï¼‰CGIï¼ˆé€šç”¨ç½‘å…³æ¥å£/ Common Gateway Interfaceï¼‰<br>2ï¼‰FastCGIï¼ˆå¸¸é©»å‹ CGI / Long-Live CGIï¼‰<br>3ï¼‰CLIï¼ˆå‘½ä»¤è¡Œè¿è¡Œ / Command Line Interfaceï¼‰<br>4ï¼‰Web æ¨¡å—æ¨¡å¼ï¼ˆApache ç­‰ Web æœåŠ¡å™¨è¿è¡Œçš„æ¨¡å¼ï¼‰<br>5ï¼‰ISAPIï¼ˆInternet Server Application Program Interfaceï¼‰</p><p>å¤‡æ³¨ï¼šåœ¨ PHP5.3 ä»¥åï¼ŒPHP ä¸å†æœ‰ ISAPI æ¨¡å¼ï¼Œå®‰è£…åä¹Ÿä¸å†æœ‰ php5isapi.dll è¿™ä¸ªæ–‡ä»¶ã€‚è¦åœ¨ IIS6 ä¸Šä½¿ç”¨é«˜ç‰ˆæœ¬ PHPï¼Œå¿…é¡»å®‰è£… FastCGI æ‰©å±•ï¼Œç„¶åä½¿ IIS6 æ”¯æŒ FastCGIã€‚</p><h4 id="1-1ã€CGI-æ¨¡å¼"><a href="#1-1ã€CGI-æ¨¡å¼" class="headerlink" title="1.1ã€CGI æ¨¡å¼"></a>1.1ã€CGI æ¨¡å¼</h4><p>CGI å³é€šç”¨ç½‘å…³æ¥å£ï¼ˆCommon Gateway Interfaceï¼‰ï¼Œå®ƒæ˜¯ä¸€æ®µç¨‹åºï¼Œé€šä¿—çš„è®² CGI å°±è±¡æ˜¯ä¸€åº§æ¡¥ï¼ŒæŠŠç½‘é¡µå’Œ Web æœåŠ¡å™¨ä¸­çš„æ‰§è¡Œç¨‹åºè¿æ¥èµ·æ¥ï¼Œå®ƒæŠŠ HTML æ¥æ”¶çš„æŒ‡ä»¤ä¼ é€’ç»™æœåŠ¡å™¨çš„æ‰§è¡Œç¨‹åºï¼Œå†æŠŠæœåŠ¡å™¨æ‰§è¡Œç¨‹åºçš„ç»“æœè¿”è¿˜ç»™ HTML é¡µã€‚CGI çš„è·¨å¹³å°æ€§èƒ½æä½³ï¼Œå‡ ä¹å¯ä»¥åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šå®ç°ã€‚CGI å·²ç»æ˜¯æ¯”è¾ƒè€çš„æ¨¡å¼äº†ï¼Œè¿™å‡ å¹´éƒ½å¾ˆå°‘ç”¨äº†ã€‚</p><p>æ¯æœ‰ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ï¼Œéƒ½ä¼šå…ˆè¦åˆ›å»º CGI çš„å­è¿›ç¨‹ï¼Œç„¶åå¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œåç»“æŸè¿™ä¸ªå­è¿›ç¨‹ï¼Œè¿™å°±æ˜¯ Fork-And-Execute æ¨¡å¼ã€‚ å½“ç”¨æˆ·è¯·æ±‚æ•°é‡éå¸¸å¤šæ—¶ï¼Œä¼šå¤§é‡æŒ¤å ç³»ç»Ÿçš„èµ„æºå¦‚å†…å­˜ï¼ŒCPU æ—¶é—´ç­‰ï¼Œé€ æˆæ•ˆèƒ½ä½ä¸‹ã€‚æ‰€ä»¥ç”¨ CGI æ–¹å¼çš„æœåŠ¡å™¨æœ‰å¤šå°‘è¿æ¥è¯·æ±‚å°±ä¼šæœ‰å¤šå°‘ CGI å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹åå¤åŠ è½½æ˜¯ CGI æ€§èƒ½ä½ä¸‹çš„ä¸»è¦åŸå› ã€‚</p><p>å¦‚æœä¸æƒ³æŠŠ PHP åµŒå…¥åˆ°æœåŠ¡å™¨ç«¯è½¯ä»¶ï¼ˆå¦‚ Apacheï¼‰ä½œä¸ºä¸€ä¸ªæ¨¡å—å®‰è£…çš„è¯ï¼Œå¯ä»¥é€‰æ‹©ä»¥ CGI çš„æ¨¡å¼å®‰è£…ã€‚æˆ–è€…æŠŠ PHP ç”¨äºä¸åŒçš„ CGI å°è£…ä»¥ä¾¿ä¸ºä»£ç åˆ›å»ºå®‰å…¨çš„ chroot å’Œ setuid ç¯å¢ƒã€‚è¿™æ ·æ¯ä¸ªå®¢æˆ·æœºè¯·æ±‚ä¸€ä¸ª PHP æ–‡ä»¶ï¼ŒWeb æœåŠ¡å™¨å°±è°ƒç”¨ php.exeï¼ˆwin ä¸‹æ˜¯ php.exe,linux æ˜¯ phpï¼‰å»è§£é‡Šè¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åå†æŠŠè§£é‡Šçš„ç»“æœä»¥ç½‘é¡µçš„å½¢å¼è¿”å›ç»™å®¢æˆ·æœºã€‚ è¿™ç§å®‰è£…æ–¹å¼é€šå¸¸ä¼šæŠŠ PHP çš„å¯æ‰§è¡Œæ–‡ä»¶å®‰è£…åˆ° web æœåŠ¡å™¨çš„ cgi-bin ç›®å½•ã€‚CERT å»ºè®®ä¹¦ CA-96.11 å»ºè®®ä¸è¦æŠŠä»»ä½•çš„è§£é‡Šå™¨æ”¾åˆ° cgi-bin ç›®å½•ã€‚ è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯æŠŠ Web Server å’Œå…·ä½“çš„ç¨‹åºå¤„ç†ç‹¬ç«‹å¼€æ¥ï¼Œç»“æ„æ¸…æ™°ï¼Œå¯æ§æ€§å¼ºï¼ŒåŒæ—¶ç¼ºç‚¹å°±æ˜¯å¦‚æœåœ¨é«˜è®¿é—®éœ€æ±‚çš„æƒ…å†µä¸‹ï¼ŒCGI çš„è¿›ç¨‹ Fork å°±ä¼šæˆä¸ºå¾ˆå¤§çš„æœåŠ¡å™¨è´Ÿæ‹…ï¼Œæƒ³ è±¡ä¸€ä¸‹æ•°ç™¾ä¸ªå¹¶å‘è¯·æ±‚å¯¼è‡´æœåŠ¡å™¨ Fork å‡ºæ•°ç™¾ä¸ªè¿›ç¨‹å°±æ˜ç™½äº†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ CGI ä¸€ç›´èƒŒè´Ÿæ€§èƒ½ä½ä¸‹ï¼Œé«˜èµ„æºæ¶ˆè€—çš„æ¶åçš„åŸå› ã€‚</p><h4 id="1-2ã€FastCGI-æ¨¡å¼"><a href="#1-2ã€FastCGI-æ¨¡å¼" class="headerlink" title="1.2ã€FastCGI æ¨¡å¼"></a>1.2ã€FastCGI æ¨¡å¼</h4><p>FastCGI æ˜¯ CGI çš„å‡çº§ç‰ˆæœ¬ï¼ŒFastCGI åƒæ˜¯ä¸€ä¸ªå¸¸é©» (long-live)å‹çš„ CGIï¼Œå®ƒå¯ä»¥ä¸€ç›´æ‰§è¡Œç€ï¼Œåªè¦æ¿€æ´»åï¼Œä¸ä¼šæ¯æ¬¡éƒ½è¦èŠ±è´¹æ—¶é—´å» Fork ä¸€æ¬¡ ï¼ˆè¿™æ˜¯ CGI æœ€ä¸ºäººè¯Ÿç—…çš„ fork-and-execute æ¨¡å¼ï¼‰ã€‚<br>FastCGI æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©åœ°ã€é«˜é€Ÿåœ°åœ¨ HTTP server å’ŒåŠ¨æ€è„šæœ¬è¯­è¨€é—´é€šä¿¡çš„æ¥å£ã€‚å¤šæ•°æµè¡Œçš„ HTTP server éƒ½æ”¯æŒ FastCGIï¼ŒåŒ…æ‹¬ Apacheã€Nginx å’Œ lighttpd ç­‰ï¼ŒåŒæ—¶ï¼ŒFastCGI ä¹Ÿè¢«è®¸å¤šè„šæœ¬è¯­è¨€æ‰€æ”¯æŒï¼Œå…¶ä¸­å°±æœ‰ PHPã€‚<br>FastCGI æ¥å£æ–¹å¼é‡‡ç”¨ C/S ç»“æ„ï¼Œå¯ä»¥å°† HTTP æœåŠ¡å™¨å’Œè„šæœ¬è§£ææœåŠ¡å™¨åˆ†å¼€ï¼ŒåŒæ—¶åœ¨è„šæœ¬è§£ææœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªè„šæœ¬è§£æå®ˆæŠ¤è¿›ç¨‹ã€‚å½“ HTTP æœåŠ¡å™¨æ¯æ¬¡é‡åˆ°åŠ¨æ€ç¨‹åºæ—¶ï¼Œå¯ä»¥å°†å…¶ç›´æ¥äº¤ä»˜ç»™ FastCGI è¿›ç¨‹æ¥æ‰§è¡Œï¼Œç„¶åå°†å¾—åˆ°çš„ç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚è¿™ç§æ–¹å¼å¯ä»¥è®© HTTP æœåŠ¡å™¨ä¸“ä¸€åœ°å¤„ç†é™æ€è¯·æ±‚æˆ–è€…å°†åŠ¨æ€è„šæœ¬æœåŠ¡å™¨çš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜äº†æ•´ä¸ªåº”ç”¨ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>ã€åŸç†ã€‘<br>1ï¼‰Web Server å¯åŠ¨æ—¶è½½å…¥ FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼ˆIIS ISAPI æˆ– Apache Module)ï¼›<br>2ï¼‰FastCGI è¿›ç¨‹ç®¡ç†å™¨è‡ªèº«åˆå§‹åŒ–ï¼Œå¯åŠ¨å¤šä¸ª CGI è§£é‡Šå™¨è¿›ç¨‹ (å¯è§å¤šä¸ª php-cgi.exe æˆ– php-cig)å¹¶ç­‰å¾…æ¥è‡ª Web Server çš„è¿æ¥ï¼›<br>3ï¼‰å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ Web Server æ—¶ï¼ŒFastCGI è¿›ç¨‹ç®¡ç†å™¨é€‰æ‹©å¹¶è¿æ¥åˆ°ä¸€ä¸ª CGI è§£é‡Šå™¨ã€‚Web server å°† CGI ç¯å¢ƒå˜é‡å’Œæ ‡å‡†è¾“å…¥å‘é€åˆ° FastCGI å­è¿›ç¨‹ php-cgiï¼›<br>4ï¼‰FastCGI å­è¿›ç¨‹å®Œæˆå¤„ç†åå°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ä»åŒä¸€è¿æ¥è¿”å› Web Serverã€‚å½“ FastCGI å­è¿›ç¨‹å…³é—­è¿æ¥æ—¶ï¼Œè¯·æ±‚ä¾¿å‘Šå¤„ç†å®Œæˆã€‚FastCGI å­è¿›ç¨‹æ¥ç€ç­‰å¾…å¹¶å¤„ç†æ¥è‡ª FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼ˆè¿è¡Œåœ¨ WebServer ä¸­ï¼‰çš„ä¸‹ä¸€ä¸ªè¿æ¥ã€‚åœ¨æ­£å¸¸çš„ CGI æ¨¡å¼ä¸­ï¼Œphp-cgi.exe åœ¨æ­¤ä¾¿é€€å‡ºäº†ã€‚<br>åœ¨ CGI æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥æƒ³è±¡ CGI é€šå¸¸æœ‰å¤šæ…¢ã€‚æ¯ä¸€ä¸ª Web è¯·æ±‚ PHP éƒ½å¿…é¡»é‡æ–°è§£æ php.iniã€é‡æ–°è½½å…¥å…¨éƒ¨ dll æ‰©å±•å¹¶é‡åˆå§‹åŒ–å…¨éƒ¨æ•°æ®ç»“æ„ã€‚ä½¿ç”¨ FastCGIï¼Œæ‰€æœ‰è¿™äº›éƒ½åªåœ¨è¿›ç¨‹å¯åŠ¨æ—¶å‘ç”Ÿä¸€æ¬¡ã€‚ä¸€ä¸ªé¢å¤–çš„å¥½å¤„æ˜¯ï¼ŒæŒç»­æ•°æ®åº“è¿æ¥ï¼ˆPersistent database connectionï¼‰å¯ä»¥å·¥ä½œã€‚</p><p>å¤‡æ³¨ï¼šPHP çš„ FastCGI è¿›ç¨‹ç®¡ç†å™¨æ˜¯ PHP-FPMï¼ˆPHP-FastCGI Process Managerï¼‰<br>ã€ä¼˜ç‚¹ã€‘<br>1ï¼‰ä»ç¨³å®šæ€§ä¸Šçœ‹ï¼ŒFastCGI æ˜¯ä»¥ç‹¬ç«‹çš„è¿›ç¨‹æ± æ¥è¿è¡Œ CGIï¼Œå•ç‹¬ä¸€ä¸ªè¿›ç¨‹æ­»æ‰ï¼Œç³»ç»Ÿå¯ä»¥å¾ˆè½»æ˜“çš„ä¸¢å¼ƒï¼Œç„¶åé‡æ–°åˆ†é…æ–°çš„è¿›ç¨‹æ¥è¿è¡Œé€»è¾‘ï¼›<br>2ï¼‰ä»å®‰å…¨æ€§ä¸Šçœ‹ï¼ŒFastCGI æ”¯æŒåˆ†å¸ƒå¼è¿ç®—ã€‚FastCGI å’Œå®¿ä¸»çš„ Server å®Œå…¨ç‹¬ç«‹ï¼ŒFastCGI æ€ä¹ˆ down ä¹Ÿä¸ä¼šæŠŠ Server æå®ï¼›<br>3ï¼‰ä»æ€§èƒ½ä¸Šçœ‹ï¼ŒFastCGI æŠŠåŠ¨æ€é€»è¾‘çš„å¤„ç†ä» Server ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¤§è´Ÿè·çš„ IO å¤„ç†è¿˜æ˜¯ç•™ç»™å®¿ä¸» Serverï¼Œè¿™æ ·å®¿ä¸» Server å¯ä»¥ä¸€å¿ƒä¸€æ„ä½œ IOï¼Œå¯¹äºä¸€ä¸ªæ™®é€šçš„åŠ¨æ€ç½‘é¡µæ¥è¯´, é€»è¾‘å¤„ç†å¯èƒ½åªæœ‰ä¸€å°éƒ¨åˆ†ï¼Œå¤§é‡çš„æ˜¯å›¾ç‰‡ç­‰é™æ€ã€‚</p><p>ã€ç¼ºç‚¹ã€‘<br>è¯´å®Œäº†å¥½å¤„ï¼Œä¹Ÿæ¥è¯´è¯´ç¼ºç‚¹ã€‚ä»æˆ‘çš„å®é™…ä½¿ç”¨æ¥çœ‹ï¼Œç”¨ FastCGI æ¨¡å¼æ›´é€‚åˆç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨ã€‚ä½†å¯¹äºå¼€å‘ç”¨æœºå™¨æ¥è¯´å°±ä¸å¤ªåˆé€‚ã€‚å› ä¸ºå½“ä½¿ç”¨ Zend Studio è°ƒè¯•ç¨‹åºæ—¶ï¼Œç”±äº FastCGI ä¼šè®¤ä¸º PHP è¿›ç¨‹è¶…æ—¶ï¼Œä»è€Œåœ¨é¡µé¢è¿”å› 500 é”™è¯¯ã€‚è¿™ä¸€ç‚¹è®©äººéå¸¸æ¼ç«ï¼Œæ‰€ä»¥æˆ‘åœ¨å¼€å‘æœºå™¨ä¸Šè¿˜æ˜¯æ¢å›äº† ISAPI æ¨¡å¼ã€‚å¯¹æŸäº›æœåŠ¡å™¨çš„æ–°ç‰ˆæœ¬æ”¯æŒä¸å¥½ï¼Œå¯¹åˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡æ²¡è¦æ±‚çš„æ¨¡å—åŒ–å®‰è£…æ˜¯å¦æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ç›®å‰çš„ FastCGI å’Œ Server æ²Ÿé€šè¿˜ä¸å¤Ÿæ™ºèƒ½ï¼Œä¸€ä¸ª FastCGI è¿›ç¨‹å¦‚æœæ‰§è¡Œæ—¶é—´è¿‡é•¿ä¼šè¢«å½“æˆæ˜¯æ­»è¿›ç¨‹æ€æ‰é‡èµ·ï¼Œè¿™æ ·åœ¨å¤„ç†é•¿æ—¶é—´ä»»åŠ¡çš„æ—¶å€™å¾ˆéº»çƒ¦ï¼Œè¿™æ ·åšä¹Ÿä½¿å¾— FastCGI æ— æ³•å…è®¸è”æœºè°ƒè¯•ã€‚å› ä¸ºæ˜¯å¤šè¿›ç¨‹ï¼Œæ‰€ä»¥æ¯” CGI å¤šçº¿ç¨‹æ¶ˆè€—æ›´å¤šçš„æœåŠ¡å™¨å†…å­˜ï¼ŒPHP-CGI è§£é‡Šå™¨æ¯è¿›ç¨‹æ¶ˆè€— 7 è‡³ 25 å…†å†…å­˜ï¼Œå°†è¿™ä¸ªæ•°å­—ä¹˜ä»¥ 50 æˆ– 100 å°±æ˜¯å¾ˆå¤§çš„å†…å­˜æ•°ã€‚</p><h4 id="1-3-CLI-æ¨¡å¼"><a href="#1-3-CLI-æ¨¡å¼" class="headerlink" title="1.3 CLI æ¨¡å¼"></a>1.3 CLI æ¨¡å¼</h4><p>PHP-CLI æ˜¯ PHP Command Line Interface çš„ç®€ç§°ï¼Œå¦‚åŒå®ƒåå­—çš„æ„æ€ï¼Œå°±æ˜¯ PHP åœ¨å‘½ä»¤è¡Œè¿è¡Œçš„æ¥å£ï¼ŒåŒºåˆ«äºåœ¨ Web æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ PHP ç¯å¢ƒï¼ˆPHP-CGIï¼ŒISAPI ç­‰ï¼‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒPHP ä¸å•å¯ä»¥å†™å‰å°ç½‘é¡µï¼Œå®ƒè¿˜å¯ä»¥ç”¨æ¥å†™åå°çš„ç¨‹åºã€‚ PHP çš„ CLI Shell è„šæœ¬é€‚ç”¨äºæ‰€æœ‰çš„ PHP ä¼˜åŠ¿ï¼Œä½¿åˆ›å»ºè¦ä¹ˆæ”¯æŒè„šæœ¬æˆ–ç³»ç»Ÿç”šè‡³ä¸ GUI åº”ç”¨ç¨‹åºçš„æœåŠ¡ç«¯ï¼Œåœ¨ Windows å’Œ Linux ä¸‹éƒ½æ˜¯æ”¯æŒ PHP-CLI æ¨¡å¼çš„ã€‚<br>ã€ä¼˜ç‚¹ã€‘<br>1ï¼‰ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œå­è¿›ç¨‹ç»“æŸä»¥åï¼Œå†…æ ¸ä¼šè´Ÿè´£å›æ”¶èµ„æºï¼›<br>2ï¼‰ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œå­è¿›ç¨‹å¼‚å¸¸é€€å‡ºä¸ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹ Thread é€€å‡ºï¼Œçˆ¶è¿›ç¨‹è¿˜æœ‰æœºä¼šé‡å»ºæµç¨‹ï¼›<br>3ï¼‰ä¸€ä¸ªå¸¸é©»ä¸»è¿›ç¨‹ï¼Œåªè´Ÿè´£ä»»åŠ¡åˆ†å‘ï¼Œé€»è¾‘æ›´æ¸…æ¥šã€‚<br>æˆ‘ä»¬åœ¨ Linux ä¸‹ç»å¸¸ä½¿ç”¨â€php â€“mâ€æŸ¥æ‰¾ PHP å®‰è£…äº†é‚£äº›æ‰©å±•å°±æ˜¯ PHP å‘½ä»¤è¡Œè¿è¡Œæ¨¡å¼ï¼›æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¾“å…¥â€php â€“hâ€å»æ·±å…¥ç ”ç©¶è¯¥è¿è¡Œæ¨¡å¼ã€‚</p><h4 id="1-4-æ¨¡å—æ¨¡å¼"><a href="#1-4-æ¨¡å—æ¨¡å¼" class="headerlink" title="1.4 æ¨¡å—æ¨¡å¼"></a>1.4 æ¨¡å—æ¨¡å¼</h4><p>æ¨¡å—æ¨¡å¼æ˜¯ä»¥ mod_php5 æ¨¡å—çš„å½¢å¼é›†æˆï¼Œæ­¤æ—¶ mod_php5 æ¨¡å—çš„ä½œç”¨æ˜¯æ¥æ”¶ Apache ä¼ é€’è¿‡æ¥çš„ PHP æ–‡ä»¶è¯·æ±‚ï¼Œå¹¶å¤„ç†è¿™äº›è¯·æ±‚ï¼Œç„¶åå°†å¤„ç†åçš„ç»“æœè¿”å›ç»™ Apacheã€‚å¦‚æœæˆ‘ä»¬åœ¨ Apache å¯åŠ¨å‰åœ¨å…¶é…ç½®æ–‡ä»¶ä¸­é…ç½®å¥½äº† PHP æ¨¡å—<br>ï¼ˆmod_php5ï¼‰ï¼Œ PHP æ¨¡å—é€šè¿‡æ³¨å†Œ apache2 çš„ ap_hook_post_config æŒ‚é’©ï¼Œåœ¨ Apache å¯åŠ¨çš„æ—¶å€™å¯åŠ¨æ­¤æ¨¡å—ä»¥æ¥å— PHP æ–‡ä»¶çš„è¯·æ±‚ã€‚<br>é™¤äº†è¿™ç§å¯åŠ¨æ—¶çš„åŠ è½½æ–¹å¼ï¼ŒApache çš„æ¨¡å—å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€è£…è½½ï¼Œè¿™æ„å‘³ç€å¯¹æœåŠ¡å™¨å¯ä»¥è¿›è¡ŒåŠŸèƒ½æ‰©å±•è€Œä¸éœ€è¦é‡æ–°å¯¹æºä»£ç è¿›è¡Œç¼–è¯‘ï¼Œç”šè‡³æ ¹æœ¬ä¸éœ€è¦åœæ­¢æœåŠ¡å™¨ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„ä»…ä»…æ˜¯ç»™æœåŠ¡å™¨å‘é€ä¿¡å· HUP æˆ–è€… AP_SIG_GRACEFUL é€šçŸ¥æœåŠ¡å™¨é‡æ–°è½½å…¥æ¨¡å—ã€‚ä½†æ˜¯åœ¨åŠ¨æ€åŠ è½½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¨¡å—ç¼–è¯‘æˆä¸ºåŠ¨æ€é“¾æ¥åº“ã€‚æ­¤æ—¶çš„åŠ¨æ€åŠ è½½å°±æ˜¯åŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚ Apache ä¸­å¯¹åŠ¨æ€é“¾æ¥åº“çš„å¤„ç†æ˜¯é€šè¿‡æ¨¡å— mod_so æ¥å®Œæˆçš„ï¼Œå› æ­¤ mod_so æ¨¡å—ä¸èƒ½è¢«åŠ¨æ€åŠ è½½ï¼Œå®ƒåªèƒ½è¢«é™æ€ç¼–è¯‘è¿› Apache çš„æ ¸å¿ƒã€‚è¿™æ„å‘³ç€å®ƒæ˜¯éšç€ Apache ä¸€èµ·å¯åŠ¨çš„ã€‚<br>Apache æ˜¯å¦‚ä½•åŠ è½½æ¨¡å—çš„å‘¢ï¼Ÿæˆ‘ä»¬ä»¥å‰é¢æåˆ°çš„ mod_php5 æ¨¡å—ä¸ºä¾‹ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ Apache çš„é…ç½®æ–‡ä»¶ httpd.conf ä¸­æ·»åŠ ä¸€è¡Œï¼š<br>LoadModule php5_module modules/mod_php5.so</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† LoadModule å‘½ä»¤ï¼Œè¯¥å‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡å—çš„åç§°ï¼Œåç§°å¯ä»¥åœ¨æ¨¡å—å®ç°çš„æºç ä¸­æ‰¾åˆ°ã€‚ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯è¯¥æ¨¡å—æ‰€å¤„çš„è·¯å¾„ã€‚å¦‚æœéœ€è¦åœ¨æœåŠ¡å™¨è¿è¡Œæ—¶åŠ è½½æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡å‘é€ä¿¡å· HUP æˆ–è€… AP_SIG_GRACEFUL ç»™æœåŠ¡å™¨ï¼Œä¸€æ—¦æ¥å—åˆ°è¯¥ä¿¡å·ï¼ŒApache å°†é‡æ–°è£…è½½æ¨¡å—ï¼Œè€Œä¸éœ€è¦é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚<br>è¯¥è¿è¡Œæ¨¡å¼æ˜¯æˆ‘ä»¬ä»¥å‰åœ¨ windows ç¯å¢ƒä¸‹ä½¿ç”¨ apache æœåŠ¡å™¨ç»å¸¸ä½¿ç”¨çš„ï¼Œè€Œåœ¨æ¨¡å—åŒ–ï¼ˆDLLï¼‰ä¸­ï¼ŒPHP æ˜¯ä¸ Web æœåŠ¡å™¨ä¸€èµ·å¯åŠ¨å¹¶è¿è¡Œçš„ã€‚ï¼ˆå®ƒæ˜¯ apache åœ¨ CGI çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ä¸€ç§æ‰©å±•ï¼ŒåŠ å¿« PHP çš„è¿è¡Œæ•ˆç‡ï¼‰ã€‚</p><h4 id="1-5-ISAPI-æ¨¡å¼"><a href="#1-5-ISAPI-æ¨¡å¼" class="headerlink" title="1.5 ISAPI æ¨¡å¼"></a>1.5 ISAPI æ¨¡å¼</h4><p>ISAPIï¼ˆInternet Server Application Program Interfaceï¼‰æ˜¯å¾®è½¯æä¾›çš„ä¸€å¥—é¢å‘ Internet æœåŠ¡çš„ API æ¥å£ï¼Œä¸€ä¸ª ISAPI çš„ DLLï¼Œå¯ä»¥åœ¨è¢«ç”¨æˆ·è¯·æ±‚æ¿€æ´»åé•¿é©»å†…å­˜ï¼Œç­‰å¾…ç”¨æˆ·çš„å¦ä¸€ä¸ªè¯·æ±‚ï¼Œè¿˜å¯ä»¥åœ¨ä¸€ä¸ª DLL é‡Œè®¾ç½®å¤šä¸ªç”¨æˆ·è¯·æ±‚å¤„ç†å‡½æ•°ï¼Œæ­¤å¤–ï¼ŒISAPI çš„ DLL åº”ç”¨ç¨‹åºå’Œ WWW æœåŠ¡å™¨å¤„äºåŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ•ˆç‡è¦æ˜¾è‘—é«˜äº CGIã€‚ï¼ˆç”±äºå¾®è½¯çš„æ’ä»–æ€§ï¼Œåªèƒ½è¿è¡Œäº windows ç¯å¢ƒï¼‰<br>PHP ä½œä¸º Apache æ¨¡å—ï¼ŒApache æœåŠ¡å™¨åœ¨ç³»ç»Ÿå¯åŠ¨åï¼Œé¢„å…ˆç”Ÿæˆå¤šä¸ªè¿›ç¨‹å‰¯æœ¬é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦æœ‰è¯·æ±‚å‡ºç°ï¼Œå°±ç«‹å³ä½¿ç”¨è¿™äº›ç©ºä½™çš„å­è¿›ç¨‹è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ç”Ÿæˆå­è¿›ç¨‹é€ æˆçš„å»¶è¿Ÿäº†ã€‚è¿™äº›æœåŠ¡å™¨å‰¯æœ¬åœ¨å¤„ç†å®Œä¸€æ¬¡ HTTP è¯·æ±‚ä¹‹åå¹¶ä¸ç«‹å³é€€å‡ºï¼Œè€Œæ˜¯åœç•™åœ¨è®¡ç®—æœºä¸­ç­‰å¾…ä¸‹æ¬¡è¯·æ±‚ã€‚å¯¹äºå®¢æˆ·æµè§ˆå™¨çš„è¯·æ±‚ååº”æ›´å¿«ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</p><h3 id="4-PHP-ä»£ç çš„æ‰§è¡Œæµç¨‹"><a href="#4-PHP-ä»£ç çš„æ‰§è¡Œæµç¨‹" class="headerlink" title="4. PHP ä»£ç çš„æ‰§è¡Œæµç¨‹"></a>4. PHP ä»£ç çš„æ‰§è¡Œæµç¨‹</h3><ul><li><a href="http://blog.csdn.net/a2534725767/article/details/55194582" target="_blank" rel="noopener">http://blog.csdn.net/a2534725767/article/details/55194582</a></li></ul><pre><code class="hljs undefined">1<span class="hljs-selector-class">.Scanning</span>(<span class="hljs-selector-tag">Lexing</span>) ,å°†<span class="hljs-selector-tag">PHP</span>ä»£ç è½¬æ¢ä¸ºè¯­è¨€ç‰‡æ®µ(<span class="hljs-selector-tag">Tokens</span>)2<span class="hljs-selector-class">.Parsing</span>, å°†<span class="hljs-selector-tag">Tokens</span>è½¬æ¢æˆç®€å•è€Œæœ‰æ„ä¹‰çš„è¡¨è¾¾å¼3<span class="hljs-selector-class">.Compilation</span>, å°†è¡¨è¾¾å¼ç¼–è¯‘æˆ<span class="hljs-selector-tag">Opocdes</span>4<span class="hljs-selector-class">.Execution</span>, é¡ºæ¬¡æ‰§è¡Œ<span class="hljs-selector-tag">Opcodes</span>ï¼Œæ¯æ¬¡ä¸€æ¡ï¼Œä»è€Œå®ç°<span class="hljs-selector-tag">PHP</span>è„šæœ¬çš„åŠŸèƒ½ã€‚</code></pre><h3 id="5-PHP-ä¸-Golang-çš„åŒºåˆ«"><a href="#5-PHP-ä¸-Golang-çš„åŒºåˆ«" class="headerlink" title="5. PHP ä¸ Golang çš„åŒºåˆ«"></a>5. PHP ä¸ Golang çš„åŒºåˆ«</h3><h4 id="å‚è€ƒåšæ–‡"><a href="#å‚è€ƒåšæ–‡" class="headerlink" title="å‚è€ƒåšæ–‡"></a>å‚è€ƒåšæ–‡</h4><ul><li><a href="http://www.yinwang.org/blog-cn/2014/04/18/golang" target="_blank" rel="noopener">å¯¹ Go è¯­è¨€çš„ç»¼åˆè¯„ä»·</a></li><li><a href="https://www.zhihu.com/question/21409296" target="_blank" rel="noopener">Go è¯­è¨€çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ</a></li><li><a href="http://blog.csdn.net/liigo/article/details/23699459" target="_blank" rel="noopener">æˆ‘ä¸ºä»€ä¹ˆæ”¾å¼ƒ Go è¯­è¨€</a></li><li><a href="http://blog.csdn.net/a82168506/article/details/6664714" target="_blank" rel="noopener">php çš„ä¼˜ç¼ºç‚¹</a></li><li><a href="http://www.cnblogs.com/xiaotaoing/p/6687418.html" target="_blank" rel="noopener">php ä¼˜ç¼ºç‚¹</a></li></ul><blockquote><p>é¢è¯•çš„æ—¶å€™åŸºæœ¬ä¸Šä¸Šé¢è¯´åˆ°çš„éƒ½è¯´åˆ°äº†ä¸€äº›ä½†æ˜¯é¢è¯•çš„æ—¶å€™é€»è¾‘è¿˜æ˜¯ä¸å¤Ÿæ¸…æ™°</p></blockquote><h3 id="6-æ·±åº¦ä¼˜å…ˆéå†ä¸å¹¿åº¦ä¼˜å…ˆéå†"><a href="#6-æ·±åº¦ä¼˜å…ˆéå†ä¸å¹¿åº¦ä¼˜å…ˆéå†" class="headerlink" title="6. æ·±åº¦ä¼˜å…ˆéå†ä¸å¹¿åº¦ä¼˜å…ˆéå†"></a>6. æ·±åº¦ä¼˜å…ˆéå†ä¸å¹¿åº¦ä¼˜å…ˆéå†</h3><ul><li><a href="http://www.cnblogs.com/biyeymyhjob/archive/2012/07/18/2596983.html" target="_blank" rel="noopener">http://www.cnblogs.com/biyeymyhjob/archive/2012/07/18/2596983.html</a></li></ul><h4 id="a-DFS"><a href="#a-DFS" class="headerlink" title="a. DFS"></a>a. DFS</h4><p>ï¼ˆ1ï¼‰è®¿é—®é¡¶ç‚¹ vï¼›<br>ï¼ˆ2ï¼‰ä» v çš„æœªè¢«è®¿é—®çš„é‚»æ¥ç‚¹ä¸­é€‰å–ä¸€ä¸ªé¡¶ç‚¹ wï¼Œä» w å‡ºå‘è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼›<br>ï¼ˆ3ï¼‰é‡å¤ä¸Šè¿°ä¸¤æ­¥ï¼Œç›´è‡³å›¾ä¸­æ‰€æœ‰å’Œ v æœ‰è·¯å¾„ç›¸é€šçš„é¡¶ç‚¹éƒ½è¢«è®¿é—®åˆ°ã€‚</p><h4 id="b-BFS"><a href="#b-BFS" class="headerlink" title="b. BFS"></a>b. BFS</h4><p>ï¼ˆ1ï¼‰é¡¶ç‚¹ v å…¥é˜Ÿåˆ—ã€‚<br>ï¼ˆ2ï¼‰å½“é˜Ÿåˆ—éç©ºæ—¶åˆ™ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™ç®—æ³•ç»“æŸã€‚<br>ï¼ˆ3ï¼‰å‡ºé˜Ÿåˆ—å–å¾—é˜Ÿå¤´é¡¶ç‚¹ vï¼›è®¿é—®é¡¶ç‚¹ v å¹¶æ ‡è®°é¡¶ç‚¹ v å·²è¢«è®¿é—®ã€‚<br>ï¼ˆ4ï¼‰æŸ¥æ‰¾é¡¶ç‚¹ v çš„ç¬¬ä¸€ä¸ªé‚»æ¥é¡¶ç‚¹ colã€‚<br>ï¼ˆ5ï¼‰è‹¥ v çš„é‚»æ¥é¡¶ç‚¹ col æœªè¢«è®¿é—®è¿‡çš„ï¼Œåˆ™ col å…¥é˜Ÿåˆ—ã€‚<br>ï¼ˆ6ï¼‰ç»§ç»­æŸ¥æ‰¾é¡¶ç‚¹ v çš„å¦ä¸€ä¸ªæ–°çš„é‚»æ¥é¡¶ç‚¹ colï¼Œè½¬åˆ°æ­¥éª¤ï¼ˆ5ï¼‰ã€‚<br>ç›´åˆ°é¡¶ç‚¹ v çš„æ‰€æœ‰æœªè¢«è®¿é—®è¿‡çš„é‚»æ¥ç‚¹å¤„ç†å®Œã€‚è½¬åˆ°æ­¥éª¤ï¼ˆ2ï¼‰ã€‚<br>å¹¿åº¦ä¼˜å…ˆéå†å›¾æ˜¯ä»¥é¡¶ç‚¹ v ä¸ºèµ·å§‹ç‚¹ï¼Œç”±è¿‘è‡³è¿œï¼Œä¾æ¬¡è®¿é—®å’Œ v æœ‰è·¯å¾„ç›¸é€šè€Œä¸”è·¯å¾„é•¿åº¦ä¸º 1ï¼Œ2ï¼Œâ€¦â€¦çš„é¡¶ç‚¹ã€‚ä¸ºäº†ä½¿â€œå…ˆè¢«è®¿é—®é¡¶ç‚¹çš„é‚»æ¥ç‚¹â€å…ˆäºâ€œåè¢«è®¿é—®é¡¶ç‚¹çš„é‚»æ¥ç‚¹â€è¢«è®¿é—®ï¼Œéœ€è®¾ç½®é˜Ÿåˆ—å­˜å‚¨è®¿é—®çš„é¡¶ç‚¹ã€‚</p><h3 id="7-æµè§ˆå™¨è¾“å…¥ä¸€ä¸ª-URL-ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…"><a href="#7-æµè§ˆå™¨è¾“å…¥ä¸€ä¸ª-URL-ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…" class="headerlink" title="7. æµè§ˆå™¨è¾“å…¥ä¸€ä¸ª URL ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…"></a>7. æµè§ˆå™¨è¾“å…¥ä¸€ä¸ª URL ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…</h3><ul><li><a href="http://www.cnblogs.com/wenanry/archive/2010/02/25/1673368.html" target="_blank" rel="noopener">http://www.cnblogs.com/wenanry/archive/2010/02/25/1673368.html</a></li></ul><h3 id="8-éå†ä¸€ä¸ªç›®å½•ä¸‹é¢æ‰€æœ‰çš„æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹"><a href="#8-éå†ä¸€ä¸ªç›®å½•ä¸‹é¢æ‰€æœ‰çš„æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹" class="headerlink" title="8. éå†ä¸€ä¸ªç›®å½•ä¸‹é¢æ‰€æœ‰çš„æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹"></a>8. éå†ä¸€ä¸ªç›®å½•ä¸‹é¢æ‰€æœ‰çš„æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹</h3><blockquote><p>é¢è¯•çš„æ—¶å€™å†™äº†ä¸€ä¸ª DFSï¼Œä¸€ä¸‹è¢«é—®åˆ° BFS æ€ä¹ˆå†™çš„æ—¶å€™çŸ­è·¯äº†ï¼Œæ²¡æœ‰æƒ³èµ·äº†ï¼Œå…¶å®å®ç°çš„æ–¹æ³•ä¸éš¾ï¼Œå‚è€ƒé—®é¢˜ 6</p></blockquote><h3 id="å…¶å®è¿˜æœ‰å…¶ä»–çš„é—®é¢˜ï¼Œä¸è¿‡å¿˜äº†"><a href="#å…¶å®è¿˜æœ‰å…¶ä»–çš„é—®é¢˜ï¼Œä¸è¿‡å¿˜äº†" class="headerlink" title="å…¶å®è¿˜æœ‰å…¶ä»–çš„é—®é¢˜ï¼Œä¸è¿‡å¿˜äº†"></a>å…¶å®è¿˜æœ‰å…¶ä»–çš„é—®é¢˜ï¼Œä¸è¿‡å¿˜äº†</h3><h2 id="ä¸‰é¢-20min"><a href="#ä¸‰é¢-20min" class="headerlink" title="ä¸‰é¢[20min]"></a>ä¸‰é¢[20min]</h2><blockquote><p>ä¸‰é¢æ²¡æœ‰è¢«é—®åˆ°æŠ€æœ¯ç»†èŠ‚</p></blockquote><h3 id="0-è‡ªæˆ‘ä»‹ç»-1"><a href="#0-è‡ªæˆ‘ä»‹ç»-1" class="headerlink" title="0. è‡ªæˆ‘ä»‹ç»"></a>0. è‡ªæˆ‘ä»‹ç»</h3><h3 id="1-ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®"><a href="#1-ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="1. ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®"></a>1. ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªé¡¹ç›®</h3><h3 id="2-åœ¨å¹³æ—¶åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°çš„éš¾ç‚¹"><a href="#2-åœ¨å¹³æ—¶åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°çš„éš¾ç‚¹" class="headerlink" title="2. åœ¨å¹³æ—¶åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°çš„éš¾ç‚¹"></a>2. åœ¨å¹³æ—¶åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°çš„éš¾ç‚¹</h3><p>å‡ ä¸ªæ–¹é¢ç®€å•è®²äº†ä¸€ä¸‹ï¼Œå›¢é˜Ÿåä½œçš„éš¾ç‚¹ï¼ŒæŠ€æœ¯éš¾ç‚¹ï¼Œå¿ƒç†éš¾ç‚¹</p><h3 id="3-å›¢é˜Ÿåˆä½œå½“ä¸­å¦‚æœç¢°åˆ°ä¸€ä¸ª-BUGï¼Œä½†æ˜¯å¼€å‘äººå‘˜è§‰å¾—ä¸é‡è¦ï¼Œä½ è§‰å¾—é‡è¦æ€ä¹ˆç­ï¼Ÿ"><a href="#3-å›¢é˜Ÿåˆä½œå½“ä¸­å¦‚æœç¢°åˆ°ä¸€ä¸ª-BUGï¼Œä½†æ˜¯å¼€å‘äººå‘˜è§‰å¾—ä¸é‡è¦ï¼Œä½ è§‰å¾—é‡è¦æ€ä¹ˆç­ï¼Ÿ" class="headerlink" title="3. å›¢é˜Ÿåˆä½œå½“ä¸­å¦‚æœç¢°åˆ°ä¸€ä¸ª BUGï¼Œä½†æ˜¯å¼€å‘äººå‘˜è§‰å¾—ä¸é‡è¦ï¼Œä½ è§‰å¾—é‡è¦æ€ä¹ˆç­ï¼Ÿ"></a>3. å›¢é˜Ÿåˆä½œå½“ä¸­å¦‚æœç¢°åˆ°ä¸€ä¸ª BUGï¼Œä½†æ˜¯å¼€å‘äººå‘˜è§‰å¾—ä¸é‡è¦ï¼Œä½ è§‰å¾—é‡è¦æ€ä¹ˆç­ï¼Ÿ</h3><p>åšæŒä¸æ”¾è¿‡ä¸ºåº•çº¿ï¼Œæ¢ä½æ€è€ƒï¼Œä»¥äº§å“å’Œç”¨æˆ·çš„è§’åº¦åŠè¯´å¼€å‘</p><h3 id="4-å¯¹åŠ ç­æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ"><a href="#4-å¯¹åŠ ç­æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ" class="headerlink" title="4. å¯¹åŠ ç­æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ"></a>4. å¯¹åŠ ç­æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ</h3><p>æ­£å¸¸ç°è±¡ï¼Œå®Œå…¨å¯ä»¥æ¥å—</p><h3 id="5-ä¸ºä»€ä¹ˆæƒ³å»æ·±åœ³ï¼Ÿ"><a href="#5-ä¸ºä»€ä¹ˆæƒ³å»æ·±åœ³ï¼Ÿ" class="headerlink" title="5. ä¸ºä»€ä¹ˆæƒ³å»æ·±åœ³ï¼Ÿ"></a>5. ä¸ºä»€ä¹ˆæƒ³å»æ·±åœ³ï¼Ÿ</h3><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/1358.html">æ‹›é“¶ç½‘ç»œé¢è¯•æ€»ç»“</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
      <tag>ç§‹æ‹›</tag>
      
      <tag>ç™¾åº¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†’æ³¡æ’åº</title>
    <link href="/post/21238.html"/>
    <url>/post/21238.html</url>
    
    <content type="html"><![CDATA[<h1 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰æ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚</p><h2 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h2><ol><li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ï¼ˆä»åå¾€å‰ï¼‰ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚</li><li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚åœ¨è¿™ä¸€ç‚¹ï¼Œæœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚<br>(<strong>å¦‚æœè¿™ä¸€æ­¥æ²¡æœ‰å‡ºç°ä»»ä½•ä¸€æ¬¡äº¤æ¢ï¼Œé‚£ä¹ˆè¯´æ˜æ‰€æœ‰çš„å…ƒç´ å·²ç»æœ‰åºï¼Œä¸éœ€è¦å†è¿›è¡Œä¸‹é¢çš„æ­¥éª¤äº†</strong>)</li><li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚</li><li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚</li></ol><h2 id="å›¾ç‰‡ç¤ºä¾‹"><a href="#å›¾ç‰‡ç¤ºä¾‹" class="headerlink" title="å›¾ç‰‡ç¤ºä¾‹"></a>å›¾ç‰‡ç¤ºä¾‹</h2><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142754.gif" srcset="/img/loading.gif" alt></p><h2 id="ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰"><a href="#ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰" class="headerlink" title="ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰"></a>ç¨‹åºç¤ºä¾‹ï¼ˆgoï¼‰</h2><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SortInt</span><span class="hljs-params">(a []<span class="hljs-keyword">int</span>)</span> <span class="hljs-params">([]<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>)</span></span> &#123;<span class="hljs-comment">//äº¤æ¢æ¬¡æ•°ï¼Œè®¡æ•°</span>n := <span class="hljs-number">0</span>aLen := <span class="hljs-built_in">len</span>(a)<span class="hljs-keyword">for</span> i := aLen - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- &#123;<span class="hljs-comment">//æ ‡è®°ï¼Œå¦‚æœflagä¸€æ¬¡å†’æ³¡ä¹‹åæ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆè¯æ˜æ’åºå·²å®Œæˆï¼Œä¸éœ€è¦å†æ¬¡æ’åºï¼Œç›´æ¥é€€å‡º</span>flag := <span class="hljs-number">0</span><span class="hljs-comment">//ä¸€æ¬¡å†’æ³¡</span><span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; i; j++ &#123;<span class="hljs-keyword">if</span> a[j] &gt; a[j+<span class="hljs-number">1</span>] &#123;<span class="hljs-comment">//äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ï¼Œæ— éœ€å¼•å…¥ä¸´æ—¶å˜é‡</span>a[j], a[j+<span class="hljs-number">1</span>] = a[j+<span class="hljs-number">1</span>], a[j]n++<span class="hljs-comment">//æœ‰äº¤æ¢ï¼Œflag=1</span>flag = <span class="hljs-number">1</span>&#125;&#125;<span class="hljs-comment">//åˆ¤æ–­ä¸€æ¬¡å†’æ³¡ï¼Œæ˜¯å¦å­˜åœ¨äº¤æ¢</span><span class="hljs-keyword">if</span> flag == <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">break</span>&#125;&#125;<span class="hljs-keyword">return</span> a, n&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>æ’åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é—ä¼ ç®—æ³•</title>
    <link href="/post/34642.html"/>
    <url>/post/34642.html</url>
    
    <content type="html"><![CDATA[<h2 id="å®ç°ç¤ºä¾‹-Golang"><a href="#å®ç°ç¤ºä¾‹-Golang" class="headerlink" title="å®ç°ç¤ºä¾‹-Golang"></a>å®ç°ç¤ºä¾‹-Golang</h2><p><a href="https://github.com/mohuishou/algorithm/tree/master/GA" target="_blank" rel="noopener">github</a></p><pre><code class="hljs golang"><span class="hljs-keyword">package</span> GA<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span><span class="hljs-string">"math"</span><span class="hljs-string">"math/rand"</span><span class="hljs-string">"time"</span>)<span class="hljs-keyword">var</span> (groupSize      <span class="hljs-keyword">int</span>      <span class="hljs-comment">//ç§ç¾¤å¤§å°</span>chromosomeSize <span class="hljs-keyword">int</span>      <span class="hljs-comment">//æŸ“è‰²ä½“é•¿åº¦</span>selectRand     <span class="hljs-keyword">float64</span>  <span class="hljs-comment">//è½®ç›˜é€‰æ‹©æ¦‚ç‡</span>crossRand      <span class="hljs-keyword">float64</span>  <span class="hljs-comment">//äº¤å‰æ¦‚ç‡</span>mutationRand   <span class="hljs-keyword">float64</span>  <span class="hljs-comment">//å˜å¼‚æ¦‚ç‡</span>group          []Person <span class="hljs-comment">//ç§ç¾¤</span>bestPerson     Person   <span class="hljs-comment">//å½“å‰æœ€å¥½çš„ä¸ªä½“</span>r              *rand.Rand)<span class="hljs-comment">//Person ä¸ªä½“</span><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;chromosome []<span class="hljs-keyword">int</span>   <span class="hljs-comment">//æŸ“è‰²ä½“</span>value      <span class="hljs-keyword">float64</span> <span class="hljs-comment">//é€‚åº”å€¼</span>&#125;<span class="hljs-comment">//Init åˆå§‹åŒ–å‡½æ•°</span><span class="hljs-comment">//åˆå§‹åŒ–è®¾ç½®ç§ç¾¤å¤§å°ã€è½®ç›˜é€‰æ‹©æ¦‚ç‡ã€äº¤å‰æ¦‚ç‡å·²ç»å˜å¼‚çš„æ¦‚ç‡</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Init</span><span class="hljs-params">(GroupSize, ChromosomeSize <span class="hljs-keyword">int</span>, SelectRand, CrossRand, MutationRand <span class="hljs-keyword">float64</span>)</span></span> &#123;groupSize = GroupSizecrossRand = CrossRandselectRand = SelectRandmutationRand = MutationRandchromosomeSize = ChromosomeSizer = rand.New(rand.NewSource(time.Now().UnixNano()))bestPerson.chromosome = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, chromosomeSize)&#125;<span class="hljs-comment">//InitGroup åˆå§‹åŒ–ç§ç¾¤</span><span class="hljs-comment">//æ ¹æ®ç§ç¾¤å¤§å°éšæœºäº§ç”Ÿä¸€äº›ä¸ªä½“å¡«å……</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitGroup</span><span class="hljs-params">()</span></span> &#123;group = <span class="hljs-built_in">make</span>([]Person, groupSize)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; groupSize; i++ &#123;group[i].chromosome = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, chromosomeSize)<span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; chromosomeSize; j++ &#123;<span class="hljs-keyword">if</span> r.Float64() &gt; selectRand &#123;group[i].chromosome[j] = <span class="hljs-number">1</span>&#125;&#125;&#125;&#125;<span class="hljs-comment">//Fitness è®¡ç®—é€‚åº”å€¼</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Fitness</span><span class="hljs-params">(person Person)</span> <span class="hljs-title">float64</span></span> &#123;x := decode(person)<span class="hljs-keyword">return</span> x + <span class="hljs-number">10</span>*math.Sin(<span class="hljs-number">5</span>*x) + <span class="hljs-number">7</span>*math.Cos(<span class="hljs-number">4</span>*x)&#125;<span class="hljs-comment">//è§£ç </span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">decode</span><span class="hljs-params">(person Person)</span> <span class="hljs-title">float64</span></span> &#123;<span class="hljs-keyword">var</span> sum <span class="hljs-keyword">float64</span><span class="hljs-comment">//è§£ç </span><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; chromosomeSize; i++ &#123;<span class="hljs-comment">//äºŒè¿›åˆ¶æŸ“è‰²ä½“è½¬åè¿›åˆ¶å€¼</span><span class="hljs-keyword">if</span> person.chromosome[i] == <span class="hljs-number">1</span> &#123;sum = sum + math.Pow(<span class="hljs-number">2.0</span>, <span class="hljs-keyword">float64</span>(i))&#125;&#125;<span class="hljs-keyword">return</span> sum * <span class="hljs-number">9</span> / (math.Pow(<span class="hljs-number">2.0</span>, <span class="hljs-number">14.0</span>) - <span class="hljs-number">1</span>)&#125;<span class="hljs-comment">//Select é€‰æ‹©</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Select</span><span class="hljs-params">()</span></span> &#123;newGroup := <span class="hljs-built_in">make</span>([]Person, groupSize)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; groupSize; i++ &#123;newGroup[i].chromosome = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, chromosomeSize)rnd := r.Float64()A:<span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; groupSize; j++ &#123;<span class="hljs-keyword">if</span> group[j].value &gt; rnd*bestPerson.value &#123;<span class="hljs-built_in">copy</span>(newGroup[i].chromosome, group[j].chromosome)<span class="hljs-keyword">break</span> A&#125;<span class="hljs-keyword">if</span> j == groupSize<span class="hljs-number">-1</span> &#123;<span class="hljs-built_in">copy</span>(newGroup[i].chromosome, bestPerson.chromosome)&#125;&#125;&#125;group = newGroupnewGroup = <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">//Cross äº¤å‰</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Cross</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; groupSize; i = i + <span class="hljs-number">2</span> &#123;<span class="hljs-keyword">if</span> r.Float64() &lt; crossRand &#123;crossPosition := r.Intn(chromosomeSize - <span class="hljs-number">1</span>)<span class="hljs-keyword">if</span> crossPosition == <span class="hljs-number">0</span> || crossPosition == <span class="hljs-number">1</span> &#123;<span class="hljs-keyword">continue</span>&#125;<span class="hljs-comment">//äº¤å‰</span><span class="hljs-keyword">for</span> j := crossPosition; j &lt; chromosomeSize; j++ &#123;tmp := group[i].chromosome[j]group[i].chromosome[j] = group[i+<span class="hljs-number">1</span>].chromosome[j]group[i+<span class="hljs-number">1</span>].chromosome[j] = tmp&#125;&#125;&#125;&#125;<span class="hljs-comment">//Mutation å˜å¼‚</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Mutation</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; groupSize; i++ &#123;<span class="hljs-keyword">if</span> r.Float64() &lt; mutationRand &#123;mutationPosition := r.Intn(chromosomeSize - <span class="hljs-number">1</span>)<span class="hljs-comment">//å•ç‚¹å˜å¼‚</span><span class="hljs-keyword">if</span> group[i].chromosome[mutationPosition] == <span class="hljs-number">0</span> &#123;group[i].chromosome[mutationPosition] = <span class="hljs-number">1</span>&#125; <span class="hljs-keyword">else</span> &#123;group[i].chromosome[mutationPosition] = <span class="hljs-number">0</span>&#125;&#125;&#125;&#125;<span class="hljs-comment">//GA é—ä¼ ç®—æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GA</span><span class="hljs-params">()</span></span> &#123;<span class="hljs-comment">//åˆå§‹åŒ–</span>Init(<span class="hljs-number">100</span>, <span class="hljs-number">14</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.05</span>)<span class="hljs-comment">//åˆå§‹åŒ–ç§ç¾¤</span>InitGroup()<span class="hljs-comment">//é—ä¼ å¾ªç¯</span><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">200</span>; i++ &#123;<span class="hljs-comment">//è®¡ç®—é€‚åº”å€¼</span><span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; groupSize; j++ &#123;group[j].value = Fitness(group[j])<span class="hljs-comment">//ä¿å­˜å½“å‰æœ€å¥½çš„ä¸ªä½“</span><span class="hljs-keyword">if</span> group[j].value &gt; bestPerson.value &#123;<span class="hljs-built_in">copy</span>(bestPerson.chromosome, group[j].chromosome)bestPerson.value = group[j].valuefmt.Println(<span class="hljs-string">"ç¬¬"</span>, i, <span class="hljs-string">"ä»£æœ€å¥½ä¸ªä½“ï¼š"</span>, bestPerson.value, <span class="hljs-string">" "</span>, decode(bestPerson))&#125;&#125;<span class="hljs-comment">//é€‰æ‹©</span>Select()<span class="hljs-comment">//äº¤å‰</span>Cross()<span class="hljs-comment">//å˜å¼‚</span>Mutation()&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/defer.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•05-æ ˆä¸‹: æ·±å…¥ç†è§£ defer</a></li><li><a href="https://lailin.xyz/post/stack.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•04-æ ˆä¸Š: å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨</a></li><li><a href="https://lailin.xyz/post/array_2.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•03-æ•°ç»„ä¸‹: ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>é—ä¼ ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ€çŸ­è·¯å¾„ç®—æ³•SPFA</title>
    <link href="/post/21230.html"/>
    <url>/post/21230.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>å‰é¢è¯´äº†å•æºæœ€çŸ­è·¯å¾„ç®—æ³• Dijkstraï¼Œä»¥åŠå¤šæºæœ€çŸ­è·¯å¾„ç®—æ³• Floydï¼Œä½†æ˜¯éƒ½ä¸èƒ½é€‚ç”¨äºæœ‰è´Ÿæƒè¾¹å­˜åœ¨çš„æƒ…å†µï¼Œè¿™é‡Œå®ç°ä¸€ä¸‹æ˜¯è¥¿å—äº¤é€šå¤§å­¦æ®µå‡¡ä¸äº 1994 å¹´å‘è¡¨çš„ SPFAï¼ˆShortest Path Faster Algorithmï¼‰ç®—æ³•ã€‚è¯¥ç®—æ³•åœ¨ Bellman-ford ç®—æ³•çš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸€ä¸ªé˜Ÿåˆ—ä¼˜åŒ–ï¼Œå‡å°‘äº†å†—ä½™çš„æ¾å¼›æ“ä½œã€‚</p></blockquote><blockquote><p>spfa å¯ä»¥é€‚ç”¨äºæœ‰è´Ÿæƒè¾¹å­˜åœ¨çš„æƒ…å†µï¼Œä½†æ˜¯æ— æ³•æ±‚è§£å­˜åœ¨è´Ÿæƒå›è·¯çš„æƒ…å†µï¼Œä½†æ˜¯å¯ä»¥åˆ¤æ–­</p></blockquote><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åªè¦æœ€çŸ­è·¯å¾„å­˜åœ¨ï¼ŒSPFA ç®—æ³•å¿…å®šèƒ½æ±‚å‡ºæœ€å°å€¼ã€‚è¯æ˜ï¼šæ¯æ¬¡å°†ç‚¹æ”¾å…¥é˜Ÿå°¾ï¼Œéƒ½æ˜¯ç»è¿‡æ¾å¼›æ“ä½œè¾¾åˆ°çš„ã€‚æ¢è¨€ä¹‹ï¼Œæ¯æ¬¡çš„ä¼˜åŒ–å°†ä¼šæœ‰æŸä¸ªç‚¹ v çš„æœ€çŸ­è·¯å¾„ä¼°è®¡å€¼ d[v]å˜å°ã€‚æ‰€ä»¥ç®—æ³•çš„æ‰§è¡Œä¼šä½¿ d è¶Šæ¥è¶Šå°ã€‚ç”±äºæˆ‘ä»¬å‡å®šå›¾ä¸­ä¸å­˜åœ¨è´Ÿæƒå›è·¯ï¼Œæ‰€ä»¥æ¯ä¸ªç»“ç‚¹éƒ½æœ‰æœ€çŸ­è·¯å¾„å€¼ã€‚å› æ­¤ï¼Œç®—æ³•ä¸ä¼šæ— é™æ‰§è¡Œä¸‹å»ï¼Œéšç€ d å€¼çš„é€æ¸å˜å°ï¼Œç›´åˆ°åˆ°è¾¾æœ€çŸ­è·¯å¾„å€¼æ—¶ï¼Œç®—æ³•ç»“æŸï¼Œè¿™æ—¶çš„æœ€çŸ­è·¯å¾„ä¼°è®¡å€¼å°±æ˜¯å¯¹åº”ç»“ç‚¹çš„æœ€çŸ­è·¯å¾„å€¼ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="github"><a href="#github" class="headerlink" title="github"></a><a href="https://github.com/mohuishou/algorithm/tree/master/ShortestPath/Floyd" target="_blank" rel="noopener">github</a></h3><h3 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h3><pre><code class="hljs go">q := list.New()q.PushBack(s)<span class="hljs-comment">//å¾ªç¯è·³å‡ºæ¡ä»¶ï¼šé˜Ÿåˆ—ä¸ºç©º</span><span class="hljs-keyword">for</span> q.Len() != <span class="hljs-number">0</span> &#123;u := q.Front().Value.(Graph.VextexType)q.Remove(q.Front())<span class="hljs-comment">//é‡Šæ”¾å¯¹ç‚¹uçš„æ ‡è®°</span>visited[u] = <span class="hljs-literal">false</span>e := graph.G[u].FisrtEdge<span class="hljs-keyword">for</span> e != <span class="hljs-literal">nil</span> &#123;<span class="hljs-comment">//è¿™æ¡è¾¹ä¸‹çš„é¡¶ç‚¹</span>v := e.V<span class="hljs-comment">//å¦‚æœå½“å‰ç‚¹çš„è·ç¦»åŠ ä¸Šè¾¹çš„è·ç¦»å°äºä¹‹å‰è¯¥ç‚¹çš„è·ç¦»ï¼Œé‚£ä¹ˆå°±æ›´æ–°è¯¥ç‚¹çš„è·ç¦»</span><span class="hljs-keyword">if</span> dist[v] &gt; dist[u]+e.Weight &#123;dist[v] = dist[u] + e.Weight <span class="hljs-comment">//æ›´æ–°è¯¥ç‚¹è·ç¦»</span>path[v] = u                  <span class="hljs-comment">//æ›´æ–°çˆ¶èŠ‚ç‚¹</span><span class="hljs-comment">//å¦‚æœé¡¶ç‚¹ä¸åœ¨é˜Ÿå†…ï¼Œåˆ™å°†é¡¶ç‚¹å…¥é˜Ÿ</span><span class="hljs-keyword">if</span> visited[v] == <span class="hljs-literal">false</span> &#123;q.PushBack(v) <span class="hljs-comment">//å°†è¯¥ç‚¹å…¥é˜Ÿ</span>visited[v] = <span class="hljs-literal">true</span>count[v]++<span class="hljs-comment">//å‡ºç°è´Ÿç¯ï¼ŒæŠ¥é”™</span><span class="hljs-keyword">if</span> count[v] &gt; graph.VNum &#123;<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"å­˜åœ¨è´Ÿç¯ï¼"</span>)&#125;&#125;&#125;e = e.Next&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span></code></pre><h3 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h3><pre><code class="hljs go">visited[u] = <span class="hljs-literal">true</span>e := graph.G[u].FisrtEdge<span class="hljs-keyword">for</span> e != <span class="hljs-literal">nil</span> &#123;v := e.V<span class="hljs-keyword">if</span> dist[v] &gt; dist[u]+e.Weight &#123;dist[v] = dist[u] + e.Weight <span class="hljs-comment">//æ›´æ–°è¯¥ç‚¹è·ç¦»</span>path[v] = u                  <span class="hljs-comment">//æ›´æ–°çˆ¶èŠ‚ç‚¹</span><span class="hljs-keyword">if</span> visited[v] == <span class="hljs-literal">false</span> &#123;count[v]++<span class="hljs-keyword">if</span> count[v] &gt; graph.VNum &#123;<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"å­˜åœ¨è´Ÿç¯ï¼"</span>)&#125;<span class="hljs-comment">//æ³¨æ„DFSçš„ç»“æœä¸èƒ½ç›´æ¥returnï¼Œç›´æ¥returnçš„æ—¶å€™å›æº¯çš„æ—¶å€™å°±æ²¡æœ‰åŠæ³•åœ¨ä¸Šä¸€çº§é‡æ–°æ‰¾å€¼äº†</span>err := DFS(v)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">return</span> err&#125;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;&#125;e = e.Next&#125;visited[u] = <span class="hljs-literal">false</span><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span></code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/defer.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•05-æ ˆä¸‹: æ·±å…¥ç†è§£ defer</a></li><li><a href="https://lailin.xyz/post/stack.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•04-æ ˆä¸Š: å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨</a></li><li><a href="https://lailin.xyz/post/array_2.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•03-æ•°ç»„ä¸‹: ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å›¾</tag>
      
      <tag>æœ€çŸ­è·¯å¾„</tag>
      
      <tag>spfa</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ€çŸ­è·¯å¾„ç®—æ³•-Floyd</title>
    <link href="/post/60101.html"/>
    <url>/post/60101.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ä¸Šä¸€ç¯‡å½“ä¸­è®²äº† Dijkstra ç®—æ³•ï¼ŒDijkstra é€‚ç”¨äºå¯¹äºå•æºè·¯å¾„çš„æ±‚å–ï¼Œä½†æ˜¯å¯¹äºä»»æ„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„æœ€å°è·¯å¾„å‘¢ï¼Ÿé¦–å…ˆæƒ³åˆ°çš„å½“ç„¶æ˜¯ç›´æ¥ä½¿ç”¨å¤šæ¬¡çš„ Dijkstra ç®—æ³•æ¥æ±‚å–ä»»æ„ä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œä½†æ˜¯è¿™æ ·ä¸‹æ¥æ—¶é—´å¤æ‚åº¦ä¼šæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€ç§æ–°çš„ç®—æ³•ï¼ŒFloyd ç®—æ³•æ¥æ±‚å–æœ€çŸ­è·¯å¾„</p></blockquote><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>Floyd ç®—æ³•æ˜¯ä¸€ä¸ªç»å…¸çš„åŠ¨æ€è§„åˆ’ç®—æ³•ã€‚ç”¨é€šä¿—çš„è¯­è¨€æ¥æè¿°çš„è¯ï¼Œé¦–å…ˆæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯»æ‰¾ä»ç‚¹ i åˆ°ç‚¹ j çš„æœ€çŸ­è·¯å¾„ã€‚ä»åŠ¨æ€è§„åˆ’çš„è§’åº¦çœ‹é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªç›®æ ‡é‡æ–°åšä¸€ä¸ªè¯ é‡Š<br>ä»ä»»æ„èŠ‚ç‚¹ i åˆ°ä»»æ„èŠ‚ç‚¹ j çš„æœ€çŸ­è·¯å¾„ä¸å¤–ä¹ 2 ç§å¯èƒ½:</p><ul><li>1.ç›´æ¥ä» i åˆ° jï¼Œ</li><li>2.ä» i ç»è¿‡è‹¥å¹²ä¸ªèŠ‚ç‚¹ k åˆ° jã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬å‡è®¾ Dis(i,j)ä¸ºèŠ‚ç‚¹ u åˆ°èŠ‚ç‚¹ v çš„æœ€çŸ­è·¯å¾„çš„è·ç¦»ï¼Œå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ kï¼Œæˆ‘ä»¬æ£€æŸ¥ Dis(i,k) + Dis(k,j) &lt; Dis(i,j)æ˜¯å¦æˆç«‹ï¼Œå¦‚æœæˆç«‹ï¼Œè¯æ˜ä» i åˆ° k å†åˆ° j çš„è·¯å¾„æ¯” i ç›´æ¥åˆ° j çš„è·¯å¾„çŸ­ï¼Œæˆ‘ä»¬ä¾¿è®¾ç½® Dis(i,j) = Dis(i,k) + Dis(k,j)ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“æˆ‘ä»¬éå†å®Œæ‰€æœ‰èŠ‚ç‚¹ kï¼ŒDis(i,j)ä¸­è®°å½•çš„ä¾¿æ˜¯ i åˆ° j çš„æœ€çŸ­è·¯å¾„çš„è·ç¦»ã€‚</li></ul><h2 id="ç®—æ³•æè¿°ï¼š"><a href="#ç®—æ³•æè¿°ï¼š" class="headerlink" title="ç®—æ³•æè¿°ï¼š"></a>ç®—æ³•æè¿°ï¼š</h2><p>a.ä»ä»»æ„ä¸€æ¡å•è¾¹è·¯å¾„å¼€å§‹ã€‚æ‰€æœ‰ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»æ˜¯è¾¹çš„æƒï¼Œå¦‚æœä¸¤ç‚¹ä¹‹é—´æ²¡æœ‰è¾¹ç›¸è¿ï¼Œåˆ™æƒä¸ºæ— ç©·å¤§ã€‚ ã€€ã€€<br>b.å¯¹äºæ¯ä¸€å¯¹é¡¶ç‚¹ u å’Œ vï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé¡¶ç‚¹ w ä½¿å¾—ä» u åˆ° w å†åˆ° v æ¯”å·±çŸ¥çš„è·¯å¾„æ›´çŸ­ã€‚å¦‚æœæ˜¯æ›´æ–°å®ƒã€‚</p><h2 id="Golang-å®ç°"><a href="#Golang-å®ç°" class="headerlink" title="Golang å®ç°"></a>Golang å®ç°</h2><pre><code class="hljs go"><span class="hljs-keyword">package</span> ShortestPath<span class="hljs-keyword">import</span> (<span class="hljs-string">"errors"</span><span class="hljs-string">"github.com/mohuishou/algorithm/GraphMatrix"</span>)<span class="hljs-comment">//Floyd æ±‚å–å¤šæºæœ€çŸ­è·¯å¾„</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Floyd</span><span class="hljs-params">(graph GraphMatrix.Graph, dist [][]GraphMatrix.EdgeType, path [][]<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; graph.VNum; i++ &#123;<span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; graph.VNum; j++ &#123;path[i][j] = <span class="hljs-number">-1</span>dist[i][j] = graph.G[i][j]&#125;&#125;    <span class="hljs-comment">//æ³¨æ„ï¼Œkå¿…é¡»æ”¾åœ¨æœ€å¤–å±‚ï¼Œå¦‚æœæ”¾åœ¨æœ€é‡Œå±‚ä¼šè¿‡æ—©çš„ç¡®è®¤ä¸¤ç‚¹çš„æœ€çŸ­è·¯å¾„</span><span class="hljs-keyword">for</span> k := <span class="hljs-number">0</span>; k &lt; graph.VNum; k++ &#123;<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; graph.VNum; i++ &#123;<span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; graph.VNum; j++ &#123;<span class="hljs-comment">//æ‰¾åˆ°æ›´çŸ­çš„è·¯å¾„</span><span class="hljs-keyword">if</span> dist[i][k]+dist[k][j] &lt; dist[i][j] &#123;dist[i][j] = dist[i][k] + dist[k][j]<span class="hljs-comment">//å‘ç°è´Ÿå€¼åœˆ</span><span class="hljs-keyword">if</span> i == j &amp;&amp; dist[i][j] &lt; <span class="hljs-number">0</span> &#123;<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"å­˜åœ¨è´Ÿå€¼åœˆ"</span>)&#125;path[i][j] = k&#125;&#125;&#125;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>&#125;<span class="hljs-comment">//GetPathForFloyd è·å–è·¯å¾„</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetPathForFloyd</span><span class="hljs-params">(path [][]<span class="hljs-keyword">int</span>, s, t <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(tPath []<span class="hljs-keyword">int</span>)</span></span> &#123;tPath = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">1</span>)tPath[<span class="hljs-number">0</span>] = s<span class="hljs-keyword">for</span> &#123;s = path[s][t]<span class="hljs-keyword">if</span> s == <span class="hljs-number">-1</span> || s == t &#123;tPath = <span class="hljs-built_in">append</span>(tPath, t)<span class="hljs-keyword">return</span> tPath&#125;tPath = <span class="hljs-built_in">append</span>(tPath, s)&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/defer.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•05-æ ˆä¸‹: æ·±å…¥ç†è§£ defer</a></li><li><a href="https://lailin.xyz/post/stack.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•04-æ ˆä¸Š: å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨</a></li><li><a href="https://lailin.xyz/post/array_2.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•03-æ•°ç»„ä¸‹: ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å›¾</tag>
      
      <tag>æœ€çŸ­è·¯å¾„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é‚»æ¥è¡¨-Golang</title>
    <link href="/post/18885.html"/>
    <url>/post/18885.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€ç®€å•ç›´æ¥çš„åŠæ³•ä¸€èˆ¬å°±æ˜¯ä½¿ç”¨é‚»æ¥çŸ©é˜µçš„åŠæ³•æ¥è¡¨ç¤ºå›¾ï¼Œä½†æ˜¯å¯¹äºç¨€ç–å›¾æ¥è¯´è¾¹çš„æ•°ç›®æƒ³å¯¹æ¥è¯´æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨é‚»æ¥çŸ©é˜µçš„åŠæ³•ä¼šæ¯”è¾ƒæµªè´¹èµ„æºï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨é‚»æ¥è¡¨</p></blockquote><h2 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h2><p><a href="https://github.com/mohuishou/algorithm/tree/master/Graph" target="_blank" rel="noopener">https://github.com/mohuishou/algorithm/tree/master/Graph</a></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><pre><code class="hljs go"><span class="hljs-keyword">package</span> Graph<span class="hljs-keyword">import</span> (<span class="hljs-string">"bufio"</span><span class="hljs-string">"io"</span><span class="hljs-string">"os"</span><span class="hljs-string">"strconv"</span><span class="hljs-string">"strings"</span>)<span class="hljs-comment">// EdgeType è¾¹çš„æƒå€¼ç±»å‹</span><span class="hljs-keyword">type</span> EdgeType <span class="hljs-keyword">int</span><span class="hljs-comment">// VextexType é¡¶ç‚¹ç±»å‹å®šä¹‰</span><span class="hljs-keyword">type</span> VextexType <span class="hljs-keyword">int</span><span class="hljs-comment">// VextexDataType é¡¶ç‚¹å€¼ç±»å‹å®šä¹‰</span><span class="hljs-keyword">type</span> VextexDataType <span class="hljs-keyword">int</span><span class="hljs-comment">//EdgeNode è¾¹çš„èŠ‚ç‚¹</span><span class="hljs-keyword">type</span> EdgeNode <span class="hljs-keyword">struct</span> &#123;Weight EdgeType   <span class="hljs-comment">//æƒå€¼</span>V      VextexType <span class="hljs-comment">//æŒ‡å‘å‚¨å­˜è¯¥é¡¶ç‚¹çš„ä¸‹æ ‡</span>Next   *EdgeNode  <span class="hljs-comment">//æŒ‡å‘ä¸‹ä¸€æ¡è¾¹</span>&#125;<span class="hljs-comment">//VextexNode é¡¶ç‚¹èŠ‚ç‚¹å®šä¹‰</span><span class="hljs-keyword">type</span> VextexNode <span class="hljs-keyword">struct</span> &#123;data      VextexDataType <span class="hljs-comment">//é¡¶ç‚¹çš„å€¼</span>FisrtEdge *EdgeNode      <span class="hljs-comment">//è¯¥é¡¶ç‚¹æŒ‡å‘çš„ç¬¬ä¸€æ¡è¾¹</span>&#125;<span class="hljs-comment">//Graph å›¾</span><span class="hljs-keyword">type</span> Graph <span class="hljs-keyword">struct</span> &#123;VNum, ENum <span class="hljs-keyword">int</span>          <span class="hljs-comment">//é¡¶ç‚¹æ•°ç›®ï¼Œè¾¹æ•°ç›®</span>G          []VextexNode <span class="hljs-comment">//é‚»æ¥è¡¨</span>&#125;<span class="hljs-comment">//CreateGraph åˆ›å»ºé‚»æ¥è¡¨</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateGraph</span><span class="hljs-params">(VNum <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(graph Graph)</span></span> &#123;graph.VNum = VNumgraph.G = <span class="hljs-built_in">make</span>([]VextexNode, VNum)<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; VNum; i++ &#123;graph.G[i] = VextexNode&#123;&#125;&#125;<span class="hljs-keyword">return</span> graph&#125;<span class="hljs-comment">//AddEdge æ·»åŠ è¾¹</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(graph Graph)</span> <span class="hljs-title">AddEdge</span><span class="hljs-params">(s, t VextexType, weight EdgeType)</span></span> &#123;edge := &amp;EdgeNode&#123;V: t, Weight: weight&#125;<span class="hljs-comment">//æ·»åŠ è¾¹åˆ°å¤´éƒ¨</span>edge.Next = graph.G[s].FisrtEdgegraph.G[s].FisrtEdge = edge&#125;<span class="hljs-comment">//BuildGraph é€šè¿‡è¯»å–æ–‡ä»¶å»ºå›¾</span><span class="hljs-comment">//æ–‡ä»¶æ ¼å¼è¦æ±‚:</span><span class="hljs-comment">//é¡¶ç‚¹ä¸ªæ•° è¾¹æ•°</span><span class="hljs-comment">//é¡¶ç‚¹v1 é¡¶ç‚¹V2 è¾¹çš„æƒé‡</span><span class="hljs-comment">//...</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BuildGraph</span><span class="hljs-params">(path <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(graph Graph)</span></span> &#123;f, err := os.Open(path)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;buf := bufio.NewReader(f)i := <span class="hljs-number">0</span><span class="hljs-comment">//è¾¹çš„æ•°ç›®</span><span class="hljs-keyword">for</span> &#123;line, err := buf.ReadString(<span class="hljs-string">'\n'</span>)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-keyword">if</span> err == io.EOF &#123;<span class="hljs-keyword">return</span> graph&#125;<span class="hljs-built_in">panic</span>(err)&#125;line = strings.TrimSpace(line)data := strings.Split(line, <span class="hljs-string">" "</span>)<span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> &#123;n, err := strconv.Atoi(data[<span class="hljs-number">0</span>])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;graph = CreateGraph(n)graph.ENum, err = strconv.Atoi(data[<span class="hljs-number">1</span>])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> i &lt;= graph.ENum &#123;s, err := strconv.Atoi(data[<span class="hljs-number">0</span>])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;t, err := strconv.Atoi(data[<span class="hljs-number">1</span>])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;weight, err := strconv.Atoi(data[<span class="hljs-number">2</span>])<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<span class="hljs-built_in">panic</span>(err)&#125;graph.AddEdge(VextexType(s), VextexType(t), EdgeType(weight))&#125;i++&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/defer.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•05-æ ˆä¸‹: æ·±å…¥ç†è§£ defer</a></li><li><a href="https://lailin.xyz/post/stack.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•04-æ ˆä¸Š: å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨</a></li><li><a href="https://lailin.xyz/post/array_2.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•03-æ•°ç»„ä¸‹: ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>å›¾</tag>
      
      <tag>é‚»æ¥è¡¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ€çŸ­è·¯å¾„ç®—æ³•-Dijkstra</title>
    <link href="/post/13459.html"/>
    <url>/post/13459.html</url>
    
    <content type="html"><![CDATA[<h2 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h2><blockquote><p>è¿™ä¸ªç®—æ³•æ˜¯é€šè¿‡ä¸ºæ¯ä¸ªé¡¶ç‚¹ v ä¿ç•™ç›®å‰ä¸ºæ­¢æ‰€æ‰¾åˆ°çš„ä» s åˆ° v çš„æœ€çŸ­è·¯å¾„æ¥å·¥ä½œçš„ã€‚åˆå§‹æ—¶ï¼ŒåŸç‚¹ s çš„è·¯å¾„æƒé‡è¢«èµ‹ä¸º 0 ï¼ˆd[s] = 0ï¼‰ã€‚è‹¥å¯¹äºé¡¶ç‚¹ s å­˜åœ¨èƒ½ç›´æ¥åˆ°è¾¾çš„è¾¹ï¼ˆs,mï¼‰ï¼Œåˆ™æŠŠ d[m]è®¾ä¸º wï¼ˆs, mï¼‰,åŒæ—¶æŠŠæ‰€æœ‰å…¶ä»–ï¼ˆs ä¸èƒ½ç›´æ¥åˆ°è¾¾çš„ï¼‰é¡¶ç‚¹çš„è·¯å¾„é•¿åº¦è®¾ä¸ºæ— ç©·å¤§ï¼Œå³è¡¨ç¤ºæˆ‘ä»¬ä¸çŸ¥é“ä»»ä½•é€šå‘è¿™äº›é¡¶ç‚¹çš„è·¯å¾„ï¼ˆå¯¹äºæ‰€æœ‰é¡¶ç‚¹çš„é›†åˆ V ä¸­çš„ä»»æ„é¡¶ç‚¹ vï¼Œ è‹¥ v ä¸ä¸º s å’Œä¸Šè¿° m ä¹‹ä¸€ï¼Œ d[v] = âˆï¼‰ã€‚å½“ç®—æ³•ç»“æŸæ—¶ï¼Œd[v] ä¸­å­˜å‚¨çš„ä¾¿æ˜¯ä» s åˆ° v çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ–è€…å¦‚æœè·¯å¾„ä¸å­˜åœ¨çš„è¯æ˜¯æ— ç©·å¤§ã€‚<br>è¾¹çš„æ‹“å±•æ˜¯ Dijkstra ç®—æ³•çš„åŸºç¡€æ“ä½œï¼šå¦‚æœå­˜åœ¨ä¸€æ¡ä» u åˆ° v çš„è¾¹ï¼Œé‚£ä¹ˆä» s åˆ° v çš„æœ€çŸ­è·¯å¾„å¯ä»¥é€šè¿‡å°†è¾¹ï¼ˆu, vï¼‰æ·»åŠ åˆ°å°¾éƒ¨æ¥æ‹“å±•ä¸€æ¡ä» s åˆ° v çš„è·¯å¾„ã€‚è¿™æ¡è·¯å¾„çš„é•¿åº¦æ˜¯ d[u] + w(u, v)ã€‚å¦‚æœè¿™ä¸ªå€¼æ¯”ç›®å‰å·²çŸ¥çš„ d[v] çš„å€¼è¦å°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ–°å€¼æ¥æ›¿ä»£å½“å‰ d[v] ä¸­çš„å€¼ã€‚æ‹“å±•è¾¹çš„æ“ä½œä¸€ç›´è¿è¡Œåˆ°æ‰€æœ‰çš„ d[v] éƒ½ä»£è¡¨ä» s åˆ° v çš„æœ€çŸ­è·¯å¾„çš„é•¿åº¦å€¼ã€‚æ­¤ç®—æ³•çš„ç»„ç»‡ä»¤ d[u] è¾¾åˆ°å…¶æœ€ç»ˆå€¼æ—¶ï¼Œæ¯æ¡è¾¹ï¼ˆu, vï¼‰éƒ½åªè¢«æ‹“å±•ä¸€æ¬¡ã€‚<br>ç®—æ³•ç»´æŠ¤ä¸¤ä¸ªé¡¶ç‚¹é›†åˆ S å’Œ Qã€‚é›†åˆ S ä¿ç•™æ‰€æœ‰å·²çŸ¥æœ€å° d[v] å€¼çš„é¡¶ç‚¹ v ï¼Œè€Œé›†åˆ Q åˆ™ä¿ç•™å…¶ä»–æ‰€æœ‰é¡¶ç‚¹ã€‚é›†åˆ S åˆå§‹çŠ¶æ€ä¸ºç©ºï¼Œè€Œåæ¯ä¸€æ­¥éƒ½æœ‰ä¸€ä¸ªé¡¶ç‚¹ä» Q ç§»åŠ¨åˆ° Sã€‚è¿™ä¸ªè¢«é€‰æ‹©çš„é¡¶ç‚¹æ˜¯ Q ä¸­æ‹¥æœ‰æœ€å°çš„ d[u] å€¼çš„é¡¶ç‚¹ã€‚å½“ä¸€ä¸ªé¡¶ç‚¹ u ä» Q ä¸­è½¬ç§»åˆ°äº† S ä¸­ï¼Œç®—æ³•å¯¹ u çš„æ¯æ¡å¤–æ¥è¾¹ (u, v) è¿›è¡Œæ‹“å±•ã€‚</p></blockquote><p>å¦‚ä¸‹å›¾ï¼š<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142734.gif" srcset="/img/loading.gif" alt></p><h2 id="ä»£ç å®ç°-Golang"><a href="#ä»£ç å®ç°-Golang" class="headerlink" title="ä»£ç å®ç°-Golang"></a>ä»£ç å®ç°-Golang</h2><p><a href="https://github.com/mohuishou/algorithm/tree/master/ShortestPath" target="_blank" rel="noopener">github</a></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> ShortestPath<span class="hljs-keyword">import</span> (<span class="hljs-string">"errors"</span><span class="hljs-string">"container/list"</span><span class="hljs-string">"github.com/mohuishou/algorithm/Graph"</span>)<span class="hljs-comment">//INF æ— ç©·å¤§</span><span class="hljs-keyword">const</span> INF = <span class="hljs-number">0xffffff</span><span class="hljs-comment">//Dijkstra ç®—æ³•</span><span class="hljs-comment">//ä¸€ç§æ±‚å•æºæœ€çŸ­è·¯å¾„çš„ç®—æ³•</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Dijkstra</span><span class="hljs-params">(graph Graph.Graph, s Graph.VextexType, dist []Graph.EdgeType, path []Graph.VextexType)</span></span> &#123;visited := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">bool</span>, graph.VNum)<span class="hljs-comment">//åˆå§‹åŒ–</span><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; graph.VNum; i++ &#123;dist[i] = INF <span class="hljs-comment">//è·ç¦»ä¸ºæ— ç©·å¤§</span>path[i] = <span class="hljs-number">-1</span>  <span class="hljs-comment">//æ²¡æœ‰ä¸Šä¸€ä¸ªèŠ‚ç‚¹</span>visited[i] = <span class="hljs-literal">false</span>&#125;path[s] = sdist[s] = <span class="hljs-number">0</span><span class="hljs-comment">//ä½¿ç”¨listå®ç°ä¸€ä¸ªé˜Ÿåˆ—æ“ä½œ</span>q := list.New()<span class="hljs-comment">//å°†ç‚¹så…¥é˜Ÿ</span>q.PushBack(s)<span class="hljs-keyword">for</span> q.Len() != <span class="hljs-number">0</span> &#123;u := q.Front().Value.(Graph.VextexType)q.Remove(q.Front())<span class="hljs-comment">//å¦‚æœè¯¥ç‚¹å‘¨å›´çš„ç‚¹å·²ç»èµ°è¿‡ï¼Œåˆ™æ— éœ€å†èµ°</span><span class="hljs-keyword">if</span> visited[u] &#123;<span class="hljs-keyword">continue</span>&#125;<span class="hljs-comment">//å°†è¯¥ç‚¹åŠ å…¥å·²è§‚å¯Ÿ</span>visited[u] = <span class="hljs-literal">true</span>e := graph.G[u].FisrtEdge<span class="hljs-keyword">for</span> e != <span class="hljs-literal">nil</span> &#123;<span class="hljs-comment">//è¿™æ¡è¾¹ä¸‹çš„é¡¶ç‚¹</span>v := e.V<span class="hljs-comment">//å¦‚æœè¯¥ç‚¹å°šæœªèµ°è¿‡ï¼Œå¹¶ä¸”å½“å‰ç‚¹çš„è·ç¦»åŠ ä¸Šè¾¹çš„è·ç¦»å°äºä¹‹å‰è¯¥ç‚¹çš„è·ç¦»ï¼Œé‚£ä¹ˆå°±æ›´æ–°è¯¥ç‚¹çš„è·ç¦»</span><span class="hljs-keyword">if</span> visited[v] == <span class="hljs-literal">false</span> &amp;&amp; dist[v] &gt; dist[u]+e.Weight &#123;dist[v] = dist[u] + e.Weight <span class="hljs-comment">//æ›´æ–°è¯¥ç‚¹è·ç¦»</span>path[v] = u                  <span class="hljs-comment">//æ›´æ–°çˆ¶èŠ‚ç‚¹</span>q.PushBack(v)                <span class="hljs-comment">//å°†è¯¥ç‚¹å…¥é˜Ÿ</span>&#125;e = e.Next&#125;&#125;&#125;<span class="hljs-comment">//GetPath é€šè¿‡è·¯å¾„è·å¾—åˆ°æŒ‡å®šç›®çš„èŠ‚ç‚¹çš„è·¯å¾„</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetPath</span><span class="hljs-params">(path []Graph.VextexType, t Graph.VextexType)</span> <span class="hljs-params">([]Graph.VextexType, error)</span></span> &#123;tPath := <span class="hljs-built_in">make</span>([]Graph.VextexType, <span class="hljs-number">0</span>)<span class="hljs-keyword">for</span> &#123;tPath = <span class="hljs-built_in">append</span>(tPath, t)<span class="hljs-keyword">if</span> path[t] == <span class="hljs-number">-1</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"ä¸å­˜åœ¨åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„"</span>)&#125;<span class="hljs-keyword">if</span> t == path[t] &#123;<span class="hljs-keyword">return</span> tPath, <span class="hljs-literal">nil</span>&#125;t = path[t]&#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/defer.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•05-æ ˆä¸‹: æ·±å…¥ç†è§£ defer</a></li><li><a href="https://lailin.xyz/post/stack.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•04-æ ˆä¸Š: å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨</a></li><li><a href="https://lailin.xyz/post/array_2.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•03-æ•°ç»„ä¸‹: ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>åä¸ºè½¯æŒ‘</tag>
      
      <tag>å›¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åä¸ºè½¯æŒ‘2017</title>
    <link href="/post/4976.html"/>
    <url>/post/4976.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç¨ç¨æ€»ç»“ä¸€ä¸‹æœ€è¿‘å·®ä¸å¤šå‡ å¤©çš„å¿ƒè·¯å†ç¨‹ï¼Œè™½ç„¶æœ€åæ²¡æœ‰æ‹¿åˆ°åæ¬¡ï¼Œä½†æ˜¯ä»æœ€å¼€å§‹çš„è¿æœ€çŸ­è·¯å¾„æ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Œåˆ°ç°åœ¨çš„å·²ç»å¯ä»¥åˆ©ç”¨é—ä¼ ç®—æ³•+æœ€å°è´¹ç”¨æœ€å¤§æµç®—æ³•æ±‚å‡ºä¸€äº›å¯è¡Œçš„è§£ï¼Œå°±çŸ­çŸ­çš„ä¸åˆ°ä¸€å‘¨çš„æ—¶é—´ï¼Œå­¦ä¹ åˆ°äº†å¯ä»¥è¯´ä¹‹å‰ä¸€ä¸ªå­¦æœŸä¹Ÿæœªå¿…èƒ½å¤Ÿå­¦ä¹ åˆ°çš„çŸ¥è¯†ã€‚</p></blockquote><p>è¿™ä¸¤å¤©ä¼šæŠŠæœ€è¿‘å­¦åˆ°çš„ç›¸å…³çŸ¥è¯†è®°å½•åˆ°åšå®¢å½“ä¸­ï¼Œåœ¨è¿™å„¿æš‚ä¸”å…ˆåˆ—ä¸€ä¸ªå¤§çº²ï¼š</p><ul><li><p>æœ€çŸ­è·¯å¾„é—®é¢˜</p><ul><li>Dijkstra</li><li>Floyd</li><li>SPFA</li></ul></li><li><p>ç›¸å…³é—®é¢˜</p><ul><li>æœ€å¤§æµé—®é¢˜</li><li>æœ€å°è´¹ç”¨æœ€å¤§æµé—®é¢˜</li></ul></li><li><p>å¯å‘å¼ç®—æ³•</p><ul><li>é—ä¼ ç®—æ³•</li><li>æ¨¡æ‹Ÿé€€ç«ç®—æ³•</li><li>ç²’å­ç¾¤ç®—æ³•</li></ul><p>ä¸Šé¢éƒ½æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ç”¨åˆ°äº†çš„ä¸€äº›ç®—æ³•æˆ–è€…æ˜¯ä¸€äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯åœ¨å¯¹äºè¿™ä¸ªå…·ä½“çš„é—®é¢˜è§£å†³çš„æ—¶å€™è¿˜è¦åšå‡ºä¸€äº›å…·ä½“çš„è°ƒæ•´ï¼Œç›´æ¥å¥—ç”¨æ˜¯ä¸ä¼šå‡ºç»“æœçš„ã€‚</p><p>ä½†æ˜¯å¤§ä½“çš„æ€è·¯å°±æ˜¯å¯å‘å¼ç®—æ³•ç¡®å®šæœåŠ¡å™¨èŠ‚ç‚¹çš„æ•°ç›®ä»¥åŠä½ç½®ï¼Œç„¶åç”¨æœ€å°è´¹ç”¨æœ€å¤§æµå¾—åˆ°èŠ±è´¹ä»¥åŠç»“æœè·¯å¾„ã€‚</p></li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/defer.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•05-æ ˆä¸‹: æ·±å…¥ç†è§£ defer</a></li><li><a href="https://lailin.xyz/post/stack.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•04-æ ˆä¸Š: å¦‚ä½•å®ç°ä¸€ä¸ªè®¡ç®—å™¨</a></li><li><a href="https://lailin.xyz/post/array_2.html">Goæ•°æ®ç»“æ„ä¸ç®—æ³•03-æ•°ç»„ä¸‹: ä½¿ç”¨ GDB è°ƒè¯• Golang ä»£ç </a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>åä¸ºè½¯æŒ‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨vboxåœ¨winä¸‹æ­å»ºlinuxå¼€å‘ç¯å¢ƒ</title>
    <link href="/post/50696.html"/>
    <url>/post/50696.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¹‹å‰ä¸€ç›´åœ¨ç”¨ deepinï¼Œä½†æ˜¯æœ€è¿‘å› ä¸ºè¦ä½¿ç”¨ win ä¸‹çš„ä¸€äº›è½¯ä»¶å°±ç›´æ¥åˆ‡åˆ° win äº†ï¼Œæƒ³äº†æƒ³å¯ä¸å¯ä»¥ç›´æ¥æ­å»ºä¸€ä¸ª linux ç¯å¢ƒï¼Œåœ¨ windows ä¸‹ç¼–ç å‘¢<br>ç¬¬ä¸€æ¬¡å°è¯•çš„æ˜¯ docker çš„æ–¹æ¡ˆï¼Œä½†æ˜¯æœ€åæ”¾å¼ƒäº†ï¼Œå› ä¸º docker åˆ©ç”¨ vbox å»ºç«‹çš„è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™æ˜¯ä¸æ˜¯çš„ä¼šå‡ºç°é—®é¢˜ç„¶åå°±é‡å»ºï¼Œååˆ†çš„ä¸ç¨³å®šã€‚<br>æ‰€ä»¥è¿™æ¬¡ç›´æ¥ä½¿ç”¨è™šæ‹Ÿæœºæ­å»º</p></blockquote><h2 id="å‡†å¤‡å·¥å…·"><a href="#å‡†å¤‡å·¥å…·" class="headerlink" title="å‡†å¤‡å·¥å…·"></a>å‡†å¤‡å·¥å…·</h2><ul><li>ubuntu-16.04-server-amd64.iso (åªéœ€è¦å¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥ä½¿ç”¨ server å°±è¡Œä¸éœ€è¦æ¡Œé¢ç‰ˆ)</li><li>vbox 5.1.10ï¼ˆæˆ‘ä½¿ç”¨çš„æœ€æ–°ç‰ˆï¼‰</li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>1.å®‰è£… VBox</p><p><em>ä¸å†èµ˜è¿°ï¼Œç›´æ¥é»˜è®¤å°±è¡Œï¼Œæœ€å¥½ä¸è¦å®‰è£…åœ¨ C ç›˜ã€‚å¦‚æœæœ‰é—®é¢˜å¯ä»¥å‚è§ç½‘ä¸Šçš„å…¶ä»–æ•™ç¨‹</em></p><p>2.å®‰è£… UbuntuServer16.04</p><p><em>åšäº†å‡ ä¸ªåŠ¨å›¾</em></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142743.gif" srcset="/img/loading.gif" alt></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142745.gif" srcset="/img/loading.gif" alt></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142746.gif" srcset="/img/loading.gif" alt></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142747.gif" srcset="/img/loading.gif" alt></p><p>3.è®¾ç½®ç½‘å¡</p><p>VBox é»˜è®¤ä½¿ç”¨ NAT æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å¼ä¸‹ä¸»æœºæ˜¯ ping ä¸é€šè™šæ‹Ÿæœºçš„ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ª host-only ç½‘å¡ï¼Œä½¿ç”¨åŒç½‘å¡ï¼Œä¸€ä¸ª NAT ç”¨äºä¸Šç½‘ï¼Œä¸€ä¸ª host-only ç”¨äºå’Œä¸»æœºç›¸è¿ï¼Œä¹‹åç›´æ¥ç”¨ xshell è¿æ¥ï¼Œè™šæ‹Ÿæœºåå°æ‰“å¼€å°±è¡Œäº†ã€‚</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142747.png" srcset="/img/loading.gif" alt></p><p>è¿›å…¥è™šæ‹Ÿæœºï¼Œä½¿ç”¨<code>ifconfig</code>å‘½ä»¤å‘ç°åªæœ‰ä¸€å¼ ç½‘å¡<code>ifconfig -a</code>å‘ç°è¿˜æœ‰ä¸€å¼ ç½‘å¡<code>enp0s8</code>æœªè¿æ¥ä¸Š</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142748.png" srcset="/img/loading.gif" alt></p><p>è¾“å…¥<code>sudo vi /etc/network/interfaces</code></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142750.png" srcset="/img/loading.gif" alt></p><p>æ–°å¢ä¸‹é¢å‡ è¡Œ</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142751.png" srcset="/img/loading.gif" alt></p><p>ä¿å­˜é‡å¯</p><p><code>ifconfig</code> æŸ¥çœ‹ä¸€å…±å‡ºç°ä¸‰ä¸ªç½‘å¡<br>ä½¿ç”¨ä¸»æœº ping è™šæ‹Ÿæœºå¯ä»¥ ping é€š</p><p>4.å®‰è£… ssh æœåŠ¡ç«¯</p><pre><code class="hljs bash">sudo apt-get updatesudo apt-get install openssh-server</code></pre><p>å®‰è£…ä¹‹åå°±å¯ä»¥ä½¿ç”¨ xshell ç­‰å·¥å…·ç›´æ¥è¿æ¥è™šæ‹Ÿæœºäº†</p><p>5.å…±äº«æ–‡ä»¶å¤¹</p><p>(1).éœ€è¦å…ˆå®‰è£… vbox å¢å¼ºç»„ä»¶</p><p>a.å®‰è£…å¢å¼ºç»„ä»¶å‰éœ€è¦å…ˆè£…ä¸€äº›ä¾èµ–</p><pre><code class="hljs bash">sudo apt-get install aptitudesudo  aptitude install build-essential linux-headers-$(uname -r) -y</code></pre><p>b.ç‚¹å‡» vbox çš„èœå•ï¼Œæ·»åŠ å¢å¼ºåŠŸèƒ½</p><p>c.æŒ‚è½½å…‰ç›˜</p><pre><code class="hljs bash">sudo mount /dev/cdrom /mnt</code></pre><p>d.å®‰è£…å¢å¼ºåŠŸèƒ½</p><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /mntsudo ./VBoxLinuxAdditions.run</code></pre><p>å®‰è£…æˆåŠŸï¼Œé‡å¯</p><p>(2).æŒ‚è½½ç£ç›˜</p><p>a.åœ¨ VBox ä¸»ç•Œé¢-&gt;é€‰ä¸­è™šæ‹Ÿæœº-&gt;è®¾ç½®-&gt;å…±äº«æ–‡ä»¶å¤¹-&gt;æ·»åŠ å…±äº«æ–‡ä»¶å¤¹</p><p>b.<br>å‡è®¾å‘½åå…±äº«æ–‡ä»¶å¤¹ä¸º www</p><pre><code class="hljs bash">sudo mkdir /wwwsudo mount -t vboxsf www /www</code></pre><p>æŒ‚è½½æˆåŠŸ</p><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>ä¹‹å‰çš„å¯åŠ¨éƒ½æ˜¯æœ‰ç•Œé¢çš„ï¼Œä¹‹åä½¿ç”¨çš„æ—¶å€™å¸Œæœ›ä¸å‡ºç°ç•Œé¢ç›´æ¥åå°è¿è¡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ xshell è¿æ¥å°±å¥½<br>å¤åˆ¶ä¸‹é¢çš„ä»£ç ï¼Œæ–°å»ºä¸€ä¸ª UbuntuServer.bat ç²˜è´´è¿›å»ï¼Œä»¥åç›´æ¥ç‚¹å‡»è¿™ä¸ªè„šæœ¬å°±è¡Œäº†</p><pre><code class="hljs bash">%VBOX_MSI_INSTALL_PATH%VBoxManage startvm ubuntu --<span class="hljs-built_in">type</span> headless</code></pre><h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>åˆ°è¿™å„¿æ•´ä¸ªæµç¨‹å°±ç»“æŸäº†ï¼Œä¹‹åå¯ä»¥æ ¹æ®éœ€æ±‚æ·»åŠ è½¯ä»¶æˆ–è€…æ˜¯ç¯å¢ƒï¼Œä¾‹å¦‚ lnmpã€nodeã€golangã€javaã€gcc ç­‰ç­‰</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/50628.html">linuxä¸‹å¤©ç¿¼é£æ‰¬è®¤è¯ä¸Šç½‘çš„ä¸€ä¸ªè§£å†³æ–¹æ³•</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>è™šæ‹Ÿæœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨windowså®‰è£…dockertoolï¼Œå¹¶ä¸”é…ç½®æ–‡ä»¶å¤¹å…±äº«</title>
    <link href="/post/7964.html"/>
    <url>/post/7964.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä»Šå¤©æŠ˜è…¾äº†å¥½ä¹…ï¼Œç»ˆäºå¥½äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ç‚¹å°é—æ†¾ã€‚</p></blockquote><p>å®ç°ä¸‹é¢å‡ ä¸ªç‚¹</p><ul><li>å®‰è£… dockertool(é€šè¿‡ boot2docker ä»¥åŠ vbox é©±åŠ¨)</li><li>ä½¿ç”¨ kitematic å¯è§†åŒ–ç®¡ç†</li><li>å’Œ windows æœ¬åœ°å…±äº«æ–‡ä»¶å¤¹</li></ul><h2 id="å®‰è£…-dockertool"><a href="#å®‰è£…-dockertool" class="headerlink" title="å®‰è£… dockertool"></a>å®‰è£… dockertool</h2><h3 id="ä¸‹è½½-dockertool"><a href="#ä¸‹è½½-dockertool" class="headerlink" title="ä¸‹è½½ dockertool"></a>ä¸‹è½½ dockertool</h3><p>åœ°å€ä¸€ï¼š<a href="http://get.daocloud.io/#install-docker-for-mac-windows" target="_blank" rel="noopener">daocloud åŠ é€Ÿ</a><br>åœ°å€äºŒï¼š<a href="https://github.com/docker/toolbox/releases/tag/v1.12.3" target="_blank" rel="noopener">github</a></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>åŒå‡»æ–‡ä»¶å®‰è£…å³å¯ï¼Œå¯ä»¥æ›´æ”¹å®‰è£…ä½ç½®çš„é€‰é¡¹ï¼Œå…¶ä½™é»˜è®¤å³å¯<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142752.png" srcset="/img/loading.gif" alt><br>å¦‚æœç”µè„‘ä¸Šå·²ç»å®‰è£…äº† vbox å°†ä¸ä¼šå†å®‰è£…ï¼Œå¦‚æœæ²¡æœ‰ vbox å°†åœ¨ C ç›˜å®‰è£… VBoxï¼Œå¦‚æœä¸æƒ³å®‰è£…åˆ° C ç›˜å¯ä»¥æå‰å®‰è£…</p><h3 id="ä½¿ç”¨-kitematic-å¯è§†åŒ–ç®¡ç†"><a href="#ä½¿ç”¨-kitematic-å¯è§†åŒ–ç®¡ç†" class="headerlink" title="ä½¿ç”¨ kitematic å¯è§†åŒ–ç®¡ç†"></a>ä½¿ç”¨ kitematic å¯è§†åŒ–ç®¡ç†</h3><p>docker ToolBox è‡ªå¸¦ kitematic å¯ä»¥ç›´æ¥æ‰“å¼€<br><strong>æ³¨æ„ï¼š</strong> å¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡ MACHINE_STORAGE_PATHï¼Œæ›´æ”¹äº†è™šæ‹Ÿæœºçš„é»˜è®¤ä¿å­˜ä½ç½®ï¼Œkitematic å¯èƒ½ä¼šæ‰“ä¸å¼€ï¼Œå¹¶ä¸”å¯åŠ¨æŠ¥é”™ï¼š<code>Error: write EPROTO</code><br>æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯è¿™æ ·åªæœ‰ kitematic ä¸èƒ½ä½¿ç”¨ï¼Œdocker æ²¡æœ‰å½±å“</p><h3 id="ä½¿ç”¨åŠ é€Ÿå™¨"><a href="#ä½¿ç”¨åŠ é€Ÿå™¨" class="headerlink" title="ä½¿ç”¨åŠ é€Ÿå™¨"></a>ä½¿ç”¨åŠ é€Ÿå™¨</h3><p>åœ¨ä¸ä½¿ç”¨åŠ é€Ÿå™¨çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨çš„å‘ docker hub æ‹‰å–é•œåƒï¼Œä½†æ˜¯å›½å†…çš„è®¿é—® docker hub çš„é€Ÿåº¦å®åœ¨æ˜¯æœ‰äº›æ…¢ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨<a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">daoclou</a>çš„åŠ é€Ÿå™¨<br>æ‰“å¼€ powershell</p><pre><code class="hljs undefined">docker-machine ssh<span class="hljs-built_in"> default</span>sudo sed -i <span class="hljs-string">"s|EXTRA_ARGS='|EXTRA_ARGS='--registry-mirror=åŠ é€Ÿåœ°å€ |g"</span> /var/lib/boot2docker<span class="hljs-built_in">/profile</span>exitdocker-machine restart default</code></pre><p>ç¬¬ä¸€è¡Œï¼šè¿æ¥ sshï¼Œè¿›å…¥è™šæ‹Ÿæœº<br>ç¬¬äºŒè¡Œï¼šæ·»åŠ åŠ é€Ÿå™¨åœ°å€<br>ç¬¬ä¸‰è¡Œï¼šé€€å‡ºè™šæ‹Ÿæœº<br>ç¬¬å››è¡Œï¼šé‡å¯è™šæ‹Ÿæœº</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ xshell ç­‰è½¯ä»¶è¿æ¥ä¹‹åç›´æ¥è¾“å…¥</p><pre><code class="hljs undefined">sudo sed -i <span class="hljs-string">"s|EXTRA_ARGS='|EXTRA_ARGS='--registry-mirror=åŠ é€Ÿåœ°å€ |g"</span> /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">boot2docker</span>/<span class="hljs-title">profile</span></span></code></pre><p>ç„¶ååœ¨é€€å‡ºè¿æ¥ï¼Œåœ¨æœ¬æœºç¯å¢ƒä¸‹é‡å¯ docker-machine</p><pre><code class="hljs undefined"><span class="hljs-title">docker</span>-machine restart <span class="hljs-keyword">default</span></code></pre><h2 id="å…±äº«æ–‡ä»¶å¤¹"><a href="#å…±äº«æ–‡ä»¶å¤¹" class="headerlink" title="å…±äº«æ–‡ä»¶å¤¹"></a>å…±äº«æ–‡ä»¶å¤¹</h2><p>å…±äº«æ–‡ä»¶å¤¹æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ vbox ä¸ä¸»æœºå…±äº«æ–‡ä»¶å¤¹ç„¶ååœ¨è®© docker ä¸ boot2docker è™šæ‹Ÿæœºå…±äº«ï¼Œç¬¬äºŒç§æ˜¯åˆ›å»ºä¸€ä¸ª samba æœåŠ¡ã€‚<br>æˆ‘è¿™é‡Œä½¿ç”¨ç¬¬ä¸€ç§ã€‚</p><p>1.é¦–å…ˆåœ¨ vbox å½“ä¸­æ·»åŠ å…±äº«æ–‡ä»¶å¤¹<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-142753.png" srcset="/img/loading.gif" alt></p><p>2.ç„¶åè¿›å…¥ powershell æˆ–è€…å…¶ä»–çš„ shell è½¯ä»¶</p><p>è¿›å…¥è™šæ‹Ÿæœº(ä¸è¦ç›´æ¥åœ¨ vbox å½“ä¸­è¿›å…¥ï¼Œç›´æ¥è¿›å…¥å¯èƒ½ä¼šåˆ›å»ºå¤±è´¥)</p><pre><code class="hljs undefined"><span class="hljs-title">docker</span>-machine ssh <span class="hljs-keyword">default</span></code></pre><p>æŒ‚è½½æ–‡ä»¶å¤¹</p><pre><code class="hljs undefined">sudo mkdir <span class="hljs-string">/www</span>sudo mount -t vboxsf www <span class="hljs-string">/www</span></code></pre><p>www æ˜¯åœ¨ vbo å…±äº«æ–‡ä»¶å¤¹è®¾ç½®çš„ï¼Œ/www æ˜¯åœ¨è™šæ‹Ÿæœºä¸­æ–°å»ºçš„</p><p>æ–‡ä»¶å¤¹æŒ‚è½½æˆåŠŸä¹‹åå°±å¯ä»¥åˆ›å»º docker äº†ï¼Œä½†æ˜¯æ³¨æ„ä¸èƒ½ç›´æ¥åœ¨ kitematic å½“ä¸­åˆ›å»ºï¼Œkitematic å½“ä¸­åªèƒ½æŒ‚è½½<code>C\user</code>ä¸‹çš„ç›®å½•ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨åˆ›å»º docker å®¹å™¨<br>ä¾‹å¦‚ï¼š</p><pre><code class="hljs undefined">docker run -d -P <span class="hljs-params">--name</span> web -v <span class="hljs-string">/www</span>:<span class="hljs-string">/www</span> webdevops/php-apache-dev</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/51252.html">dockeré•œåƒç˜¦èº«&ä¼˜åŒ–</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨laravel/lumenä¹‹å¤–ä½¿ç”¨Eloquent</title>
    <link href="/post/29454.html"/>
    <url>/post/29454.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™å‘¨åˆšåšå®Œå­¦æ ¡çš„ä¸€ä¸ªæ™ºèƒ½ç¡¬ä»¶æ¯”èµ›çš„ä½œå“ï¼Œæˆ‘è´Ÿè´£åç«¯æœåŠ¡å™¨ï¼Œä»¥åŠé…å¥— App çš„åˆ¶ä½œã€‚æ•´ä¸ªä¸€å—éƒ½ç”¨ socket è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä½†æ˜¯å…¶ä¸­æ¶‰åŠåˆ°çš„æ•°æ®åº“çš„æ“ä½œï¼Œæœ€è¿‘ lumen ç”¨çš„æ¯”è¾ƒå¤šï¼Œè§‰å¾—å®ƒçš„æ•°æ®åº“çš„ç»„ä»¶ç‰¹åˆ«æ–¹ä¾¿ï¼Œæ‰€ä»¥å°±æƒ³çœ‹çœ‹èƒ½ä¸èƒ½å•ç‹¬æ‹¿å‡ºæ¥ä½¿ç”¨ã€‚</p></blockquote><p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾èµ„æ–™ï¼Œä¸»è¦åˆ†ä¸ºä¸¤æ­¥è¿›è¡Œ</p><h2 id="å®‰è£…ç›¸åº”çš„æ•°æ®åº“åŒ…"><a href="#å®‰è£…ç›¸åº”çš„æ•°æ®åº“åŒ…" class="headerlink" title="å®‰è£…ç›¸åº”çš„æ•°æ®åº“åŒ…"></a>å®‰è£…ç›¸åº”çš„æ•°æ®åº“åŒ…</h2><p><em>è¿™é‡Œä½¿ç”¨ 5.2 çš„åŒ…ï¼Œå¯ä»¥æ›´å…·è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ›´æ¢</em></p><pre><code class="hljs bash">composer require illuminate/database ~5.2</code></pre><h2 id="è®¾ç½®å¯åŠ¨æ–‡ä»¶-start-php"><a href="#è®¾ç½®å¯åŠ¨æ–‡ä»¶-start-php" class="headerlink" title="è®¾ç½®å¯åŠ¨æ–‡ä»¶(start.php)"></a>è®¾ç½®å¯åŠ¨æ–‡ä»¶(start.php)</h2><p>è¿™é‡Œå°†é…ç½®æ–‡ä»¶ä¸å¯åŠ¨æ–‡ä»¶åˆ†å¼€ï¼Œä¹Ÿå¯ä»¥åˆå¹¶åœ¨ä¸€èµ·ã€‚æˆ‘ç›´æ¥ä½¿ç”¨äº†ä¸€ä¸ª php æ–‡ä»¶è¿”å›æ•°ç»„ï¼Œä¹Ÿå¯ä»¥å¼•å…¥<code>vlucas/phpdotenv</code>ä½¿ç”¨.env æ–‡ä»¶æ¥é…ç½®å˜é‡</p><h3 id="start-php"><a href="#start-php" class="headerlink" title="start.php"></a>start.php</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/** * Created by mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt;. * User: mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt; * Date: 2016/11/14 0014 * Time: 18:50 */</span>$database = <span class="hljs-keyword">require_once</span> <span class="hljs-string">"config.php"</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">Container</span>;<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Database</span>\<span class="hljs-title">Capsule</span>\<span class="hljs-title">Manager</span> <span class="hljs-title">as</span> <span class="hljs-title">Capsule</span>;$capsule = <span class="hljs-keyword">new</span> Capsule;<span class="hljs-comment">// åˆ›å»ºé“¾æ¥</span>$capsule-&gt;addConnection($database);<span class="hljs-comment">// è®¾ç½®å…¨å±€é™æ€å¯è®¿é—®DB</span>$capsule-&gt;setAsGlobal();<span class="hljs-comment">// å¯åŠ¨Eloquent</span>$capsule-&gt;bootEloquent();</code></pre><h3 id="config-php"><a href="#config-php" class="headerlink" title="config.php"></a>config.php</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/** * Created by PhpStorm. * User: lxl * Date: 16-11-17 * Time: ä¸‹åˆ8:38 */</span><span class="hljs-keyword">return</span> [    <span class="hljs-string">'driver'</span> =&gt; <span class="hljs-string">'mysql'</span>,    <span class="hljs-string">'host'</span> =&gt; <span class="hljs-string">"localhost"</span>,    <span class="hljs-string">'database'</span> =&gt; <span class="hljs-string">"smart_lock"</span>,    <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">"root"</span>,    <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">"mima"</span>,    <span class="hljs-string">'charset'</span> =&gt; <span class="hljs-string">'utf8'</span>,    <span class="hljs-string">'collation'</span> =&gt; <span class="hljs-string">'utf8_unicode_ci'</span>,    <span class="hljs-string">'prefix'</span> =&gt; <span class="hljs-string">""</span>,];</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>laravel</tag>
      
      <tag>lumen</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaç¬”è®°1</title>
    <link href="/post/52826.html"/>
    <url>/post/52826.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>java åˆå­¦ç¬”è®°ï¼Œéšæ‰‹è®°å½•</p></blockquote><ul><li><p>å•å¼•å·è¡¨ç¤ºå­—ç¬¦<code>char</code>ç±»å‹(<em>ä¸å¸¸ç”¨</em>)ï¼ŒåŒå¼•å·æ‰æ˜¯å­—ç¬¦ä¸²</p></li><li><p>float ç±»å‹åé¢è¦æ·»åŠ  f<code>3.14f</code>(<em>ä¸å¸¸ç”¨</em>)ï¼Œä¸æ·»åŠ åç¼€é»˜è®¤ä¸º double</p></li><li><p><code>final</code>è¡¨ç¤ºå¸¸é‡ï¼Œ<code>static final</code>è¡¨ç¤ºç±»å¸¸é‡</p></li><li><p>ä½è¿ç®— - ä¸ï¼š<code>&amp;</code> - æˆ–ï¼š<code>|</code> - éï¼š<code>~</code> - å¼‚æˆ–ï¼š<code>^</code> - å·¦ç§»ï¼š<code>&lt;&lt;</code> - å³ç§»ï¼š<code>&gt;&gt;</code></p></li><li><p>ä¸è¦æŠŠå¸ƒå°”å€¼å¼ºåˆ¶è½¬æ¢ä¸ºä»»ä½•çš„å…¶ä»–æ•°å€¼ï¼Œå¦‚æœè¦è½¬æ¢ä¸º intï¼Œå¯ä»¥ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦<code>b ? 1:0</code></p></li><li><p>æ•°ç»„çš„å‘½å - <code>int[] a</code>(<em>æ›´å¸¸ç”¨</em>) - <code>int a[]</code></p></li><li><p>æ•°ç»„å¿…é¡»å…ˆåˆå§‹åŒ–æ‰èƒ½ä½¿ç”¨ï¼Œæ²¡æœ‰åˆå§‹åŒ–çš„æ•°ç»„ä¸èƒ½ä½¿ç”¨ - <code>int[] a=new int[100]</code></p></li><li><p>å‘½ä»¤è¡Œå‚æ•°</p></li></ul><pre><code class="hljs undefined"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> </span>&#123;&#125;</code></pre><p><em>main å‡½æ•°çš„å‚æ•°ï¼Œargs æ¥å—æ¥è‡ªå‘½ä»¤è¡Œçš„å‚æ•°ï¼Œæ¯ä¸€ä¸ªç©ºæ ¼æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯ç¨‹åºæ–‡ä»¶åä¸åŒ…å«åœ¨å†…</em></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/62897.html">javaä¸­å­—ç¬¦ä¸²ç›¸ç­‰çš„åˆ¤æ–­</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€é”®è¿ç§»typechoåˆ°hexo</title>
    <link href="/post/59080.html"/>
    <url>/post/59080.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸ºäº†æ›´å¥½çš„å†™åšå®¢ï¼Œæœ€è¿‘æ‰“ç®—æŠŠåšå®¢é™æ€åŒ–ï¼Œå‘ç°äº† node å†™çš„ hexoã€‚é¡ºä¾¿ä¹Ÿå¯ä»¥ç›´æ¥åˆ©ç”¨ github å’Œ coding çš„ pages æ¥æ­å»ºåšå®¢åŒæ—¶æŠŠä¹‹å‰é—²ç½®çš„æœªå¤‡æ¡ˆåŸŸå<a href="http://lailin.xyz">lailin.xyz</a>åˆ©ç”¨èµ·æ¥.</p></blockquote><p>å†™äº†ä¸€ä¸ª php çš„ typecho ä¸€é”®è½¬æ¢çš„å°ç¨‹åº:<a href="https://github.com/mohuishou/typecho2hexo" target="_blank" rel="noopener">github</a></p><h3 id="æ”¯æŒï¼š"><a href="#æ”¯æŒï¼š" class="headerlink" title="æ”¯æŒï¼š"></a>æ”¯æŒï¼š</h3><ul><li>æ–‡æ¡£ä¸€é”®è½¬å­˜ä¸º md æ–‡ä»¶</li><li>å­—ç¬¦ç¼–ç è½¬æ¢ï¼ˆgbk=&gt;utf8ï¼‰</li><li>å›¾ç‰‡/é™„ä»¶ä¸€é”®è½¬å­˜åˆ°æœ¬åœ°</li><li>å›¾ç‰‡/é™„ä»¶ä¸€é”®è½¬å­˜åˆ°ä¸ƒç‰›äº‘</li></ul><h3 id="ä½¿ç”¨è¯´æ˜ï¼š"><a href="#ä½¿ç”¨è¯´æ˜ï¼š" class="headerlink" title="ä½¿ç”¨è¯´æ˜ï¼š"></a>ä½¿ç”¨è¯´æ˜ï¼š</h3><h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><pre><code class="hljs undefined">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/mohuishou/typecho2hexo.gitcomposer install</code></pre><h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><p>å¤åˆ¶ config.example.php å¹¶é‡å‘½åä¸º config.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">return</span> [    <span class="hljs-string">"db"</span>=&gt;[        <span class="hljs-string">"host"</span>=&gt;<span class="hljs-string">"localhost"</span>, <span class="hljs-comment">//æ•°æ®åº“åœ°å€</span>        <span class="hljs-string">"port"</span>=&gt;<span class="hljs-number">3306</span>, <span class="hljs-comment">//ç«¯å£å·</span>        <span class="hljs-string">"name"</span>=&gt;<span class="hljs-string">"typecho"</span>, <span class="hljs-comment">//æ•°æ®åº“</span>        <span class="hljs-string">"user"</span>=&gt;<span class="hljs-string">"root"</span>, <span class="hljs-comment">//æ•°æ®åº“ç”¨æˆ·å</span>        <span class="hljs-string">"password"</span>=&gt;<span class="hljs-string">""</span>, <span class="hljs-comment">//æ•°æ®åº“å¯†ç </span>        <span class="hljs-string">"prefix"</span>=&gt;<span class="hljs-string">"typecho"</span>  <span class="hljs-comment">//è¡¨å‰ç¼€</span>    ],    <span class="hljs-string">"is_gbk"</span>=&gt;<span class="hljs-keyword">false</span>, <span class="hljs-comment">//æ˜¯å¦å¼€å¯gbkè½¬utf8ï¼ˆæœ‰äº›æ•°æ®åº“é‡Œé¢å‚¨å­˜çš„ä¸æ˜¯utf8æ ¼å¼éœ€è¦å¼€å¯è¿™ä¸ªé€‰é¡¹ï¼‰</span>    <span class="hljs-comment">//é™„ä»¶ç›¸å…³</span>    <span class="hljs-string">"attachment"</span>=&gt;[        <span class="hljs-string">"is_download"</span>=&gt;<span class="hljs-keyword">true</span>, <span class="hljs-comment">//æ˜¯å¦ä¸‹è½½é™„ä»¶</span>        <span class="hljs-string">"type"</span>=&gt;<span class="hljs-string">"file"</span> <span class="hljs-comment">//é™„ä»¶ä¿å­˜ç±»å‹ï¼šfile æˆ–è€… qiniu</span>    ],    <span class="hljs-comment">//ä¸ƒç‰›äº‘å‚¨å­˜ç›¸å…³</span>    <span class="hljs-string">"qiniu"</span>=&gt;[        <span class="hljs-string">"access_key"</span>=&gt;<span class="hljs-string">""</span>,        <span class="hljs-string">"secret_key"</span>=&gt;<span class="hljs-string">""</span>,        <span class="hljs-string">"bucket_name"</span>=&gt;<span class="hljs-string">"blog"</span>, <span class="hljs-comment">//ä¸ƒç‰›ç©ºé—´å</span>        <span class="hljs-string">"domain"</span>=&gt;<span class="hljs-string">"http://"</span> <span class="hljs-comment">//ä¸ƒç‰›å¤–é“¾åŸŸåï¼Œå¿…é¡»è®¾ç½®,å¸¦http://</span>    ]];</code></pre><h4 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h4><pre><code class="hljs undefined">php <span class="hljs-keyword">index</span>.php <span class="hljs-comment">//å‘½ä»¤è¡Œ</span></code></pre><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>1.å¦‚æœå‡ºç°ä¸Šä¼ é”™è¯¯ï¼Œé™„ä»¶ä¸‹è½½ä½¿ç”¨ curlï¼Œä¸‹è½½æ—¶é—´æœ€é•¿ä¸º 60sï¼Œå¦‚æœæœ‰æ¯”è¾ƒå¤§çš„æ–‡ä»¶æˆ–è€…æ˜¯ç½‘è·¯ç¯å¢ƒä¸å¥½ï¼Œè¯·æ‰‹åŠ¨æ›´æ”¹ä¸€ä¸‹ Lib/Attachment.phpï¼Œå½“ä¸­çš„æ–‡ä»¶æœ€é•¿ä¸‹è½½æ—¶é—´</p><pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">download</span><span class="hljs-params">($url,$filename,$dir)</span></span>&#123;    $path=$dir.<span class="hljs-string">"/"</span>.$filename;    $ch=curl_init();    $timeout=<span class="hljs-number">60</span>; <span class="hljs-comment">//æ–‡ä»¶æœ€é•¿ä¸‹è½½æ—¶é—´</span>    curl_setopt($ch,CURLOPT_URL,$url);    curl_setopt($ch,CURLOPT_FOLLOWLOCATION,<span class="hljs-number">1</span>);    curl_setopt($ch,CURLOPT_RETURNTRANSFER,<span class="hljs-number">1</span>);    curl_setopt($ch,CURLOPT_CONNECTTIMEOUT,$timeout);    $res=curl_exec($ch);    curl_close($ch);    <span class="hljs-comment">//æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨</span>    <span class="hljs-keyword">if</span>(!file_exists($dir)) mkdir($dir);    file_put_contents($path,$res);    <span class="hljs-keyword">return</span> $path;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/27142.html">hexo-next-algolia-searchå…¨æ–‡æœç´¢</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>php</tag>
      
      <tag>typecho</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨deepinä¸‹å®‰è£…shadowsocks-qt5</title>
    <link href="/post/46155.html"/>
    <url>/post/46155.html</url>
    
    <content type="html"><![CDATA[<h1 id="åœ¨-deepin-ä¸‹å®‰è£…-ss-qt5"><a href="#åœ¨-deepin-ä¸‹å®‰è£…-ss-qt5" class="headerlink" title="åœ¨ deepin ä¸‹å®‰è£… ss-qt5"></a>åœ¨ deepin ä¸‹å®‰è£… ss-qt5</h1><blockquote><p>å®˜ç½‘çš„æ–‡æ¡£ä¸Š Ubuntu å¯ä»¥é€šè¿‡æ·»åŠ ç§æœ‰æºçš„æ–¹å¼å®‰è£…ï¼Œdeepin ä¸è¡Œï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦ç›´æ¥ä»æºç ç¼–è¯‘å®‰è£…ã€‚</p></blockquote><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>æ£€æŸ¥ä¸‹é¢ä¸¤ä¸ªè½¯ä»¶æ˜¯å¦å·²ç»å®‰è£…ï¼Œdeepin è‡ªå¸¦çš„æ²¡æœ‰å®‰è£…ä¸Š</p><ul><li>git</li><li>g++</li></ul><h2 id="ä¸‹è½½æºä»£ç "><a href="#ä¸‹è½½æºä»£ç " class="headerlink" title="ä¸‹è½½æºä»£ç "></a>ä¸‹è½½æºä»£ç </h2><pre><code class="hljs undefined">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/shadowsocks/shadowsocks-qt5.git</code></pre><p><strong>wiki åœ°å€</strong>ï¼š<a href="https://github.com/shadowsocks/shadowsocks-qt5/wiki" target="_blank" rel="noopener">https://github.com/shadowsocks/shadowsocks-qt5/wiki</a></p><h2 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h2><p>1.æŒ‰ç…§ wiki è¿›è¡Œå®‰è£…</p><pre><code class="hljs bash">sudo apt-get install qt5-qmake qtbase5-dev libqrencode-dev libqtshadowsocks-dev libappindicator-dev libzbar-dev libbotan1.10-dev</code></pre><p>ä¼šå‡ºç°é”™è¯¯ï¼Œæ²¡æœ‰<code>libqtshadowsocks-dev</code>è¿™ä¸ªè½¯ä»¶åŒ…ï¼Œæ‰€ä»¥è¿™ä¸ªåŒ…æˆ‘ä»¬ä¹Ÿéœ€è¦è‡ªè¡Œç¼–è¯‘</p><p>2.ä¸‹è½½<code>libqtshadowsocks-dev</code>æºä»£ç </p><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/shadowsocks/libQtShadowsocks.git</code></pre><p>3.å®‰è£…ç¼–è¯‘æ‰€éœ€çš„å…¶ä»–ç»„ä»¶</p><pre><code class="hljs undefined">sudo apt-<span class="hljs-built_in">get</span> install qt5-qmake qtbase5-<span class="hljs-built_in">dev</span> libqrencode-<span class="hljs-built_in">dev</span>  libappindicator-<span class="hljs-built_in">dev</span> libzbar-<span class="hljs-built_in">dev</span> libbotan1<span class="hljs-number">.10</span>-<span class="hljs-built_in">dev</span></code></pre><p>4.ç¼–è¯‘<code>libqtshadowsocks-dev</code></p><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> libQtShadowsocksdpkg-buildpackage -uc -us -b</code></pre><p>ç¼–è¯‘æˆåŠŸä¹‹åä¼šåœ¨ä¸Šä¸€çº§ç›®å½•å‘ç°ä¸‰ä¸ª deb åŒ…ï¼ˆå®‰è£…åä¸¤ä¸ªï¼‰ï¼š</p><pre><code class="hljs bash">shadowsocks-libqtshadowsocks_1.9.0-1_amd64.deblibqtshadowsocks-dev_1.9.0-1_amd64.deblibqtshadowsocks_1.9.0-1_amd64.deb</code></pre><p>5.å®‰è£…æ‰€éœ€çš„ deb åŒ…(æ³¨æ„é¡ºåº)</p><pre><code class="hljs undefined"><span class="hljs-selector-tag">sudo</span> <span class="hljs-selector-tag">dpkg</span> <span class="hljs-selector-tag">-i</span> <span class="hljs-selector-tag">libqtshadowsocks_1</span><span class="hljs-selector-class">.9</span><span class="hljs-selector-class">.0-1_amd64</span><span class="hljs-selector-class">.deb</span><span class="hljs-selector-tag">sudo</span> <span class="hljs-selector-tag">dpkg</span> <span class="hljs-selector-tag">-i</span> <span class="hljs-selector-tag">libqtshadowsocks-dev_1</span><span class="hljs-selector-class">.9</span><span class="hljs-selector-class">.0-1_amd64</span><span class="hljs-selector-class">.deb</span></code></pre><p>6.ç¼–è¯‘<code>shadowsocks-qt5</code></p><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> shadowsocks-qt5dpkg-buildpackage -uc -us -b</code></pre><p>ç¼–è¯‘å®Œæˆä¹‹åä¼šåœ¨ä¸Šä¸€çº§ç›®å½•å‡ºç°ä¸€ä¸ª deb åŒ…<code>shadowsocks-qt5_2.7.0-1_amd64.deb</code>ï¼Œç‰ˆæœ¬ä¸åŒåŒ…åå¯èƒ½ä¼šæœ‰ä¸€äº›å°çš„åŒºåˆ«</p><p>7.å®‰è£…è¯•è¯• shadowsocks-qt5</p><pre><code class="hljs undefined"><span class="hljs-selector-tag">sudo</span> <span class="hljs-selector-tag">dpkg</span> <span class="hljs-selector-tag">-i</span> <span class="hljs-selector-tag">shadowsocks-qt5_2</span><span class="hljs-selector-class">.7</span><span class="hljs-selector-class">.0-1_amd64</span><span class="hljs-selector-class">.deb</span></code></pre><p><strong>å¤§åŠŸå‘Šæˆï¼Œæœ€ååœ¨å¯åŠ¨å™¨é‡Œé¢å°±å¯ä»¥çœ‹åˆ° ss-qt5 çš„å›¾æ ‡äº†ï¼Œæœ€åç»™å‡ºä¸Šé¢æåˆ°çš„æˆ‘ç¼–è¯‘æˆåŠŸçš„ç›¸å…³è½¯ä»¶åŒ…ï¼Œä¸ä¿è¯æœ‰ç”¨^^</strong></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ss</tag>
      
      <tag>deepin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å››å·å¤§å­¦é”æ·windowsè§£é™¤å¤šç½‘å¡é™åˆ¶</title>
    <link href="/post/18280.html"/>
    <url>/post/18280.html</url>
    
    <content type="html"><![CDATA[<h3 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h3><blockquote><p>æ¬åˆ°æœ›æ±Ÿæ ¡åŒºä¹‹åæ ¡å›­ç½‘å¿«äº†å¥½å¤šï¼Œä½†æ˜¯éœ€è¦é”æ·è®¤è¯ï¼Œé”æ·è¿™ä¸ªå‘è´§éœ€è¦é™åˆ¶å¤šç½‘å¡ï¼Œè€Œä¸”ç¨‹åºçš„å ç”¨å®åœ¨å¤ªå¤§ï¼Œååˆ†çš„ä¸æ–¹ä¾¿ã€‚ä½¿ç”¨ wifi å…±äº«è½¯ä»¶å¯ä»¥å¼€å¯ wifi çƒ­ç‚¹ï¼Œä½†æ˜¯ä¼šå‡ºç°è¿æ¥æ²¡å¤šä¹…æ²¡ç½‘çš„æƒ…å†µ</p></blockquote><p>æˆ‘ä½¿ç”¨çš„é”æ·ç‰ˆæœ¬æ˜¯ v4.96</p><h3 id="è§£å†³çš„é—®é¢˜"><a href="#è§£å†³çš„é—®é¢˜" class="headerlink" title="è§£å†³çš„é—®é¢˜"></a>è§£å†³çš„é—®é¢˜</h3><p>ç†è®ºä¸Šè¯´å¤šç½‘å¡é™åˆ¶çš„é—®é¢˜éƒ½å¯ä»¥è§£å†³æ‰ï¼š</p><ul><li>wifi çƒ­ç‚¹å…±äº«</li><li>VPNï¼ˆFQï¼‰</li><li>è™šæ‹Ÿæœº host-only</li></ul><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>1.é¦–å…ˆä½ å·²ç»å®‰è£…äº†é”æ·çš„å®¢æˆ·ç«¯å¹¶ä¸”ä½¿ç”¨å…¶å¯ä»¥è®¤è¯ä¸Šç½‘</p><p><em>æ›´æ–°ï¼šå¯ä»¥å°è¯•ç›´æ¥ä»ç¬¬äº”æ­¥å¼€å§‹ï¼Œå› ä¸ºæˆ‘å‘ç°å¥½åƒç›´æ¥ç»“æŸæ‰ç½‘å…¶å®ä¹Ÿä¸ä¼šæ‰</em></p><p>2.ç„¶åä¸‹è½½ mentohust win ç‰ˆæœ¬ï¼ˆ<a href="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/MentoHUST%EF%BC%88WINDOWS%E7%89%88%EF%BC%89.rar" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½</a>ï¼‰<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/4058054721.png" srcset="/img/loading.gif" alt="1ecdddfa-ec9a-473b-9a13-3b2e5c3b4fdb.png"></p><p>3.mentohust çš„ä½¿ç”¨æ–¹æ³•ç½‘ä¸Šæœ‰å¾ˆå¤šäº†è¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œ<a href="http://jingyan.baidu.com/article/47a29f2416ba37c015239957.html" target="_blank" rel="noopener">ç™¾åº¦ç»éªŒ</a></p><p>4.éœ€è¦æ³¨æ„è¿™é‡Œæœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œç›´æ¥æŒ‰ç…§ä¸Šé¢é“¾æ¥çš„æ–¹æ³•æ˜¯æ²¡æœ‰åŠæ³•è®¤è¯æˆåŠŸçš„ï¼Œåœ¨è®¾ç½®å¥½ä¹‹åç‚¹å‡»è®¤è¯å‰ï¼Œéœ€è¦å…ˆä½¿ç”¨é”æ·æˆåŠŸè®¤è¯ä¸Šç½‘ï¼Œç„¶åå†ä½¿ç”¨è¿™ä¸ªè½¯ä»¶è®¤è¯ 5.è®¤è¯æˆåŠŸä¹‹åæ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼Œæ‰¾åˆ° 8021.exe è¿™ä¸ªè¿›ç¨‹å¹²æ‰å°±å¯ä»¥äº† 6.ç„¶åä½¿ç”¨ win10 è‡ªå¸¦çš„ç§»åŠ¨çƒ­ç‚¹ä¹Ÿå¯ä»¥å¼€å¯çƒ­ç‚¹ä¸éœ€è¦å•ç‹¬ä¸‹è½½ wifi å…±äº«è½¯ä»¶<br>(å¦‚æœæ²¡æœ‰ï¼Œ<del>ä½¿ç”¨ wifi è½¯ä»¶,æµ‹è¯•çŒè±¹ wifi è¿˜æ˜¯ä¼šå‡ºç°æ²¡æœ‰ç½‘çš„æƒ…å†µ</del> æˆ–è€…ç›´æ¥ç”¨å‘½ä»¤è¡Œå¼€å¯ä¹Ÿæ˜¯å¯ä»¥çš„)<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/3439227638.png" srcset="/img/loading.gif" alt="1610c2cb-221c-42b6-8824-c47176e27cde.png"></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/5431.html">ä½¿ç”¨chromedpè§£å†³åçˆ¬è™«é—®é¢˜</a></li><li><a href="https://lailin.xyz/post/51466.html">å››å·å¤§å­¦æœ›æ±Ÿæ ¡åŒºä½¿ç”¨mentohustè®¤è¯ä¸Šç½‘</a></li><li><a href="https://lailin.xyz/post/31503.html">å››å·å¤§å­¦è¯„æ•™å¼€æºä»£ç </a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>å¤§å­¦</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç ´è§£</tag>
      
      <tag>å››å·å¤§å­¦</tag>
      
      <tag>é”æ·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</title>
    <link href="/post/43893.html"/>
    <url>/post/43893.html</url>
    
    <content type="html"><![CDATA[<h1 id="PHP-è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼"><a href="#PHP-è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼" class="headerlink" title="PHP è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼"></a>PHP è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</h1><blockquote><p>æœ€è¿‘ä¼šç®€å•çš„è‡ªæˆ‘æ€»ç»“ä¸€äº› php å½“ä¸­çš„ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œå½“ç„¶ä¸ªäººæ‰ç–å­¦æµ…ï¼Œå¯èƒ½äº›ä¸å¯¹çš„åœ°æ–¹æœ›å„ä½çœ‹å®˜è§è°…æŒ‡æ­£</p></blockquote><h2 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹çš„æ¨¡å¼ï¼Œç®€å•çš„è¯´å°±æ˜¯ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„</p><h2 id="ä¸ºä»€ä¹ˆï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆï¼Ÿ"></a>ä¸ºä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬ä¸€èˆ¬æœ€æ™®é€šçš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼æ˜¯è¿™æ ·<code>new classname()</code>,ä½†æ˜¯æ¢ä½æƒ³ä¸€ä¸‹ï¼Œè¿™æ ·åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æˆ‘ä»¬å¿…é¡»è¦çŸ¥é“ç±»åï¼Œä½†æ˜¯æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ä¸‹é¢å‡ ä¸ªæƒ…å†µï¼š</p><ol><li>å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç±»åå‘¢ï¼Ÿ</li><li>å¦‚æœæˆ‘åœ¨å¾ˆå¤šä¸ªæ–‡ä»¶å½“ä¸­éƒ½ç”¨åˆ°äº†è¿™ä¸ªç±»åˆ›å»ºå¯¹è±¡ï¼Œnew äº†å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯åœ¨é‡æ„æˆ–è€…å…¶ä»–ä»€ä¹ˆæƒ…å†µçš„æ—¶å€™æˆ‘è¦ä¿®æ”¹ç±»åæ€ä¹ˆåŠï¼Ÿå½“ç„¶æœ‰äººä¼šè¯´æ€ä¹ˆä¼šä¿®æ”¹ç±»åï¼Œè¿™æ˜¯æœ‰å¯èƒ½ä¼šé‡åˆ°çš„ï¼Œé‚£è¯´ä¸€ä¸€ä¸‹å¸¸è§ä¸€ç‚¹çš„ï¼Œå¦‚æœæˆ‘ç»™è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•åŠ äº†ï¼Œæˆ–è€…æ˜¯å°‘äº†ä¸€ä¸ªå‚æ•°ï¼Ÿé‚£å²‚ä¸æ˜¯å¾—ä¸€ä¸ªä¸ªçš„å»æ”¹</li><li>æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªæŠ½è±¡çš„åŸºç±»ï¼Œç”±å®ƒæ´¾ç”Ÿäº†å¾ˆå¤šå­ç±»ï¼Œæˆ‘ä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ·»åŠ å…¶ä»–çš„å­ç±»</li></ol><p>ä¸Šé¢å‡ ä¸ªéƒ½æ˜¯å¯èƒ½ä¼šé‡åˆ°çš„ä¸€äº›æƒ…å†µä¹‹ä¸€ï¼Œä½¿ç”¨å·¥å‚æ¨¡å¼å¯ä»¥æ¯”è¾ƒå¥½çš„è§£å†³ä¸Šé¢çš„é—®é¢˜</p><h2 id="æ€ä¹ˆåŠï¼Ÿ"><a href="#æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ€ä¹ˆåŠï¼Ÿ"></a>æ€ä¹ˆåŠï¼Ÿ</h2><h3 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Food</span></span>&#123;    <span class="hljs-comment">//todo</span>&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoodFactory</span></span>&#123;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> food();    &#125;&#125;$food= FoodFactory::create();</code></pre><p>ä¸Šé¢å®ç°ç®€å•å·¥å‚æ¨¡å¼,<code>FoodFactory</code>è¿™ä¸ªç±»å¾ˆç®€å•åªæœ‰ä¸€ä¸ªåˆ›å»ºæ–¹æ³•ï¼Œè¿”å› food ç±»çš„å®ä¾‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å‘ç°è¿™ä¸ªæ–¹æ³•å¾ˆç¬¨æ‹™ï¼Œåªèƒ½å®ç°ä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºï¼Œæ„Ÿè§‰æ¯”ç›´æ¥ new ä¸€ä¸ªå¯¹è±¡<br>å¥½ä¸äº†å¤šå°‘ï¼Œåªæ˜¯æ–¹ä¾¿æ”¹åŠ¨è€Œå·²</p><h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h3><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoodFactory</span></span>&#123;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">($classname)</span></span>&#123;    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">include_once</span> <span class="hljs-string">'class/'</span> . $classname . <span class="hljs-string">'.php'</span>)&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $classname;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">'Driver not found'</span>);        &#125;    &#125;&#125;</code></pre><p>é€šè¿‡ä¸Šé¢çš„æ–¹æ³•æˆ‘ä»¬å‘ç°æˆ‘ä»¬å·²ç»å¯ä»¥ä¸å±€é™äºï¼Œåˆ›å»ºä¸€ä¸ªå›ºå®šçš„ç±»çš„å¯¹è±¡äº†<br><strong>ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼š</strong><br><em>å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†å‘½åç©ºé—´çš„è¯ï¼Œåœ¨åŠ¨æ€å®ä¾‹åŒ–ç±»çš„æ—¶å€™å¿…é¡»åŒ…å«å®Œæ•´çš„å‘½åç©ºé—´ï¼Œæå‰ use æˆ–è€…å¤„äºç»Ÿä¸€å‘½åç©ºé—´éƒ½æ˜¯æ²¡æœ‰ç”¨çš„</em></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Mohuishou</span>\<span class="hljs-title">Lib</span>;  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoodFactory</span></span>&#123;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">($classname)</span></span>&#123;    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">include_once</span> <span class="hljs-string">'class/'</span> . $classname . <span class="hljs-string">'.php'</span>)&#123;        $classname=<span class="hljs-string">"Mohuishou\Lib\\"</span>.$classname;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $classname;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">'Driver not found'</span>);        &#125;    &#125;&#125;</code></pre><p>å¦‚æœæˆ‘ä»¬è¿˜æƒ³ä¼ å…¥å‚æ•°å‘¢ï¼Ÿ</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Mohuishou</span>\<span class="hljs-title">Lib</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoodFactory</span></span>&#123;    <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">($classname,$params)</span></span>&#123;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">include_once</span> <span class="hljs-string">'class/'</span> . $classname . <span class="hljs-string">'.php'</span>)&#123;    $classname=<span class="hljs-string">"Mohuishou\Lib\\"</span>.$classname;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $classname($params);&#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">'Driver not found'</span>);&#125;    &#125;&#125;</code></pre><p>å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç±»åï¼Œä¸çŸ¥é“æ–¹æ³•ï¼Œæ€ä¹ˆåŠ?æ€ä¹ˆå®ç°ä¸€ä¸ªä¸€èˆ¬çš„å·¥å‚æ¨¡å¼ï¼Ÿ<br>è¿™é‡Œå¯èƒ½éœ€è¦ç”¨åˆ°åå°„çš„æ¦‚å¿µäº†ï¼Œè¿™ç¯‡å°±ä¸è¿‡å¤šèµ˜è¿°</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-design-pattern.html">Goè®¾è®¡æ¨¡å¼24-æ€»ç»“(æ›´æ–°å®Œæ¯•)</a></li><li><a href="https://lailin.xyz/post/mediator.html">Goè®¾è®¡æ¨¡å¼23-ä¸­ä»‹æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/interpreter.html">Goè®¾è®¡æ¨¡å¼22-è§£é‡Šå™¨æ¨¡å¼</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å››å·å¤§å­¦æœ›æ±Ÿæ ¡åŒºä½¿ç”¨mentohustè®¤è¯ä¸Šç½‘</title>
    <link href="/post/51466.html"/>
    <url>/post/51466.html</url>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><blockquote><p>åˆšåˆšè§£å†³å®Œå¤©ç¿¼é£æ‰¬çš„ä¸Šç½‘é—®é¢˜ï¼Œç»“æœå°±æ¬æ ¡åŒºäº†ï¼ŒæŒ‰ç…§ä¸Šä¸€ç¯‡æ–‡ç« çš„æ–¹æ³•åœ¨è¿™è¾¹ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œä½†æ˜¯æ ¡å›­ç½‘ä½¿ç”¨çš„é”æ·è®¤è¯å·²ç»æä¾›äº† linux çš„å®¢æˆ·ç«¯äº†ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦é‚£ä¹ˆéº»çƒ¦äº†ã€‚ä½†æ˜¯åœ¨ä¿¡æ¯ç®¡ç†ä¸­å¿ƒä¸‹è½½çš„å®¢æˆ·ç«¯ç®€ç›´æ— è¯­ï¼Œå®¢æˆ·ç«¯å¿…é¡»è¦ç¦ç”¨åŒç½‘å¡ï¼Œè€Œä¸”è¿æ¥çš„çš„æ—¶å€™ä¼šå…ˆæŠŠä½ çš„ç½‘ç»œæœåŠ¡ç»™å…³é—­æ‰ã€‚ã€‚ã€‚ä½†æ˜¯æœ‰æ—¶å€™æœ‰å¼€ä¸äº†ã€‚å¦‚æœä¸æ‰‹åŠ¨ç¦ç”¨æ‰æ— çº¿ç½‘å¡ï¼Œè®¤è¯æˆåŠŸä¹‹å 3 åˆ†é’Ÿä¹‹å†…å¿…æ‰</p></blockquote><h2 id="mentohust"><a href="#mentohust" class="headerlink" title="mentohust"></a>mentohust</h2><blockquote><p>è¿˜å¥½æœ‰ mentohust è¿™ä¸ªç¥å™¨ï¼Œä½†æ˜¯ä½¿ç”¨å½“ä¸­è¿˜æ˜¯æœ‰ä¸€ç‚¹å°å‘</p></blockquote><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/4178932952.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160719182529.png"></p><p>1.é¦–å…ˆä¸‹è½½å®‰è£… mentohust</p><ul><li>å®˜æ–¹åœ°å€:<a href="https://code.google.com/archive/p/mentohust/downloads" target="_blank" rel="noopener">https://code.google.com/archive/p/mentohust/downloads</a></li><li><p>å®˜æ–¹çš„è¦ç¿»å¢™ï¼Œè¿™å„¿æä¾›ä¸€ä¸ª ubuntu/debian çš„<a href="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/994570489.deb" target="_blank" rel="noopener">mentohust_0.3.4-1-2_i386.deb</a></p><p>2.ç„¶ååœ¨å››å·å¤§å­¦ä¿¡æ¯ç®¡ç†ä¸­å¿ƒä¸‹è½½é”æ· 4.96 ç‰ˆæœ¬ï¼Œè§£å‹æå–<code>8021x.exe</code>,<code>W32N55.dll</code>,<code>SuConfig.dat</code>ç§»åŠ¨åˆ°<code>/etc/mentohust</code></p><p>3.åœ¨ç»å†ä¸€ä¸ªä¸€ä¸ªå°è¯•ä¹‹åçš„å¯ç”¨æ¨¡å¼</p></li></ul><pre><code class="hljs undefined"><span class="hljs-symbol">sudo</span> mentohust -uç”¨æˆ·å -på¯†ç  -a0 -<span class="hljs-built_in">d2</span> -<span class="hljs-keyword">b2 </span>-<span class="hljs-built_in">v4</span>.<span class="hljs-number">96</span> -w //ä¸‹æ¬¡ä½¿ç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨sudo mentohustå°±å¯ä»¥äº†</code></pre><p><strong>æ³¨æ„ï¼šå¦‚æœæ˜¾ç¤ºè®¤è¯æˆåŠŸä½†æ˜¯æ— æ³•ä¸Šç½‘ï¼Œè¯•ä¸€è¯•å…ˆå…³é—­æœ‰çº¿ç½‘ç»œçš„è¿æ¥ç„¶åå†æ‰“å¼€ï¼Œç„¶åé©¬ä¸Šè¾“å…¥ä¸Šé¢çš„å‘½ä»¤ï¼Œå³å¯ã€‚æ‹”æ’ç½‘çº¿ä¹Ÿå¯ä»¥</strong></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/5431.html">ä½¿ç”¨chromedpè§£å†³åçˆ¬è™«é—®é¢˜</a></li><li><a href="https://lailin.xyz/post/18280.html">å››å·å¤§å­¦é”æ·windowsè§£é™¤å¤šç½‘å¡é™åˆ¶</a></li><li><a href="https://lailin.xyz/post/31503.html">å››å·å¤§å­¦è¯„æ•™å¼€æºä»£ç </a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>å¤§å­¦</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å››å·å¤§å­¦</tag>
      
      <tag>mentohust</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxä¸‹å¤©ç¿¼é£æ‰¬è®¤è¯ä¸Šç½‘çš„ä¸€ä¸ªè§£å†³æ–¹æ³•</title>
    <link href="/post/50628.html"/>
    <url>/post/50628.html</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>åšä¸»å°è¯•è¿‡è®¸å¤šçš„æ–¹æ³•ä¸€ç›´æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ï¼šè™šæ‹Ÿæœºæ¡¥æ¥ ï¼Œcrossoverã€wine æ¨¡æ‹Ÿï¼Œå¾ˆæ—©ä»¥å‰çš„ linux ç‰ˆæœ¬ç­‰ç­‰ï¼Œæœ€åéƒ½æ²¡æœ‰æˆåŠŸï¼Œä½†æ˜¯å½“è¦æ¬æ ¡åŒºï¼Œä¸å†ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯çš„å‰ä¸€å¤©æ™šä¸Šï¼Œçªå‘å¥‡æƒ³ç»“æœè§£å†³äº†â€¦.</p></blockquote><p>ç†è®ºä¸Šè¯¥æ–¹æ³•å¯¹äºæ‰€æœ‰éœ€è¦è®¤è¯çš„ä¸Šç½‘å®¢æˆ·ç«¯æœ‰æ•ˆ</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>1.å®‰è£… virtualbox 2.ä¸‹è½½ windows é•œåƒï¼Œåšä¸»ä½¿ç”¨ xp</p><h2 id="å¼€å§‹è®¾ç½®"><a href="#å¼€å§‹è®¾ç½®" class="headerlink" title="å¼€å§‹è®¾ç½®"></a>å¼€å§‹è®¾ç½®</h2><p>1.é¦–å…ˆå®‰è£… windows è™šæ‹Ÿæœº,è™šæ‹Ÿæœºè®¾ç½®:</p><ul><li>å†…å­˜éšæ„ï¼Œå¯ä»¥åœ¨æµ‹è¯•å¥½ä¹‹åï¼Œè®¾ç½®ä¸ºèƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„æœ€å°å†…å­˜ï¼Œæˆ‘å…ˆä½¿ç”¨çš„æ˜¯ 512M</li><li>ç½‘å¡ï¼Œè®¾ç½®ä¸¤å¼ ç½‘å¡ï¼Œä¸€ä¸ªä½¿ç”¨æ¡¥æ¥ï¼Œæ¡¥æ¥åˆ°è¿æ¥å®½å¸¦çš„æœ‰é™ç½‘ç»œä¸Šï¼Œå¦ä¸€ä¸ªä½¿ç”¨ host-only ç”¨äºç»„å»ºå±€åŸŸç½‘</li></ul><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/3069020784.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160718200311.png"><br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/878380818.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160718200300.png"></p><p>2.åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨å®½å¸¦çš„å®¢æˆ·ç«¯æ‹¨å·ä¸Šç½‘</p><p>3.æŸ¥çœ‹å±€åŸŸç½‘åœ°å€</p><ul><li>è™šæ‹Ÿæœºå½“ä¸­ä½¿ç”¨<code>ipconfig</code>å‘½ä»¤</li><li>ä¸»æœºå½“ä¸­ä½¿ç”¨<code>ifconfig</code>å‘½ä»¤</li><li>å¦‚å›¾æ‰€ç¤º</li></ul><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/3302058632.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160718202926.png"></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/3537084827.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160718202945.png"></p><p>4.åœ¨è™šæ‹Ÿæœºå½“ä¸­ä½¿ç”¨æœåŠ¡å™¨ä»£ç†è½¯ä»¶ï¼Œç„¶åä¸»æœºå®ç°ä»£ç†ä¸Šç½‘ï¼Œæ¥¼ä¸»ä½¿ç”¨çš„ TGate</p><ul><li>TGate è®¾ç½®å¦‚å›¾æ‰€ç¤º</li></ul><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/1779186853.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160718203937.png"></p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/1448439344.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160718204111.png"></p><p>5.åœ¨ä¸»æœºè®¾ç½®ä»£ç†ä¸Šç½‘</p><ul><li>å¯ä»¥è®¾ç½®å…¨å±€ä»£ç†ï¼Œä½†æ˜¯åšä¸»çš„ deepin å…¨å±€ä»£ç†å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥å°±å…ˆè®¾ç½® chrome çš„ä»£ç†äº†</li><li>å¦‚å›¾æ‰€ç¤º<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/3447026534.png" srcset="/img/loading.gif" alt="æ·±åº¦æˆªå›¾20160718204345.png"></li></ul><blockquote><p>æ¥¼ä¸»åˆ°æ­¤å·²ç»å¯ä»¥ä½¿ç”¨äº†</p></blockquote><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/50696.html">åˆ©ç”¨vboxåœ¨winä¸‹æ­å»ºlinuxå¼€å‘ç¯å¢ƒ</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>å¤§å­¦</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤©ç¿¼é£æ‰¬</tag>
      
      <tag>linux</tag>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</title>
    <link href="/post/13242.html"/>
    <url>/post/13242.html</url>
    
    <content type="html"><![CDATA[<h3 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h3><p>laravel ç‰ˆæœ¬ï¼š<code>5.2</code><br>è™šæ‹Ÿä¸»æœºï¼šä¸‡ç½‘</p><h3 id="è¿ç§»"><a href="#è¿ç§»" class="headerlink" title="è¿ç§»"></a>è¿ç§»</h3><p>1.å…ˆæŠŠæ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°ç½‘ç«™æ ¹ç›®å½• 2.ç”±äºè®¿é—®çš„æ—¶å€™å…¥å£æ–‡ä»¶åœ¨ public ç›®å½•ä¸‹é¢ï¼Œè¿™æ—¶å€™è®¿é—® url ä¼šå˜æˆ url/public/ï¼Œé‡å†™è§„åˆ™è·³è½¬å°±è¡Œäº†,åœ¨æ ¹ç›®å½•æ–°å»º.hatcess æ–‡ä»¶</p><pre><code class="hljs undefined"><span class="hljs-section">&lt;IfModule mod_rewrite.c&gt;</span>    <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span> <span class="hljs-literal">on</span>    <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%&#123;REQUEST_URI&#125;</span> !^public    <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span> ^(.*)$ public/<span class="hljs-number">$1</span><span class="hljs-meta"> [L]</span><span class="hljs-section">&lt;/IfModule&gt;</span></code></pre><p>3.æ‰“å¼€<code>config/app.php</code><br>å°†</p><pre><code class="hljs undefined"><span class="hljs-string">'key'</span> =&gt; env(<span class="hljs-string">'APP_KEY'</span>, <span class="hljs-string">'...'</span>), <span class="hljs-comment">//32ä½å­—ç¬¦ä¸²</span><span class="hljs-string">'cipher'</span> =&gt; <span class="hljs-string">'AES-256-CBC'</span>,</code></pre><p>æ”¹ä¸º</p><pre><code class="hljs undefined"><span class="hljs-string">'key'</span> =&gt; env(<span class="hljs-string">'APP_KEY'</span>, <span class="hljs-string">'...'</span>),<span class="hljs-comment">//16ä½å­—ç¬¦ä¸²</span><span class="hljs-string">'cipher'</span> =&gt; <span class="hljs-string">'AES-128-CBC'</span>,</code></pre><p><em>ç”±äºä¸‡ç½‘ä¸æ”¯æŒâ€™AES-256-CBCâ€™æ‰€ä»¥ç”¨ 128 ä½åŠ å¯†ï¼Œ256 ä½åŠ å¯†ä½¿ç”¨ 32 ä½å­—ç¬¦ä¸²ï¼Œ128 ä½ä½¿ç”¨ 16 ä½å­—ç¬¦ä¸²</em> 4.åˆ°è¿™ä¸€æ­¥åŸºæœ¬å°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ ajax çš„æ—¶å€™ï¼Œpost æ–¹æ³•æœ‰å¯èƒ½ä¼šè¢« 301 è·³è½¬ç„¶åå˜æˆ get<br>è§£å†³æ–¹æ¡ˆï¼š<br>æ‰“å¼€<code>public</code>ç›®å½•ä¸‹çš„<code>.htaccess</code>æ–‡ä»¶åˆ é™¤ä¸‹é¢è¿™ä¸€æ®µ</p><pre><code class="hljs undefined"><span class="hljs-comment"># Redirect Trailing Slashes If Not A Folder...</span>  <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span> <span class="hljs-variable">%&#123;REQUEST_FILENAME&#125;</span> !-d  <span class="hljs-attribute"><span class="hljs-nomarkup">RewriteRule</span></span> ^(.*)/$ /<span class="hljs-number">$1</span><span class="hljs-meta"> [L,R=301]</span></code></pre><p>5.å¥½äº†ï¼Œæˆ‘çš„ä½¿ç”¨è¿‡ç¨‹ä¸­å°±æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼ˆæ³¨ï¼šæŠŠåœ¨æ§åˆ¶å°æŠŠä¸‡ç½‘çš„ php ç‰ˆæœ¬è°ƒåˆ°æœ€é«˜ï¼Œç°åœ¨æ˜¯ 5.5ï¼‰</p><p><strong>è¡¥å……ä¸€ç‚¹å¾ˆå¤šäººå®¹æ˜“å¿½ç•¥çš„ï¼Œé…ç½®æ–‡ä»¶ä¸è¦å¸è½½.env æ–‡ä»¶é‡Œé¢ï¼Œè™šæ‹Ÿæœºä¸€èˆ¬ä¸æ”¯æŒï¼Œæ¢åˆ° config ç›®å½•ä¸‹çš„ç›¸åº”é…ç½®æ–‡ä»¶ä¸‹</strong></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/29454.html">åœ¨laravel/lumenä¹‹å¤–ä½¿ç”¨Eloquent</a></li><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>laravel</tag>
      
      <tag>è™šæ‹Ÿä¸»æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨lnmp+owncloud+ossfs+ossæ­å»ºå±äºè‡ªå·±çš„ç§æœ‰äº‘ç›˜</title>
    <link href="/post/8013.html"/>
    <url>/post/8013.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç»å¸¸å†™ä¸€å†™æ–‡æ¡£ä¹‹ç±»çš„ä¸œè¥¿ï¼Œéœ€è¦ä¸€ä¸ªåŒæ­¥ç½‘ç›˜ï¼Œä½†æ˜¯ç°åœ¨å¸‚é¢ä¸Šçš„è¿˜æ˜¯æ»¡è¶³ä¸äº†æˆ‘çš„è¦æ±‚ï¼Œçªç„¶å‘ç°é˜¿é‡Œäº‘çš„ oss å¯ä»¥æŒ‚è½½æˆè™šæ‹Ÿç£ç›˜ï¼Œè¯•ç€æŠ˜è…¾äº†ä¸€ä¸‹æ•ˆæœè¿˜ä¸é”™ï¼Œä¸è¿‡è¿™ä¸­é—´è¿˜æ˜¯æœ‰è®¸å¤šçš„å‘</p></blockquote><h3 id="ä¹‹å‰ä½¿ç”¨çš„äº‘ç›˜"><a href="#ä¹‹å‰ä½¿ç”¨çš„äº‘ç›˜" class="headerlink" title="ä¹‹å‰ä½¿ç”¨çš„äº‘ç›˜"></a>ä¹‹å‰ä½¿ç”¨çš„äº‘ç›˜</h3><ol><li><p>åšæœäº‘<br>ä¸ªäººè®¤ä¸ºæ˜¯ç°åœ¨å¸‚é¢ä¸Šæœ€å¥½çš„åŒæ­¥ç›˜äº†ï¼Œæ”¯æŒå¢é‡åŒæ­¥ï¼Œå¤šå¹³å°æœ‰ linux ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ webdavã€‚ç¾ä¸­ä¸è¶³çš„å…è´¹ç‰ˆæ¯ä¸ªæœˆé™åˆ¶ä¸Šä¼ ä¸‹è½½æµé‡ï¼Œæ”¶è´¹ç‰ˆä¸é™åˆ¶æµé‡æœ‰ç©ºé—´é™åˆ¶ã€‚æœ‰æ®µæ—¶é—´çªç„¶æœ‰å¤§é‡æ–‡ä»¶éœ€è¦å¤‡ä»½å¯¼è‡´æµé‡ä¸è¶³ï¼Œä½†æ˜¯å¹³æ—¶åˆç”¨ä¸äº†å¤ªå¤šï¼Œå¼€ä¸€ä¸ªæœˆä¸“ä¸šç‰ˆçš„ç©ºé—´åˆä¸å¤Ÿï¼Œç”¨çš„æœ‰ç‚¹æ†‹å±ˆæ‰€ä»¥å°±å¼ƒç”¨äº†ã€‚</p></li><li><p>ç™¾åº¦äº‘ç­‰<br>åœ¨ä½¿ç”¨åšæœäº‘ä¹‹å‰çš„ä¸»åŠ›ç½‘ç›˜ï¼ŒåŒæ­¥ç›˜åŠŸèƒ½ç«Ÿç„¶è¦ä¼šå‘˜æ‰èƒ½ç”¨ï¼Œè€Œä¸”åŒæ­¥ç›˜åšçš„å¾ˆä¸å¥½ç”¨ï¼Œä¸è¿‡ç”¨æ¥åšèµ„æºåˆ†äº«ä¹‹ç±»çš„è¿˜ä¸é”™</p></li></ol><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨-oss"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-oss" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ oss"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ oss</h3><ol><li><p>æ•°æ®çš„ç¨³å®šæ€§ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢æŠ˜è…¾æ‰€ä»¥æœåŠ¡å™¨æœ‰æ—¶å€™å°±ä¼šé‡è£…è¿™æ—¶å€™å¯¹äºæ–‡ä»¶å°±éå¸¸çš„ä¸å¥½ç®¡ç†å’Œå¤‡ä»½ï¼Œæ”¾åœ¨ oss ä¸Šé¢èƒ½å¤Ÿæ›´å¥½çš„ç®¡ç†</p></li><li><p>ç¬¬äºŒä¸ªå°±æ˜¯ä¾¿å®œï¼Œä¸å’Œå…¶ä»–å‡ å®¶çš„äº‘æœåŠ¡å¯¹æ¯”ä»…ä»…å’Œé˜¿é‡Œäº‘çš„äº‘ç›˜ï¼Œå°±æ˜¯ä¹°æœåŠ¡å™¨çš„æ—¶å€™çš„ä¸€ä¸ªé€‰é¡¹ï¼Œä¾¿å®œå¾ˆå¤šã€‚40g çš„è¯ä¸€å¹´ä¹Ÿå°±å·®ä¸å¤š 10 å¤šå—çš„æ ·å­ã€‚è€Œä¸”å’Œ ECS æ­é…ä½¿ç”¨æ²¡æœ‰æµé‡è´¹ç”¨</p></li></ol><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>å®‰è£… lnmp æ¶æ„</p><blockquote><p>å…¶å® owncloud å®˜æ–¹æ›´åŠ æ¨è lampï¼Œä½†æ˜¯æˆ‘ä¸ªäººæ›´å–œæ¬¢ nginxï¼Œè¦æ¯” Apache çœèµ„æºä¸€äº›ï¼Œèƒ½å¤Ÿç”¨ Apache çš„ä¹Ÿå¾ˆä¸é”™ï¼Œå¯ä»¥å°‘è¸©å¾ˆå¤šé…ç½®çš„å‘ï¼Œowncloud çš„ nginx å®˜æ–¹ç¤ºä¾‹é…ç½®å¾ˆå¤šå‘ï¼Œä¹‹åä¼šè¯´åˆ°</p></blockquote><h3 id="å®‰è£…-ossfs"><a href="#å®‰è£…-ossfs" class="headerlink" title="å®‰è£… ossfs"></a>å®‰è£… ossfs</h3><blockquote><p>æ³¨æ„ï¼šåœ¨è¿™ä¹‹å‰ä½ éœ€è¦å…ˆå¼€é€š ossï¼Œæœ€å¥½æ˜¯å’Œä½ çš„ ECS æ˜¯ä¸€ä¸ªåœ°åŒºçš„ï¼Œå½“ç„¶ä¸æ˜¯ç”¨çš„ ECS ä¹Ÿå¯ä»¥ç”¨ï¼Œåªæ˜¯é€Ÿåº¦ä¼šæ…¢ä¸€äº›ï¼Œè¿˜æœ‰å°±æ˜¯ä¸‹è½½ä¼šä½¿ç”¨å…¬ç½‘æµé‡ï¼Œä¸Šä¼ æ²¡æœ‰</p></blockquote><p>1.<a href="https://help.aliyun.com/document_detail/32196.html" target="_blank" rel="noopener">ç‚¹å‡»æ‰“å¼€ ossfs çš„ä¸‹è½½é¡µé¢ä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„å®‰è£…åŒ…</a> 2.æˆ‘å·² Ubuntu ä¸ºä¾‹ï¼Œå®‰è£… ossfsï¼Œå…¶ä»–ç³»ç»Ÿçœ‹å®˜æ–¹çš„æ–‡æ¡£å°±è¡Œ</p><pre><code class="hljs bash">sudo apt-get updatesudo apt-get install gdebi-coresudo gdebi your_ossfs_package</code></pre><p>3.å°†<code>my-bucket</code>è¿™ä¸ª bucket æŒ‚è½½åˆ°<code>/data/cloud</code>ç›®å½•ä¸‹ï¼ŒAccessKeyId æ˜¯<code>faint</code>ï¼Œ AccessKeySecret æ˜¯<code>123</code>ï¼Œoss endpoint æ˜¯<code>http://oss-cn-hangzhou.aliyuncs.com</code></p><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> my-bucket:faint:123 &gt; /etc/passwd-ossfschmod 640 /etc/passwd-ossfsmkdir /data/cloud</code></pre><p><strong>æœ€åä¸€æ­¥å¾ˆé‡è¦ï¼Œä¸èƒ½ç›´æ¥ç…§å®˜æ–¹æ–‡æ¡£ä¸Šé¢çš„æ¥ï¼Œä¸ç„¶å®‰è£… owncloud çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°æ²¡æœ‰è®¿é—®æƒé™çš„é—®é¢˜</strong></p><ul><li>é¦–å…ˆå…ˆçœ‹ä¸€ä¸‹ nginx çš„ç”¨æˆ· idï¼Œä»¥æˆ‘çš„æ˜¯<code>www</code>ä¸ºä¾‹</li></ul><pre><code class="hljs bash">id www</code></pre><p>ä¼šè¿”å›ç»™ä½ ç”¨æˆ·çš„ uid å’Œ gid ç­‰ç­‰,æˆ‘å‡è®¾è¿”å›çš„ uid å’Œ gid éƒ½ä¸º 1001</p><pre><code class="hljs undefined">ossfs my-bucket /data/cloud <span class="hljs-attribute">-ourl</span>=http://oss-cn-hangzhou-internal.aliyuncs.com <span class="hljs-attribute">-ouid</span>=1001 <span class="hljs-attribute">-ogid</span>=1001 -o allow_other -o <span class="hljs-attribute">umask</span>=007</code></pre><p>è¿™é‡Œé¢<code>allow_other</code>æ˜¯å…è®¸å…¶ä»–ç”¨æˆ·è®¿é—®ï¼Œä½†æ˜¯é»˜è®¤è®¾ç½®çš„æ˜¯ 777 æƒé™è¿™æ · owncloud ä¼šæç¤ºä¸å®‰å…¨ï¼Œç”¨<code>umask=007</code>æŒ‚è½½ä¸º 770 æƒé™ï¼Œä¸çŸ¥é“ä¸ºå•¥è¿™é‡Œ 0 ä»£è¡¨ 7,7 è¡¨ç¤º 0</p><blockquote><p>åˆ°è¿™é‡Œ ossfs å°±å®‰è£…å®Œæ¯•äº†ä¸‹é¢å¼€å§‹å®‰è£… owncloud</p></blockquote><h3 id="å®‰è£…-OWNCLOUD"><a href="#å®‰è£…-OWNCLOUD" class="headerlink" title="å®‰è£… OWNCLOUD"></a>å®‰è£… OWNCLOUD</h3><blockquote><p>owncloud çš„å®‰è£…ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šçš„æ•™ç¨‹æˆ‘å°±ä¸å¤šè¯´äº†</p></blockquote><p>å…ˆæ‰“å¼€<a href="https://owncloud.org/install/#instructions-server" target="_blank" rel="noopener">owncloud çš„å®˜ç½‘çš„æœåŠ¡å™¨ç«¯çš„å®‰è£…åœ°å€</a>ï¼Œæˆ‘å®‰è£…çš„æ—¶å€™æœ€æ–°ç¨³å®šç‰ˆæ˜¯<code>9.0.2</code>å»ºè®®å›½å†…ä¸»æœºç”¨è¿…é›·ä¹‹ç±»çš„ä¸‹è½½è½¯ä»¶å…ˆä¸‹è½½ä¸‹æ¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç›´æ¥ wget æ¯”è¾ƒæ…¢</p><p>1.ä¸‹è½½å¹¶è§£å‹</p><pre><code class="hljs undefined">wget  https:<span class="hljs-regexp">//</span>download.owncloud.org<span class="hljs-regexp">/community/</span>owncloud-<span class="hljs-number">9.0</span>.<span class="hljs-number">2</span>.tar.bz2 <span class="hljs-regexp">//</span>æ‰‹åŠ¨ä¸Šä¼ è¿™ä¸€æ­¥å°±ä¸ç”¨äº†tar xvf owncloud-<span class="hljs-number">9.0</span>.<span class="hljs-number">2</span>.tar.bz2 <span class="hljs-regexp">//</span>ä»¥å®é™…çš„æ–‡ä»¶åä¸ºå‡†</code></pre><p>2.ç§»åŠ¨åˆ°ç«™ç‚¹ç›®å½•,å‡è®¾ç«™ç‚¹ç›®å½•ä¸º<code>/data/wwwroot</code></p><pre><code class="hljs undefined">mv owncloud<span class="hljs-regexp">/ /</span>data<span class="hljs-regexp">/wwwroot/</span></code></pre><p><strong>3.è®¾ç½®ç›®å½•æƒé™ï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦</strong></p><pre><code class="hljs bash">chown -R www:www /data/wwwroot/owncloud/chmod 777 /data/wwwroot/owncloud//config/</code></pre><h3 id="è®¾ç½®-nginx-è§„åˆ™ï¼ˆApache-åŸºæœ¬ä¸ç”¨æ”¹ï¼Œåªéœ€è¦è‡ªå·±å»è®¾ç½®ä¸€ä¸‹-sslï¼Œå’Œå¸¸è§„çš„è®¾ç½®å°±è¡Œäº†ï¼‰"><a href="#è®¾ç½®-nginx-è§„åˆ™ï¼ˆApache-åŸºæœ¬ä¸ç”¨æ”¹ï¼Œåªéœ€è¦è‡ªå·±å»è®¾ç½®ä¸€ä¸‹-sslï¼Œå’Œå¸¸è§„çš„è®¾ç½®å°±è¡Œäº†ï¼‰" class="headerlink" title="è®¾ç½® nginx è§„åˆ™ï¼ˆApache åŸºæœ¬ä¸ç”¨æ”¹ï¼Œåªéœ€è¦è‡ªå·±å»è®¾ç½®ä¸€ä¸‹ sslï¼Œå’Œå¸¸è§„çš„è®¾ç½®å°±è¡Œäº†ï¼‰"></a>è®¾ç½® nginx è§„åˆ™ï¼ˆApache åŸºæœ¬ä¸ç”¨æ”¹ï¼Œåªéœ€è¦è‡ªå·±å»è®¾ç½®ä¸€ä¸‹ sslï¼Œå’Œå¸¸è§„çš„è®¾ç½®å°±è¡Œäº†ï¼‰</h3><p><strong>æ³¨æ„è§„åˆ™è®¾ç½®å¥½ä¹‹åï¼Œå®‰è£…çš„æ—¶å€™ç‚¹é«˜çº§è®¾ç½®ï¼Œä½¿ç”¨ mysql æˆ–è€…å…¶ä»–æ•°æ®åº“ï¼Œ<code>sqllite</code>çš„æ€§èƒ½ä¸å¤Ÿï¼Œç„¶åå°±æ˜¯æ•°æ®æ–‡ä»¶ç›®å½•å¡«å†™ä¹‹å‰ä½  ossfs çš„æŒ‚è½½ç›®å½•ï¼Œæˆ‘ä¹‹å‰æŒ‚è½½çš„æ˜¯<code>/data/cloud</code></strong></p><blockquote><p>åé¢æœ‰ 9.x å®˜æ–¹çš„ç¤ºä¾‹ï¼Œæˆ‘è¿™å„¿æç¤ºä¸€ä¸‹æœ‰äº›å‘çš„åœ°æ–¹</p></blockquote><p>1.æœ¬èº«çš„è®¾ç½®é‡Œé¢æ²¡æœ‰ log çš„è®¾ç½®ï¼Œä¸æ–¹ä¾¿ debugï¼Œaccess_log å¯ä»¥ä¸ç”¨ï¼Œerror_log è¿˜æ˜¯éœ€è¦åŠ ä¸Šçš„ 2.é‡Œé¢æ²¡æœ‰ index çš„è®¾ç½®ï¼Œå¦‚æœæ‰“å¼€é¦–é¡µä¸€ç‰‡ç©ºç™½ï¼ŒåŠ ä¸Š index.php ä¹‹åæ²¡æœ‰é—®é¢˜çš„è¯ï¼Œ</p><pre><code class="hljs undefined"><span class="hljs-keyword">location</span> / &#123;<span class="hljs-keyword">index</span> <span class="hljs-keyword">index</span>.php <span class="hljs-meta">#åŠ ä¸Šè¿™ä¸€å¥</span>      rewrite ^ /<span class="hljs-keyword">index</span>.php$uri;&#125;</code></pre><p>3.å¦‚æœä½ è¿›å…¥å®‰è£…é¡µé¢ï¼ŒæŒ‰ç…§æç¤ºå®‰è£…å¥½äº†ä¹‹åå‡ºç°è¯´<code>æ‰¾ä¸åˆ°æ–‡ä»¶ç›®å½•</code>ä¹‹ç±»çš„è¯ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ä½ æ²¡æœ‰å¼€å¯<code>pathinfo</code>ï¼Œowncloud éœ€è¦ pathinfo çš„æ”¯æŒ(ç¤ºä¾‹çš„é…ç½®é‡Œé¢æ˜¯æœ‰ pathinfo çš„è®¾ç½®çš„)</p><h3 id="NEXT"><a href="#NEXT" class="headerlink" title="NEXT"></a>NEXT</h3><blockquote><p>åˆ°è¿™é‡ŒåŸºæœ¬ä¸Š owncloud çš„å®‰è£…åº”è¯¥å°±ç»“æŸäº†ï¼Œä½¿ç”¨ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘å»ºè®®å¼€å¯ sslï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘å¼€äº† ssl ä¹‹åè®¿é—®çš„é€Ÿåº¦æå‡äº†å¥½å‡ å€</p></blockquote><p>é™„é€å®˜æ–¹æ’ä»¶çš„åœ°å€<a href="https://apps.owncloud.com/" target="_blank" rel="noopener">ç‚¹æˆ‘ç‚¹æˆ‘</a>,å›½å†…ä¸»æœºåœ¨çº¿å®‰è£…æ’ä»¶å¯èƒ½è£…ä¸ä¸Šï¼Œå¯ä»¥ FQ ä¹‹ååœ¨è¿™é‡Œé¢ä¸‹è½½ç›¸åº”æ’ä»¶åŒ…ï¼Œä¸Šä¼ åˆ° apps ç›®å½•ä¸‹å³å¯ï¼Œä¸‹ä¸€ç¯‡è¯´ä¸€ä¸‹ç”¨ owncloud å®ç°ç¦»çº¿ä¸‹è½½åŠŸèƒ½ï¼Œç°åœ¨ 9.0.2 ç‰ˆæœ¬çš„ä½¿ç”¨ owncloud çš„ç¦»çº¿ä¸‹è½½æ’ä»¶æœ‰é—®é¢˜ï¼Œä½†æ˜¯çœ‹äº†ä¸€ä¸‹è¿™ä¸ª bug å¾ˆæ—©å°±æœ‰ï¼Œåªæ˜¯å¥½åƒä¸€ç›´æ²¡æœ‰ä¿®å¤ã€‚ä¹‹åæˆ‘æ”¹ä¸€ä¸‹èƒ½å¤Ÿç”¨äº†å†å†™ä¸‹ä¸€ç¯‡å§</p><h3 id="9-x-å®˜æ–¹ç¤ºä¾‹"><a href="#9-x-å®˜æ–¹ç¤ºä¾‹" class="headerlink" title="9.x å®˜æ–¹ç¤ºä¾‹"></a>9.x å®˜æ–¹ç¤ºä¾‹</h3><pre><code class="hljs undefined"> <span class="hljs-attribute">upstream</span> php-handler &#123;    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:9000</span>; <span class="hljs-comment">#æ³¨æ„ä¸€ä¸‹ä½ è‡ªå·±çš„phpæœåŠ¡è®¾ç½®ï¼Œè¿™ä¸€è¡Œå¯èƒ½éœ€è¦è‡ªå·±è°ƒæ•´</span>    <span class="hljs-comment">#server unix:/var/run/php5-fpm.sock;</span>&#125;<span class="hljs-section">server</span> &#123;    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;    <span class="hljs-attribute">server_name</span> cloud.example.com;    <span class="hljs-comment"># enforce https</span>    <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$request_uri</span>;&#125;<span class="hljs-section">server</span> &#123;    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;    <span class="hljs-attribute">server_name</span> cloud.example.com;    <span class="hljs-comment">#sslè¯ä¹¦çš„ä½ç½®</span>    <span class="hljs-attribute">ssl_certificate</span> /etc/ssl/nginx/cloud.example.com.crt;    <span class="hljs-attribute">ssl_certificate_key</span> /etc/ssl/nginx/cloud.example.com.key;    <span class="hljs-comment"># Add headers to serve security related headers</span>    <span class="hljs-comment"># Before enabling Strict-Transport-Security headers please read into this</span>    <span class="hljs-comment"># topic first.</span>    <span class="hljs-comment"># å®‰è£…å¥½ä¹‹åï¼Œåå°å¯èƒ½ä¼šæç¤ºç›¸åº”é”™è¯¯ï¼ŒæŠŠè¿™ä¸€æ®µçš„æ³¨é‡Šå»æ‰å°±è¡Œ</span>    <span class="hljs-comment"># add_header Strict-Transport-Security "max-age=15768000;</span>    <span class="hljs-comment"># includeSubDomains; preload;";</span>    <span class="hljs-comment">#åé¢å®‰è£…å¥½äº†ä¹‹ååå°å¯èƒ½ä¼šæç¤ºheaderçš„é”™è¯¯ï¼ŒæŠŠè¿™ä¸€çŸ­åˆ é™¤æ‰å³å¯</span>    <span class="hljs-attribute">add_header</span> X-Content-Type-Options nosniff;    <span class="hljs-attribute">add_header</span> X-Frame-Options <span class="hljs-string">"SAMEORIGIN"</span>;    <span class="hljs-attribute">add_header</span> X-XSS-Protection <span class="hljs-string">"1; mode=block"</span>;    <span class="hljs-attribute">add_header</span> X-Robots-Tag <span class="hljs-literal">none</span>;    <span class="hljs-attribute">add_header</span> X-Download-Options noopen;    <span class="hljs-attribute">add_header</span> X-Permitted-Cross-Domain-Policies <span class="hljs-literal">none</span>;    <span class="hljs-comment"># Path to the root of your installation</span>    <span class="hljs-attribute">root</span> /var/www/owncloud/;    <span class="hljs-attribute">location</span> = /robots.txt &#123;        <span class="hljs-attribute">allow</span> all;        <span class="hljs-attribute">log_not_found</span> <span class="hljs-literal">off</span>;        <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;    &#125;    <span class="hljs-comment"># The following 2 rules are only needed for the user_webfinger app.</span>    <span class="hljs-comment"># Uncomment it if you're planning to use this app.</span>    <span class="hljs-comment">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span>    <span class="hljs-comment">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json</span>    <span class="hljs-comment"># last;</span>    <span class="hljs-attribute">location</span> = /.well-known/carddav &#123; <span class="hljs-attribute">return</span> <span class="hljs-number">301</span>     <span class="hljs-variable">$scheme</span>://<span class="hljs-variable">$host</span>/remote.php/dav; &#125;    <span class="hljs-attribute">location</span> = /.well-known/caldav &#123; <span class="hljs-attribute">return</span> <span class="hljs-number">301</span>     <span class="hljs-variable">$scheme</span>://<span class="hljs-variable">$host</span>/remote.php/dav; &#125;    <span class="hljs-attribute">location</span> /.well-known/acme-challenge &#123; &#125;    <span class="hljs-comment"># set max upload size</span>    <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">512M</span>;    <span class="hljs-attribute">fastcgi_buffers</span> <span class="hljs-number">64</span> <span class="hljs-number">4K</span>;    <span class="hljs-comment"># Disable gzip to avoid the removal of the ETag header</span>    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">off</span>;    <span class="hljs-comment"># Uncomment if your server is build with the ngx_pagespeed module</span>    <span class="hljs-comment"># This module is currently not supported.</span>    <span class="hljs-comment">#pagespeed off;</span>    <span class="hljs-attribute">error_page</span> <span class="hljs-number">403</span> /core/templates/<span class="hljs-number">403</span>.php;    <span class="hljs-attribute">error_page</span> <span class="hljs-number">404</span> /core/templates/<span class="hljs-number">404</span>.php;    <span class="hljs-attribute">location</span> / &#123;        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^</span> /index.php<span class="hljs-variable">$uri</span>;    &#125;    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/</span> &#123;        <span class="hljs-attribute">deny</span> all;    &#125;    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ ^/(?:\.|autotest|occ|issue|indie|db_|console)</span> &#123;        <span class="hljs-attribute">deny</span> all;    &#125;    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~    ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater</span>    /.+|ocs-provider/.+|core/templates/<span class="hljs-number">40</span>[<span class="hljs-number">34</span>])\.php(?:$|/) &#123;        <span class="hljs-attribute">include</span> fastcgi_params;        <span class="hljs-attribute">fastcgi_split_path_info</span><span class="hljs-regexp"> ^(.+\.php)(/.+)$</span>;        <span class="hljs-attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="hljs-variable">$document_root</span><span class="hljs-variable">$fastcgi_script_name</span>;        <span class="hljs-attribute">fastcgi_param</span> PATH_INFO <span class="hljs-variable">$fastcgi_path_info</span>;        <span class="hljs-attribute">fastcgi_param</span> HTTPS <span class="hljs-literal">on</span>;        <span class="hljs-comment">#Avoid sending the security headers twice</span>        <span class="hljs-attribute">fastcgi_param</span> modHeadersAvailable <span class="hljs-literal">true</span>;        <span class="hljs-attribute">fastcgi_param</span> front_controller_active <span class="hljs-literal">true</span>;        <span class="hljs-attribute">fastcgi_pass</span> php-handler;        <span class="hljs-attribute">fastcgi_intercept_errors</span> <span class="hljs-literal">on</span>;        <span class="hljs-attribute">fastcgi_request_buffering</span> <span class="hljs-literal">off</span>;    &#125;    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ ^/(?:updater|ocs-provider)(?:$|/)</span> &#123;        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span>/ =<span class="hljs-number">404</span>;        <span class="hljs-attribute">index</span> index.php;    &#125;    <span class="hljs-comment"># Adding the cache control header for js and css files</span>    <span class="hljs-comment"># Make sure it is BELOW the PHP block</span>    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~* \.(?:css|js)$</span> &#123;        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> /index.php<span class="hljs-variable">$uri</span><span class="hljs-variable">$is_args</span><span class="hljs-variable">$args</span>;        <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">"public, max-age=7200"</span>;        <span class="hljs-comment"># Add headers to serve security related headers (It is intended to</span>        <span class="hljs-comment"># have those duplicated to the ones above)</span>        <span class="hljs-comment"># Before enabling Strict-Transport-Security headers please read into</span>        <span class="hljs-comment"># this topic first.</span>        <span class="hljs-comment"># add_header Strict-Transport-Security "max-age=15768000;</span>        <span class="hljs-comment">#  includeSubDomains; preload;";</span>        <span class="hljs-attribute">add_header</span> X-Content-Type-Options nosniff;        <span class="hljs-attribute">add_header</span> X-Frame-Options <span class="hljs-string">"SAMEORIGIN"</span>;        <span class="hljs-attribute">add_header</span> X-XSS-Protection <span class="hljs-string">"1; mode=block"</span>;        <span class="hljs-attribute">add_header</span> X-Robots-Tag <span class="hljs-literal">none</span>;        <span class="hljs-attribute">add_header</span> X-Download-Options noopen;        <span class="hljs-attribute">add_header</span> X-Permitted-Cross-Domain-Policies <span class="hljs-literal">none</span>;        <span class="hljs-comment"># Optional: Don't log access to assets</span>        <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;    &#125;    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~* \.(?:svg|gif|png|html|ttf|woff|ico|jpg|jpeg)$</span> &#123;        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> /index.php<span class="hljs-variable">$uri</span><span class="hljs-variable">$is_args</span><span class="hljs-variable">$args</span>;        <span class="hljs-comment"># Optional: Don't log access to other assets</span>        <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;    &#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>lnmp</tag>
      
      <tag>äº‘ç›˜</tag>
      
      <tag>owncloud</tag>
      
      <tag>oss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å››å·å¤§å­¦è¯„æ•™å¼€æºä»£ç </title>
    <link href="/post/31503.html"/>
    <url>/post/31503.html</url>
    
    <content type="html"><![CDATA[<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">require</span> <span class="hljs-string">"login.php"</span>;<span class="hljs-keyword">require</span> <span class="hljs-string">"QueryList.class.php"</span>;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evaluate</span></span>&#123;    <span class="hljs-keyword">private</span> $_listUrl=<span class="hljs-string">"http://202.115.47.141/jxpgXsAction.do?oper=listWj&amp;page="</span>;<span class="hljs-comment">//è¯„æ•™åˆ—è¡¨é¡µé¢</span>    <span class="hljs-keyword">private</span> $_formUrl=<span class="hljs-string">"http://202.115.47.141/jxpgXsAction.do?oper=wjShow&amp;"</span>;<span class="hljs-comment">//è¯„æ•™è¡¨å•é¡µé¢</span>    <span class="hljs-keyword">private</span> $_postUrl=<span class="hljs-string">"http://202.115.47.141/jxpgXsAction.do?oper=wjpg&amp;"</span>;<span class="hljs-comment">//è¯„æ•™æäº¤åœ°å€</span>    <span class="hljs-keyword">private</span> $_yjpj;    <span class="hljs-keyword">private</span> $_successNo=<span class="hljs-number">0</span>;<span class="hljs-comment">//æˆåŠŸæ¬¡æ•°</span>    <span class="hljs-keyword">private</span> $_failNo=<span class="hljs-number">0</span>;<span class="hljs-comment">//å¤±è´¥æ¬¡æ•°</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($name,$pass)</span>    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;_yjpj=<span class="hljs-keyword">new</span> login($name,$pass);    &#125;    <span class="hljs-comment">/**     * è·å–è¯„æ•™åˆ—è¡¨å¹¶ä¸”è¿”å›åˆ—è¡¨ä¿¡æ¯ä»¥åŠé¡µç      * <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt;     * <span class="hljs-doctag">@return</span> mixed     *       $list=[     *           'info'=&gt;[     *               [     *                   'param'=&gt;[     *                       0 =&gt; '0000000038',     *                       1 =&gt; '19873162',     *                       2 =&gt; 'é«˜è‹¹',     *                       3 =&gt; 'å­¦è¯„æ•™',     *                       4 =&gt; 'é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç†æ¦‚è®º',     *                       5 =&gt; '107021030',     *                   ],     *                   'status'=&gt;0     *               ],     *              ......     *           ],     *           'page'=&gt;[     *               [     *                   'page'=&gt;'2'     *               ]     *           ]     *       ];     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">getList</span><span class="hljs-params">()</span>    </span>&#123;        <span class="hljs-comment">/*--------------è·å–ç¬¬ä¸€é¡µçš„è¯„æ•™åˆ—è¡¨é¡µé¢---------------*/</span>        $listContent=<span class="hljs-keyword">$this</span>-&gt;_yjpj-&gt;show(<span class="hljs-keyword">$this</span>-&gt;_listUrl.<span class="hljs-string">"1"</span>);        <span class="hljs-comment">/*------------è·å–è¯„æ•™åˆ†é¡µä¿¡æ¯--------------*/</span>        $pageReg=[            <span class="hljs-string">'page'</span>=&gt;[<span class="hljs-string">'script:eq(3)'</span>,<span class="hljs-string">'html'</span>,<span class="hljs-string">''</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($page)</span></span>&#123;                $pattern=<span class="hljs-string">"/document\.all\.pageNo\.value&gt;(.)/"</span>;                preg_match($pattern,$page,$no);                <span class="hljs-keyword">if</span>($no[<span class="hljs-number">1</span>])&#123;                    <span class="hljs-keyword">return</span> $no[<span class="hljs-number">1</span>];                &#125;            &#125;]        ];        $page=QueryList::Query($listContent,$pageReg);        $page=$page-&gt;jsonArr[<span class="hljs-number">0</span>][<span class="hljs-string">'page'</span>];        <span class="hljs-comment">/*---------è·å–è¯„æ•™è€å¸ˆä¿¡æ¯--------------*/</span>        $listReg=[            <span class="hljs-string">'param'</span>=&gt;[<span class="hljs-string">'img'</span>,<span class="hljs-string">'name'</span>,<span class="hljs-string">''</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($a)</span></span>&#123;                <span class="hljs-keyword">if</span>($a)&#123;                    <span class="hljs-keyword">return</span> explode(<span class="hljs-string">'#@'</span>,$a);                &#125;            &#125;],            <span class="hljs-string">'status'</span>=&gt;[<span class="hljs-string">'img'</span>,<span class="hljs-string">'onclick'</span>,<span class="hljs-string">''</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($a)</span></span>&#123;                <span class="hljs-keyword">if</span>(trim($a)==<span class="hljs-string">"evaluation(this)"</span>)&#123;                    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;                &#125;<span class="hljs-keyword">else</span>&#123;                    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;                &#125;            &#125;],        ];        <span class="hljs-comment">/*[ä¼˜åŒ–]ï¼šå‡å°‘é‡å¤æŠ“å–åˆ—è¡¨é¡µï¼Œå¤§å¤§æé«˜æ•ˆç‡*/</span>        $c=QueryList::Query($listContent,$listReg);        $list[]=$c-&gt;jsonArr;        <span class="hljs-keyword">if</span>($page&gt;<span class="hljs-number">1</span>)&#123;            <span class="hljs-keyword">for</span>($i=<span class="hljs-number">2</span>;$i&lt;=$page;$i++)&#123;                $listContent=<span class="hljs-keyword">$this</span>-&gt;_yjpj-&gt;show(<span class="hljs-keyword">$this</span>-&gt;_listUrl.$i);                $c=QueryList::Query($listContent,$listReg);                $list[]=$c-&gt;jsonArr;            &#125;        &#125;        <span class="hljs-keyword">return</span> $list;<span class="hljs-comment">//è·å–åˆ°çš„è¯„æ•™ä¿¡æ¯</span>    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPostInfo</span><span class="hljs-params">($list)</span>    </span>&#123;<span class="hljs-comment">//        print_r($list);</span>        <span class="hljs-keyword">foreach</span>($list <span class="hljs-keyword">as</span>  $listVal)&#123;<span class="hljs-comment">//            print_r($listVal);</span>            <span class="hljs-keyword">foreach</span>($listVal <span class="hljs-keyword">as</span> $listkey =&gt; $listValue)&#123;                <span class="hljs-keyword">if</span>($listValue[<span class="hljs-string">'status'</span>]==<span class="hljs-number">1</span>)&#123;<span class="hljs-comment">//                    print_r($listValue);</span>                    $param=[                        <span class="hljs-string">'wjbm'</span>=&gt;$listValue[<span class="hljs-string">'param'</span>][<span class="hljs-number">0</span>],                        <span class="hljs-string">'bpr'</span>=&gt;$listValue[<span class="hljs-string">'param'</span>][<span class="hljs-number">1</span>],                        <span class="hljs-string">'pgnr'</span>=&gt;$listValue[<span class="hljs-string">'param'</span>][<span class="hljs-number">5</span>],                    ];                    $param=http_build_query($param);                    $url=<span class="hljs-keyword">$this</span>-&gt;_formUrl.$param;<span class="hljs-comment">//                    echo $url;</span>                    $formContent=<span class="hljs-keyword">$this</span>-&gt;_yjpj-&gt;show($url);<span class="hljs-comment">//                    print_r($formContent);</span>                    $res=QueryList::Query($formContent,[<span class="hljs-string">'name'</span>=&gt;[<span class="hljs-string">'[value=10_1]'</span>,<span class="hljs-string">'name'</span>]]);                    <span class="hljs-comment">/*--------------å°†è·å–çš„è¡¨å•ä¿¡æ¯æ•´ç†æˆä¸ºå³å°†postçš„å‚æ•°-------------*/</span>                    <span class="hljs-keyword">foreach</span>($res-&gt;jsonArr <span class="hljs-keyword">as</span> $postKey =&gt; $postValue)&#123;                        $postParam[$postValue[<span class="hljs-string">'name'</span>]]=<span class="hljs-string">"10_1"</span>;                    &#125;                    $postParam[<span class="hljs-string">'wjbm'</span>]=$listValue[<span class="hljs-string">'param'</span>][<span class="hljs-number">0</span>];                    $postParam[<span class="hljs-string">'bpr'</span>]=$listValue[<span class="hljs-string">'param'</span>][<span class="hljs-number">1</span>];                    $postParam[<span class="hljs-string">'pgnr'</span>]=$listValue[<span class="hljs-string">'param'</span>][<span class="hljs-number">5</span>];                    $postParam[<span class="hljs-string">'zgpj'</span>]=<span class="hljs-string">"very good teacher!!"</span>;                    <span class="hljs-keyword">$this</span>-&gt;post($postParam);<span class="hljs-comment">//                    return 0;</span>                &#125;            &#125;        &#125;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">post</span><span class="hljs-params">($param)</span></span>&#123;        $param=http_build_query($param);        $url=<span class="hljs-keyword">$this</span>-&gt;_postUrl.$param;<span class="hljs-comment">//        echo $url;</span>        $evalContent=<span class="hljs-keyword">$this</span>-&gt;_yjpj-&gt;show($url);        <span class="hljs-comment">/*--------------------æŠ“å–æäº¤ä¹‹åçš„æ•°æ®æŸ¥çœ‹æ˜¯å¦æˆåŠŸæäº¤--------------------*/</span>        $res=QueryList::Query($evalContent,[<span class="hljs-string">'info'</span>=&gt;[<span class="hljs-string">'script'</span>,<span class="hljs-string">'html'</span>,<span class="hljs-string">''</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($a)</span></span>&#123;            $pattern=<span class="hljs-string">'/alert\("(.+)"\)/'</span>;            preg_match_all($pattern,$a,$res);            $success=<span class="hljs-string">'è¯„ä¼°æˆåŠŸï¼'</span>;            <span class="hljs-keyword">if</span>($res[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]==$success)&#123;                $a=[                    <span class="hljs-string">'message'</span>=&gt;$res[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>],                    <span class="hljs-string">'status'</span>=&gt;<span class="hljs-number">1</span>                ];            &#125;<span class="hljs-keyword">else</span>&#123;                $a=[                    <span class="hljs-string">'message'</span>=&gt;$res[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>],                    <span class="hljs-string">'status'</span>=&gt;<span class="hljs-number">0</span>                ];            &#125;            <span class="hljs-keyword">return</span> $a;        &#125;]]);        $status=$res-&gt;jsonArr[<span class="hljs-number">0</span>][<span class="hljs-string">'info'</span>][<span class="hljs-string">'status'</span>];        <span class="hljs-keyword">if</span>($status==<span class="hljs-number">1</span>)&#123;            <span class="hljs-keyword">$this</span>-&gt;_successNo+=<span class="hljs-number">1</span>;        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;_failNo+=<span class="hljs-number">1</span>;        &#125;<span class="hljs-comment">//        print_r($res-&gt;jsonArr);</span>    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action</span><span class="hljs-params">()</span>    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;getPostInfo(<span class="hljs-keyword">$this</span>-&gt;getList());        <span class="hljs-keyword">$this</span>-&gt;count();      <span class="hljs-keyword">return</span> [<span class="hljs-string">'success'</span>=&gt;<span class="hljs-keyword">$this</span>-&gt;_successNo,<span class="hljs-string">'fail'</span>=&gt;<span class="hljs-keyword">$this</span>-&gt;_failNo];        <span class="hljs-comment">//return 'è¯„æ•™æˆåŠŸï¼ŒæˆåŠŸï¼š'.$this-&gt;_successNo.'ä½ï¼Œ'.'å¤±è´¥ï¼š'.$this-&gt;_failNo."ä½";</span>    &#125;&#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/5431.html">ä½¿ç”¨chromedpè§£å†³åçˆ¬è™«é—®é¢˜</a></li><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/18280.html">å››å·å¤§å­¦é”æ·windowsè§£é™¤å¤šç½‘å¡é™åˆ¶</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>å¤§å­¦</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>å››å·å¤§å­¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Composerä¸Šçº¿å‰çš„ä¼˜åŒ–</title>
    <link href="/post/36128.html"/>
    <url>/post/36128.html</url>
    
    <content type="html"><![CDATA[<p>æ›´æ–°ä¹‹åæˆ–è€…ä¸Šçº¿å‰åˆ«å¿˜äº†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤<br>å¦åˆ™å°‘åˆ™æŸå¤± 20%-50%çš„æ€§èƒ½ï¼Œå¤šåˆ™ç¨‹åºç›´æ¥æŠ¥é”™</p><pre><code class="hljs bash">composer dump-autoload --optimize</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>composer</tag>
      
      <tag>ä¼˜åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpè¯†åˆ«éªŒè¯ç ï¼ˆäºŒï¼‰</title>
    <link href="/post/10661.html"/>
    <url>/post/10661.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ php è¯†åˆ«éªŒè¯ç ï¼ˆä¸€ï¼‰å½“ä¸­è¯´äº†åŸºæœ¬çš„è¯†åˆ«éªŒè¯ç çš„æ–¹æ³•ï¼ŒåŠå…¶å…³é”®çš„ä»£ç ï¼Œä½†æ˜¯æœ€åæˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¯¹äºæœ‰æ—‹è½¬çš„éªŒè¯ç çš„è¯†åˆ«ç‡åŠå…¶ä½ä¸‹çš„é—®é¢˜ï¼Œä¸‹é¢æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><h2 id="æ ‡å‡†åŒ–"><a href="#æ ‡å‡†åŒ–" class="headerlink" title="æ ‡å‡†åŒ–"></a>æ ‡å‡†åŒ–</h2><blockquote><p>è§£å†³ç±»ä¼¼äºä¸‹é¢å›¾ç‰‡è¿™ç§æœ‰æ—‹è½¬å­—ç¬¦çš„éªŒè¯ç ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç»™å‡ºä¸€ç§æ ‡å‡†ï¼Œè®©æ‰€æœ‰çš„åˆ†å‰²åçš„å›¾ç‰‡éƒ½æŒ‰ç…§ä¸€ä¸ªæ ‡å‡†æ¥æ‘†æ”¾ï¼Œæœ€åå¯¹æ¯”çš„æ—¶å€™æ‰èƒ½å¤Ÿç»Ÿä¸€</p></blockquote><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/1900195239.png" srcset="/img/loading.gif" alt="inImgTemp.png"></p><p><strong>å¦‚ä½•æ ‡å‡†åŒ–ï¼Ÿ</strong></p><ul><li><p>æˆ‘ä»¬å¯¹ä¸€ä¸ªå­—ç¬¦è¿›è¡Œæ—‹è½¬ï¼Œç„¶åè®¡ç®—è¿™ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œå½“å®½åº¦æœ€å°æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†å­—ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿå¾—åˆ°æ¯”è¾ƒå¥½çš„ç»“æœäº†ï¼ˆé€šè¿‡è§‚å¯Ÿè¿™ç§éªŒè¯ç ï¼Œå‘ç°ä¸€èˆ¬åªè¦å·¦å³æ—‹è½¬ä¸‰ååº¦å³å¯ï¼‰</p></li><li><p>ç„¶åä»…ä»…è¿›è¡Œæ—‹è½¬è¿˜ä¸å¤Ÿï¼Œä¸ºäº†èƒ½å¤Ÿå’Œæ¨¡æ¿ä¹Ÿå°±æ˜¯ç‰¹å¾å€¼åº“è¿›è¡Œå¯¹æ¯”ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ï¼Œç»Ÿä¸€å­—ç¬¦é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯äºŒå€¼åŒ–ä¹‹åçš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œè¿™æ—¶å°±éœ€è¦ç”»ä¸€å¼ é•¿å®½å›ºå®šçš„å›¾ç‰‡ï¼ŒæŠŠæˆ‘ä»¬åŸæ¥çš„å›¾ç‰‡æŒ‰ç…§æ¯”ä¾‹æ‹‰ä¼¸å‹ç¼©å¤åˆ¶è¿‡å»</p></li></ul><pre><code class="hljs php">    <span class="hljs-comment">/**     * å›¾åƒæ ‡å‡†åŒ–ï¼Œå°†æ—‹è½¬çš„å›¾åƒæ ‡å‡†åŒ–     * <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt;     * <span class="hljs-doctag">@param</span> $img     * <span class="hljs-doctag">@return</span> resource æ ‡å‡†çš„å›¾åƒèµ„æºå¥æŸ„     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imageStandard</span><span class="hljs-params">($img)</span></span>&#123;        $min_w=<span class="hljs-number">999</span>;        $oimg=$img;        $c=imagecolorallocate($img, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);        <span class="hljs-keyword">for</span>($i=<span class="hljs-number">-30</span>;$i&lt;<span class="hljs-number">30</span>;$i++)&#123;            $simg=imagerotate($img,$i,$c);<span class="hljs-comment">//            //è®¡ç®—å­—ç¬¦å®½åº¦</span>            $simg_hash_data=<span class="hljs-keyword">$this</span>-&gt;getWidth($simg);            $w=count($simg_hash_data);            <span class="hljs-keyword">if</span>($w&lt;$min_w)&#123;                $oimg_hash_data=$simg_hash_data;                $min_w=$w;            &#125;        &#125;        $out_img_w=count($oimg_hash_data);        $out_img_h=count($oimg_hash_data[<span class="hljs-number">0</span>]);        $out_img = imagecreatetruecolor($out_img_w,$out_img_h);<span class="hljs-comment">//åˆ›å»ºä¸€å¹…çœŸå½©è‰²å›¾åƒ</span>        $bg=imagecolorallocate($out_img, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<span class="hljs-comment">//èƒŒæ™¯è‰²ç”»ä¸ºç™½è‰²</span>        imagefill($out_img, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>, $bg);        <span class="hljs-comment">//ä¸€åˆ—ä¸€åˆ—çš„è¿›è¡Œç”»å›¾</span>        <span class="hljs-keyword">foreach</span> ($oimg_hash_data <span class="hljs-keyword">as</span> $k=&gt;$v)&#123;            <span class="hljs-keyword">foreach</span> ($v <span class="hljs-keyword">as</span> $key=&gt; $val)&#123;                $color=<span class="hljs-number">255</span>;                <span class="hljs-keyword">if</span>($val) $color=<span class="hljs-number">0</span>;                $c = imagecolorallocate($out_img, $color, $color, $color);                imagesetpixel($out_img, $k,$key, $c);            &#125;        &#125;<span class="hljs-comment">//        imagepng($out_img,'./0.png');</span>        $hash_img = imagecreatetruecolor(<span class="hljs-keyword">self</span>::HASH_W, <span class="hljs-keyword">self</span>::HASH_H);        imagecopyresized($hash_img, $out_img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">self</span>::HASH_W,<span class="hljs-keyword">self</span>::HASH_H,$out_img_w,$out_img_h);        <span class="hljs-keyword">return</span> $hash_img;    &#125;    <span class="hljs-comment">/**     * è·å–å›¾åƒçš„å®½åº¦     * <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt;     * <span class="hljs-doctag">@param</span> $img å›¾åƒèµ„æºå¥æŸ„     * <span class="hljs-doctag">@return</span> int     */</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWidth</span><span class="hljs-params">($img)</span></span>&#123;        <span class="hljs-comment">//æ ¹æ®èµ„æºå¥æŸ„è·å–æ•´ä¸ªå›¾åƒçš„é«˜ä¸å®½</span>        $img_w=imagesx($img);        $img_h=imagesy($img);        <span class="hljs-comment">//å›¾åƒäºŒå€¼åŒ–</span>        <span class="hljs-keyword">for</span>($i = <span class="hljs-number">0</span>; $i &lt;$img_h; $i++) &#123;            <span class="hljs-keyword">for</span> ($j = <span class="hljs-number">0</span>; $j &lt;$img_w; $j++) &#123;                $rgb = imagecolorat($img,$j,$i);                <span class="hljs-keyword">if</span>($rgb==<span class="hljs-number">0</span>)&#123;                    $data[$i][$j]=<span class="hljs-number">1</span>;                &#125;<span class="hljs-keyword">else</span>&#123;                    $data[$i][$j]=<span class="hljs-number">0</span>;                &#125;            &#125;        &#125;        <span class="hljs-comment">//å»æ‰é›¶è¡Œ</span>        $data=<span class="hljs-keyword">$this</span>-&gt;removeZero($data);        <span class="hljs-comment">//æŒ‰åˆ—å–å›¾åƒè·å–å®½åº¦</span>        <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;$img_w;$i++)&#123;            $column=array_column($data,$i);            <span class="hljs-keyword">if</span>(implode(<span class="hljs-string">""</span>,$column)!=<span class="hljs-number">0</span>)&#123;                $data1[]=$column;            &#125;        &#125;        <span class="hljs-comment">//è¿”å›</span>        <span class="hljs-keyword">return</span> $data1;    &#125;</code></pre><blockquote><p>çœ‹ä¸Šæ–¹çš„ä»£ç å‘ç°ä¼šæœ‰ä¸€ä¸ªå»é™¤é›¶è¡Œçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å»é™¤ç©ºç™½è¡Œï¼Œè¿™ä¸€æ­¥æ“ä½œçš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†å‡ºæ‰ä¸Šä¸‹å·¦å³æ— ç”¨çš„ç©ºç™½éƒ¨åˆ†ï¼Œåœ¨æˆ‘ä»¬è¿›è¡Œæ¨¡æ¿å¯¹æ¯”çš„æ—¶å€™æ›´åŠ çš„ç²¾ç¡®</p></blockquote><h2 id="å»ºç«‹ç‰¹å¾å€¼åº“"><a href="#å»ºç«‹ç‰¹å¾å€¼åº“" class="headerlink" title="å»ºç«‹ç‰¹å¾å€¼åº“"></a>å»ºç«‹ç‰¹å¾å€¼åº“</h2><blockquote><p>ä¹‹å‰æåˆ°äº†å¾ˆå¤šå’Œæ¨¡æ¿æˆ–è€…æ˜¯ç‰¹å¾å€¼åº“è¿›è¡Œæ¯”è¾ƒï¼Œé‚£æˆ‘ä»¬å¦‚ä½•æ¥å»ºç«‹è¿™ä¸ªåº“å‘¢ï¼Ÿä¸‹é¢è¯´ä¸€ä¸‹æœ€ç®€å•çš„ä¸¤ç§æ–¹æ³•</p></blockquote><ul><li>ç¬¬ä¸€ç§ï¼Œå°±æ˜¯æŠŠä½ éœ€è¦çš„æ•°å­—å¯èƒ½è¿˜æœ‰ 26 ä¸ªå­—æ¯ï¼Œéƒ½å…ˆè¯†åˆ«ä¸€éç„¶åå­˜åˆ°ä¸€ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œä½¿ç”¨çš„æ—¶å€™åŒ…å«è¿™ä¸ªæ–‡ä»¶è¿›è¡Œå¯¹æ¯”å°±è¡Œäº†</li><li>ç¬¬äºŒç§ï¼Œä¹Ÿå·®ä¸å¤šï¼Œå¯ä»¥å†™ä¸€ä¸ª study æ–‡ä»¶ï¼Œè®©ä¸Šé¢çš„æ­¥éª¤ç¨å¾®æ™ºèƒ½ä¸€ç‚¹ï¼Œç›´æ¥è¾“å…¥ä¹‹åï¼Œè‡ªåŠ¨å‚¨å­˜åˆ°æ•°æ®åº“ä¸­</li></ul><p>ä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ªé’ˆå¯¹è”é€šä¼˜é€‰åœ¨æ²ƒçš„ä¸€ä¸ªå°çš„è„šæœ¬ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºè¿™ç§é€šè¿‡é“¾æ¥æ¥è¯†åˆ«çš„ï¼Œä¸€å®šè¦å…ˆå°†é“¾æ¥çš„å›¾ç‰‡ä¿å­˜ä¸‹æ¥ï¼Œå› ä¸ºé“¾æ¥æ²¡è·å–ä¸€æ¬¡å›¾ç‰‡å°±ä¼šæ”¹å˜ä¸€æ¬¡</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">/** * Created by mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt;. * User: mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt; * Date: 2016/5/1 0001 * Time: 20:44 */</span><span class="hljs-keyword">require_once</span> <span class="hljs-string">'Image.class.php'</span>;<span class="hljs-keyword">require_once</span>  <span class="hljs-string">'DB.class.php'</span>;$db=<span class="hljs-keyword">new</span> \ImageOCR\DB();<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'send'</span>])&amp;&amp;$_POST[<span class="hljs-string">'send'</span>]==<span class="hljs-string">"send"</span>)&#123;    $image=<span class="hljs-keyword">new</span> \ImageOCR\Image(<span class="hljs-string">"./img/inImgTemp.png"</span>);    $code=$_POST[<span class="hljs-string">'code'</span>];    $code_arr=str_split($code);    <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;$image::CHAR_NUM;$i++)&#123;        $hash_img_data=implode(<span class="hljs-string">""</span>,$image-&gt;splitImage($i));        $db-&gt;add($code_arr[$i],$hash_img_data);    &#125;    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;script&gt;location.href='./study.php';&lt;/script&gt;"</span>;&#125;<span class="hljs-keyword">else</span>&#123;    $image=<span class="hljs-keyword">new</span> \ImageOCR\Image(<span class="hljs-string">"http://www.169ol.com/Mall/Code/getCode&amp;1462104790492"</span>);    imagepng($image-&gt;_in_img,<span class="hljs-string">"./img/inImgTemp.png"</span>);&#125;<span class="hljs-meta">?&gt;</span>&lt;!DOCTYPE html&gt;&lt;html lang=<span class="hljs-string">"en"</span>&gt;&lt;head&gt;    &lt;meta charset=<span class="hljs-string">"UTF-8"</span>&gt;    &lt;title&gt;Study&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;form action=<span class="hljs-string">""</span> method=<span class="hljs-string">"post"</span>&gt;        &lt;img src=<span class="hljs-string">"img/inImgTemp.png"</span>&gt;        &lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"code"</span>&gt;        &lt;input name=<span class="hljs-string">"send"</span> type=<span class="hljs-string">"submit"</span> value=<span class="hljs-string">"send"</span> /&gt;    &lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="å¼€æºä»£ç "><a href="#å¼€æºä»£ç " class="headerlink" title="å¼€æºä»£ç "></a>å¼€æºä»£ç </h2><p><strong>è§‰å¾—ä¸é”™ï¼Œç»™ä¸ª star å‘—</strong></p><script src="http://git.oschina.net/lxl520/ImageOCR/widget_preview"></script><h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><p><a href="http://drops.wooyun.org/tips/141" target="_blank" rel="noopener">å¸¸è§éªŒè¯ç çš„å¼±ç‚¹ä¸éªŒè¯ç è¯†åˆ«</a></p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>ç›®å‰çš„è¯†åˆ«æ•ˆç‡å¯ä»¥è¾¾åˆ° 50%ä»¥ä¸Šï¼ŒåŸºæœ¬å¯ä»¥æŠ•å…¥æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤§çš„è¿›æ­¥ç©ºé—´ï¼Œæ­£åœ¨åšä¸‹ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œé’ˆå¯¹è¯†åˆ«ç»“æœå¯¹ç‰¹å¾åº“è¿›è¡Œè‡ªåŠ¨ä¼˜åŒ–ï¼Œè‡ªåŠ¨å»é™¤ä½¿ç”¨ç‡è¾ƒä½çš„ç‰¹å¾å€¼ï¼Œè‡ªåŠ¨ä¿å­˜ï¼Œè¯†åˆ«æˆåŠŸçš„ç‰¹å¾å€¼ç­‰ç­‰</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>å›¾ç‰‡</tag>
      
      <tag>éªŒè¯ç è¯†åˆ«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpåˆ©ç”¨curlä¿å­˜å›¾ç‰‡</title>
    <link href="/post/58471.html"/>
    <url>/post/58471.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>åšéªŒè¯ç è¯†åˆ«çš„æ—¶å€™éœ€è¦å…ˆæŠŠå›¾ç‰‡ä¿å­˜èµ·æ¥ï¼Œå†™äº†ä¸€ä¸ªä¿å­˜å›¾ç‰‡çš„å‡½æ•°</p></blockquote><pre><code class="hljs php"><span class="hljs-comment">/*** <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt;* <span class="hljs-doctag">@param</span> string $url è·å–å›¾ç‰‡çš„ç½‘å€* <span class="hljs-doctag">@param</span> string $fileName ä¿å­˜çš„åœ°å€ä»¥åŠæ–‡ä»¶å*/</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getImg</span><span class="hljs-params">($url, $fileName)</span>    </span>&#123;        $ch = curl_init();        $fp = fopen($fileName, <span class="hljs-string">'w+'</span>);        curl_setopt($ch, CURLOPT_URL, $url);        curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number">0</span>);        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="hljs-number">0</span>);        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="hljs-number">60</span>);        curl_setopt($ch, CURLOPT_FILE,$fp);        curl_exec($ch);        curl_close($ch);        fclose($fp);    &#125;</code></pre><blockquote><p>ä½¿ç”¨çš„æ—¶å€™å‘ç°ï¼Œéœ€è¦ä¿å­˜éªŒè¯ç çš„ cookiesï¼Œç•™ä½œéªŒè¯ï¼Œå¿…è¦çš„æ—¶å€™è¿˜éœ€è¦åŠ ä¸Š header</p></blockquote><pre><code class="hljs php"><span class="hljs-comment">/*** <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt;* <span class="hljs-doctag">@param</span> string $url* <span class="hljs-doctag">@param</span> string $fileName*/</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCode</span><span class="hljs-params">($url = <span class="hljs-string">'http://www.169ol.com/Mall/Code/getCode'</span>, $fileName = <span class="hljs-string">'./img/code.png'</span>)</span>    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;_code_cookie = dirname(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">"/pic.cookie"</span>;        $ch = curl_init();        $fp = fopen($fileName, <span class="hljs-string">'w+'</span>);        curl_setopt($ch, CURLOPT_URL, $url);        curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number">0</span>);        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="hljs-number">0</span>);        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="hljs-number">60</span>);        curl_setopt($ch, CURLOPT_FILE,$fp);        curl_setopt($ch, CURLOPT_COOKIEJAR, <span class="hljs-keyword">$this</span>-&gt;_code_cookie);        curl_exec($ch);        curl_close($ch);        fclose($fp);    &#125;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>å›¾ç‰‡</tag>
      
      <tag>curl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpè¯†åˆ«éªŒè¯ç ï¼ˆä¸€ï¼‰</title>
    <link href="/post/47583.html"/>
    <url>/post/47583.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æƒ³åšä¸€ä¸ªé’ˆå¯¹è”é€šä¼˜é€‰åœ¨æ²ƒè‡ªåŠ¨ç­¾åˆ°çš„å°ç¨‹åºï¼Œä½†æ˜¯ç™»é™†éœ€è¦éªŒè¯ç ï¼Œæ‰¾äº†ä¸€ä¸‹ç°æœ‰çš„ä¸€äº›åšå®¢æˆ–è€…æ˜¯å¼€æºçš„éªŒè¯ç è¯†åˆ«çš„ä»£ç ï¼Œæ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒæ»¡æ„çš„ï¼Œsoï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªã€‚</p></blockquote><h2 id="éœ€è¦è¯†åˆ«çš„éªŒè¯ç "><a href="#éœ€è¦è¯†åˆ«çš„éªŒè¯ç " class="headerlink" title="éœ€è¦è¯†åˆ«çš„éªŒè¯ç "></a>éœ€è¦è¯†åˆ«çš„éªŒè¯ç </h2><blockquote><p>ç¬¬ä¸€ç§ï¼š</p></blockquote><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2190097228.png" srcset="/img/loading.gif" alt="code.png"></p><blockquote><p>ç¬¬äºŒç§</p></blockquote><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/1819792828.gif" srcset="/img/loading.gif" alt="1211862590-56a5bd94d822e.gif"></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>åƒä¸Šå›¾çš„éªŒè¯ç ä¸€èˆ¬æ¥è¯´çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è¯†åˆ«çš„æ˜¯ 4 ä¸ªæ•°å­—ï¼Œä½†æ˜¯éªŒè¯ç ä¸ºäº†é˜²æ­¢è‡ªåŠ¨è¯†åˆ«ç¨‹åºæ·»åŠ äº†è®¸å¤šçš„å¹²æ‰°é¡¹ï¼Œä¾‹å¦‚<code>èƒŒæ™¯è‰²</code>ã€<code>é›ªèŠ±</code>ã€<code>å¹²æ‰°çº¿</code>ç­‰ç­‰</p><h2 id="å»é™¤èƒŒæ™¯"><a href="#å»é™¤èƒŒæ™¯" class="headerlink" title="å»é™¤èƒŒæ™¯"></a>å»é™¤èƒŒæ™¯</h2><p>æˆ‘ä»¬é€šè¿‡åˆ†æè¯¥éªŒè¯ç å›¾ç‰‡å¯ä»¥çŸ¥é“ï¼Œæ•°å­—çš„ rgb å€¼ä¸€èˆ¬å¤„åœ¨ 180~190 ä»¥ä¸‹ï¼Œè€ŒèƒŒæ™¯è‰²å’Œé›ªèŠ±çš„ rgb å€¼ä¸€èˆ¬å¤„åœ¨ 200 ä»¥ä¸Šï¼Œsoï¼Œæˆ‘ä»¬åªè¦åœ¨å¤„ç†å›¾ç‰‡çš„æ—¶å€™åªå– 190 ä»¥ä¸‹çš„ rgb å€¼ä¿å­˜å°± ok äº†ï¼Œè¿™æ ·å°±å¯ä»¥å»é™¤æ‰ç»å¤§éƒ¨åˆ†çš„å¹²æ‰°é¡¹</p><h2 id="äºŒå€¼åŒ–"><a href="#äºŒå€¼åŒ–" class="headerlink" title="äºŒå€¼åŒ–"></a>äºŒå€¼åŒ–</h2><p>æŠŠå¹²æ‰°ä¿¡æ¯å»é™¤ä¹‹åï¼Œåªç•™ä¸‹äºŒè¿›åˆ¶ï¼ˆä¹Ÿå°±æ˜¯ 0 å’Œ 1 è¡¨ç¤ºï¼‰çš„ç‚¹é˜µ</p><pre><code class="hljs php"><span class="hljs-comment">/** * äºŒå€¼åŒ–ï¼Œæ’é™¤èƒŒæ™¯è‰²ï¼Œé›ªèŠ±ç­‰å¹²æ‰°é¡¹ * <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt; */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imageHash</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">for</span>($i = <span class="hljs-number">0</span>; $i &lt; <span class="hljs-keyword">$this</span>-&gt;_image_h; $i++) &#123;        <span class="hljs-keyword">for</span> ($j = <span class="hljs-number">0</span>; $j &lt; <span class="hljs-keyword">$this</span>-&gt;_image_w; $j++) &#123;            $rgb = imagecolorat(<span class="hljs-keyword">$this</span>-&gt;_in_img,$j,$i);            $rgb_array = imagecolorsforindex(<span class="hljs-keyword">$this</span>-&gt;_in_img, $rgb);            <span class="hljs-keyword">if</span>($rgb_array[<span class="hljs-string">'red'</span>]&lt;<span class="hljs-number">190</span>&amp;&amp;$rgb_array[<span class="hljs-string">'green'</span>]&lt;<span class="hljs-number">190</span>&amp;&amp;$rgb_array[<span class="hljs-string">'blue'</span>]&lt;<span class="hljs-number">190</span>)&#123;                $data[$i][$j]=<span class="hljs-number">1</span>;            &#125;<span class="hljs-keyword">else</span>&#123;                $data[$i][$j]=<span class="hljs-number">0</span>;            &#125;        &#125;    &#125;&#125;</code></pre><blockquote><p>ç‚¹é˜µåŒ–ä¹‹åçš„æˆªå›¾</p></blockquote><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2878339217.png" srcset="/img/loading.gif" alt="QQæˆªå›¾20160503213904.png"></p><h2 id="å»å™ªç‚¹"><a href="#å»å™ªç‚¹" class="headerlink" title="å»å™ªç‚¹"></a>å»å™ªç‚¹</h2><p>å›¾åƒäºŒå€¼åŒ–ä¹‹åå¯èƒ½è¿˜å­˜åœ¨å¾ˆå¤šå™ªç‚¹ï¼Œå™ªç‚¹çš„ç‰¹ç‚¹ä¸€èˆ¬æ˜¯å­¤ç«‹æ— æ´çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ä»¥è¿™ä¸ª 1 ç‚¹ä¸ºä¸­å¿ƒçš„ç‚¹ï¼Œå‘¨å›´çš„ 1 ç‚¹ä¸ªæ•°å°äºä¸€ä¸ªé˜ˆå€¼ï¼ˆæˆ‘æŠŠå®ƒè®¾ä¸º 3ï¼‰ï¼Œå°±ç¡®è®¤å®ƒä¸ºå™ªç‚¹å¹¶å°†ä¹‹å»é™¤</p><pre><code class="hljs php"><span class="hljs-comment">/** * å»é™¤å™ªç‚¹ * <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt; * <span class="hljs-doctag">@param</span> $hash_data * <span class="hljs-doctag">@return</span> mixed */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeHotSpots</span><span class="hljs-params">($hash_data)</span></span>&#123;    <span class="hljs-keyword">for</span>($i = <span class="hljs-number">0</span>; $i &lt; <span class="hljs-keyword">$this</span>-&gt;_image_h; $i++) &#123;        <span class="hljs-keyword">for</span> ($j = <span class="hljs-number">0</span>; $j &lt; <span class="hljs-keyword">$this</span>-&gt;_image_w; $j++) &#123;            <span class="hljs-keyword">if</span>($hash_data[$i][$j])&#123;                <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;isHotSpots($i,$j,$hash_data)) $hash_data[$i][$j]=<span class="hljs-number">0</span>;            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> $hash_data;&#125;<span class="hljs-comment">/** * åˆ¤æ–­æ˜¯å¦æ˜¯å™ªç‚¹ * <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt; * <span class="hljs-doctag">@param</span> $i * <span class="hljs-doctag">@param</span> $j * <span class="hljs-doctag">@param</span> $hash_data * <span class="hljs-doctag">@return</span> bool ture:æ˜¯å™ªç‚¹,false:ä¸æ˜¯ */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isHotSpots</span><span class="hljs-params">($i,$j,$hash_data)</span></span>&#123;    <span class="hljs-keyword">if</span>($i == <span class="hljs-number">0</span> || $j == <span class="hljs-number">0</span> || $i == (<span class="hljs-keyword">$this</span>-&gt;_image_h - <span class="hljs-number">1</span>) || $j == (<span class="hljs-keyword">$this</span>-&gt;_image_w - <span class="hljs-number">1</span>)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;    <span class="hljs-comment">//å¾…æ£€æŸ¥ç‚¹ä¸ºä¸­å¿ƒçš„ä¹ä¸ªç‚¹</span>    $points[<span class="hljs-number">0</span>]=$hash_data[$i<span class="hljs-number">-1</span>][$j<span class="hljs-number">-1</span>];    $points[<span class="hljs-number">1</span>]=$hash_data[$i<span class="hljs-number">-1</span>][$j];    $points[<span class="hljs-number">2</span>]=$hash_data[$i<span class="hljs-number">-1</span>][$j+<span class="hljs-number">1</span>];    $points[<span class="hljs-number">3</span>]=$hash_data[$i][$j<span class="hljs-number">-1</span>];    $points[<span class="hljs-number">4</span>]=$hash_data[$i][$j];<span class="hljs-comment">//å¾…æ£€æŸ¥ç‚¹</span>    $points[<span class="hljs-number">5</span>]=$hash_data[$i][$j+<span class="hljs-number">1</span>];    $points[<span class="hljs-number">6</span>]=$hash_data[$i+<span class="hljs-number">1</span>][$j<span class="hljs-number">-1</span>];    $points[<span class="hljs-number">7</span>]=$hash_data[$i+<span class="hljs-number">1</span>][$j];    $points[<span class="hljs-number">8</span>]=$hash_data[$i+<span class="hljs-number">1</span>][$j+<span class="hljs-number">1</span>];    $count=<span class="hljs-number">0</span>;    <span class="hljs-keyword">foreach</span> ($points <span class="hljs-keyword">as</span> $v)&#123;        <span class="hljs-keyword">if</span>($v)&#123;            $count++;        &#125;    &#125;    <span class="hljs-keyword">return</span> $count&lt;<span class="hljs-number">4</span>;&#125;</code></pre><blockquote><p>å»é™¤å™ªç‚¹ä¹‹å</p></blockquote><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/1678387744.png" srcset="/img/loading.gif" alt="QQæˆªå›¾20160503214315.png"></p><h2 id="å»é™¤å¹²æ‰°çº¿"><a href="#å»é™¤å¹²æ‰°çº¿" class="headerlink" title="å»é™¤å¹²æ‰°çº¿"></a>å»é™¤å¹²æ‰°çº¿</h2><p>é€šè¿‡å»é™¤å™ªç‚¹ä¹‹åçš„å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¤§éƒ¨åˆ†çš„å¹²æ‰°çº¿ï¼Œå…¶å®å·²ç»è¢«å»é™¤æ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ï¼Œå»é™¤å™ªç‚¹çš„æ–¹æ³•å½“åšä¸€ä¸ªæ»¤é•œï¼Œå¤šè¿‡æ»¤å‡ æ¬¡ï¼Œå¹²æ‰°çº¿åŸºæœ¬ä¸Šå¯ä»¥å»é™¤å®Œæ¯•ï¼ˆè¿™é‡Œæµ‹è¯•å»é™¤ä¸‰æ¬¡çš„æ•ˆæœæ˜¯æœ€å¥½çš„ï¼‰</p><h2 id="åˆ†å‰²éªŒè¯ç "><a href="#åˆ†å‰²éªŒè¯ç " class="headerlink" title="åˆ†å‰²éªŒè¯ç "></a>åˆ†å‰²éªŒè¯ç </h2><p>è¿™ä¸ªéªŒè¯ç çš„æ¯ä¸ªæ•°å­—å…¶å®éƒ½æ˜¯ç­‰åˆ†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç­‰åˆ†çš„æ–¹æ³•å»åˆ†å‰²å®ƒ</p><pre><code class="hljs php"><span class="hljs-comment">/** * <span class="hljs-doctag">@author</span> mohuishou&lt;1<span class="hljs-doctag">@lailin</span>.xyz&gt; * <span class="hljs-doctag">@param</span> $n * <span class="hljs-doctag">@return</span> array */</span><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">splitImage</span><span class="hljs-params">($n)</span></span>&#123;    $data=[];    $a=<span class="hljs-keyword">$this</span>-&gt;_image_w/<span class="hljs-keyword">self</span>::CHAR_NUM;    <span class="hljs-keyword">for</span>($i=$n*$a;$i&lt;($n+<span class="hljs-number">1</span>)*$a;$i++)&#123;        $column=array_column(<span class="hljs-keyword">$this</span>-&gt;_hash_data,$i);        <span class="hljs-keyword">if</span>(implode(<span class="hljs-string">""</span>,$column)!=<span class="hljs-number">0</span>)&#123;            $data[]=$column;        &#125;    &#125;    $out_img_w=count($data)+<span class="hljs-number">4</span>;    $out_img_h=count($data[<span class="hljs-number">0</span>])+<span class="hljs-number">4</span>;    $out_img = imagecreatetruecolor($out_img_w,$out_img_h);<span class="hljs-comment">//åˆ›å»ºä¸€å¹…çœŸå½©è‰²å›¾åƒ</span>    $bg=imagecolorallocate($out_img, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>);<span class="hljs-comment">//èƒŒæ™¯è‰²ç”»ä¸ºç™½è‰²</span>    imagefill($out_img, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>, $bg);    <span class="hljs-comment">//ä¸€åˆ—ä¸€åˆ—çš„è¿›è¡Œç”»å›¾</span>    <span class="hljs-keyword">foreach</span> ($data <span class="hljs-keyword">as</span> $k=&gt;$v)&#123;        <span class="hljs-keyword">foreach</span> ($v <span class="hljs-keyword">as</span> $key=&gt; $val)&#123;            $color=<span class="hljs-number">255</span>;            <span class="hljs-keyword">if</span>($val) $color=<span class="hljs-number">0</span>;            $c = imagecolorallocate($out_img, $color, $color, $color);            imagesetpixel($out_img, $k+<span class="hljs-number">2</span>,$key+<span class="hljs-number">2</span>, $c);        &#125;    &#125;    <span class="hljs-keyword">return</span> $out_img;&#125;</code></pre><h2 id="ä¿å­˜-amp-å¯¹æ¯”è¯†åˆ«"><a href="#ä¿å­˜-amp-å¯¹æ¯”è¯†åˆ«" class="headerlink" title="ä¿å­˜&amp;å¯¹æ¯”è¯†åˆ«"></a>ä¿å­˜&amp;å¯¹æ¯”è¯†åˆ«</h2><blockquote><p>æœ€åå°†åˆ†å‰²å¥½çš„å›¾ç‰‡äºŒå€¼åŒ–ï¼Œé€šè¿‡ä¸€ä¸ªæ•°ç»„ä¿å­˜ä¸‹æ¥ï¼Œä½œä¸ºä¸€ä¸ªæ ‡å‡†ï¼Œç„¶ååä¹‹åéœ€è¦éªŒè¯çš„éªŒè¯ç ï¼Œé€šè¿‡å’Œä¹‹å‰çš„æ•°ç»„æ±‚äº¤é›†ï¼Œæ¯”è¾ƒæœ€ç›¸è¿‘çš„æ•°å­—å¾—å‡ºç»“æœå³å¯</p></blockquote><h2 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h2><p><strong>å…¶å®åˆ°è¿™ä¸€æ­¥ä¹‹åå·²ç»èƒ½å¤Ÿè¯†åˆ«ä¸€äº›éªŒè¯ç äº†ï¼Œå¯¹äºç¬¬äºŒç§éªŒè¯ç å·²ç»å¯ä»¥è¾¾åˆ°å¾ˆå¥½çš„è¯†åˆ«æ•ˆæœï¼Œä½†æ˜¯å¯¹äºç¬¬ä¸€ç§éªŒè¯ç çš„è¯†åˆ«ç‡å¾ˆä½å¾ˆä½ï¼Œå¤§æ¦‚åªæœ‰<code>5%-15%</code>ï¼ŒåŸºæœ¬ä¸èƒ½æŠ•å…¥ä½¿ç”¨ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« é’ˆå¯¹è¿™ç§éªŒè¯ç ï¼Œæ€ä¹ˆæ›´å¥½çš„è¯†åˆ«ï¼Œä¸»è¦æ˜¯<code>æ ‡å‡†åŒ–</code>å’Œ<code>ç‰¹å¾åº“çš„å»ºç«‹</code></strong></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>å›¾ç‰‡</tag>
      
      <tag>è¯†åˆ«</tag>
      
      <tag>éªŒè¯ç è¯†åˆ«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>php-webhookåˆ©ç”¨phpè„šæœ¬è‡ªåŠ¨åŒ–éƒ¨ç½²gité¡¹ç›®</title>
    <link href="/post/61468.html"/>
    <url>/post/61468.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>é‡åˆ°æƒé™çš„é—®é¢˜å¼„äº†å¥½ä¹…ï¼Œæ•´ç†ä¸€ä¸‹æ­¥éª¤ç®€å•çš„å†™ä¸€ä¸‹<br>åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« çš„æ—¶å€™é»˜è®¤ä½ çš„æœåŠ¡å™¨ä¸Šå®‰è£…äº† web æœåŠ¡å™¨å’Œ git</p></blockquote><h2 id="step1"><a href="#step1" class="headerlink" title="step1"></a>step1</h2><blockquote><p>å†™ä¸€ä¸ªç®€å•çš„è„šæœ¬æŸ¥çœ‹ä½ çš„æœåŠ¡å™¨è¿è¡Œçš„è´¦æˆ·ï¼Œå’Œæ˜¯å¦èƒ½å¤Ÿè¿è¡Œç›¸å…³å‡½æ•°</p></blockquote><pre><code class="hljs php">$test=shell_exec(<span class="hljs-string">"whoami"</span>);var_dump($test);<span class="hljs-comment">//æˆ‘çš„è¿”å›çš„æ˜¯ www-data</span></code></pre><p><strong>å¦‚æœè¿™é‡Œè¿”å› null çš„è¯ï¼Œä¸å¦¨æ£€æŸ¥ä¸€ä¸‹ shell_exec å‡½æ•°æ˜¯å¦è¢«ç¦ç”¨äº†</strong></p><h2 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h2><blockquote><p>å»ºç«‹ ssh å…¬é’¥ï¼Œä»¥æˆ‘çš„ www-data è´¦æˆ·ä¸ºä¾‹å­</p></blockquote><p>1.å…ˆå»ºç«‹ä¸€ä¸ª.ssh ç›®å½•å¹¶ç»™äºˆ www-data ç”¨æˆ·æƒé™</p><pre><code class="hljs undefined">sudo mkdir <span class="hljs-regexp">/var/</span>www/.sshsudo chown -R www-<span class="hljs-string">data:</span>www-data <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/.ssh/</span></code></pre><p>2.ç”Ÿæˆ webhook éƒ¨ç½²å…¬é’¥</p><pre><code class="hljs undefined"><span class="hljs-title">sudo</span> -<span class="hljs-type">Hu</span> www-<span class="hljs-class"><span class="hljs-keyword">data</span> ssh-keygen -t rsa //ä¸€ç›´å›è½¦å³å¯</span></code></pre><p><em>å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œé‡åˆ°äº†<code>-su: sudo: command not found</code>ï¼Œå¯ä»¥å…ˆå®‰è£…<code>sudo</code>å‘½ä»¤,<code>apt-get install sudo</code>ï¼Œå¦‚æœä½ å’Œæˆ‘è¿˜ä¸€æ ·é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œä¸å¦¨å…ˆè¯•è¯•<code>apt-get update</code></em></p><p>3.å°† webhook éƒ¨ç½²å…¬é’¥ä¸Šä¼ åˆ°æ‰˜ç®¡ç½‘ç«™</p><blockquote><p>æµ‹è¯•ç”¨çš„ Codingï¼Œå…¶ä»–è¿˜åœ¨æµ‹è¯•å½“ä¸­</p></blockquote><p>å…ˆæŸ¥çœ‹å…¬é’¥</p><pre><code class="hljs undefined">sudo cat <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/.ssh/i</span>d_rsa.pub</code></pre><p>ç„¶åå¤åˆ¶ä¸Šé¢çš„å†…å®¹åˆ°æ‰˜ç®¡ç½‘ç«™ï¼Œé¡¹ç›®çš„ webhook ä¸Šé¢</p><h2 id="step3"><a href="#step3" class="headerlink" title="step3"></a>step3</h2><blockquote><p>webhook æ–‡ä»¶</p></blockquote><script src="http://git.oschina.net/lxl520/php-webhook/widget_preview"></script><h2 id="step4"><a href="#step4" class="headerlink" title="step4"></a>step4</h2><blockquote><p>å…ˆåœ¨æœåŠ¡å™¨ä¸Š<code>git clone</code></p></blockquote><pre><code class="hljs undefined"><span class="hljs-title">sudo</span> chown -<span class="hljs-type">R</span> www-<span class="hljs-class"><span class="hljs-keyword">data</span>:www-<span class="hljs-keyword">data</span> &#123;ä»£ç åœ°å€&#125;</span><span class="hljs-title">sudo</span> -<span class="hljs-type">Hu</span> www-<span class="hljs-class"><span class="hljs-keyword">data</span> git clone &#123;ä½ çš„é¡¹ç›®<span class="hljs-title">ssh</span>åœ°å€&#125; &#123;ä»£ç åœ°å€&#125;  <span class="hljs-comment">--depth=1</span></span></code></pre><p><strong>æ³¨æ„ï¼Œè¿™é‡Œåˆå§‹åŒ– clone å¿…é¡»è¦ç”¨ www-data ç”¨æˆ·</strong></p><h2 id="step5"><a href="#step5" class="headerlink" title="step5"></a>step5</h2><blockquote><p>åœ¨æ‰˜ç®¡ç½‘ç«™ä¸Šæ·»åŠ  webhook åœ°å€ï¼Œç„¶åæäº¤ä¸€æ¬¡æµ‹è¯•</p></blockquote><h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><blockquote><p>å‚è€ƒäº†ä»¥ä¸‹ä»£ç <br><a href="https://gist.github.com/overtrue/0bf1cd704bf804de2e2c" target="_blank" rel="noopener">https://gist.github.com/overtrue/0bf1cd704bf804de2e2c</a></p></blockquote><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>git</tag>
      
      <tag>webhook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginxæ— æ³•å¯åŠ¨</title>
    <link href="/post/33991.html"/>
    <url>/post/33991.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä»Šå¤©è£…äº†ä¸€ä¸ªæœåŠ¡å™¨ä½†æ˜¯ nginx ä¸€ç›´æ— æ³•å¯åŠ¨ï¼Œgoogle äº†å„ç§ç­”æ¡ˆï¼Œè¿˜æ˜¯æ²¡æœ‰æ•ˆæœ</p></blockquote><h3 id="ä¾‹å¦‚ï¼š"><a href="#ä¾‹å¦‚ï¼š" class="headerlink" title="ä¾‹å¦‚ï¼š"></a>ä¾‹å¦‚ï¼š</h3><pre><code class="hljs undefined">nginxå¯åŠ¨ï¼Œé‡å¯ï¼Œå…³é—­å‘½ä»¤åœæ­¢æ“ä½œåœæ­¢æ“ä½œæ˜¯é€šè¿‡å‘nginxè¿›ç¨‹å‘é€ä¿¡å·ï¼ˆä»€ä¹ˆæ˜¯ä¿¡å·è¯·å‚é˜…linuxæ–‡ ç« ï¼‰æ¥è¿›è¡Œçš„æ­¥éª¤<span class="hljs-number">1</span>ï¼šæŸ¥è¯¢nginxä¸»è¿›ç¨‹å·ps -ef | grep nginxåœ¨è¿›ç¨‹åˆ—è¡¨é‡Œ é¢æ‰¾masterè¿›ç¨‹ï¼Œå®ƒçš„ç¼–å·å°±æ˜¯ä¸»è¿›ç¨‹å·äº†ã€‚æ­¥éª¤<span class="hljs-number">2</span>ï¼šå‘é€ä¿¡å·ä»å®¹åœæ­¢Nginxï¼š<span class="hljs-keyword">kill</span> -<span class="hljs-keyword">QUIT</span> ä¸»è¿›ç¨‹å·å¿«é€Ÿåœæ­¢Nginxï¼š<span class="hljs-keyword">kill</span> -TERM ä¸»è¿›ç¨‹å·å¼ºåˆ¶åœæ­¢Nginxï¼špkill -<span class="hljs-number">9</span> nginxå¦å¤–ï¼Œ è‹¥åœ¨nginx.confé…ç½®äº†pidæ–‡ä»¶å­˜æ”¾è·¯å¾„åˆ™è¯¥æ–‡ä»¶å­˜æ”¾çš„å°±æ˜¯Nginxä¸»è¿›ç¨‹å·ï¼Œå¦‚æœæ²¡æŒ‡å®šåˆ™æ”¾åœ¨nginxçš„logsç›®å½•ä¸‹ã€‚æœ‰äº†pidæ–‡ ä»¶ï¼Œæˆ‘ä»¬å°±ä¸ç”¨å…ˆæŸ¥è¯¢Nginxçš„ä¸»è¿›ç¨‹å·ï¼Œè€Œç›´æ¥å‘Nginxå‘é€ä¿¡å·äº†ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š<span class="hljs-keyword">kill</span> -ä¿¡å·ç±»å‹ '/usr/nginx/logs/nginx.pid'å¹³æ»‘é‡å¯å¦‚æœæ›´æ”¹äº†é…ç½®å°±è¦é‡å¯Nginxï¼Œè¦å…ˆå…³é—­Nginxå†æ‰“å¼€ï¼Ÿä¸æ˜¯çš„ï¼Œå¯ä»¥å‘Nginx å‘é€ä¿¡å·ï¼Œå¹³æ»‘é‡å¯ã€‚å¹³æ»‘é‡å¯å‘½ä»¤ï¼š<span class="hljs-keyword">kill</span> -HUP ä½è¿›ç§°å·æˆ–è¿›ç¨‹å·æ–‡ä»¶è·¯å¾„æˆ–è€…ä½¿ç”¨/usr/nginx/sbin/nginx -<span class="hljs-keyword">s</span> reloadæ³¨æ„ï¼Œä¿®æ”¹äº†é…ç½®æ–‡ä»¶åæœ€å¥½å…ˆæ£€æŸ¥ä¸€ä¸‹ä¿®æ”¹è¿‡çš„é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ ç¡®ï¼Œä»¥å…é‡å¯åNginxå‡ºç°é”™è¯¯å½±å“æœåŠ¡å™¨ç¨³å®šè¿è¡Œã€‚åˆ¤æ–­Nginxé…ç½®æ˜¯å¦æ­£ç¡®å‘½ä»¤å¦‚ä¸‹ï¼šnginx -t -c /usr/nginx/conf/nginx.confæˆ–è€…/usr/nginx/sbin/nginx -tå¹³æ»‘å‡çº§å¦‚æœæœåŠ¡å™¨æ­£åœ¨è¿è¡Œçš„Nginxè¦è¿›è¡Œå‡çº§ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—æ—¶ï¼Œæˆ‘ä»¬éœ€ è¦åœæ‰æœåŠ¡å™¨å¹¶åšç›¸åº”ä¿®æ”¹ï¼Œè¿™æ ·æœåŠ¡å™¨å°±è¦åœ¨ä¸€æ®µæ—¶é—´å†…åœæ­¢æœåŠ¡ï¼ŒNginxå¯ä»¥åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹è¿›è¡Œå„ç§å‡çº§åŠ¨ä½œè€Œä¸å½±å“æœåŠ¡å™¨è¿è¡Œã€‚æ­¥éª¤<span class="hljs-number">1</span>ï¼šå¦‚ æœå‡çº§Nginxç¨‹åºï¼Œå…ˆç”¨æ–°ç¨‹åºæ›¿æ¢æ—§ç¨‹åºæ–‡ä»¶ï¼Œç¼–è¯‘å®‰è£…çš„è¯æ–°ç¨‹åºç›´æ¥ç¼–è¯‘åˆ°Nginxå®‰è£…ç›®å½•ä¸­ã€‚æ­¥ éª¤<span class="hljs-number">2</span>ï¼šæ‰§è¡Œå‘½ä»¤<span class="hljs-keyword">kill</span> -USR2 æ—§ç‰ˆç¨‹åºçš„ä¸»è¿›ç¨‹å·æˆ–è¿›ç¨‹æ–‡ä»¶åæ­¤æ—¶æ—§çš„Nginxä¸»è¿›ç¨‹å°†ä¼šæŠŠè‡ªå·±çš„è¿›ç¨‹æ–‡ä»¶æ”¹åä¸º.oldbinï¼Œç„¶åæ‰§è¡Œæ–°ç‰ˆ Nginxã€‚æ–°æ—§Nginxä¼šåŒå¸‚è¿è¡Œï¼Œå…±åŒå¤„ç†è¯·æ±‚ã€‚è¿™æ—¶è¦é€æ­¥åœæ­¢æ—§ç‰ˆ Nginxï¼Œè¾“å…¥å‘½ä»¤ï¼š<span class="hljs-keyword">kill</span> -WINCH æ—§ç‰ˆä¸»è¿›ç¨‹å·æ…¢æ…¢æ—§çš„å·¥ä½œè¿›ç¨‹å°±éƒ½ä¼šéšç€ä»»åŠ¡æ‰§è¡Œå®Œæ¯•è€Œé€€å‡ºï¼Œæ–°ç‰ˆçš„Nginxçš„å·¥ä½œè¿›ç¨‹ä¼šé€æ¸å–ä»£æ—§ç‰ˆ å·¥ä½œè¿›ç¨‹ã€‚æ­¤ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šä½¿ç”¨æ–°ç‰ˆè¿˜æ˜¯æ¢å¤åˆ°æ—§ç‰ˆã€‚ä¸é‡è½½é…ç½®å¯åŠ¨æ–°/æ—§å·¥ä½œè¿›ç¨‹<span class="hljs-keyword">kill</span> -HUP æ—§/æ–°ç‰ˆä¸»è¿›ç¨‹å·ä»å®¹å…³é—­æ—§/æ–°è¿›ç¨‹<span class="hljs-keyword">kill</span> -<span class="hljs-keyword">QUIT</span> æ—§/æ–°ä¸»è¿›ç¨‹å·å¦‚æœæ­¤æ—¶æŠ¥é”™ï¼Œæç¤ºè¿˜æœ‰è¿›ç¨‹æ²¡æœ‰ç»“æŸå°±ç”¨ä¸‹é¢å‘½ä»¤å…ˆå…³é—­æ—§/æ–°å·¥ä½œè¿›ç¨‹ï¼Œå†å…³é—­ä¸»è¿›ç¨‹å·ï¼š<span class="hljs-keyword">kill</span> -TERM æ—§/æ–°å·¥ä½œè¿›ç¨‹å·è¿™æ ·ä¸‹æ¥ï¼Œå¦‚æœè¦æ¢å¤åˆ°æ—§ç‰ˆæœ¬ï¼Œåªéœ€è¦ä¸Šé¢çš„å‡ ä¸ªæ­¥ éª¤éƒ½æ˜¯æ“ä½œæ–°ç‰ˆä¸»è¿›ç¨‹å·ï¼Œå¦‚æœè¦ç”¨æ–°ç‰ˆæœ¬å°±ä¸Šé¢çš„å‡ ä¸ªæ­¥éª¤éƒ½æ“ä½œæ—§ç‰ˆä¸»è¿›ç¨‹å·å°±è¡Œäº†ã€‚ä¸Šé¢å°±æ˜¯Nginxçš„ä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œå¸Œæœ›ä»¥åNginxèƒ½æœ‰æ›´å¥½çš„æ–¹æ³•æ¥å¤„ç†è¿™äº›æ“ä½œï¼Œ æœ€å¥½æ˜¯Nginxçš„å‘½ä»¤è€Œä¸æ˜¯å‘Nginxè¿›ç¨‹å‘é€ç³»ç»Ÿä¿¡å·ã€‚</code></pre><h3 id="åé¢å‘ç°"><a href="#åé¢å‘ç°" class="headerlink" title="åé¢å‘ç°"></a>åé¢å‘ç°</h3><p>çªç„¶æƒ³èµ·æ¥ä¼šä¸ä¼šæ˜¯é…ç½®æ–‡ä»¶æœ‰é”™è¯¯å¯¼è‡´çš„æ— æ³•å¯åŠ¨ï¼Œso</p><pre><code class="hljs undefined">nginx -t -c <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf</span></code></pre><p><strong>ç»“æœå‘ç°</strong>æ˜¯é…ç½®é¡¹é‡Œé¢çš„æ—¥å¿—æ–‡ä»¶ç›®å½•ä¸å­˜åœ¨</p><h3 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h3><p>ä»¥åé‡åˆ°è¿™ç§é—®é¢˜ä¸€å®šè¦å…ˆçœ‹çœ‹æ—¥å¿—æˆ–è€…å…ˆæµ‹è¯•ä¸€ä¸‹è¯­å¥</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59269.html">nginx-phpæŠ¥502é”™è¯¯</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>æœåŠ¡å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginx-phpæŠ¥502é”™è¯¯</title>
    <link href="/post/59269.html"/>
    <url>/post/59269.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ­£æ˜¯æ‚²å‚¬çŠ¯äº†ä¸€ä¸ªè¶…ä½çº§çš„é”™è¯¯</p></blockquote><p>åœ¨è…¾è®¯äº‘æ–°ä¹°äº†ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç›´æ¥ç”¨äº†ä»¥å‰ nginx çš„é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯è£…ä¸Šä¹‹åå…ˆæ˜¯ 404 ç„¶å 502ï¼Œä¸€ç›´ä¸çŸ¥é“ä¸ºä»€ä¹ˆ</p><pre><code class="hljs undefined"><span class="hljs-number">404</span>æ˜¯å› ä¸ºæœ¬æ¥è¦æŠ¥<span class="hljs-number">502</span>çš„é”™è¯¯ï¼Œä½†æ˜¯<span class="hljs-number">502</span>çš„é¡µé¢æ²¡æœ‰æ”¾è¿›å»....</code></pre><h4 id="502-çš„é”™è¯¯åœ¨ç½‘ä¸Šæœç´¢äº†å¾ˆå¤šç­”æ¡ˆéƒ½æ²¡æœ‰è§£å†³ï¼Œç„¶ååé¢å‘ç°æˆ‘è‡ªå·±ç«Ÿç„¶æ²¡æœ‰çœ‹é”™è¯¯æ—¥å¿—ï¼Œç¿»æ—¥å¿—çš„æ—¶å€™å‘ç°æ˜¯ï¼š"><a href="#502-çš„é”™è¯¯åœ¨ç½‘ä¸Šæœç´¢äº†å¾ˆå¤šç­”æ¡ˆéƒ½æ²¡æœ‰è§£å†³ï¼Œç„¶ååé¢å‘ç°æˆ‘è‡ªå·±ç«Ÿç„¶æ²¡æœ‰çœ‹é”™è¯¯æ—¥å¿—ï¼Œç¿»æ—¥å¿—çš„æ—¶å€™å‘ç°æ˜¯ï¼š" class="headerlink" title="502 çš„é”™è¯¯åœ¨ç½‘ä¸Šæœç´¢äº†å¾ˆå¤šç­”æ¡ˆéƒ½æ²¡æœ‰è§£å†³ï¼Œç„¶ååé¢å‘ç°æˆ‘è‡ªå·±ç«Ÿç„¶æ²¡æœ‰çœ‹é”™è¯¯æ—¥å¿—ï¼Œç¿»æ—¥å¿—çš„æ—¶å€™å‘ç°æ˜¯ï¼š"></a>502 çš„é”™è¯¯åœ¨ç½‘ä¸Šæœç´¢äº†å¾ˆå¤šç­”æ¡ˆéƒ½æ²¡æœ‰è§£å†³ï¼Œç„¶ååé¢å‘ç°æˆ‘è‡ªå·±ç«Ÿç„¶æ²¡æœ‰çœ‹é”™è¯¯æ—¥å¿—ï¼Œç¿»æ—¥å¿—çš„æ—¶å€™å‘ç°æ˜¯ï¼š</h4><pre><code class="hljs undefined"><span class="hljs-number">2016</span>/<span class="hljs-number">04</span>/<span class="hljs-number">25</span> <span class="hljs-number">04</span>:<span class="hljs-number">32</span>:<span class="hljs-number">42</span> <span class="hljs-string">[crit]</span> <span class="hljs-number">251</span>#<span class="hljs-number">251</span>: *<span class="hljs-number">166</span> connect() to unix:/var/run/php5-fpm.sock failed (<span class="hljs-number">2</span>: No such file or directory) while connecting to upstream, client: <span class="hljs-number">220</span>.<span class="hljs-number">167</span>.<span class="hljs-number">47</span>.<span class="hljs-number">185</span>, server: <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>, request: <span class="hljs-string">"<span class="hljs-keyword">GET</span> / HTTP/1.1"</span>, upstream: <span class="hljs-string">"fastcgi://unix:/var/run/php5-fpm.sock:"</span>, host: <span class="hljs-string">"115.159.94.101"</span></code></pre><h4 id="çªç„¶é—´æç„¶å¤§æ‚Ÿï¼Œæˆ‘æ–°ä¹°çš„æœåŠ¡å™¨è£…çš„æ˜¯-php7ï¼Œä»¥å‰ç”¨çš„-php5ï¼Œsock-æ–‡ä»¶çš„åœ°å€ä¸ä¸€æ ·-æ”¹æˆä¸‹é¢è¿™ä¸ªé‡å¯ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†"><a href="#çªç„¶é—´æç„¶å¤§æ‚Ÿï¼Œæˆ‘æ–°ä¹°çš„æœåŠ¡å™¨è£…çš„æ˜¯-php7ï¼Œä»¥å‰ç”¨çš„-php5ï¼Œsock-æ–‡ä»¶çš„åœ°å€ä¸ä¸€æ ·-æ”¹æˆä¸‹é¢è¿™ä¸ªé‡å¯ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†" class="headerlink" title="çªç„¶é—´æç„¶å¤§æ‚Ÿï¼Œæˆ‘æ–°ä¹°çš„æœåŠ¡å™¨è£…çš„æ˜¯ php7ï¼Œä»¥å‰ç”¨çš„ php5ï¼Œsock æ–‡ä»¶çš„åœ°å€ä¸ä¸€æ ·,æ”¹æˆä¸‹é¢è¿™ä¸ªé‡å¯ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†"></a>çªç„¶é—´æç„¶å¤§æ‚Ÿï¼Œæˆ‘æ–°ä¹°çš„æœåŠ¡å™¨è£…çš„æ˜¯ php7ï¼Œä»¥å‰ç”¨çš„ php5ï¼Œsock æ–‡ä»¶çš„åœ°å€ä¸ä¸€æ ·,æ”¹æˆä¸‹é¢è¿™ä¸ªé‡å¯ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†</h4><pre><code class="hljs undefined">fastcgi_pass <span class="hljs-string">unix:</span><span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/php/</span>php7<span class="hljs-number">.0</span>-fpm.sock;</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>æœåŠ¡å™¨</tag>
      
      <tag>php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€éªŒè¯æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º</title>
    <link href="/post/48100.html"/>
    <url>/post/48100.html</url>
    
    <content type="html"><![CDATA[<h3 id="éªŒè¯æµ®ç‚¹æ•°"><a href="#éªŒè¯æµ®ç‚¹æ•°" class="headerlink" title="éªŒè¯æµ®ç‚¹æ•°"></a>éªŒè¯æµ®ç‚¹æ•°</h3><blockquote><p>è™½ç„¶ä»¥å‰ä¹Ÿå­¦è¿‡æµ®ç‚¹æ•°çš„è¡¨ç¤ºåŸç†ï¼Œå¤§è‡´çš„åŸç†è¿˜æ˜¯æ¸…æ¥šçš„ï¼Œä½†æ˜¯ä½¿ç”¨ C è¯­è¨€çš„æ¥è¿›æ€§éªŒè¯è¿˜æ²¡æœ‰å°è¯•è¿‡ï¼Œä¸‹é¢æ˜¯éªŒè¯çš„è¿‡ç¨‹</p></blockquote><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li>çŸ¥é“æµ®ç‚¹æ•°ï¼Œæ˜¯æŒ‰ç…§ 32 ä½åœ¨å†…å­˜ä¸­ä¿å­˜ï¼Œå…¶ä¸­ç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ï¼Œå 8 ä½è¡¨ç¤ºæŒ‡æ•°ï¼Œæœ€å 23 ä½è¡¨ç¤ºå°æ•°</li><li>C è¯­è¨€å½“ä¸­å­˜åœ¨æŒ‡é’ˆï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æŒ‡é’ˆæ¥è·å–ï¼Œå˜é‡çš„åœ°å€ã€‚</li><li>æ‰€ä»¥å°±å…ˆå®šä¹‰ä¸€ä¸ªå˜é‡æ¥å‚¨å­˜æµ®ç‚¹æ•°ï¼Œåœ¨å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆæ¥è·å–ï¼Œæµ®ç‚¹æ•°çš„å‚¨å­˜åœ°å€ï¼Œåœ¨æŠŠ 16 è¿›åˆ¶æˆ–è€… 10 è¿›åˆ¶çš„åœ°å€è½¬åŒ–ä¸º 2 è¿›åˆ¶å³å¯<a id="more"></a></li></ol><pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;<span class="hljs-keyword">float</span> a=<span class="hljs-number">209.125</span>;<span class="hljs-keyword">int</span> *p=(<span class="hljs-keyword">int</span> *)&amp;a;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<span class="hljs-built_in">printf</span>(<span class="hljs-string">"è¯·è¾“å…¥ä¸€ä¸²æ•°:"</span>);<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%f"</span>,&amp;a);<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, *p);<span class="hljs-comment">//è¾“å‡ºæ•°å€¼åœ¨å†…å­˜ä¸­10è¿›åˆ¶è¡¨ç¤º</span>decimal2Binary(*p);<span class="hljs-comment">//å°†åè¿›åˆ¶è½¬åŒ–ä¸ºäºŒè¿›åˆ¶</span>decimal2Binary_2(*p);&#125;getchar();<span class="hljs-comment">//é˜²æ­¢ç¨‹åºé€€å‡º</span><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><ol start="4"><li>åœ¨åè¿›åˆ¶è½¬åŒ–ä¸ºäºŒè¿›åˆ¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸¤ç§åŠæ³•ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯é€šè¿‡å¾ªç¯æ±‚ä½™çš„åŠæ³•æ¥è½¬åŒ–</li></ol><pre><code class="hljs C"><span class="hljs-comment">/** * [decimal2Binary åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œä½¿ç”¨å¾ªç¯æ±‚ä½™æ³•] * @author mohuishou&lt;1@lailin.xyz&gt; * @param  x [è¦è½¬æ¢çš„åè¿›åˆ¶æ•°] * @return   [0] */</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">decimal2Binary</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>&#123;<span class="hljs-keyword">int</span> a[<span class="hljs-number">32</span>];<span class="hljs-keyword">int</span> rem;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">31</span>;j&gt;=<span class="hljs-number">0</span>;j--)&#123; rem=x%<span class="hljs-number">2</span>; x=x/<span class="hljs-number">2</span>; a[j]=rem;&#125;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">31</span>;i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,a[i]);<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><ol start="5"><li>ç¬¬äºŒç§æ˜¯åé¢æŸ¥èµ„æ–™çš„æ—¶å€™çœ‹åˆ°çš„ä¸€ç§åŠæ³•ï¼Œæˆ‘è½¬æ¢äº†ä¸€ä¸‹ï¼Œç”¨äºè¿™ä¸ªå°ç¨‹åºã€‚ä¸»è¦æ˜¯å……åˆ†åº”ç”¨äº† C è¯­è¨€å½“ä¸­çš„ä½è¿ç®—</li></ol><pre><code class="hljs C"><span class="hljs-comment">/** * [decimal2Binary_2 åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œä½¿ç”¨æŒ‰ä½å¯¹æ¯”æ³•] * @author mohuishou&lt;1@lailin.xyz&gt; * @param  x [è¦è¿›è¡Œè½¬åŒ–çš„10è¿›åˆ¶æ•°] * @return   [0] */</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">decimal2Binary_2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>&#123;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">31</span>; i &gt;=<span class="hljs-number">0</span>;i--)&#123;<span class="hljs-keyword">if</span>(x&amp;(<span class="hljs-number">1</span>&lt;&lt;i))&#123;<span class="hljs-comment">//å°†1å·¦ç§»iä½å¹¶å’Œxè¿›è¡ŒæŒ‰ä½å¯¹æ¯”</span><span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,<span class="hljs-number">1</span> );&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,<span class="hljs-number">0</span> );&#125;&#125;<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h3 id="0-åœ¨æµ®ç‚¹æ•°ä¸­æ€ä¹ˆè¡¨ç¤º"><a href="#0-åœ¨æµ®ç‚¹æ•°ä¸­æ€ä¹ˆè¡¨ç¤º" class="headerlink" title="0 åœ¨æµ®ç‚¹æ•°ä¸­æ€ä¹ˆè¡¨ç¤º"></a>0 åœ¨æµ®ç‚¹æ•°ä¸­æ€ä¹ˆè¡¨ç¤º</h3><blockquote><p>æˆ‘å…ˆé€šè¿‡ä¸Šé¢å†™å¥½çš„ç¨‹åºï¼Œè¾“å…¥ 0 ä¹‹åï¼Œå¾—åˆ°çš„å€¼ä¸º 32 ä¸ª 0ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªç®€å•çš„åˆ†æè®¤ä¸ºï¼š</p></blockquote><h4 id="æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•"><a href="#æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•"></a>æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•</h4><ol><li>æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼šå…ˆè½¬åŒ–ä¸º 1.xxxï¼ˆå°æ•°éƒ¨åˆ†ï¼‰ * 2^mï¼ˆæŒ‡æ•°éƒ¨åˆ†ï¼‰</li><li>é¦–å…ˆåˆ¤æ–­ç¬¦å·ï¼Œæ­£çš„è¯ç¬¬ä¸€ä½ä¸º 0ï¼Œè´Ÿæ•°çš„è¯ä¸ºç¬¬ä¸€ä½ 1</li><li>æŒ‡æ•°éƒ¨åˆ† m+127=&gt;è½¬åŒ–ä¸º 2 è¿›åˆ¶</li><li>å°æ•°éƒ¨åˆ† xxx=&gt;è½¬åŒ–ä¸º 2 è¿›åˆ¶ï¼Œ</li></ol><h4 id="å¯¹äº-0-çš„æ¨æ–­"><a href="#å¯¹äº-0-çš„æ¨æ–­" class="headerlink" title="å¯¹äº 0 çš„æ¨æ–­"></a>å¯¹äº 0 çš„æ¨æ–­</h4><p>ç”±äº 0 çš„è¯ï¼Œä»–ç¬¬ä¸€æ­¥å°±ä¸èƒ½è½¬åŒ–ä¸º 1.xxxï¼ˆå°æ•°éƒ¨åˆ†ï¼‰ * 2^mï¼ˆæŒ‡æ•°éƒ¨åˆ†)çš„å½¢å¼ï¼Œæ‰€ä»¥æ¯”è¾ƒå¥½çš„ä¸€ä¸ªåŠæ³•å°±æ˜¯ä»¥ 32 ä¸ª 0 è¡¨ç¤º</p><h4 id="æ¨æ–­çš„éªŒè¯"><a href="#æ¨æ–­çš„éªŒè¯" class="headerlink" title="æ¨æ–­çš„éªŒè¯"></a>æ¨æ–­çš„éªŒè¯</h4><blockquote><p>å¯¹äº C è¯­è¨€æ¥è¯´æˆ‘åœ¨ä¹‹å‰å°±å·²ç»éªŒè¯äº†ï¼Œç„¶åæˆ‘æŸ¥è¯¢äº†ç»´åŸºç™¾ç§‘ IEEE äºŒè¿›åˆ¶æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†ï¼ˆIEEE 754ï¼‰<a href="https://zh.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noopener">ç‚¹å‡»æ‰“å¼€</a>ï¼Œå¯¹æ¯”å¾—å‡ºï¼Œ0 çš„äºŒè¿›åˆ¶æµ®ç‚¹æ•°è¡¨ç¤ºçš„ç¡®æ˜¯ 32 ä¸ª 0</p></blockquote><h3 id="ç¨‹åºè¿è¡Œç»“æœæˆªå›¾"><a href="#ç¨‹åºè¿è¡Œç»“æœæˆªå›¾" class="headerlink" title="ç¨‹åºè¿è¡Œç»“æœæˆªå›¾"></a>ç¨‹åºè¿è¡Œç»“æœæˆªå›¾</h3><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2541890988.png" srcset="/img/loading.gif" alt="1.png"></p><h3 id="ç¨‹åºæºä»£ç æˆªå›¾"><a href="#ç¨‹åºæºä»£ç æˆªå›¾" class="headerlink" title="ç¨‹åºæºä»£ç æˆªå›¾"></a>ç¨‹åºæºä»£ç æˆªå›¾</h3><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2014147934.png" srcset="/img/loading.gif" alt="2.png"><br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2014147934.png" srcset="/img/loading.gif" alt="3.png"></p>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jsç¼–ç è§£ç URL</title>
    <link href="/post/62847.html"/>
    <url>/post/62847.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ js çš„ URL ç¼–ç è§£ç å½“ä¸­æœ‰è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯</p></blockquote><h3 id="ç¼–ç è§£ç å‡½æ•°"><a href="#ç¼–ç è§£ç å‡½æ•°" class="headerlink" title="ç¼–ç è§£ç å‡½æ•°"></a>ç¼–ç è§£ç å‡½æ•°</h3><p>1.</p><p>ç¼–ç <code>encodeURI(str)</code><br>è§£ç <code>decodeURI(str)</code></p><p>2.</p><p>ç¼–ç <code>encodeURIComponent</code><br>è§£ç <code>decodeURIComponent</code></p><a id="more"></a><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><p>encodeURI å¯¹äºå­—æ¯å’Œå±äº URL çš„å­—ç¬¦ä¸è¿›è¡Œç¼–ç <br>ä½†æ˜¯ encodeURIComponent ä¼šå¯¹å±äº URL çš„å­—ç¬¦ä¹Ÿè¿›è¡Œç¼–ç <br><strong>ä¾‹å¦‚è¿™äº›å­—ç¬¦</strong><code>-_.!~*&#39;()</code></p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><pre><code class="hljs undefined">var <span class="hljs-built_in">str</span>=<span class="hljs-string">"http://lxl520.com/ç¨‹åº"</span>;console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"æˆ‘æ˜¯åˆå§‹å­—ç¬¦ä¸²"</span>+<span class="hljs-built_in">str</span>);</code></pre><p><em>æˆ‘æ˜¯åˆå§‹å­—ç¬¦ä¸²<a href="http://lxl520.com/ç¨‹åº" target="_blank" rel="noopener">http://lxl520.com/ç¨‹åº</a></em></p><pre><code class="hljs undefined"><span class="hljs-keyword">var</span> str2=<span class="hljs-built_in">encodeURI</span>(str);<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æˆ‘æ˜¯ç»è¿‡encodeURIç¼–ç çš„ï¼š"</span>+str2);</code></pre><p><em>æˆ‘æ˜¯ç»è¿‡ encodeURI ç¼–ç çš„ï¼š<a href="http://lxl520.com/%E7%A8%8B%E5%BA%8F" target="_blank" rel="noopener">http://lxl520.com/%E7%A8%8B%E5%BA%8F</a></em></p><pre><code class="hljs undefined"><span class="hljs-keyword">var</span> str3=<span class="hljs-built_in">encodeURIComponent</span>(str);<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æˆ‘æ˜¯ç»è¿‡encodeURIComponentç¼–ç çš„ï¼š"</span>+str3);</code></pre><p><em>æˆ‘æ˜¯ç»è¿‡ encodeURIComponent ç¼–ç çš„ï¼šhttp%3A%2F%2Flxl520.com%2F%E7%A8%8B%E5%BA%8F</em></p><pre><code class="hljs undefined"><span class="hljs-keyword">var</span> str2Decode=<span class="hljs-built_in">decodeURI</span>(str2);<span class="hljs-keyword">var</span> str3Decode=<span class="hljs-built_in">decodeURIComponent</span>(str3);<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æˆ‘ä»¬æ˜¯ç»è¿‡è§£ç çš„å­—ç¬¦ä¸²ï¼š"</span>+str2Decode+<span class="hljs-string">"\n"</span>+str3Decode);</code></pre><p><em>æˆ‘ä»¬æ˜¯ç»è¿‡è§£ç çš„å­—ç¬¦ä¸²ï¼š<a href="http://lxl520.com/ç¨‹åº" target="_blank" rel="noopener">http://lxl520.com/ç¨‹åº</a><br><a href="http://lxl520.com/ç¨‹åº" target="_blank" rel="noopener">http://lxl520.com/ç¨‹åº</a></em></p><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹ 2"></a>ç¤ºä¾‹ 2</h3><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>URLç¼–ç <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"get"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥æ‚¨è¦ç¼–ç çš„å­—ç¬¦ä¸²"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"urlEncode();"</span>&gt;</span>ç‚¹å‡»è¿›è¡Œç¼–ç <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"urlDecode();"</span>&gt;</span>ç‚¹å‡»è¿›è¡Œè§£ç <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¾“å‡ºæ¡†"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">      <span class="hljs-comment">/**       * <span class="hljs-doctag">@author <span class="hljs-variable">mohuishou</span></span>       * [test URLç¼–ç æµ‹è¯•]       * <span class="hljs-doctag">@return <span class="hljs-type">&#123;[type]&#125;</span> </span>[description]       */</span>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">var</span> str = <span class="hljs-string">"http://lxl520.com/ç¨‹åº"</span>;        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æˆ‘æ˜¯åˆå§‹å­—ç¬¦ä¸²"</span> + str);        <span class="hljs-keyword">var</span> str2 = <span class="hljs-built_in">encodeURI</span>(str);        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æˆ‘æ˜¯ç»è¿‡encodeURIç¼–ç çš„ï¼š"</span> + str2);        <span class="hljs-keyword">var</span> str3 = <span class="hljs-built_in">encodeURIComponent</span>(str);        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æˆ‘æ˜¯ç»è¿‡encodeURIComponentç¼–ç çš„ï¼š"</span> + str3);        <span class="hljs-keyword">var</span> str2Decode = <span class="hljs-built_in">decodeURI</span>(str2);        <span class="hljs-keyword">var</span> str3Decode = <span class="hljs-built_in">decodeURIComponent</span>(str3);        <span class="hljs-built_in">console</span>.log(          <span class="hljs-string">"æˆ‘ä»¬æ˜¯ç»è¿‡è§£ç çš„å­—ç¬¦ä¸²ï¼š"</span> + str2Decode + <span class="hljs-string">"\n"</span> + str3Decode        );      &#125;      <span class="hljs-comment">/**       * <span class="hljs-doctag">@author <span class="hljs-variable">mohuishou</span></span>       * æ›´æ”¹è¾“å…¥çš„å€¼ï¼Œå¹¶å°†å…¶è¾“å‡º       */</span>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">urlEncode</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">var</span> getVal = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"get"</span>).value; <span class="hljs-comment">//è·å–è¾“å…¥æ¡†çš„å€¼</span>        <span class="hljs-keyword">var</span> strEncode = <span class="hljs-built_in">encodeURI</span>(getVal);        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"output"</span>).value = strEncode; <span class="hljs-comment">//å°†ç¼–ç è¿‡åçš„å€¼è¾“å‡ºåˆ°è¾“å‡ºæ¡†</span>      &#125;      <span class="hljs-comment">/**       * [urlDecode è§£ç å‡½æ•°ï¼Œå¯¹è¿›è¡Œè§£ç ]       * <span class="hljs-doctag">@return <span class="hljs-type">&#123;[type]&#125;</span> </span>[description]       */</span>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">urlDecode</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">var</span> getVal = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"get"</span>).value; <span class="hljs-comment">//è·å–è¾“å…¥æ¡†çš„å€¼</span>        <span class="hljs-keyword">var</span> strDecode = <span class="hljs-built_in">decodeURI</span>(getVal);        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"output"</span>).value = strDecode;      &#125;    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59875.html">ã€ç¦åˆ©ã€‘è‡³å–„ç½‘åª’ä½“ç´ æä¸€é”®è¯„ä»·</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cssä¸­æƒé‡ä¸ä¼˜å…ˆçº§</title>
    <link href="/post/39494.html"/>
    <url>/post/39494.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä»Šå¤©åœ¨å†™ä¸€ä¸ªå‰ç«¯æ–‡ä»¶çš„æ—¶å€™å‘ç°æœ‰ä¸€ä¸ªæ ·å¼çªç„¶æ²¡æœ‰äº†ä½œç”¨ï¼Œä½†æ˜¯æŒ‰ç…§ä¼˜å…ˆçº§æ¥è¯´åº”è¯¥åé¢çš„å‰é¢çš„æ‰å¯¹ã€‚<br>ç„¶åç ”ç©¶äº†ä¸€ä¸‹ css å½“ä¸­çš„ä¼˜å…ˆçº§åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼Œæ‰å‘ç°åŸæ¥éƒ½æ˜¯æƒé‡çš„é”…</p></blockquote><a id="more"></a><h3 id="é€‰æ‹©å™¨çš„æƒé‡"><a href="#é€‰æ‹©å™¨çš„æƒé‡" class="headerlink" title="é€‰æ‹©å™¨çš„æƒé‡"></a>é€‰æ‹©å™¨çš„æƒé‡</h3><blockquote><p>åˆ†ä¸ºå››ä¸ªç­‰çº§,æƒé‡å€¼è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§åˆ«è¶Šé«˜</p></blockquote><h4 id="æƒé‡è¡¨"><a href="#æƒé‡è¡¨" class="headerlink" title="æƒé‡è¡¨"></a>æƒé‡è¡¨</h4><table><thead><tr><th>é€‰æ‹©å™¨</th><th>ä¾‹å­</th><th>æƒé‡å€¼</th></tr></thead><tbody><tr><td>å†…è”æ ·å¼</td><td><code>style=&#39;&#39;</code></td><td>1000</td></tr><tr><td>id é€‰æ‹©å™¨</td><td><code>#title</code></td><td>100</td></tr><tr><td>ç±»ï¼Œä¼ªç±»ï¼Œå±æ€§é€‰æ‹©å™¨</td><td><code>.titleï¼Œ:hover ,a[href]</code></td><td>10</td></tr><tr><td>ç±»å‹é€‰æ‹©å™¨ï¼Œä¼ªå…ƒç´ é€‰æ‹©å™¨</td><td><code>p, :before</code></td><td>1</td></tr><tr><td>é€šç”¨é€‰æ‹©å™¨ï¼Œå­é€‰æ‹©å™¨å’Œç›¸é‚»åŒèƒé€‰æ‹©å™¨</td><td><code>*,&gt;,+</code></td><td>0</td></tr></tbody></table><h4 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h4><p><strong>sytle</strong></p><pre><code class="hljs css"><span class="hljs-comment">/*æƒé‡=100+1=101*/</span><span class="hljs-selector-id">#title</span> <span class="hljs-selector-tag">h2</span> &#123;  <span class="hljs-attribute">color</span>: red;&#125;<span class="hljs-comment">/*æƒé‡=10+1=11*/</span><span class="hljs-selector-class">.content</span> <span class="hljs-selector-tag">h2</span> &#123;  <span class="hljs-attribute">color</span>: blue;&#125;<span class="hljs-comment">/*æƒé‡=100+1=101*/</span><span class="hljs-selector-id">#title</span> <span class="hljs-selector-tag">a</span> &#123;  <span class="hljs-attribute">color</span>: orange;&#125;<span class="hljs-comment">/*æƒé‡=100+10=110*/</span><span class="hljs-selector-id">#title</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-attr">[href]</span> &#123;  <span class="hljs-attribute">color</span>: green;&#125;</code></pre><p><strong>html</strong></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æˆ‘æ˜¯æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:#333;"</span>&gt;</span>æˆ‘æ˜¯å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>    <span class="hljs-comment">&lt;!--æƒé‡=1000--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://lxl520.com"</span>&gt;</span>lxl520<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>0...0<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141636.png" srcset="/img/loading.gif" alt></p><h3 id="å±‚å åŸç†ï¼ˆæˆ–è€…è¯´æ˜¯å°±è¿‘åŸåˆ™ï¼‰"><a href="#å±‚å åŸç†ï¼ˆæˆ–è€…è¯´æ˜¯å°±è¿‘åŸåˆ™ï¼‰" class="headerlink" title="å±‚å åŸç†ï¼ˆæˆ–è€…è¯´æ˜¯å°±è¿‘åŸåˆ™ï¼‰"></a>å±‚å åŸç†ï¼ˆ<em>æˆ–è€…è¯´æ˜¯å°±è¿‘åŸåˆ™</em>ï¼‰</h3><p><strong>å½“ä¸¤ä¸ªæ ·å¼çš„ä¼˜å…ˆçº§ä¸€æ ·æ—¶,ä¼šè‡ªåŠ¨é€‰æ‹©æœ€è¿‘çš„ä¸€æ¡æ ·å¼</strong></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">  <span class="hljs-selector-id">#title</span> &#123;    <span class="hljs-attribute">color</span>: red;  &#125;  <span class="hljs-selector-id">#title</span> &#123;    <span class="hljs-attribute">color</span>: blue;  &#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span>æˆ‘åˆ°åº•å•¥é¢œè‰²<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></code></pre><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141637.png" srcset="/img/loading.gif" alt></p><h3 id="ä¾‹å¤–ï¼ˆ-importantï¼‰"><a href="#ä¾‹å¤–ï¼ˆ-importantï¼‰" class="headerlink" title="ä¾‹å¤–ï¼ˆ!importantï¼‰"></a>ä¾‹å¤–ï¼ˆ!importantï¼‰</h3><p><strong>åœ¨å±æ€§çš„åé¢åŠ ä¸Š!important å¯ä»¥ç”¨æ¥ææƒï¼Œå°±å¥½æ¯”ç›´æ¥è·å¾—ç®¡ç†å‘˜æƒé™ä¸€æ ·ï¼Œè¿™è¿™ä¸ªå±æ€§ä¼šå˜æˆæœ€é«˜ä¼˜å…ˆçº§</strong></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">  <span class="hljs-selector-tag">h2</span> &#123;    <span class="hljs-attribute">color</span>: red <span class="hljs-meta">!important</span>;  &#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:blue;"</span>&gt;</span>æˆ‘æƒ³å¿…åº”è¯¥æ˜¯è“è‰²<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></code></pre><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141638.png" srcset="/img/loading.gif" alt></p><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><ol><li><p><strong>ä¸€äº›ä¸æˆæ–‡è§„åˆ™</strong></p><ul><li><strong>ä¸è¦</strong>åœ¨å…¨ç«™èŒƒå›´çš„ css ä¸­ä½¿ç”¨<code>!important</code>.</li><li><strong>åªåœ¨</strong>éœ€è¦è¦†ç›–å…¨ç«™èŒƒå›´çš„ css æˆ–æ˜¯å¤–éƒ¨ cssï¼ˆä¾‹å¦‚å¼•ç”¨çš„ ExtJs æˆ–æ˜¯ YUIï¼‰çš„æ—¶å€™æ‰åœ¨æŒ‡å®šçš„é¡µé¢ä¸Šä½¿ç”¨<code>!important</code>ã€‚</li><li><strong>ä¸è¦</strong>åœ¨ä½ çš„æ’ä»¶ä¸­ä½¿ç”¨<code>!important</code>ã€‚</li><li><strong>æ°¸è¿œ</strong>éƒ½è¦ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨æ ·å¼è§„åˆ™çš„ä¼˜å…ˆçº§æ¥è§£å†³é—®é¢˜è€Œä¸æ˜¯<code>!important</code>ã€‚</li></ul></li><li><p>å¦‚æœä½ å’Œæˆ‘ä¸€æ ·é‡åˆ°äº†ä¼¼ä¹æ²¡æœ‰èµ·ä½œç”¨çš„ CSS è§„åˆ™ï¼Œè¯·è¯•è¯•åœ¨ä½ çš„é€‰æ‹©å™¨ä¸­æ·»åŠ ä»–çš„ä¸€ä¸ªçˆ¶å…ƒç´ çš„ IDï¼Œä»è€Œæé«˜å®ƒçš„ç‰¹æ®Šæ€§ã€‚çœ‹çœ‹èƒ½ä¸èƒ½è§£å†³é—®é¢˜</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>EmotionCamera</title>
    <link href="/post/16707.html"/>
    <url>/post/16707.html</url>
    
    <content type="html"><![CDATA[<h4 id="wiz_toc_0">ç®€å•å®ç°é€»è¾‘</h4><ol><br><li>é¦–å…ˆè¯†åˆ«è„¸éƒ¨</li><br><li>æ ‡è¯†å‡ºå…³é”®ç‚¹</li><br><li>é€šè¿‡ä¸€å®šçš„ç®—æ³•æ•æŠ“è¡¨æƒ…</li><br></ol><h4 id="wiz_toc_1">è¡¨æƒ…ç›¸æœºæ¨¡å—éœ€è¦å®ç°çš„ä»»åŠ¡</h4><ol><br><li>ä»€ä¹ˆæ—¶å€™æ‹ç…§ï¼Ÿ<br><br><em>éœ€è¦ç¡®å®šä¸€ä¸ªé˜ˆå€¼</em></li><br><li>å¯¼å‡ºä¸€ä¸ªé™æ€åº“<br><br><em>ioså’Œandriod</em><br><br><blockquote><br><p>è¡¥å……ï¼Œioséœ€è¦æ¶‰åŠåˆ°macç³»ç»Ÿè¿˜æœ‰OCï¼›andriodéœ€è¦æ¶‰åŠåˆ°Linuxï¼Œå®‰å“æ–¹é¢å¯¼å‡ºçš„é™æ€åº“æ˜¯.aæ ¼å¼ï¼›åŠ¨æ€åº“ä¸º.soæ ¼å¼</p><br></blockquote></li><br></ol><h4 id="wiz_toc_2">æœ€è¿‘ä¸¤å‘¨éœ€è¦å®Œæˆçš„ä»»åŠ¡</h4><blockquote><br><p>ç°åœ¨çš„æ—¶é—´ï¼š2015å¹´11æœˆ1æ—¥ 23:34:33<br><br>ä¸¤å‘¨åéœ€è¦è¾¾åˆ°çš„æ•ˆæœï¼šä½¿ç”¨å®‰å“è°ƒç”¨C++ç”Ÿæˆçš„.aæ–‡ä»¶</p><br></blockquote><h5 id="wiz_toc_3">éœ€è¦æœç´¢çš„ä¸€äº›ä¸œè¥¿ï¼š</h5><p></p><ol><p></p><li>C++é™æ€åº“å¯¼å‡ºï¼ˆios/andriodï¼‰</li><br><li>é™æ€vsåŠ¨æ€åº“</li><br><li>objectâ€•C ï¼ˆiosï¼‰</li><br><li>makefile&amp;modify Macro</li><br><li>èƒ½ä¸èƒ½ç›´æ¥åœ¨ä¸€ä¸ªç¯å¢ƒä¸‹åŒæ—¶å¯¼å‡ºioså’Œå®‰å“éœ€è¦çš„åº“</li></ol>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpstrom10æ¿€æ´»æ–¹æ³•ï¼ˆJetBrainsç³»åˆ—è½¯ä»¶æ¿€æ´»ï¼‰</title>
    <link href="/post/28397.html"/>
    <url>/post/28397.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ‰¾åˆ°ä¸€ä¸ª JetBrains ç³»åˆ—è½¯ä»¶çš„æ³¨å†ŒæœåŠ¡å™¨</p></blockquote><p><strong>æ³¨å†Œæ—¶é€‰æ‹©â€œLicense serverâ€è¾“å…¥â€œ<a href="http://idea.lanyus.com/â€ç‚¹å‡»â€œOKâ€å¿«é€Ÿæ¿€æ´»JetBrainsç³»åˆ—äº§å“" target="_blank" rel="noopener">http://idea.lanyus.com/â€ç‚¹å‡»â€œOKâ€å¿«é€Ÿæ¿€æ´»JetBrainsç³»åˆ—äº§å“</a></strong></p><p>ä¹Ÿå¯ä»¥<br><a href="http://idea.lanyus.com/" target="_blank" rel="noopener">ç‚¹å‡»è¿›å…¥è®¡ç®—æ³¨å†Œç </a></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/18280.html">å››å·å¤§å­¦é”æ·windowsè§£é™¤å¤šç½‘å¡é™åˆ¶</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç ´è§£</tag>
      
      <tag>php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NDKå¼€å‘ä¸­æ— æ³•è®¿é—®android.support.v7.app.AppCompatActivityè§£å†³åŠæ³•</title>
    <link href="/post/64902.html"/>
    <url>/post/64902.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>é”™è¯¯è¯¦æƒ…ï¼š<br>é”™è¯¯: æ— æ³•è®¿é—® android.support.v7.app.AppCompatActivity<br>æ‰¾ä¸åˆ° android.support.v7.app.AppCompatActivity çš„ç±»æ–‡ä»¶</p></blockquote><p>ä¸ºäº†è¿™ä¸ªé—®é¢˜çº ç»“ 2 å¤©äº†ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šçš„è§£å†³åŠæ³•éƒ½ä¸è¡Œï¼Œå‡ ä¹æ‰€æœ‰çš„åŠæ³•éƒ½è¯•è¿‡äº†</p><p>æ— æ„ä¸­æŸ¥çœ‹ sdk Manager çš„æ—¶å€™å‘ç°æˆ‘çš„<strong>â€œandroid support libraryâ€</strong>æ²¡æœ‰å®‰è£…ï¼Œç„¶åå½“å³å®‰è£…ä¸Šå»</p><p>éšåæ‰§è¡Œï¼š</p><pre><code class="hljs undefined">javah -d jni -classpath   F:<span class="hljs-symbol">\S</span>oftInstall<span class="hljs-symbol">\A</span>ndroid<span class="hljs-symbol">\s</span>dk<span class="hljs-symbol">\p</span>latforms<span class="hljs-symbol">\a</span>ndroid-23<span class="hljs-symbol">\a</span>ndroid.jar;F:<span class="hljs-symbol">\S</span>oftInstall<span class="hljs-symbol">\a</span>ndroid<span class="hljs-symbol">\s</span>dk<span class="hljs-symbol">\e</span>xtras<span class="hljs-symbol">\a</span>ndroid<span class="hljs-symbol">\s</span>upport<span class="hljs-symbol">\v</span>4<span class="hljs-symbol">\a</span>ndroid-support-v4.jar;F:<span class="hljs-symbol">\S</span>oftInstall<span class="hljs-symbol">\a</span>ndroid<span class="hljs-symbol">\s</span>dk<span class="hljs-symbol">\e</span>xtras<span class="hljs-symbol">\a</span>ndroid<span class="hljs-symbol">\s</span>upport<span class="hljs-symbol">\v</span>7<span class="hljs-symbol">\a</span>ppcompat<span class="hljs-symbol">\l</span>ibs<span class="hljs-symbol">\a</span>ndroid-support-v7-appcompat.jar;..<span class="hljs-symbol">\.</span>.<span class="hljs-symbol">\b</span>uild<span class="hljs-symbol">\i</span>ntermediates<span class="hljs-symbol">\c</span>lasses<span class="hljs-symbol">\d</span>ebug com.lxl520.demo3.MainActivity</code></pre><p>å³å¯</p><p><strong>æ³¨æ„ï¼š</strong><br>å¦‚æœå‘ç°ä½ çš„ sdk æ–‡ä»¶å¤¹ä¸‹é¢æ²¡æœ‰<strong>sdk\extras\android\support**<br>è¿™ä¸ªæ–‡ä»¶å¤¹çš„æ—¶å€™ä¸€å®šè¦æ£€æŸ¥ä¸€ä¸‹ä½ çš„</strong>â€œandroid support libraryâ€**æ˜¯å¦å®‰è£…ï¼Œ<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141647.png" srcset="/img/loading.gif" alt></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/34934.html">appcanåˆ©ç”¨å¤©ç¿¼rtcå®ç°è§†é¢‘é€šè¯åŠŸèƒ½</a></li><li><a href="https://lailin.xyz/post/35791.html">ä½¿ç”¨MITAPPInventor2webå®¢æˆ·ç«¯ç»„ä»¶ä¿å­˜æ•°æ®è‡³äº‘ç«¯</a></li><li><a href="https://lailin.xyz/post/23045.html">å¦‚ä½•ä½¿ç”¨MITAPPInventor2å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£app</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>app</tag>
      
      <tag>ndk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpsocketè¿æ¥ï¼ŒUDP</title>
    <link href="/post/19867.html"/>
    <url>/post/19867.html</url>
    
    <content type="html"><![CDATA[<pre><code class="hljs php">&lt;meta charset=<span class="hljs-string">"utf-8"</span>&gt;<span class="hljs-meta">&lt;?php</span><span class="hljs-comment">//æœåŠ¡å™¨ä¿¡æ¯</span>$server = <span class="hljs-string">'udp://192.168.253.1:9998'</span>;<span class="hljs-comment">//æ¶ˆæ¯ç»“æŸç¬¦å·</span>$msg_eof = <span class="hljs-string">"\n"</span>;$socket = stream_socket_server($server, $errno, $errstr, STREAM_SERVER_BIND);<span class="hljs-keyword">if</span> (!$socket) &#123;<span class="hljs-keyword">die</span>(<span class="hljs-string">"$errstr ($errno)"</span>);&#125;<span class="hljs-keyword">do</span> &#123;<span class="hljs-comment">//æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯</span>$inMsg = stream_socket_recvfrom($socket, <span class="hljs-number">1024</span>, <span class="hljs-number">0</span>, $peer);<span class="hljs-comment">//æœåŠ¡ç«¯æ‰“å°å‡ºç›¸å…³ä¿¡æ¯</span><span class="hljs-keyword">echo</span> <span class="hljs-string">"Client : $peer\n"</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">"Receive : &#123;$inMsg&#125;"</span>;<span class="hljs-comment">//ç»™å®¢æˆ·ç«¯å‘é€ä¿¡æ¯</span>$outMsg = substr($inMsg, <span class="hljs-number">0</span>, (strrpos($inMsg, $msg_eof))).<span class="hljs-string">' -- '</span>.date(<span class="hljs-string">"D M j H:i:s Y\r\n"</span>);stream_socket_sendto($socket, $outMsg, <span class="hljs-number">0</span>, $peer);&#125; <span class="hljs-keyword">while</span> ($inMsg !== <span class="hljs-keyword">false</span>);<span class="hljs-meta">?&gt;</span></code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>socket</tag>
      
      <tag>udp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>appcanåˆ©ç”¨å¤©ç¿¼rtcå®ç°è§†é¢‘é€šè¯åŠŸèƒ½</title>
    <link href="/post/34934.html"/>
    <url>/post/34934.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ä»£ç æ˜¯åœ¨ç¤ºä¾‹ä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›ç®€åŒ–ï¼Œå¹¶å°†å…¶å•ç‹¬åšäº†ä¸€ä¸ª vedio.js æ–‡ä»¶ï¼Œåªéœ€è¦ä¸¤ä¸ªæŒ‰é’®ï¼Œå³å¯å®Œæˆæ¥å¬å’Œæ‹¨æ‰“çš„éœ€æ±‚</p></blockquote><p><strong>attentionï¼š</strong></p><ol><li>é»˜è®¤å°†ç”¨æˆ·åè®¾ç½®æˆ 1234ï¼Œæ‹¨æ‰“çš„å¸å·è®¾ç½®æˆ 4321ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ä¸€ä¸ª app å®ç°çš„è¯ï¼Œå…·ä½“é€»è¾‘è‡ªè¡Œä¿®æ”¹</li></ol><h4 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><pre><code class="hljs javascript"><span class="hljs-comment">/** * è§†é¢‘åŠŸèƒ½å®ç° * ä½¿ç”¨å¤©ç¿¼rtcæ’ä»¶å®ç° */</span><span class="hljs-comment">/** * åˆå§‹åŒ–ï¼Œåœ¨é¡µé¢åˆå§‹åŒ–æ–¹æ³•ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•° * å®šä¹‰å¤©ç¿¼rtcå›è°ƒå‡½æ•° * åŒä¸€ä¸ªé¡µé¢ä¸­  appcan.readyå¯ä»¥å­˜åœ¨å¤šä¸ªï¼Œä¸ä¼šå†²çª;è€ŒuexOnloadä¸è¡Œ... */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rtcInit</span>(<span class="hljs-params"></span>) </span>&#123;  uexESurfingRtc.onGlobalStatus = upgateGlobalStatus; <span class="hljs-comment">//å…¨å±€ç›‘æ§</span>  uexESurfingRtc.cbLogStatus = upgateLogStatus; <span class="hljs-comment">//ç™»é™†å›è°ƒ</span>  uexESurfingRtc.cbCallStatus = updateCallStatus; <span class="hljs-comment">//å‘¼å«å›è°ƒ</span>  <span class="hljs-comment">//uexESurfingRtc.cbRemotePicPath = showRemotePicPath;//æˆªå±å›è°ƒ</span>  <span class="hljs-comment">/*----------é…ç½®å¤©ç¿¼rtcæ’ä»¶çš„appkey &amp; appid---------*/</span>  appId = <span class="hljs-string">"70392"</span>;  appKey = uexESurfingRtc.setAppKeyAndAppId(appKey, appId); <span class="hljs-comment">//è¾“å…¥ä½ è‡ªå·±çš„appKey;</span>&#125;<span class="hljs-comment">/** * ç™»é™†å›è°ƒï¼Œè¿”å›æ˜¯å¦ç™»é™†æˆåŠŸ */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upgateLogStatus</span>(<span class="hljs-params">opCode, dataType, data</span>) </span>&#123;  <span class="hljs-comment">//alert(data);</span>  <span class="hljs-keyword">if</span> (<span class="hljs-string">"OK"</span> == data.substring(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) &#123;    <span class="hljs-keyword">var</span> status = data.split(<span class="hljs-string">"OK:"</span>)[<span class="hljs-number">1</span>];    <span class="hljs-keyword">var</span> showStr = <span class="hljs-string">""</span>;    <span class="hljs-keyword">if</span> (<span class="hljs-string">"LOGIN"</span> == status) &#123;      showStr = <span class="hljs-string">"ç™»é™†æˆåŠŸï¼Œç‚¹å‡»é€€å‡º"</span>;      $(<span class="hljs-string">"#login"</span>).attr(<span class="hljs-string">"name"</span>, <span class="hljs-string">"logout"</span>);    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"LOGOUT"</span> == status) &#123;      showStr = <span class="hljs-string">"ç™»é™†"</span>;      $(<span class="hljs-string">"#login"</span>).attr(<span class="hljs-string">"name"</span>, <span class="hljs-string">"login"</span>);    &#125;    $(<span class="hljs-string">"#login"</span>).text(showStr);  &#125; <span class="hljs-keyword">else</span> &#123;    alert(data);  &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateCallStatus</span>(<span class="hljs-params">opCode, dataType, data</span>) </span>&#123;  alert(data);  <span class="hljs-keyword">if</span> (<span class="hljs-string">"OK"</span> == data.substring(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) &#123;    <span class="hljs-keyword">var</span> status = data.split(<span class="hljs-string">"OK:"</span>)[<span class="hljs-number">1</span>];    <span class="hljs-keyword">var</span> showStr = <span class="hljs-string">""</span>;    <span class="hljs-keyword">if</span> (<span class="hljs-string">"NORMAL"</span> == status) &#123;      showStr = <span class="hljs-string">"call"</span>;    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"INCOMING"</span> == status) &#123;      showStr = <span class="hljs-string">"accept"</span>;    &#125;    <span class="hljs-comment">// else if("CALLING" == status)</span>    <span class="hljs-comment">// &#123;</span>    <span class="hljs-comment">//     showStr = "Calling";</span>    <span class="hljs-comment">// &#125;</span>    $(<span class="hljs-string">"#call"</span>).attr(<span class="hljs-string">"name"</span>, showStr);    $(<span class="hljs-string">"#call"</span>).text(showStr);  &#125; <span class="hljs-keyword">else</span> &#123;    alert(data);  &#125;&#125;<span class="hljs-comment">/** *ç›‘æ§ä¸­å¿ƒå›è°ƒ */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upgateGlobalStatus</span>(<span class="hljs-params">opCode, dataType, data</span>) </span>&#123;  $(<span class="hljs-string">"#content"</span>).append(data);&#125;<span class="hljs-comment">/** * ç™»é™†æ–¹æ³•çš„å®ç° * */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">// alert(123);</span>  <span class="hljs-comment">/*--è®¾ç½®ç™»é™†çš„é…ç½®ï¼Œåˆ†åˆ«æ˜¯æœ¬åœ°çª—å£å’Œå¯¹æ–¹è§†é¢‘çª—å£çš„å¤§å°----*/</span>  jsonViewConfig = &#123;    <span class="hljs-attr">localView</span>: &#123;      <span class="hljs-attr">x</span>: <span class="hljs-string">"10"</span>,      <span class="hljs-attr">y</span>: <span class="hljs-string">"800"</span>,      <span class="hljs-attr">w</span>: <span class="hljs-string">"432"</span>,      <span class="hljs-attr">h</span>: <span class="hljs-string">"528"</span>,    &#125;,    <span class="hljs-attr">remoteView</span>: &#123;      <span class="hljs-attr">x</span>: <span class="hljs-string">"440"</span>,      <span class="hljs-attr">y</span>: <span class="hljs-string">"800"</span>,      <span class="hljs-attr">w</span>: <span class="hljs-string">"432"</span>,      <span class="hljs-attr">h</span>: <span class="hljs-string">"528"</span>,    &#125;,  &#125;;  <span class="hljs-comment">/*---è¿™é‡Œé»˜è®¤è®¾ç½®ä¸€ä¸ªç”¨æˆ·åç”¨äºè°ƒè¯•ï¼ŒåæœŸç”¨æˆ·ç™»å½•ä¹‹åç›´æ¥è‡ªåŠ¨ç”Ÿæˆ---*/</span>  userName = <span class="hljs-string">"1234"</span>;  <span class="hljs-comment">/*--uexESurfingRtc.loginå‡½æ•°éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨JSON.stringifyæ–¹æ³•å°†jsonå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²--*/</span>  jsonDtr = <span class="hljs-built_in">JSON</span>.stringify(jsonViewConfig);  uexESurfingRtc.login(jsonDtr, userName);&#125;<span class="hljs-comment">/** * é€€å‡ºç™»å½• * <span class="hljs-doctag">@return <span class="hljs-type">&#123;[type]&#125;</span> </span>[description] */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>) </span>&#123;  uexESurfingRtc.logout();&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">call</span>(<span class="hljs-params"></span>) </span>&#123;  uexESurfingRtc.call(<span class="hljs-string">"3"</span>, <span class="hljs-string">"4321"</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">accept</span>(<span class="hljs-params"></span>) </span>&#123;  uexESurfingRtc.acceptCall(<span class="hljs-string">"3"</span>);&#125;<span class="hljs-comment">/** *ç™»é™†æŒ‰é’® *ç‚¹å‡»ä¹‹åç›´æ¥è§†é¢‘ç™»é™† */</span>appcan.button(<span class="hljs-string">"#login"</span>, <span class="hljs-string">"ani-act"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">var</span> btnName = $(<span class="hljs-string">"#login"</span>).attr(<span class="hljs-string">"name"</span>);  <span class="hljs-keyword">if</span> (btnName == <span class="hljs-string">"login"</span>) &#123;    $(<span class="hljs-string">"#login"</span>).text(<span class="hljs-string">"ç™»é™†ä¸­ï¼Œè¯·ç¨å€™..."</span>);    login();  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((btnName = <span class="hljs-string">"logout"</span>)) &#123;    $(<span class="hljs-string">"#login"</span>).text(<span class="hljs-string">"é€€å‡ºä¸­ï¼Œè¯·ç¨å€™..."</span>);    logout();  &#125;&#125;);<span class="hljs-comment">/** * å‘¼å«æŒ‰é’® */</span>appcan.button(<span class="hljs-string">"#call"</span>, <span class="hljs-string">"ani-act"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">var</span> btnName = $(<span class="hljs-string">"#call"</span>).attr(<span class="hljs-string">"name"</span>);  <span class="hljs-keyword">if</span> (btnName == <span class="hljs-string">"call"</span>) &#123;    $(<span class="hljs-string">"#call"</span>).text(<span class="hljs-string">"å‘¼å«ä¸­ï¼Œè¯·ç¨å€™..."</span>);    call();  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((btnName = <span class="hljs-string">"accept"</span>)) &#123;    $(<span class="hljs-string">"#call"</span>).text(<span class="hljs-string">"æ¥å¬ä¸­ï¼Œè¯·ç¨å€™..."</span>);    accept();  &#125;&#125;);</code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/64902.html">NDKå¼€å‘ä¸­æ— æ³•è®¿é—®android.support.v7.app.AppCompatActivityè§£å†³åŠæ³•</a></li><li><a href="https://lailin.xyz/post/35791.html">ä½¿ç”¨MITAPPInventor2webå®¢æˆ·ç«¯ç»„ä»¶ä¿å­˜æ•°æ®è‡³äº‘ç«¯</a></li><li><a href="https://lailin.xyz/post/23045.html">å¦‚ä½•ä½¿ç”¨MITAPPInventor2å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£app</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>app</tag>
      
      <tag>appcan</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaä¸­å­—ç¬¦ä¸²ç›¸ç­‰çš„åˆ¤æ–­</title>
    <link href="/post/62897.html"/>
    <url>/post/62897.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>ä»Šå¤©éœ€è¦å†™ä¸€ä¸ª Java çš„å°ç¨‹åºéœ€è¦åˆ¤æ–­ä¸€ä¸‹ä»æ§åˆ¶å°è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å‘ç°ç›´æ¥ä½¿ç”¨â€œ==â€æ¥åˆ¤æ–­æ˜¯æ²¡æœ‰åŠæ³•åˆ¤æ–­å‡ºæ¥çš„ï¼ŒGoogle&amp;ç™¾åº¦äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°ä¸€ä¸ªè§£å†³åŠæ³•</p></blockquote><h4 id="1-ç”¨â€œ-â€è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦è¡¨ç¤ºæŒ‡å‘å­—ç¬¦ä¸²çš„å¼•ç”¨æ˜¯å¦ç›¸åŒ"><a href="#1-ç”¨â€œ-â€è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦è¡¨ç¤ºæŒ‡å‘å­—ç¬¦ä¸²çš„å¼•ç”¨æ˜¯å¦ç›¸åŒ" class="headerlink" title="1. ç”¨â€œ==â€è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦è¡¨ç¤ºæŒ‡å‘å­—ç¬¦ä¸²çš„å¼•ç”¨æ˜¯å¦ç›¸åŒ"></a>1. ç”¨â€œ==â€è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦è¡¨ç¤ºæŒ‡å‘å­—ç¬¦ä¸²çš„å¼•ç”¨æ˜¯å¦ç›¸åŒ</h4><p>æ¯”å¦‚è¯´ï¼š</p><pre><code class="hljs java">String a=<span class="hljs-string">"abc"</span>;String b=<span class="hljs-string">"abc"</span>;a==b;<span class="hljs-comment">//å°†è¿”å›trueã€‚</span><span class="hljs-comment">/*è¿™æ˜¯å› ä¸ºåœ¨javaä¸­å­—ç¬¦ä¸²çš„å€¼æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œç›¸åŒçš„å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­åªä¼šå­˜ä¸€ä»½ï¼Œæ‰€ä»¥aå’ŒbæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡*/</span></code></pre><p>å†æ¯”å¦‚ï¼š</p><pre><code class="hljs java">String a=<span class="hljs-keyword">new</span> String(<span class="hljs-string">"abc"</span>);String b=<span class="hljs-keyword">new</span> String(<span class="hljs-string">"abc"</span>);<span class="hljs-comment">//é‚£ä¹ˆa==bå°†è¿”å›falseï¼Œå› ä¸ºaå’ŒbæŒ‡å‘ä¸åŒçš„å¯¹è±¡ã€‚</span></code></pre><p>ç”¨ scanner ç±»è·å–å­—ç¬¦ä¸²æ¥æ¯”è¾ƒçš„æ—¶å€™ï¼š</p><pre><code class="hljs java">Scanner input=<span class="hljs-keyword">new</span> Scanner(System.in);<span class="hljs-comment">//æ–°å»ºinputå¯¹è±¡ï¼Œç”¨äºå®ç°è¾“å…¥åŠŸèƒ½</span>String a=<span class="hljs-string">"exit"</span>;<span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²</span>System.out.println(<span class="hljs-string">"è¯·è¾“å…¥æ‚¨æƒ³è¾“å…¥çš„å­—ç¬¦ä¸²ï¼š"</span>);String get=input.nextLine();<span class="hljs-comment">//è·å–è¾“å…¥å¾—çš„å­—ç¬¦ä¸²çš„å€¼</span><span class="hljs-keyword">if</span>(get==a)&#123;    System.out.println(a);&#125;<span class="hljs-comment">//è¿™ä¸ªæ—¶å€™æ²¡æœ‰è¾“å‡ºå€¼</span></code></pre><h4 id="2-ç”¨-equals-æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸åŒ"><a href="#2-ç”¨-equals-æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸åŒ" class="headerlink" title="2. ç”¨ equals æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸åŒ"></a>2. ç”¨ equals æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸åŒ</h4><p>æ¯”å¦‚ï¼š</p><pre><code class="hljs java">String a=<span class="hljs-keyword">new</span> String(<span class="hljs-string">"abc"</span>);String b=<span class="hljs-keyword">new</span> String(<span class="hljs-string">"abc"</span>);a.equals(b);<span class="hljs-comment">//å°†è¿”å›trueã€‚</span></code></pre><p><strong>æ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†é¿å…å‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ä½¿ç”¨ equals æ–¹æ³•ã€‚</strong></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/52826.html">javaç¬”è®°1</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>office2016æ¿€æ´»å·¥å…·</title>
    <link href="/post/37989.html"/>
    <url>/post/37989.html</url>
    
    <content type="html"><![CDATA[<h4 id="å¯ä»¥ç”¨äºæ¿€æ´»-windows-office2010-2013-2016-å…¨ç³»åˆ—ç‰ˆæœ¬"><a href="#å¯ä»¥ç”¨äºæ¿€æ´»-windows-office2010-2013-2016-å…¨ç³»åˆ—ç‰ˆæœ¬" class="headerlink" title="å¯ä»¥ç”¨äºæ¿€æ´» windows office2010/2013/2016 å…¨ç³»åˆ—ç‰ˆæœ¬"></a>å¯ä»¥ç”¨äºæ¿€æ´» windows office2010/2013/2016 å…¨ç³»åˆ—ç‰ˆæœ¬</h4><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/QQ%E5%9B%BE%E7%89%8720151022110350.png" srcset="/img/loading.gif" alt="è¯·è¾“å…¥å›¾ç‰‡æè¿°"></p><p><strong>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œè¯¥è½¯ä»¶å³å¯</strong><br>30S ä¸åˆ°ï¼Œä½ ä¼šå‘ç°ä½ çš„ office æˆ–è€… windows å·²ç»æ¿€æ´»äº†ï¼Œæ²¡æœ‰å®‰è£…ç•Œé¢</p><p><a href="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/1198607745.rar" target="_blank" rel="noopener">è½¯ä»¶ä¸‹è½½</a></p><h3 id="ps-æœ¬è½¯ä»¶æ”¶é›†äºç½‘ç»œï¼Œè¿™é‡Œä»…ä½œåˆ†äº«ï¼Œè¯·ä¸‹è½½ä¹‹å-24-å°æ—¶ä¹‹å†…åˆ é™¤ï¼Œå¹¶ä¸”ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”"><a href="#ps-æœ¬è½¯ä»¶æ”¶é›†äºç½‘ç»œï¼Œè¿™é‡Œä»…ä½œåˆ†äº«ï¼Œè¯·ä¸‹è½½ä¹‹å-24-å°æ—¶ä¹‹å†…åˆ é™¤ï¼Œå¹¶ä¸”ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”" class="headerlink" title="ps:æœ¬è½¯ä»¶æ”¶é›†äºç½‘ç»œï¼Œè¿™é‡Œä»…ä½œåˆ†äº«ï¼Œè¯·ä¸‹è½½ä¹‹å 24 å°æ—¶ä¹‹å†…åˆ é™¤ï¼Œå¹¶ä¸”ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”"></a><em>ps:æœ¬è½¯ä»¶æ”¶é›†äºç½‘ç»œï¼Œè¿™é‡Œä»…ä½œåˆ†äº«ï¼Œè¯·ä¸‹è½½ä¹‹å 24 å°æ—¶ä¹‹å†…åˆ é™¤ï¼Œå¹¶ä¸”ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”</em></h3><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/18280.html">å››å·å¤§å­¦é”æ·windowsè§£é™¤å¤šç½‘å¡é™åˆ¶</a></li><li><a href="https://lailin.xyz/post/28397.html">phpstrom10æ¿€æ´»æ–¹æ³•ï¼ˆJetBrainsç³»åˆ—è½¯ä»¶æ¿€æ´»ï¼‰</a></li><li><a href="https://lailin.xyz/post/19314.html">phpstrom9å¯ç”¨æ³¨å†Œç ä¸€æš</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç ´è§£</tag>
      
      <tag>è½¯ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨MITAPPInventor2webå®¢æˆ·ç«¯ç»„ä»¶ä¿å­˜æ•°æ®è‡³äº‘ç«¯</title>
    <link href="/post/35791.html"/>
    <url>/post/35791.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ¥ç€å‰é¢çš„è¯´ï¼Œè“ç‰™æ¥æ”¶åˆ°æ•°æ®ä¹‹åéœ€è¦å°†æ•°æ®å¤„ç†åˆ†æç„¶åä¿å­˜ä¸‹æ¥ï¼Œä½†æ˜¯ AI2 å¹¶æ²¡æœ‰ç›´æ¥å†™ä»£ç æ¥çš„æ–¹ä¾¿å¿«æ·ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ç°åœ¨å¤„äºäº‘è®¡ç®—çš„æ—¶ä»£ï¼Œæ•°æ®æ— ä»·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•å°†æ•°æ®ä¿å­˜åˆ°äº‘ç«¯ã€‚</p></blockquote><h4 id="æ•°æ®ä¿å­˜åˆ°äº‘ç«¯çš„æ–¹æ³•ï¼š"><a href="#æ•°æ®ä¿å­˜åˆ°äº‘ç«¯çš„æ–¹æ³•ï¼š" class="headerlink" title="æ•°æ®ä¿å­˜åˆ°äº‘ç«¯çš„æ–¹æ³•ï¼š"></a>æ•°æ®ä¿å­˜åˆ°äº‘ç«¯çš„æ–¹æ³•ï¼š</h4><ol><li>ä½¿ç”¨è‡ªå¸¦çš„ç½‘ç»œå¾®æ•°æ®åº“</li><li>ä½¿ç”¨ web å®¢æˆ·ç«¯è°ƒç”¨å†™å¥½çš„åç«¯æ¥å£ä¸Šä¼ æ•°æ®</li></ol><blockquote><p>ç”±äºè‡ªå¸¦çš„ç½‘ç»œå¾®æ•°æ®åº“æ˜¯ Python å†™çš„ï¼Œè€Œä¸”å¯¹äºæ•°æ®åº“çš„æ¥å£æœ‰ç€ä¸¥æ ¼é™åˆ¶ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘æ‰ç”¨æˆ‘è‡ªå·±ç”¨ php+mysql å†™çš„ä¸€ä¸ª api æ¥è¿›è¡Œä¸Šä¼ </p></blockquote><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><ol><li>å…ˆçœ‹çœ‹ç”¨åˆ°çš„ç»„ä»¶ï¼šä¸»è¦æ˜¯ web å®¢æˆ·ç«¯<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141639.jpg" srcset="/img/loading.gif" alt></li><li>ç»„ä»¶çš„ä»£ç å—:<ul><li>ç”¨äºè®¾ç½® web å®¢æˆ·ç«¯çš„ç½‘å€<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141640.jpg" srcset="/img/loading.gif" alt></li><li>æ‰§è¡Œ get è¯·æ±‚<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141641.jpg" srcset="/img/loading.gif" alt></li><li>è¯·æ±‚æˆåŠŸåè¿”å›æ“ä½œ<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141642.jpg" srcset="/img/loading.gif" alt><br>æ³¨æ„ï¼šè¿™ä¸€ä¸ªçš„è¯å¦‚æœä½ è®¾ç½®äº†ä¿å­˜å“åº”ä¿¡æ¯ä¸º ture å°±é€‰æ‹©è·å¾—æ–‡ä»¶è¿™ä¸ªæ§åˆ¶å—ï¼Œå¦åˆ™çš„è¯é€‰æ‹©è·å¾—æ–‡å­—çš„æ§åˆ¶å—ï¼Œæˆ‘ä»¬ä½¿ç”¨è·å¾—æ–‡å­—çš„æ§åˆ¶å—</li></ul></li></ol><h4 id="é€»è¾‘æ§åˆ¶å›¾"><a href="#é€»è¾‘æ§åˆ¶å›¾" class="headerlink" title="é€»è¾‘æ§åˆ¶å›¾"></a>é€»è¾‘æ§åˆ¶å›¾</h4><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141643.jpg" srcset="/img/loading.gif" alt><br><em>æˆ‘åšçš„æ¥å£çš„è¿”å›å€¼ä¸º json æ ¼å¼æ‰€ä»¥é‡‡ç”¨äº† json çš„è§£æï¼Œæˆ‘æš‚æ—¶ä¸éœ€è¦åˆ¤æ–­è¿”å›å€¼å¾—å†…å®¹ã€é‡Œé¢åŒ…å«äº†ä¸Šä¼ æ˜¯å¦æˆåŠŸä¹‹ç±»çš„ã€‘ï¼Œå¦‚æœéœ€è¦çš„è¯è¯·å‚è€ƒæœ‰å…³ json è§£æçš„ç›¸å…³å†…å®¹</em></p><h4 id="æ¨èå‚è€ƒæ‰‹å†Œ"><a href="#æ¨èå‚è€ƒæ‰‹å†Œ" class="headerlink" title="æ¨èå‚è€ƒæ‰‹å†Œ"></a>æ¨èå‚è€ƒæ‰‹å†Œ</h4><ol><li>æ„Ÿè°¢@è€å·«å©†ç¿»è¯‘çš„å‚è€ƒæ‰‹å†Œï¼Œè¿™é‡Œåˆ†äº«ç»™å¤§å®¶ï¼š<a href="http://www.17coding.net/reference/" target="_blank" rel="noopener">AI2 ä¸­æ–‡å‚è€ƒæ‰‹å†Œ</a></li><li><a href="http://blog.sina.com.cn/s/blog_62218b990102vhmo.html" target="_blank" rel="noopener">@è€å·«å©†çš„ json è§£ææ•™ç¨‹</a></li><li><a href="http://i.youku.com/u/UNTc5MzY3NTYw/playlists" target="_blank" rel="noopener">AI2 è§†é¢‘æ•™ç¨‹</a>ä¸å¾—ä¸åæ§½è¿™ä¸ªæ•™ç¨‹çš„æ¸…æ™°åº¦</li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/64902.html">NDKå¼€å‘ä¸­æ— æ³•è®¿é—®android.support.v7.app.AppCompatActivityè§£å†³åŠæ³•</a></li><li><a href="https://lailin.xyz/post/34934.html">appcanåˆ©ç”¨å¤©ç¿¼rtcå®ç°è§†é¢‘é€šè¯åŠŸèƒ½</a></li><li><a href="https://lailin.xyz/post/23045.html">å¦‚ä½•ä½¿ç”¨MITAPPInventor2å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£app</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>app</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpå¦‚ä½•å®ç°æ•´é™¤</title>
    <link href="/post/28942.html"/>
    <url>/post/28942.html</url>
    
    <content type="html"><![CDATA[<h3 id="php-å¦‚ä½•å®ç°æ•´é™¤"><a href="#php-å¦‚ä½•å®ç°æ•´é™¤" class="headerlink" title="php å¦‚ä½•å®ç°æ•´é™¤"></a>php å¦‚ä½•å®ç°æ•´é™¤</h3><blockquote><p>ä»¥å‰åœ¨ç”¨ C/C++çš„æ—¶å€™ï¼Œæ•´é™¤å°±æ˜¯â€™/â€˜ï¼Œè¿˜è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸ªé—®é¢˜ï¼Œä»Šå¤©ç”¨åˆ° php è°ƒè¯•çš„æ—¶å€™å‡ºé”™äº†ï¼Œæœ€åå‘ç°ï¼šåœ¨ php ä¸­â€™/â€˜é™¤æ³•æ˜¯é»˜è®¤å¸¦æœ‰å°æ•°éƒ¨åˆ†çš„ï¼Œphp è‡ªå¸¦æœ‰å‡ ä¸ªå‡½æ•°å¯ä»¥å¯¹å°æ•°è¿›è¡Œå¤„ç†</p></blockquote><h4 id="1-round-å‡½æ•°ï¼Œå››èˆäº”å…¥"><a href="#1-round-å‡½æ•°ï¼Œå››èˆäº”å…¥" class="headerlink" title="1. round()å‡½æ•°ï¼Œå››èˆäº”å…¥"></a>1. round()å‡½æ•°ï¼Œå››èˆäº”å…¥</h4><pre><code>&lt;?php echo round(7/3); //2 ?&gt;</code></pre><h4 id="2-ceil-å‡½æ•°ï¼Œè¿›ä¸€æ³•"><a href="#2-ceil-å‡½æ•°ï¼Œè¿›ä¸€æ³•" class="headerlink" title="2. ceil()å‡½æ•°ï¼Œè¿›ä¸€æ³•"></a>2. ceil()å‡½æ•°ï¼Œè¿›ä¸€æ³•</h4><p><em>ä¹Ÿå°±æ˜¯å–æ¯”è¯¥æ•°å¤§çš„æœ€å°æ•´æ•°</em></p><pre><code>&lt;?php echo ceil(7/3); //3 ?&gt;</code></pre><h4 id="3-floor-å‡½æ•°ï¼Œèˆä¸€æ³•"><a href="#3-floor-å‡½æ•°ï¼Œèˆä¸€æ³•" class="headerlink" title="3. floor()å‡½æ•°ï¼Œèˆä¸€æ³•"></a>3. floor()å‡½æ•°ï¼Œèˆä¸€æ³•</h4><p><em>ä¹Ÿå°±æ˜¯å–æ¯”è¯¥æ•°å°çš„æœ€å¤§æ•´æ•°</em></p><p>&lt;?php echo floor(7/3); //2?&gt;</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li><a href="https://lailin.xyz/post/go-training-week3-goroutine.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>phpstrom9å¯ç”¨æ³¨å†Œç ä¸€æš</title>
    <link href="/post/19314.html"/>
    <url>/post/19314.html</url>
    
    <content type="html"><![CDATA[<h4 id="phpstrom9-å¯ç”¨æ³¨å†Œç ä¸€æš"><a href="#phpstrom9-å¯ç”¨æ³¨å†Œç ä¸€æš" class="headerlink" title="phpstrom9 å¯ç”¨æ³¨å†Œç ä¸€æš"></a>phpstrom9 å¯ç”¨æ³¨å†Œç ä¸€æš</h4><p><strong>username</strong></p><pre><code>EMBRACE</code></pre><p><strong>key</strong></p><pre><code class="hljs undefined"><span class="hljs-section">===== LICENSE BEGIN =====</span>43136-1204201000002UsvSON704l"dILe1PVx3y4"B349AU6oSDJrsjE8nMOQh"8HTDJHIUUhgd1BebYc5U"6OxDbVsALB4Eb10PW8"<span class="hljs-section">===== LICENSE END =====</span></code></pre><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/18280.html">å››å·å¤§å­¦é”æ·windowsè§£é™¤å¤šç½‘å¡é™åˆ¶</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç ´è§£</tag>
      
      <tag>php</tag>
      
      <tag>æ³¨å†Œç </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ç¦åˆ©ã€‘è‡³å–„ç½‘åª’ä½“ç´ æä¸€é”®è¯„ä»·</title>
    <link href="/post/59875.html"/>
    <url>/post/59875.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åšè‡³å–„ç½‘ä¸Šé¢çš„é¢˜æ—¶å€™ï¼Œå‘ç°åª’ä½“ç´ æéœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„è¯„ä»·å®åœ¨æ˜¯æœ‰ç‚¹çƒ¦ï¼›æ‰€ä»¥å¼€æŒ‚å†™äº†ä¸€ä¸ª JS çš„å°æ’ä»¶ï¼Œç›´æ¥ä¸€æ¬¡æ€§æå®š</p></blockquote><p><strong>æ–¹æ³•ä¸€ï¼šç›´æ¥å°†ä¸‹é¢è¿™ä¸ªé“¾æ¥æ‹–å…¥ä¹¦ç­¾æ ï¼Œç„¶ååœ¨ä½ éœ€è¦ä¸€ä»¶è¯„ä»·åª’ä½“ç´ æçš„åœ°æ–¹ç‚¹å‡»å°±å¥½</strong><br><em>ps:æ¯›æ¦‚æµ‹è¯•æˆåŠŸï¼Œå…¶ä»–çš„è¯·è‡ªæµ‹</em></p><p><a href="javascript:(function(){function sleep(d){for(var t=Date.now();Date.now()-t<=d;){}}function getNum(text){var value=text.replace(/[^0-9]/ig,"");return value}var obj=$("p[href="+"\"javascript:;\""+"]").each(function(){var name=$(this).attr("name");name=getNum(name);parent.showMediaRight(name);wkMediaPj(name,3);var btn1=$(".aui_state_highlight");btn1.click();sleep(1000)})})();" target="_blank" rel="noopener">è‡³å–„ç½‘åª’ä½“ç´ æä¸€é”®è¯„ä»·</a></p><p><em>æœ‰ä»€ä¹ˆé—®é¢˜ç›´æ¥åœ¨è¯„è®ºé—®å°±å¥½</em></p><p><strong>æ›´æ–°ï¼Œé™„èµ ä¸€ä¸ªæ¯›æ¦‚çš„ç­”æ¡ˆ</strong><br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141644.jpg" srcset="/img/loading.gif" alt></p><p><strong>æ¯›æ¦‚ç­”æ¡ˆè¡¥å……ï¼šä¸­é—´æœ‰ä¸€ä¸ªé—®å·ï¼Œé‚£é“é¢˜çš„ç­”æ¡ˆæ˜¯ï¼šä¸€ä¸ªä¸­å¿ƒï¼Œä¸¤ä¸ªåŸºæœ¬çš„</strong><br><strong>æ³¨ï¼šè¿™æ˜¯æ¯›æ¦‚ä¸Šçš„ç­”æ¡ˆ</strong></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/62847.html">jsç¼–ç è§£ç URL</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>js</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨MITAPPInventor2å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£app</title>
    <link href="/post/23045.html"/>
    <url>/post/23045.html</url>
    
    <content type="html"><![CDATA[<h3 id="å¦‚ä½•ä½¿ç”¨-MIT-APP-Inventor2-å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£-app"><a href="#å¦‚ä½•ä½¿ç”¨-MIT-APP-Inventor2-å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£-app" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ MIT APP Inventor2 å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£ app"></a>å¦‚ä½•ä½¿ç”¨ MIT APP Inventor2 å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè“ç‰™ä¸²å£ app</h3><hr><blockquote><p>æœ€è¿‘åšå­¦æ ¡çš„ä¸€ä¸ªæ¯”èµ›ï¼Œæˆ‘æ˜¯å¹³æ—¶æ˜¯å­¦ä¹ åš web åç«¯çš„ï¼Œæœ‰æ—¶å€™æå¸¦ä¸€äº›å‰ç«¯çš„ä¸œè¥¿ï¼Œä½†æ˜¯æœ€è¿‘è¿™ä¸ªæ¯”èµ›éœ€è¦åšä¸€ä¸ª appï¼Œé—®é¢˜æ¥äº†ï¼Œæ²¡æœ‰å­¦è¿‡ Java æ²¡æœ‰å­¦è¿‡ OC æ‰€ä»¥ ios å’Œå®‰å“éƒ½æ˜¯æ— ä»ä¸‹æ‰‹ï¼Œç„¶åæœ€åæ‰¾äº†å¾ˆå¤šæ··åˆå¼€å‘çš„å·¥å…·ï¼Œæ¯”å¦‚è¯´ APPCANï¼Œapicloudï¼Œhbuilderï¼Œwex5 ç­‰ç­‰ï¼Œæœ€åä¸æ˜¯æ²¡æœ‰è“ç‰™ä¸²å£çš„æ’ä»¶ï¼Œå°±æ˜¯æ²¡æœ‰åŠæ³•ä½¿ç”¨.æœ€ç»ˆåœ¨ä¸€æ¬¡æœç´¢ä¸­æ— æ„çš„å‘ç°äº†è¿™ä¸ª AI2.</p></blockquote><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><hr><p><strong>1. ä½¿ç”¨ AI2 çš„å‰ææ¡ä»¶ï¼š</strong></p><ul><li>ä¸è¦æ±‚ç•Œé¢çš„ç¾è§‚æ€§ï¼Œéœ€è¦å®ç”¨æ€§</li><li>ä¸ä¼šåŸç”Ÿä»£ç çš„ç¼–ç¨‹</li></ul><p><strong>2. ä½¿ç”¨ AI2 å¥½å¤„ï¼š</strong></p><ul><li>ä¸è¦æ±‚ä½ ä¼šå†™ä»£ç ï¼Œå›¾å½¢åŒ–ç¼–ç¨‹ï¼Œç®€å•æ˜“ç”¨</li><li>æä¾›äº†å¾ˆå¤šæ¨¡å—ä¸€èˆ¬åšä¸€ä¸ªå¸¸ç”¨çš„ app å®Œå…¨æ²¡æœ‰é—®é¢˜</li><li>æœ‰ä¸­æ–‡ç‰ˆï¼Œæ‰€ä»¥è¯´è¯­è¨€éšœç¢ä¹Ÿä¸å­˜åœ¨äº†</li></ul><p><strong>3. ä½¿ç”¨ AI2 çš„å‡ ç§æ–¹å¼ï¼š</strong></p><ul><li>ç¦»çº¿å®‰è£…ï¼Œç¦»çº¿è°ƒè¯•</li><li>åœ¨çº¿ä½¿ç”¨ï¼ŒAI ä¼´ä¾£è°ƒè¯•ï¼ˆæ¨¡æ‹Ÿå™¨è°ƒè¯•ï¼‰<br><em>ä¸ªäººæ¨èç¬¬äºŒç§ï¼Œåœ¨çº¿ä½¿ç”¨ï¼ŒAI ä¼´ä¾£è°ƒè¯•</em></li></ul><p><strong>4. AI2 çš„ä¸­æ–‡ç½‘å€ï¼š</strong></p><ul><li>æœ€æ–°çš„ä¸­æ–‡æœåŠ¡å™¨ï¼š<a href="http://app.gzjkw.net/" target="_blank" rel="noopener">http://app.gzjkw.net/</a></li><li>ä¸­æ–‡æ•™ç¨‹ç½‘ç«™ï¼š<a href="http://www.17coding.net/" target="_blank" rel="noopener">http://www.17coding.net/</a></li></ul><h4 id="æ•™ç¨‹"><a href="#æ•™ç¨‹" class="headerlink" title="æ•™ç¨‹"></a>æ•™ç¨‹</h4><blockquote><p>PS:ä»…ä»…æ˜¯è‡ªå·±çš„ä¸€äº›ç»éªŒè§‚ç‚¹ï¼Œæœ‰ä»€ä¹ˆé”™è¯¯å¤§å®¶äº¤æµå•Š</p></blockquote><hr><h5 id="1-ç‚¹å‡»è¿›å…¥-http-app-gzjkw-net-ï¼Œ-æ³¨å†Œå¸å·ä¹‹åï¼Œè¿›å…¥ä»¥ä¸‹é¡µé¢"><a href="#1-ç‚¹å‡»è¿›å…¥-http-app-gzjkw-net-ï¼Œ-æ³¨å†Œå¸å·ä¹‹åï¼Œè¿›å…¥ä»¥ä¸‹é¡µé¢" class="headerlink" title="1. ç‚¹å‡»è¿›å…¥ http://app.gzjkw.net/ï¼Œ æ³¨å†Œå¸å·ä¹‹åï¼Œè¿›å…¥ä»¥ä¸‹é¡µé¢"></a>1. ç‚¹å‡»è¿›å…¥ <a href="http://app.gzjkw.net/" target="_blank" rel="noopener">http://app.gzjkw.net/</a>ï¼Œ æ³¨å†Œå¸å·ä¹‹åï¼Œè¿›å…¥ä»¥ä¸‹é¡µé¢</h5><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/blogQQå›¾ç‰‡20151015130813.png" srcset="/img/loading.gif" alt="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾"></p><h5 id="2-é€‰æ‹©ä¸Šé¢çš„å¸®åŠ©ä¸‹è½½AI-ä¼´ä¾£apkï¼Œä¹‹åç”¨äºåœ¨çº¿è°ƒè¯•"><a href="#2-é€‰æ‹©ä¸Šé¢çš„å¸®åŠ©ä¸‹è½½AI-ä¼´ä¾£apkï¼Œä¹‹åç”¨äºåœ¨çº¿è°ƒè¯•" class="headerlink" title="2. é€‰æ‹©ä¸Šé¢çš„å¸®åŠ©ä¸‹è½½AI ä¼´ä¾£apkï¼Œä¹‹åç”¨äºåœ¨çº¿è°ƒè¯•"></a>2. é€‰æ‹©ä¸Šé¢çš„å¸®åŠ©ä¸‹è½½<strong>AI ä¼´ä¾£</strong>apkï¼Œä¹‹åç”¨äºåœ¨çº¿è°ƒè¯•</h5><ul><li>æˆ–è€…ç›´æ¥ç‚¹å‡» <a href="http://app.gzjkw.net/companions/MITAI2Companion.apk" title="AIä¼´ä¾£" target="_blank" rel="noopener">AI ä¼´ä¾£</a> ä¸‹è½½</li></ul><h5 id="3-ç®€å•çš„åŠŸèƒ½ä»‹ç»"><a href="#3-ç®€å•çš„åŠŸèƒ½ä»‹ç»" class="headerlink" title="3. ç®€å•çš„åŠŸèƒ½ä»‹ç»"></a>3. ç®€å•çš„åŠŸèƒ½ä»‹ç»</h5><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/blogQQå›¾ç‰‡20151015131926.png" srcset="/img/loading.gif" alt="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾"></p><ul><li><strong>å…¶ä¸­æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„å‡ ä¸ªç»„ä»¶ï¼š</strong></li></ul><table><thead><tr><th>åç§°</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td>è“ç‰™å®¢æˆ·ç«¯ 1</td><td style="text-align:center">ç”¨äºæ¥æ”¶è“ç‰™ä¸²å£è®¾å¤‡çš„æ¶ˆæ¯</td></tr><tr><td>æŒ‰é’®</td><td style="text-align:center">ä¸€èˆ¬çš„ button</td></tr><tr><td>æ°´å¹³å¸ƒå±€</td><td style="text-align:center">ç”¨äºå¸ƒå±€æ•´ä¸ªç•Œé¢</td></tr><tr><td>å¯¹è¯æ¡†</td><td style="text-align:center">ç”¨äºå‘å‡ºæç¤ºæ¶ˆæ¯</td></tr><tr><td>activity æ§åˆ¶å™¨</td><td style="text-align:center">ç”¨äºæ‰“å¼€è“ç‰™</td></tr><tr><td>web å®¢æˆ·ç«¯</td><td style="text-align:center">ç”¨äºé“¾æ¥ç½‘ç»œç›¸å…³çš„ä¸œè¥¿ï¼ˆè¿™ä¸ªä¸‹ä¸€æ¬¡ç”¨åˆ°ï¼‰</td></tr><tr><td>è®¡æ—¶å™¨</td><td style="text-align:center">ç”¨äºå®šæ—¶æ¥æ”¶è“ç‰™ä¸²å£å‘é€å‡ºæ¥çš„æ¶ˆæ¯</td></tr></tbody></table><ul><li><strong>å…·ä½“çš„å¸¸ç”¨ç»„ä»¶çš„ä»‹ç»ï¼Œè¯·å¤§å®¶ç‚¹å‡»ç½‘ç«™æŸ¥çœ‹<a href="http://www.17coding.net/" target="_blank" rel="noopener">http://www.17coding.net/</a></strong></li></ul><h5 id="4-é€»è¾‘è®¾ç½®"><a href="#4-é€»è¾‘è®¾ç½®" class="headerlink" title="4. é€»è¾‘è®¾ç½®"></a>4. é€»è¾‘è®¾ç½®</h5><ul><li>é¦–å…ˆå®Œæˆç•Œé¢çš„ä¸€ä¸ªç•Œé¢çš„å¸ƒå±€å·¥ä½œ<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/blogQQå›¾ç‰‡20151015170129.png" srcset="/img/loading.gif" alt="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾"></li><li><p>ç»„ä»¶çš„é€»è¾‘è®¾ç½®ã€ç‚¹å‡»å³ä¸Šè§’çš„é€»è¾‘è®¾è®¡å³å¯ã€‘<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/blogQQå›¾ç‰‡20151015170447.png" srcset="/img/loading.gif" alt="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾"></p></li><li><p>å…¶ä¸­å°† activity å¯åŠ¨å™¨ 1 çš„ action å€¼è®¾ç½®ä¸º<strong>android.bluetooth.adapter.action.REQUEST_ENABLE</strong> ï¼Œè¿™æ ·å¯ä»¥è¾¾åˆ°å¼€å¯è“ç‰™çš„æ•ˆæœ</p></li></ul><h3 id="ä¸‹ä¸€ç¯‡è®²å¦‚ä½•å°†æ•°æ®ä¿å­˜åˆ°æœåŠ¡å™¨ï¼ˆä¸ä½¿ç”¨è‡ªå¸¦çš„ç½‘ç»œæ•°æ®åº“çš„æƒ…å†µä¸‹ï¼‰"><a href="#ä¸‹ä¸€ç¯‡è®²å¦‚ä½•å°†æ•°æ®ä¿å­˜åˆ°æœåŠ¡å™¨ï¼ˆä¸ä½¿ç”¨è‡ªå¸¦çš„ç½‘ç»œæ•°æ®åº“çš„æƒ…å†µä¸‹ï¼‰" class="headerlink" title="ä¸‹ä¸€ç¯‡è®²å¦‚ä½•å°†æ•°æ®ä¿å­˜åˆ°æœåŠ¡å™¨ï¼ˆä¸ä½¿ç”¨è‡ªå¸¦çš„ç½‘ç»œæ•°æ®åº“çš„æƒ…å†µä¸‹ï¼‰"></a><em>ä¸‹ä¸€ç¯‡è®²å¦‚ä½•å°†æ•°æ®ä¿å­˜åˆ°æœåŠ¡å™¨ï¼ˆä¸ä½¿ç”¨è‡ªå¸¦çš„ç½‘ç»œæ•°æ®åº“çš„æƒ…å†µä¸‹ï¼‰</em></h3><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/64902.html">NDKå¼€å‘ä¸­æ— æ³•è®¿é—®android.support.v7.app.AppCompatActivityè§£å†³åŠæ³•</a></li><li><a href="https://lailin.xyz/post/34934.html">appcanåˆ©ç”¨å¤©ç¿¼rtcå®ç°è§†é¢‘é€šè¯åŠŸèƒ½</a></li><li><a href="https://lailin.xyz/post/35791.html">ä½¿ç”¨MITAPPInventor2webå®¢æˆ·ç«¯ç»„ä»¶ä¿å­˜æ•°æ®è‡³äº‘ç«¯</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>app</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CoreThinkå›¾ç‰‡è½®æ’­æ’ä»¶ã€ImageSliderã€‘</title>
    <link href="/post/15278.html"/>
    <url>/post/15278.html</url>
    
    <content type="html"><![CDATA[<p>ç§»æ¤äº OT æ’ä»¶ï¼ŒåŸæ–‡åœ°å€<a href="http://www.topthink.com/topic/6244.html" target="_blank" rel="noopener">http://www.topthink.com/topic/6244.html</a></p><p>1ã€æ”¯æŒ unslider\flexslider åˆ‡æ¢é€‰æ‹©</p><p>2ã€æ”¯æŒæ¨èä½é€‰æ‹©</p><p>3ã€æ”¯æŒå¤šå›¾</p><p>4ã€åˆ‡æ¢æ—¶é—´&amp;æ–¹å‘é€‰æ‹©</p><p>5ã€è‡ªå®šä¹‰å®¹å™¨å®½åº¦&amp;é«˜åº¦</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141646.png" srcset="/img/loading.gif" alt></p><p><strong><em>**</em></strong>*<strong><em>**</em></strong>ä½¿ç”¨è¯´æ˜<strong><em>**</em></strong>***<strong><em>**</em></strong><br>1ã€è¯·å…ˆå°†ä¸‹é¢è¿™æ®µä»£ç å¤åˆ¶åˆ° Application\common\controller\addon.class.php</p><pre><code>/* è·å–ä»¶æ‰€éœ€çš„é’©å­æ˜¯å¦å­˜åœ¨ï¼Œæ²¡æœ‰åˆ™æ–°å¢   * @param string $str  é’©å­åç§°   * @param string $addons  æ’ä»¶åç§°   * @param string $addons  ä»¶ç®€ä»‹   */ public function existHook($str, $addons, $msg=&apos;&apos;){       $hook_mod = M(&apos;addon_hook&apos;); $where[&apos;name&apos;] = $str;       $gethook = $hook_mod-&gt;where($where)-&gt;find();       if(!$gethook || empty($gethook) || !is_array($gethook)){           $data[&apos;name&apos;] = $str; $data[&apos;description&apos;] = $msg; $data[&apos;type&apos;] = 1;           $data[&apos;update_time&apos;] = NOW_TIME; $data[&apos;addons&apos;] = $addons;           if( false !== $hook_mod-&gt;create($data) ){               $hook_mod-&gt;add();           }       }   }   /**    * deleteé’©å­    * @param string $hook  é’©å­åç§°    */   public function deleteHook($hook){       $model = M(&apos;addon_hook&apos;);       $condition = array( &apos;name&apos; =&gt; $hook, );       $model-&gt;where($condition)-&gt;delete();   }</code></pre><p>2ã€è°ƒç”¨æ–¹æ³•</p><pre><code class="hljs undefined">&#123;<span class="hljs-symbol">:hook</span>(<span class="hljs-name">'ImageSlider'</span>)&#125;</code></pre><p>3ã€å¦‚æœå‡ºç°æ˜¾ç¤ºä¸å‡ºå›¾ç‰‡ï¼Œè·¯å¾„é”™è¯¯çš„æƒ…å†µ</p><p>è¯·æ”¹ä¸€ä¸‹é‚£ä¸ª unslider\flexslider.html çš„å›¾ç‰‡è·¯å¾„ï¼Œå› ä¸ºå®‰è£…çš„è·¯å¾„ä¸åŒå¯èƒ½å‡ºç°æ„å¤–</p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>corethink</tag>
      
      <tag>æ’ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Corethinkç€‘å¸ƒæµæ’ä»¶</title>
    <link href="/post/54589.html"/>
    <url>/post/54589.html</url>
    
    <content type="html"><![CDATA[<h2 id="ã€åŸåˆ›æ’ä»¶ã€‘ç€‘å¸ƒæµ"><a href="#ã€åŸåˆ›æ’ä»¶ã€‘ç€‘å¸ƒæµ" class="headerlink" title="ã€åŸåˆ›æ’ä»¶ã€‘ç€‘å¸ƒæµ"></a>ã€åŸåˆ›æ’ä»¶ã€‘ç€‘å¸ƒæµ</h2><h3 id="1ã€å‰å°ç•Œé¢"><a href="#1ã€å‰å°ç•Œé¢" class="headerlink" title="1ã€å‰å°ç•Œé¢"></a>1ã€å‰å°ç•Œé¢</h3><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141648.png" srcset="/img/loading.gif" alt></p><h3 id="2ã€å‰å°å¤§å›¾é¢„è§ˆ"><a href="#2ã€å‰å°å¤§å›¾é¢„è§ˆ" class="headerlink" title="2ã€å‰å°å¤§å›¾é¢„è§ˆ"></a>2ã€å‰å°å¤§å›¾é¢„è§ˆ</h3><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141649.png" srcset="/img/loading.gif" alt></p><h3 id="3ã€åå°è®¾ç½®"><a href="#3ã€åå°è®¾ç½®" class="headerlink" title="3ã€åå°è®¾ç½®"></a>3ã€åå°è®¾ç½®</h3><p>æ”¯æŒå®¹å™¨å®½åº¦è‡ªå®šä¹‰ï¼Œé«˜åº¦éšå®½åº¦æŒ‰æ¯”ä¾‹æ”¹å˜</p><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141650.png" srcset="/img/loading.gif" alt></p><h3 id="4ã€åå°ç®¡ç†ç•Œé¢"><a href="#4ã€åå°ç®¡ç†ç•Œé¢" class="headerlink" title="4ã€åå°ç®¡ç†ç•Œé¢"></a>4ã€åå°ç®¡ç†ç•Œé¢</h3><p>ä½œè€…ï¼Œå†…å®¹ä¸ºé€‰å¡«é¡¹ï¼Œå…¶ä½™ä¸ºå¿…å¡«é¡¹<br><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141651.png" srcset="/img/loading.gif" alt></p><h3 id="5ã€æ–°å¢ç•Œé¢"><a href="#5ã€æ–°å¢ç•Œé¢" class="headerlink" title="5ã€æ–°å¢ç•Œé¢"></a>5ã€æ–°å¢ç•Œé¢</h3><p><img src="https://me-blog.oss-cn-shenzhen.aliyuncs.com/img/2018-12-03-141653.png" srcset="/img/loading.gif" alt></p><p><strong>**</strong>***<strong>**</strong>ä½¿ç”¨è¯´æ˜<strong><strong><em>**</em></strong></strong>****<strong><strong><em>**</em></strong></strong><br>1ã€å‰å°è°ƒç”¨</p><pre><code>é’©å­{:hook(&apos;WaterFall&apos;)}</code></pre><p>2ã€å®‰è£…è¯´æ˜</p><p>å¦‚æœé»˜è®¤è¡¨å‰ç¼€ä¸æ˜¯ ct<em>ï¼Œè¯·åœ¨æ’ä»¶ç›®å½•ä¸‹ WaterFallAddon.class.php ä¸­çš„ ct</em>æ”¹ä¸ºä½ çš„è¡¨å‰ç¼€</p><pre><code>-&gt;where(&apos;ct_addon_waterfall.status=1&apos;)</code></pre><p>3ã€å®‰è£…è¯´æ˜ 2<br>å¦‚æœä¸èƒ½å®‰è£…æ˜¯ä¸å­˜åœ¨é’©å­åŸå› ï¼Œè§£å†³åŠæ³•è¯·çœ‹æˆ‘ä¸Šä¸€ä¸ª OT ç§»æ¤æ’ä»¶ ImageSlider ä¸­çš„ä½¿ç”¨æ–¹æ³•</p><p><a href="http://lxl520.com/me/blog/index.php/archives/6/" target="_blank" rel="noopener">ImageSlider</a></p><p>psï¼š</p><p><a href="http://www.cnblogs.com/sanshi/p/3237429.html" target="_blank" rel="noopener">æ„Ÿè°¢ä¸‰ç”ŸçŸ³ä¸Šçš„å‰ç«¯ç€‘å¸ƒæµæ•™ç¨‹</a></p><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/59080.html">ä¸€é”®è¿ç§»typechoåˆ°hexo</a></li><li><a href="https://lailin.xyz/post/43893.html">phpè®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼</a></li><li><a href="https://lailin.xyz/post/13242.html">è¿ç§»laravelæ¡†æ¶é¡¹ç›®åˆ°è™šæ‹Ÿä¸»æœº</a></li></ul></div>]]></content>
    
    
    <categories>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>corethink</tag>
      
      <tag>æ’ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
