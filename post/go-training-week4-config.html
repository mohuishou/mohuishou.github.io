<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/icons/touch-icon-apple.png"><link rel="icon" type="image/png" href="/icons/favicon-32x32.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="Mohuishou"><meta name="keywords" content="Go, Docker, PHP"><title>Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç† - Mohuishou</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main-8c4c5e426918ae095492d8a940e57fef.css"><link rel="stylesheet" href="/assets/css/custom-94ac739f6571b69e61e199e75a4cbff4.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"lailin.xyz",root:"/",version:"1.8.7",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!0,baidu:null,google:"UA-137859264-1",gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils-5ecdced2f65030c3508cf0b3db78f4ad.js"></script><script src="/js/color-schema-4678c2299d6eeb96e23435ea339c9331.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>mohuishou</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/"><i class="iconfont icon-category-fill"></i> Go è¿›é˜¶è®­ç»ƒè¥(æ›´æ–°ä¸­)</a></li><li class="nav-item"><a class="nav-link" href="/post/go-design-pattern.html"><i class="iconfont icon-notebook"></i> Go è®¾è®¡æ¨¡å¼</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> æ›´å¤š</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾ </a><a class="dropdown-item" href="/atom.xml"><i class="iconfont icon-rss"></i> rss </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/img/bg.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-03-05 00:08" pubdate>2021å¹´3æœˆ5æ—¥ å‡Œæ™¨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.7k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 31 åˆ†é’Ÿ</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"><div class="sidebar"><p class="sidebar-header">Goè¿›é˜¶è®­ç»ƒè¥</p><div class="sidebar-body" id="sidebar-body"><ol class="sidebar-list sidebar-list-1"><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23xho0000m4t51q602czj").classList.toggle("sidebar-is-collapsed")'>Week01: å¾®æœåŠ¡</a><ol id="sidebar-ckkm23xho0000m4t51q602czj" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-01.html">å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-02.html">å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&amp;å¤šç§Ÿæˆ·</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23ykh0003m4t53mln1w0n").classList.toggle("sidebar-is-collapsed")'>Week02: Goé”™è¯¯å¤„ç†</a><ol id="sidebar-ckkm23ykh0003m4t53mln1w0n" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-03.html">Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm2667n000pm4t52z016wn0").classList.toggle("sidebar-is-collapsed")'>Week03: Go å¹¶å‘ç¼–ç¨‹</a><ol id="sidebar-ckkm2667n000pm4t52z016wn0" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-goroutine.html">Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-go-memory-model.html">Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-data-race.html">Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sync.html">Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-waitgroup.html">Goå¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-atomic.html">Goå¹¶å‘ç¼–ç¨‹(äº”) æ·±å…¥ç†è§£ sync/atomic</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-errgroup.html">Goå¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-once.html">Goå¹¶å‘ç¼–ç¨‹(å…«) æ·±å…¥ç†è§£ sync.Once</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-context.html">Goå¹¶å‘ç¼–ç¨‹(ä¹) æ·±å…¥ç†è§£ Context</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-channel.html">Goå¹¶å‘ç¼–ç¨‹(å) æ·±å…¥ç†è§£ Channel</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sum.html">Goå¹¶å‘ç¼–ç¨‹(åä¸€) æ€»ç»“</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23zra000im4t5en8m0qy9").classList.toggle("sidebar-is-collapsed")'>Week04: Go å·¥ç¨‹åŒ–</a><ol id="sidebar-ckkm23zra000im4t5en8m0qy9" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-clean-arch.html">Goå·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®°</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-project-layout.html">Goå·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-wire.html">Goå·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-api-design.html">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ &amp; è®¾è®¡</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-protoc-gen-go-gin.html">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </a></li><li class="sidebar-list-item is-active-li"><a class="sidebar-link sidebar-active-link" href="/post/go-training-week4-config.html">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-go-module.html">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</a></li></ol></li></ol></div></div></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</h1><div class="markdown-body"><h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><p>æœ¬ç³»åˆ—ä¸º <a target="_blank" rel="noopener" href="https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;utm_medium=lailin.xyz">Go è¿›é˜¶è®­ç»ƒè¥</a> ç¬”è®°ï¼Œé¢„è®¡ 2021Q2 å®Œæˆæ›´æ–°ï¼Œè®¿é—® <a href="https://lailin.xyz/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">åšå®¢: Go è¿›é˜¶è®­ç»ƒè¥</a> å³å¯æŸ¥çœ‹å½“å‰æ›´æ–°è¿›åº¦ï¼Œéƒ¨åˆ†æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œä½¿ç”¨ PC å¤§å±æµè§ˆä½“éªŒæ›´ä½³ã€‚<strong>_3 æœˆè¿›åº¦: 03/15 _</strong>3 æœˆå¼€å§‹ä¼šå°è¯•çˆ†æ›´æ¨¡å¼ï¼Œäº‰å–åšåˆ°ä¸¤å¤©æ›´æ–°ä¸€ç¯‡æ–‡ç« ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥æ‹‰åˆ°æ–‡ç« æœ€ä¸‹æ–¹è·å–å…³æ³¨æ–¹å¼ã€‚</p><p>åº”ç”¨çš„é…ç½®å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§</p><ul><li>ç¯å¢ƒé…ç½®<ul><li>ç¯å¢ƒé…ç½®ï¼Œåº”è¯¥æ˜¯åº”ç”¨éƒ¨ç½²æ—¶å°±å·²ç»ç¡®å®šå¥½çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸åº”è¯¥å†™åœ¨æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶æˆ–è€…æ˜¯æ”¾åˆ°é…ç½®ä¸­å¿ƒï¼Œè€Œæ˜¯åº”è¯¥ç”±æˆ‘ä»¬çš„éƒ¨ç½²å¹³å°ï¼Œä¾‹å¦‚ K8s ç›´æ¥åœ¨å®¹å™¨å¯åŠ¨æ—¶å€™å°±æ³¨å…¥å¥½</li><li>region: åŒºåŸŸä¿¡æ¯</li><li>env: ç¯å¢ƒä¿¡æ¯ï¼Œä¾‹å¦‚ prod, test</li><li>zone: å¯ç”¨åŒº</li><li>host: æœºå™¨å</li><li>appid: åº”ç”¨ id</li><li>color: æµé‡æŸ“è‰²ä¿¡æ¯ï¼Œç”¨æ¥åšæµé‡åˆ†å‘çš„</li></ul></li><li>é™æ€é…ç½®<ul><li>èµ„æºéœ€è¦åˆå§‹åŒ–çš„é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚ http/gRPC serverã€redisã€mysql ç­‰</li><li>è¿™ç±»èµ„æºåœ¨çº¿å˜æ›´é…ç½®çš„é£é™©éå¸¸å¤§ï¼Œå°½é‡ä¸è¦åœ¨çº¿åŠ¨æ€å˜æ›´ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡å‡ºç°ä¸å¯é¢„æœŸçš„äº‹æ•…</li><li>å˜æ›´é™æ€é…ç½®å’Œå‘å¸ƒ bianry app æ²¡æœ‰åŒºåˆ«ï¼Œåº”è¯¥èµ°ä¸€æ¬¡è¿­ä»£å‘å¸ƒçš„æµç¨‹ã€‚</li></ul></li><li>åŠ¨æ€é…ç½®<ul><li>åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦ä¸€äº›åœ¨çº¿çš„å¼€å…³ï¼Œæ¥æ§åˆ¶ä¸šåŠ¡çš„ä¸€äº›ç®€å•ç­–ç•¥ï¼Œä¼šé¢‘ç¹çš„è°ƒæ•´å’Œä½¿ç”¨ï¼Œæˆ‘ä»¬æŠŠè¿™ç±»æ˜¯åŸºç¡€ç±»å‹(int, bool)ç­‰é…ç½®ï¼Œç”¨äºå¯ä»¥åŠ¨æ€å˜æ›´ä¸šåŠ¡æµçš„æ”¶å½’ä¸€èµ·ï¼Œ</li><li>ä¸è¿‡ä¸šåŠ¡é…ç½®æœ€å¥½åšåˆ°ç®¡ç†åå°ï¼Œå› ä¸ºé…ç½®ä¸­å¿ƒè¿è¥åŒå­¦ä¸€èˆ¬æ²¡æœ‰æƒé™ï¼Œå¹¶ä¸”å¾ˆå¤šé…ç½®ä¸­å¿ƒçš„æ ¡éªŒåšçš„ä¸å¤Ÿå¥½ï¼Œä¸ç†Ÿæ‚‰çš„äººè¿›è¡Œå˜æ›´å¾ˆå®¹æ˜“å‡ºé—®é¢˜</li></ul></li><li>å…¨å±€é…ç½®<ul><li>æˆ‘ä»¬ä¾èµ–çš„å„ç±»ç»„ä»¶ã€ä¸­é—´ä»¶éƒ½æœ‰å¤§é‡çš„é»˜è®¤é…ç½®æˆ–è€…æŒ‡å®šé…ç½®ï¼Œåœ¨å„ä¸ªé¡¹ç›®é‡Œå¤§é‡æ‹·è´å¤åˆ¶ï¼Œå®¹æ˜“å‡ºç°æ„å¤–ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å…¨å±€é…ç½®æ¨¡æ¿æ¥å®šåˆ¶åŒ–å¸¸ç”¨çš„ç»„ä»¶ï¼Œç„¶åå†ç‰¹åŒ–çš„åº”ç”¨é‡Œè¿›è¡Œå±€éƒ¨æ›¿æ¢ã€‚</li></ul></li></ul><h2 id="å‡½æ•°å‚æ•°é…ç½®"><a href="#å‡½æ•°å‚æ•°é…ç½®" class="headerlink" title="å‡½æ•°å‚æ•°é…ç½®"></a>å‡½æ•°å‚æ•°é…ç½®</h2><p>ä¸‹é¢è¿™ä¸ªæ˜¯ redis åˆå§‹åŒ–çš„ä¾‹å­ï¼Œä¸€èˆ¬åœ¨æˆ‘ä»¬åˆšåˆšå¼€å§‹å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šå‘ä¸‹é¢è¿™ä¹ˆå†™ï¼ŒæŠŠéœ€è¦çš„å‚æ•°æ”¾åˆ°å‡½æ•°çš„å…¥å‚å°±è¡Œäº†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Dial</span><span class="hljs-params">(network, address <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(Conn, error)</span></span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¦‚æœè¿™ä¸ªå‡½æ•°åªæ˜¯ä½ è‡ªå·±ç”¨ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ¯›ç—…ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå…¬å…±çš„åº“æˆ–è€…æ˜¯ä¸­é—´ä»¶å°±ä¼šå‘ç°ï¼Œç”¨æˆ·çš„è¯‰æ±‚æ˜¯å¤šç§å¤šæ ·ï¼Œçµæ´»å¤šå˜çš„ã€‚å°±ä¼šå¬è§</p><ul><li>æˆ‘è¦è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´</li><li>æˆ‘è¦è‡ªå®šä¹‰ database</li></ul><p>ç­‰ç­‰ä¸€ç³»åˆ—çš„éœ€æ±‚å’Œå„ç§å„æ ·çš„å£°éŸ³ã€‚<br>è¿™æ—¶å€™ä¸ºäº†æ»¡è¶³å¤§å®¶çš„éœ€æ±‚ï¼Œæœ€ç®€å•ï¼Œæœ€ç›´æ¥çš„åšæ³•å°±æ˜¯ï¼Œä¸ºä¸åŒçš„éœ€æ±‚æ·»åŠ ä¸åŒçš„åˆå§‹åŒ–å‡½æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DialTimeout</span><span class="hljs-params">(network, address <span class="hljs-keyword">string</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                 connectTimeout, readTimeout, writeTimeout time.Duration)</span> <span class="hljs-params">(Conn, error)</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DialDatabase</span><span class="hljs-params">(network, address <span class="hljs-keyword">string</span>, database <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(Conn, error)</span></span><br></code></pre></td></tr></table></figure><p>ä½†è¿™æ ·æ¯•ç«Ÿä¸æ˜¯ä¸€ä¸ªåŠæ³•ï¼Œå› ä¸ºç”¨æˆ·çš„éœ€æ±‚æ˜¯æ»¡è¶³ä¸å®Œçš„ï¼Œä½œä¸ºå…¬å…±åº“ï¼Œä¸å¯èƒ½ä¸ºæ¯ä¸ªç”¨æˆ·çš„éœ€æ±‚éƒ½å•ç‹¬æ¥æä¸ªå‡½æ•°ç­¾åï¼Œé‚£è¿™æ ·å‡½æ•°ç­¾åä¹Ÿå¤ªå¤šäº†ã€‚è€Œä¸”è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯å‚æ•°åˆ—è¡¨ä¼šå¾ˆé•¿ï¼Œä¾‹å¦‚ä¸Šé¢çš„ <code>DialTimeout</code> , å¯è¯»æ€§ä¹Ÿä¸å¥½ã€‚<br>å½“ç„¶è¿™ä¹Ÿå’Œ Go çš„å‡½æ•°ä¸èƒ½é‡è½½æœ‰å…³ç³»ï¼Œå¦‚æœå¯ä»¥é‡è½½çš„è¯ï¼Œæ¯ç§éœ€æ±‚æ¥ä¸€ä¸ªå¯èƒ½ä¹Ÿè¿˜è¡Œï¼Œä½†æ˜¯å…¶å®ä¹Ÿä¸å¤Ÿä¼˜é›…ã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„åŠæ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ—¢ç„¶å‚æ•°æ¯”è¾ƒé•¿ï¼Œé…ç½®å˜åŒ–åˆæƒ³è¦çµæ´»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡å°±å¥½äº†ï¼Œè®©æ¯ä¸ªç”¨æˆ·è‡ªå·±æ„é€ å»ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> &#123;<br>  *pool.Config<br>  Addr <span class="hljs-keyword">string</span><br>  Auth <span class="hljs-keyword">string</span><br>  DialTimeout time.Duration<br>  ReadTimeout time.Duration<br>  WriteTimeout time.Duration<br>&#125;<br><br><span class="hljs-comment">// NewConn new a redis conn.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewConn</span><span class="hljs-params">(c *Config)</span> <span class="hljs-params">(cn Conn, err error)</span></span><br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><ul><li>å¯ä»¥çœ‹åˆ° <code>NewConn</code> ä¼ é€’çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆè¿™ä¸ªåªèƒ½å°±èƒ½å¤Ÿè¢«å¤–é¢ä¿®æ”¹ï¼Œåªè¦å¤–é¢ä¿®æ”¹é‚£å°±éº»çƒ¦äº†ï¼Œå› ä¸ºä¸çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè¿™æ˜¯ä¸€ä¸ªæœªå®šä¹‰çš„è¡Œä¸ºã€‚</li><li>è¿˜æœ‰å°±æ˜¯æˆ‘ä»¬æ²¡æœ‰åŠæ³•æŒ‡å®šå¿…å¡«å‚æ•°ï¼Œè¿™æ ·ä¼ é€’ç›¸å½“äºæ¯ä¸€é¡¹éƒ½æ˜¯å¯é€‰çš„</li></ul><p>æ—¢ç„¶æŒ‡é’ˆå¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºï¼Œé‚£æˆ‘ä»¬å°±æ¢ä¸ªæ–¹å¼, ä¸ä¼ æŒ‡é’ˆä¼ ç»“æ„ä½“ä¸å°±è¡Œäº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewConn</span><span class="hljs-params">(c Config)</span> <span class="hljs-params">(cn Conn, err error)</span></span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™åˆå¸¦æ¥äº†ä¸€äº›æ–°çš„é—®é¢˜</p><ul><li>é¦–å…ˆï¼Œå¿…å¡«å‚æ•°çš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³çš„</li><li>å…¶æ¬¡ï¼Œè¿™ä¹ˆä¼ å‚æˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•åŒºåˆ†é»˜è®¤å€¼çš„ï¼Œé€šè¿‡æŒ‡é’ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­æ˜¯å¦ç­‰äº nil æ¥åŒºåˆ†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„åœºæ™¯ä¸‹å…¶å®ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ï¼Œè¿™æ ·åšåè€Œé™ä½äº†ä½¿ç”¨ä½“éªŒ</li></ul><p>æ‰€ä»¥ï¼Œæœ‰ä¸€æ®µæ—¶é—´æ¯›è€å¸ˆä»–ä»¬éƒ½æ˜¯ä½¿ç”¨ä¸Šé¢ä¼ æŒ‡é’ˆçš„è¿™ç§æ–¹å¼ï¼Œå½“ç„¶è¿™ç§æ–¹å¼æˆ‘ä»¬ä¹Ÿç”¨è¿‡ï¼Œè™½ç„¶å¯ä»¥ç”¨ï¼Œä½†æ˜¯å°±æ˜¯æœ‰ç‚¹ä¸çˆ½</p><blockquote><p>â€œI believe that we, as Go programmers, should work hard to ensure that nil is never a parameter that needs to be passed to any public function.â€ â€“ Dave Cheney</p></blockquote><p>dava å¤§ç¥ä¹Ÿæåˆ°è¿‡ï¼Œæˆ‘ä»¬åº”è¯¥å°† nil ä½œä¸ºä¸€ä¸ªå‡½æ•°çš„å‚æ•°å€¼è¿›è¡Œä¼ é€’ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ<br>å¦‚æœå»çœ‹ä¸€äº›çŸ¥åçš„å¼€æºåº“æˆ–è€…æ˜¯æ ‡å‡†åº“çš„ä¸€äº›åˆå§‹åŒ–ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ç§å§¿åŠ¿</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> DialOption <span class="hljs-keyword">struct</span> &#123;<br>  f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*dialOptions)</span></span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Dial</span><span class="hljs-params">(network, address <span class="hljs-keyword">string</span>, options ...DialOption)</span> <span class="hljs-params">(Conn, error)</span></span> &#123;<br>  do := dialOptions&#123;<br>    dial: net.Dial,<br>  &#125;<br>  <span class="hljs-keyword">for</span> _, option := <span class="hljs-keyword">range</span> options &#123;<br>    option.f(&amp;do)<br>  &#125; <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// DialReadTimeout specifies the timeout for reading a single command reply.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DialReadTimeout</span><span class="hljs-params">(d time.Duration)</span> <span class="hljs-title">DialOption</span></span> &#123;<br>	<span class="hljs-keyword">return</span> DialOption&#123;<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(do *dialOptions)</span></span> &#123;<br>		do.readTimeout = d<br>	&#125;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ“ä½œçš„æ ¸å¿ƒåœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæœªå¯¼å‡ºçš„ option struct ç”¨äºå­˜æ”¾é…ç½®ï¼Œç„¶ååˆ°å¤„ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œç„¶åæˆ‘ä»¬åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä½¿ç”¨å¯å˜å‚æ•°è¿›è¡Œä¼ é€’ï¼Œç„¶åå†åˆå§‹åŒ–å‡½æ•°å†…éƒ¨é€šè¿‡ for å¾ªç¯è°ƒç”¨ä¿®æ”¹ç›¸å…³çš„é…ç½®ã€‚</p><ul><li>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠå¿…å¡«å‚æ•°æ”¾åœ¨å‰é¢å‡ ä½ï¼Œä¿è¯å‚æ•°å¿…å¡«ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬</li><li>ç„¶åé»˜è®¤å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨å…ˆåˆå§‹åŒ–ä¸€ä¸ª defaultOption ç„¶åç”¨åé¢é…ç½®çš„å‡½æ•°è¿›è¡Œä¿®æ”¹å³å¯</li></ul><p>æˆ‘ä»¬å¯ä»¥åœ¨åŒ…é‡Œé¢ç›´æ¥å®šä¹‰ä¸€äº›å‡½æ•°ä¾‹å¦‚ä¸Šé¢çš„ <code>DialReadTimeout</code> æ¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè¿›è¡Œé…ç½®ä¿®æ”¹</p><p>ä½†æ˜¯è¿™æ ·å°±å¯ä»¥äº†ä¹ˆï¼Ÿè¿™ç§ä½¿ç”¨æ–¹å¼</p><ul><li>é¦–å…ˆï¼Œå‡½æ•°æŒ‡é’ˆæ²¡æœ‰å¿…è¦æé‚£ä¹ˆéº»çƒ¦ï¼Œå…¶å®ç›´æ¥é¡¶ä¸€ä¸ªå‡½æ•°ç±»å‹å°±å¯ä»¥äº† <code>type DialOption func(*dialOptions)</code></li><li>å…¶æ¬¡ï¼Œè¿™ç§åšæ³•è¿˜æ˜¯åªèƒ½åœ¨åŒ…å†…éƒ¨è¿›è¡Œå®šä¹‰ï¼Œç”¨æˆ·æ˜¯æ²¡æœ‰åŠæ³•è‡ªå®šä¹‰ä¸€äº›é…ç½®çš„ï¼Œä½†æ˜¯å…¶å®ä¹Ÿå¤Ÿç”¨äº†</li></ul><p>å¦‚æœæƒ³è¦ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ä¸€äº›é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ grpc çš„é…ç½®å®šä¹‰ï¼Œä¸»è¦çš„æ€è·¯å°±æ˜¯æŠŠ option ä»å‡½æ•°ä¿®æ”¹æ¥å£ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ª <code>EmptyCallOption</code> å®ç°è¿™ä¸ªæ¥å£ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£åŒ…å«çš„å‡½æ•°æ˜¯æœªå¯¼å‡ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨éœ€è¦åšé…ç½®çš„ struct å½“ä¸­åŒ…å«è¿™ä¸ª <code>EmptyCallOption</code> å°±å¯ä»¥äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> GreeterClient <span class="hljs-keyword">interface</span> &#123;<br>  SayHello(ctx context.Context, in *HelloRequest, opts ...grpc.CallOption)     (*HelloReply, error)<br>&#125;<br><br><span class="hljs-keyword">type</span> CallOption <span class="hljs-keyword">interface</span> &#123;<br>  before(*callInfo) error<br>  after(*callInfo)<br>&#125;<br><span class="hljs-comment">// EmptyCallOption does not alter the Call configuration.</span><br><span class="hljs-keyword">type</span> EmptyCallOption <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-comment">// TimeoutCallOption timeout option.</span><br><span class="hljs-keyword">type</span> TimeoutCallOption <span class="hljs-keyword">struct</span> &#123;<br>  grpc.EmptyCallOption<br>  Timeout time.Duration<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><p>åˆ°è¿™é‡Œå‡½æ•°çš„é…ç½®å°±è§£å†³äº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆå’Œé…ç½®æ–‡ä»¶è¿›è¡Œç»“åˆå‘¢ï¼Ÿç°åœ¨çš„è¿™ç§åšæ³•éšè—äº†ç»“æ„ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥ä½¿ç”¨ <code>json.Unmarshal</code> è¿™ç§æ–¹æ³•ç›´æ¥ååºåˆ—åŒ–å›æ¥ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„åŠæ³•å°±æ˜¯æˆ‘ä»¬è®¾å®šä¸¤ä¸ªå‡½æ•°å¦‚æœéœ€è¦é…ç½®æ–‡ä»¶ååºåˆ—åŒ–çš„å°±ç”¨ä¸å¸¦ Option çš„ï¼Œåä¹‹ç”¨å¸¦ Option çš„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Dial</span><span class="hljs-params">(network, address <span class="hljs-keyword">string</span>, options ...DialOption)</span> <span class="hljs-params">(Conn, error)</span></span><br><br><span class="hljs-comment">// NewConn new a redis conn.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewConn</span><span class="hljs-params">(c *Config)</span> <span class="hljs-params">(cn Conn, err error)</span></span><br></code></pre></td></tr></table></figure><p>è¿™ä¹ˆåšæ¯”è¾ƒå¤§çš„é—®é¢˜å°±æ˜¯ï¼ŒæŠŠ config ç»™æš´éœ²äº†å‡ºæ¥ï¼Œå¹¶ä¸”æœ‰ä¸¤ç§åˆå§‹åŒ–æ–¹å¼ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶å°±æ²¡æœ‰åŠæ³•å¾—åˆ°ä½¿ç”¨ Option çš„å¥½å¤„äº†</p><p>è¯¾ä¸Šæä¾›äº†ä¸€ç§è§£å†³æ€è·¯å°±æ˜¯æŠŠè¿™ä¸¤æ­¥è¿›è¡Œåˆ†ç¦»ï¼Œé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ protobuf æ–‡ä»¶å®šä¹‰å¥½é…ç½®çš„ç»“æ„ï¼Œè¿™æ ·å¯ä»¥åŠ ä¸Šä¸€äº›éªŒè¯æ¡ä»¶</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;google/protobuf/duration.proto&quot;</span>;<br><span class="hljs-keyword">package</span> config.redis.v1;<br><span class="hljs-comment">// redis config.</span><br><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">redis</span> </span>&#123;<br>  <span class="hljs-built_in">string</span> network = <span class="hljs-number">1</span>;<br>  <span class="hljs-built_in">string</span> address = <span class="hljs-number">2</span>;<br>  <span class="hljs-built_in">int32</span> database = <span class="hljs-number">3</span>;<br>  <span class="hljs-built_in">string</span> password = <span class="hljs-number">4</span>;<br>  google.protobuf.Duration read_timeout = <span class="hljs-number">5</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰å¥½ä¹‹åä½¿ç”¨ yaml æ¥ä¿®æ”¹é…ç½®ï¼Œç„¶åä½¿ç”¨ <code>Options</code> æ–¹æ³•ï¼Œå°† protobuf ç”Ÿæˆçš„ <code>Config</code> æ›¿æ¢ä¸º redis.Options</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ApplyYAML</span><span class="hljs-params">(s *redis.Config, yml <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<br>  js, err := yaml.YAMLToJSON([]<span class="hljs-keyword">byte</span>(yml))<br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    <span class="hljs-keyword">return</span> err<br>  &#125;<br>  <span class="hljs-keyword">return</span> ApplyJSON(s, <span class="hljs-keyword">string</span>(js))<br>&#125;<br><span class="hljs-comment">// Options apply config to options.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Options</span><span class="hljs-params">(c *redis.Config)</span> []<span class="hljs-title">redis</span>.<span class="hljs-title">Options</span></span> &#123;<br>  <span class="hljs-keyword">return</span> []redis.Options&#123;<br>    redis.DialDatabase(c.Database),<br>    redis.DialPassword(c.Password),<br>    redis.DialReadTimeout(c.ReadTimeout),<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼é™¤äº†å®šä¹‰èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä½¿ç”¨ä¸Šè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½¿ç”¨åªéœ€è¦åƒä¸‹é¢è¿™æ ·å°±å¯ä»¥äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-comment">// load config file from yaml.</span><br>  c := <span class="hljs-built_in">new</span>(redis.Config)<br>  _ = ApplyYAML(c, loadConfig())<br>  r, _ := redis.Dial(c.Network, c.Address, Options(c)...)<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œç»Ÿä¸€æ¥å…¥äº†é…ç½®ä¸­å¿ƒï¼Œæ‰€ä»¥æˆ‘ç°åœ¨çš„åšæ³•æ˜¯å®šä¹‰ä¸€ä¸ª <code>WithConfigCenter</code> çš„æ–¹æ³•å°±è¡Œäº†ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®è¿˜è¦ç®€å•ä¸€ç‚¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithConfigCenter</span><span class="hljs-params">(config ConfigCenter, key <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Option</span></span><br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¿®æ”¹é…ç½®å…¶å®æ˜¯ä¸€ä»¶æ¯”è¾ƒå±é™©çš„äº‹æƒ…ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç¼ºä¹è¶³å¤Ÿçš„æ•¬ç•ï¼Œå› ä¸ºç°åœ¨åœ¨çº¿çš„é…ç½®ä¸­å¿ƒè¶Šæ¥æ–¹ä¾¿ï¼Œæ‰€ä»¥ä¿®æ”¹çš„æˆæœ¬è¶Šæ¥è¶Šä½ï¼Œå¤§å®¶å°±è¶Šæ¥è¶Šéšæ„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹é…ç½®çš„ä¿®æ”¹æ…é‡ä¸€äº›ã€‚é…ç½®çš„ç›®æ ‡ï¼š</p><ul><li>é¿å…å¤æ‚</li><li>å¤šæ ·çš„é…ç½®</li><li>ç®€å•åŒ–åŠªåŠ›</li><li>ä»¥åŸºç¡€è®¾æ–½ -&gt; é¢å‘ç”¨æˆ·è¿›è¡Œè½¬å˜</li><li>é…ç½®çš„å¿…é€‰é¡¹å’Œå¯é€‰é¡¹</li><li>é…ç½®çš„é˜²å¾¡ç¼–ç¨‹</li><li>æƒé™å’Œå˜æ›´è·Ÿè¸ª</li><li>é…ç½®çš„ç‰ˆæœ¬å’Œåº”ç”¨å¯¹é½ï¼Œè¿™ä¸ªå¾ˆå¤šéƒ½æ²¡åšåˆ°ï¼Œç»å¸¸åº”ç”¨å›æ»šäº†é…ç½®æ²¡å›æ»šï¼Œå°±å‡ºäº‹æ•…äº†</li><li>å®‰å…¨çš„é…ç½®å˜æ›´ï¼šé€æ­¥éƒ¨ç½²ã€å›æ»šæ›´æ”¹ã€è‡ªåŠ¨å›æ»š</li></ul><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li><a target="_blank" rel="noopener" href="https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;utm_medium=lailin.xyz">Go è¿›é˜¶è®­ç»ƒè¥-æå®¢æ—¶é—´</a></li><li><a target="_blank" rel="noopener" href="https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html">command center: Self-referential functions and the design of options</a></li><li><a target="_blank" rel="noopener" href="https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis">Functional options for friendly APIs â€“ The acme of foolishness</a></li></ol><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSSï¼Œä¹Ÿå¯ä»¥ç‚¹å‡»é¦–é¡µé€šè¿‡ webpush è®¢é˜…æµè§ˆå™¨æ¶ˆæ¯é€šçŸ¥</li><li><a target="_blank" rel="noopener" href="https://github.com/mohuishou">Github</a> Follow me</li><li><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/mo-hui-shou-76">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a target="_blank" rel="noopener" href="https://toutiao.io/subjects/387401?f=new">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week4-go-module.html">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</a></li><li><a href="https://lailin.xyz/post/go-training-week4-protoc-gen-go-gin.html">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </a></li><li><a href="https://lailin.xyz/post/go-training-week4-api-design.html">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ & è®¾è®¡</a></li></ul></div></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">Goè¿›é˜¶è®­ç»ƒè¥</a> <a class="hover-with-bg" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Week04-Go-%E5%B7%A5%E7%A8%8B%E5%8C%96/">Week04: Go å·¥ç¨‹åŒ–</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a> <a class="hover-with-bg" href="/tags/Go/">Go</a> <a class="hover-with-bg" href="/tags/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">Goè¿›é˜¶è®­ç»ƒè¥</a> <a class="hover-with-bg" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/">å·¥ç¨‹åŒ–</a></div></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œç¦æ­¢å…¨æ–‡è½¬è½½</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/post/go-training-week4-go-module.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/post/go-training-week4-protoc-gen-go-gin.html"><span class="hidden-mobile">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><script type="text/javascript">Fluid.utils.waitElementVisible("comments",function(){var t="github-light",e="github-dark",s="dark"===(s=document.documentElement.getAttribute("data-user-color-scheme"))?e:t;window.UtterancesThemeLight=t,window.UtterancesThemeDark=e;e=document.createElement("script");e.setAttribute("src","https://utteranc.es/client.js"),e.setAttribute("repo","scuplus/blogComment"),e.setAttribute("issue-term","pathname"),e.setAttribute("label","utterances"),e.setAttribute("theme",s),e.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(e)})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div class="toc-body" id="toc-body"></div></div></div></div><div id="bottom"><div id="bottom-drawer" class="bottom-drawer"><div class="sidebar"><p class="sidebar-header">Goè¿›é˜¶è®­ç»ƒè¥</p><div class="sidebar-body" id="sidebar-body"><ol class="sidebar-list sidebar-list-1"><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23xho0000m4t51q602czj").classList.toggle("sidebar-is-collapsed")'>Week01: å¾®æœåŠ¡</a><ol id="sidebar-ckkm23xho0000m4t51q602czj" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-01.html">å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-02.html">å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&amp;å¤šç§Ÿæˆ·</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23ykh0003m4t53mln1w0n").classList.toggle("sidebar-is-collapsed")'>Week02: Goé”™è¯¯å¤„ç†</a><ol id="sidebar-ckkm23ykh0003m4t53mln1w0n" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-03.html">Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm2667n000pm4t52z016wn0").classList.toggle("sidebar-is-collapsed")'>Week03: Go å¹¶å‘ç¼–ç¨‹</a><ol id="sidebar-ckkm2667n000pm4t52z016wn0" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-goroutine.html">Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-go-memory-model.html">Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-data-race.html">Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sync.html">Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-atomic.html">Goå¹¶å‘ç¼–ç¨‹(äº”) æ·±å…¥ç†è§£ sync/atomic</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-waitgroup.html">Goå¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-errgroup.html">Goå¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-once.html">Goå¹¶å‘ç¼–ç¨‹(å…«) æ·±å…¥ç†è§£ sync.Once</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-context.html">Goå¹¶å‘ç¼–ç¨‹(ä¹) æ·±å…¥ç†è§£ Context</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-channel.html">Goå¹¶å‘ç¼–ç¨‹(å) æ·±å…¥ç†è§£ Channel</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sum.html">Goå¹¶å‘ç¼–ç¨‹(åä¸€) æ€»ç»“</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23zra000im4t5en8m0qy9").classList.toggle("sidebar-is-collapsed")'>Week04: Go å·¥ç¨‹åŒ–</a><ol id="sidebar-ckkm23zra000im4t5en8m0qy9" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-clean-arch.html">Goå·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®°</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-project-layout.html">Goå·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-wire.html">Goå·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-api-design.html">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ &amp; è®¾è®¡</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-protoc-gen-go-gin.html">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </a></li><li class="sidebar-list-item is-active-li"><a class="sidebar-link sidebar-active-link" href="/post/go-training-week4-config.html">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-go-module.html">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</a></li></ol></li></ol></div></div><div id="toc-mobile"><div class="toc-body" id="toc-body-mobile"></div></div></div><div id="bottom-tab"><a class="sub-menu" onclick='showBottomDrawer(this,"#bottom-drawer .sidebar")'><i class="iconfont"></i> ç« èŠ‚ </a><a class="sub-menu" onclick='showBottomDrawer(this,"#bottom-drawer #toc-mobile")'><i class="iconfont"></i> ç›®å½• </a><a href="#comments" class="sub-menu" onclick='showBottomDrawer(this,"#comments")'><i class="iconfont"></i> è¯„è®º</a></div></div><script>function showBottomDrawer(s,t){let e=document.querySelector("#bottom-tab");e.childNodes.forEach(t=>{t!=s&&t.classList&&t.classList.remove("active")}),"#comments"!=t&&s.classList.toggle("active");let o=document.querySelector("#bottom-drawer"),c=document.querySelector(t);o.childNodes.forEach(t=>{t!=c&&t.classList&&t.classList.remove("active")}),c.classList.toggle("active"),"#comments"!=t?(c.classList.contains("active")&&!o.classList.contains("active")&&o.classList.add("active"),!c.classList.contains("active")&&o.classList.contains("active")&&o.classList.remove("active")):o.classList.remove("active")}document.onreadystatechange=function(t){0!=$("#bottom-drawer").height&&window.tocbot.init({tocSelector:"#toc-body-mobile",contentSelector:".markdown-body",headingSelector:"h1,h2,h3,h4",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:20})}</script></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-x-md"><div class="container custom mx-auto"><script>!function(e,s,p){var r;void 0===e.webpushr&&(e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)},r=s.getElementsByTagName(p)[0],(p=s.createElement(p)).id="webpushr-jssdk",p.async=1,p.src="https://cdn.webpushr.com/app.min.js",r.parentNode.appendChild(p))}(window,document,"script"),webpushr("setup",{key:"BBkZb7rpvsVqVNkORXD9T9T93MJodtpNJD5c1f2HE_XsED3r94An3CKObdyTJ6ub3ARm9LIdeDCVzKLBsK760NM"})</script></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/debouncer-c523e4d3f8b7b837c19f74984acbabf7.js"></script><script src="/js/events-f495e9aefe2285fc712ba316bdf01b26.js"></script><script src="/js/plugins-93fa930e12b7596433529edc1b5458df.js"></script><script src="/js/lazyload-e96b3165477d429bf8096bdbd068d816.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script><script>!function(t){(0,Fluid.plugins.typing)(t.getElementById("subtitle").title)}((window,document))</script><script src="/js/local-search-c277a106ee2a2e265fcd58887e53c0fb.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-137859264-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script>let sidebarBody=document.querySelector(".sidebar .sidebar-body"),sidebarActive=document.querySelector(".sidebar .is-active-li"),bc=sidebarBody.getBoundingClientRect(),ac=sidebarActive.getBoundingClientRect(),t=ac.y-bc.y-bc.height/2;0<t&&sidebarBody.scrollTo({top:t,behavior:"smooth"})</script><script src="/js/boot-b4d619350e67f5b3ceeb2164d30268e0.js"></script></body></html>