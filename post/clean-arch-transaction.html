<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/icons/touch-icon-apple.png"><link rel="icon" href="/icons/favicon-32x32.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="åœ¨ä¸ŠåŠå¹´å·¥ç¨‹åŒ–ç›¸å…³çš„æ–‡ç« å½“ä¸­æåˆ°äº†æˆ‘æœ€ç»ˆé€‰ç”¨çš„åŸºäºæ•´æ´æ¶æ„çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Œä½†æ˜¯äº‹åŠ¡é—®é¢˜ä¸€ç›´æ²¡æœ‰æ¯”è¾ƒæ¸…æ™°çš„æ€è·¯ï¼Œä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸€äº›ä¸æˆç†Ÿçš„å°å»ºè®®"><meta name="author" content="Mohuishou"><meta name="keywords" content="Go,Docker,PHP"><meta name="description" content="åœ¨ä¸ŠåŠå¹´å·¥ç¨‹åŒ–ç›¸å…³çš„æ–‡ç« å½“ä¸­æåˆ°äº†æˆ‘æœ€ç»ˆé€‰ç”¨çš„åŸºäºæ•´æ´æ¶æ„çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Œä½†æ˜¯äº‹åŠ¡é—®é¢˜ä¸€ç›´æ²¡æœ‰æ¯”è¾ƒæ¸…æ™°çš„æ€è·¯ï¼Œä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸€äº›ä¸æˆç†Ÿçš„å°å»ºè®®"><meta property="og:type" content="article"><meta property="og:title" content="Go å·¥ç¨‹åŒ–(å) å¦‚ä½•åœ¨æ•´æ´æ¶æ„ä¸­ä½¿ç”¨äº‹åŠ¡?"><meta property="og:url" content="https://lailin.xyz/post/clean-arch-transaction.html"><meta property="og:site_name" content="Mohuishou"><meta property="og:description" content="åœ¨ä¸ŠåŠå¹´å·¥ç¨‹åŒ–ç›¸å…³çš„æ–‡ç« å½“ä¸­æåˆ°äº†æˆ‘æœ€ç»ˆé€‰ç”¨çš„åŸºäºæ•´æ´æ¶æ„çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Œä½†æ˜¯äº‹åŠ¡é—®é¢˜ä¸€ç›´æ²¡æœ‰æ¯”è¾ƒæ¸…æ™°çš„æ€è·¯ï¼Œä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸€äº›ä¸æˆç†Ÿçš„å°å»ºè®®"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lailin.xyz/notion_images/e2db534deab367b9312304cf4aab6cd5.png"><meta property="article:published_time" content="2021-12-23T16:00:00.000Z"><meta property="article:modified_time" content="2022-04-21T12:56:24.106Z"><meta property="article:author" content="Mohuishou"><meta property="article:tag" content="go"><meta property="article:tag" content="å·¥ç¨‹å®è·µ"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://lailin.xyz/notion_images/e2db534deab367b9312304cf4aab6cd5.png"><title>Go å·¥ç¨‹åŒ–(å) å¦‚ä½•åœ¨æ•´æ´æ¶æ„ä¸­ä½¿ç”¨äº‹åŠ¡? - Mohuishou</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main-c1a2ba48b1cbfbb102870f1f7fdc6af7.css"><link rel="stylesheet" href="/assets/css/custom-20b83bcc6d190c466b14490ddfd6fab4.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"lailin.xyz",root:"/",version:"1.8.12",typing:{enable:!1,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:null,google:"UA-137859264-1",gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"}</script><script src="/js/utils-10734676b63578b88b4b8e46ef525a20.js"></script><script src="/js/color-schema-1e146e57667997eb91b1ed8f419f9e22.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>mohuishou</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> Go ç³»åˆ—</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/"><i class="iconfont icon-category-fill"></i> Go è¿›é˜¶è®­ç»ƒè¥(æ›´æ–°ä¸­) </a><a class="dropdown-item" href="/post/list.html"><i class="iconfont icon-notebook"></i> Go æ•°æ®ç»“æ„ä¸ç®—æ³•(æ›´æ–°ä¸­) </a><a class="dropdown-item" href="/post/go-design-pattern.html"><i class="iconfont icon-notebook"></i> Go è®¾è®¡æ¨¡å¼</a></div></li><li class="nav-item"><a class="nav-link" href="/post/operator-01-overview.html"><i class="iconfont icon-category-fill"></i> kubernetes ç³»åˆ—</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> æ›´å¤š</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾ </a><a class="dropdown-item" href="/atom.xml"><i class="iconfont icon-rss"></i> rss </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/img/bg.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Go å·¥ç¨‹åŒ–(å) å¦‚ä½•åœ¨æ•´æ´æ¶æ„ä¸­ä½¿ç”¨äº‹åŠ¡?">Go å·¥ç¨‹åŒ–(å) å¦‚ä½•åœ¨æ•´æ´æ¶æ„ä¸­ä½¿ç”¨äº‹åŠ¡?</span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-12-24 00:00" pubdate>2021å¹´12æœˆ24æ—¥ å‡Œæ™¨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 6.2k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 52 åˆ†é’Ÿ</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2 post-categories"><div class="category-list"><div class="category row"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-5635160ef7307ccb3bfb116a87b12b17" role="tab" data-toggle="collapse" href="#collapse-5635160ef7307ccb3bfb116a87b12b17" aria-expanded="true">Goè¿›é˜¶è®­ç»ƒè¥(34) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-5635160ef7307ccb3bfb116a87b12b17" role="tabpanel" aria-labelledby="heading-5635160ef7307ccb3bfb116a87b12b17"><div class="category-post-list"></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-a41dee97aac19be1190166bbb774caae" role="tab" data-toggle="collapse" href="#collapse-a41dee97aac19be1190166bbb774caae" aria-expanded="false">Week01: å¾®æœåŠ¡(2) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-a41dee97aac19be1190166bbb774caae" role="tabpanel" aria-labelledby="heading-a41dee97aac19be1190166bbb774caae"><div class="category-post-list"><a href="/post/go-training-01.html" class="list-group-item list-group-item-action"><span class="category-post">å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</span> </a><a href="/post/go-training-02.html" class="list-group-item list-group-item-action"><span class="category-post">å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&amp;å¤šç§Ÿæˆ·</span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-d164da313d64fe1286b62ba12ecff46b" role="tab" data-toggle="collapse" href="#collapse-d164da313d64fe1286b62ba12ecff46b" aria-expanded="false">Week02: Goé”™è¯¯å¤„ç†(1) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-d164da313d64fe1286b62ba12ecff46b" role="tabpanel" aria-labelledby="heading-d164da313d64fe1286b62ba12ecff46b"><div class="category-post-list"><a href="/post/go-training-03.html" class="list-group-item list-group-item-action"><span class="category-post">Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-f10a23eef212070a176eed5d79b6d6ba" role="tab" data-toggle="collapse" href="#collapse-f10a23eef212070a176eed5d79b6d6ba" aria-expanded="false">Week03: Go å¹¶å‘ç¼–ç¨‹(12) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-f10a23eef212070a176eed5d79b6d6ba" role="tabpanel" aria-labelledby="heading-f10a23eef212070a176eed5d79b6d6ba"><div class="category-post-list"><a href="/post/go-training-week3-goroutine.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</span> </a><a href="/post/go-training-week3-go-memory-model.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</span> </a><a href="/post/go-training-week3-data-race.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</span> </a><a href="/post/go-training-week3-sync.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</span> </a><a href="/post/go-training-week3-atomic.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(äº”) æ·±å…¥ç†è§£ sync/atomic</span> </a><a href="/post/go-training-week3-waitgroup.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup</span> </a><a href="/post/go-training-week3-errgroup.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup</span> </a><a href="/post/go-training-week3-once.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å…«) æ·±å…¥ç†è§£ sync.Once</span> </a><a href="/post/go-training-week3-context.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¹) æ·±å…¥ç†è§£ Context</span> </a><a href="/post/go-training-week3-channel.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å) æ·±å…¥ç†è§£ Channel</span> </a><a href="/post/go-training-week3-sum.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(åä¸€) æ€»ç»“</span> </a><a href="/post/go-training-week5-singleflight.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(åäºŒ) Singleflight</span></a></div></div></div><div class="category-sub row"><a class="category-subitem list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-5f1c09a879adce524fb674e873d85f0d" role="tab" data-toggle="collapse" href="#collapse-5f1c09a879adce524fb674e873d85f0d" aria-expanded="true">Week04: Go å·¥ç¨‹åŒ–(11) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-5f1c09a879adce524fb674e873d85f0d" role="tabpanel" aria-labelledby="heading-5f1c09a879adce524fb674e873d85f0d"><div class="category-post-list"><a href="/post/go-training-week4-clean-arch.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®°</span> </a><a href="/post/go-training-week4-project-layout.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„</span> </a><a href="/post/go-training-week4-wire.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire</span> </a><a href="/post/go-training-week4-api-design.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ &amp; è®¾è®¡</span> </a><a href="/post/go-training-week4-protoc-gen-go-gin.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </span> </a><a href="/post/go-training-week4-config.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</span> </a><a href="/post/go-training-week4-go-module.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</span> </a><a href="/post/go-training-week4-unit-test.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•</span> </a><a href="/post/go-training-week4-practice.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¹) é¡¹ç›®é‡æ„å®è·µ</span> </a><a href="/post/clean-arch-transaction.html" class="list-group-item list-group-item-action active"><span class="category-post">Go å·¥ç¨‹åŒ–(å) å¦‚ä½•åœ¨æ•´æ´æ¶æ„ä¸­ä½¿ç”¨äº‹åŠ¡?</span> </a><a href="/post/graceful-repo-code.html" class="list-group-item list-group-item-action"><span class="category-post">Go å·¥ç¨‹åŒ–(åä¸€) å¦‚ä½•ä¼˜é›…çš„å†™å‡º repo å±‚ä»£ç </span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-edde40ce71fea3216c3528e70a2f78d3" role="tab" data-toggle="collapse" href="#collapse-edde40ce71fea3216c3528e70a2f78d3" aria-expanded="false">Week05: è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡(1) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-edde40ce71fea3216c3528e70a2f78d3" role="tabpanel" aria-labelledby="heading-edde40ce71fea3216c3528e70a2f78d3"><div class="category-post-list"><a href="/post/go-training-week5-comment-design-1.html" class="list-group-item list-group-item-action"><span class="category-post">è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡</span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-9e5f96df977f309449649723b9fb267c" role="tab" data-toggle="collapse" href="#collapse-9e5f96df977f309449649723b9fb267c" aria-expanded="false">Week06: å¾®æœåŠ¡å¯ç”¨æ€§è®¾è®¡(7) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-9e5f96df977f309449649723b9fb267c" role="tabpanel" aria-labelledby="heading-9e5f96df977f309449649723b9fb267c"><div class="category-post-list"><a href="/post/go-training-week6-usability-1-bulkhe.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(ä¸€) éš”ç¦»è®¾è®¡</span> </a><a href="/post/go-training-week6-2-token-bucket-1.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(äºŒ) ä»¤ç‰Œæ¡¶åŸç†åŠä½¿ç”¨</span> </a><a href="/post/go-training-week6-3-token-bucket-2.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(ä¸‰) ä»¤ç‰Œæ¡¶çš„å®ç° rate/limt</span> </a><a href="/post/go-training-week6-4-leaky-bucket.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(å››) æ¼æ¡¶ç®—æ³•</span> </a><a href="/post/go-training-week6-4-auto-limiter.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(äº”) è‡ªé€‚åº”é™æµ</span> </a><a href="/post/go-training-week6-6-breaker.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(å…­) ç†”æ–­</span> </a><a href="/post/go-training-week6-7-summary.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(ä¸ƒ) æ€»ç»“: ä¸€å¼ å›¾ä¸²è”å¯ç”¨æ€§çŸ¥è¯†ç‚¹</span></a></div></div></div></div></div></div></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Go å·¥ç¨‹åŒ–(å) å¦‚ä½•åœ¨æ•´æ´æ¶æ„ä¸­ä½¿ç”¨äº‹åŠ¡?</h1><div class="markdown-body"><div class="note note-info"><p>æ³¨ï¼šæœ¬æ–‡æ‰€æœ‰ç¤ºä¾‹ä»£ç éƒ½å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/mohuishou/blog-code">blog-code</a> ä»“åº“ä¸­æ‰¾åˆ°</p></div><div class="note note-info"><p>æœ¬ç³»åˆ—ä¸º Go è¿›é˜¶è®­ç»ƒè¥ ç¬”è®°ï¼Œé¢„è®¡ 2021Q2 å®Œæˆæ›´æ–°ï¼Œè®¿é—® <a href="https://lailin.xyz/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">åšå®¢: Goè¿›é˜¶è®­ç»ƒè¥</a>, å³å¯æŸ¥çœ‹å½“å‰æ›´æ–°è¿›åº¦ï¼Œéƒ¨åˆ†æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œä½¿ç”¨ PC å¤§å±æµè§ˆä½“éªŒæ›´ä½³ã€‚</p></div><aside><p><img class="emoji" draggable="false" alt="ğŸ„" src="https://twemoji.maxcdn.com/v/13.1.0/72x72/1f384.png" srcset="/img/loading.gif" lazyload> åœ£è¯å¿«ä¹! è·ç¦»ä¸Šæ¬¡æ›´æ–°é¡¹ç›®ç»“æ„ç›¸å…³çš„æ–‡ç« å·²ç»å¤§åŠå¹´äº†ï¼Œå›è¿‡å¤´æ¥å®Œå–„ä¸€äº›ç»†èŠ‚</p></aside><aside><p><img class="emoji" draggable="false" alt="ğŸ’¡" src="https://twemoji.maxcdn.com/v/13.1.0/72x72/1f4a1.png" srcset="/img/loading.gif" lazyload> 2021/04/21 æ›´æ–°: æ–°å¢äº‹åŠ¡å•æµ‹æ–¹æ³•ï¼Œè¯„è®ºåŒºæœ‰æœ‹å‹è¯¢é—®å¦‚ä½•å¯¹äº‹åŠ¡æ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥æ‹‰åˆ°æœ¬æ–‡çš„æœ€ä¸‹æ–¹</p></aside><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>å…ˆç®€å•å›é¡¾ä¸€ä¸‹ <a href="https://lailin.xyz/post/go-training-week4-practice.html">ã€Š<strong>Goå·¥ç¨‹åŒ–(ä¹) é¡¹ç›®é‡æ„å®è·µ</strong>ã€‹</a> å¦‚æœè¿˜æ²¡çœ‹è¿‡ä¹‹å‰è¿™ç¯‡æ–‡ç« å¯ä»¥å…ˆçœ‹ä¸€ä¸‹</p><p><img src="/notion_images/805635522d5562315f675cdb4153ee69.png" srcset="/img/loading.gif" lazyload></p><p>åœ¨æˆ‘ä»¬ä¹‹å‰çš„é¡¹ç›®ç›®å½•åˆ†å±‚ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦åˆ†ä¸ºäº†äº”ä¸ªå—</p><ul><li><code>cmd/appname</code> æ˜¯æˆ‘ä»¬æœåŠ¡çš„å…¥å£ï¼Œåªè´Ÿè´£å¯åŠ¨å’Œä¾èµ–æ³¨å…¥ï¼ˆä½¿ç”¨ Wireï¼‰</li><li><code>domain</code> æˆ–è€… <code>model</code> æ˜¯æˆ‘ä»¬çš„å®ä½“å®šä¹‰ + æ¥å£å®šä¹‰</li><li><code>server</code> è´Ÿè´£å®ç°æˆ‘ä»¬åœ¨ proto ä¸­å®šä¹‰çš„æ¥å£ï¼Œåœ¨è¿™ä¸€å±‚ä¸­æˆ‘ä»¬åªåšæ•°æ®è½¬æ¢ï¼Œä¸å†™ä¸šåŠ¡é€»è¾‘</li><li><code>usecase</code> è´Ÿè´£å®ç°æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘</li><li><code>repo</code> è´Ÿè´£æ•°æ®æ“ä½œï¼Œ ä»…åšæ•°æ®æ“ä½œï¼Œä¸å®ç°ä¸šåŠ¡é€»è¾‘</li></ul><p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä»…ä»…æåˆ°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ç¤ºä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…ä¸šåŠ¡æµç¨‹å¾€å¾€æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œå°±ä¸€ä¸ªéå¸¸å¸¸è§çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦åˆ›å»ºä¸€ç¯‡æ–‡ç« ï¼Œæ–‡ç« ä¸Šéœ€è¦å…³è”åˆ†ç±»æˆ–è€…æ˜¯æ ‡ç­¾ä¿¡æ¯ï¼Œè¿™é‡Œè‡³å°‘å°±åˆ†ä¸¤æ­¥</p><ul><li>åˆ›å»ºæ–‡ç« </li><li>å…³è”æ–‡ç« å’Œæ ‡ç­¾</li></ul><p>è¿™ä¸¤ä¸ªåˆ›å»ºæ“ä½œéœ€è¦ä¿è¯ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨äº‹åŠ¡ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„äº‹åŠ¡åœ¨å“ªé‡Œæ‰¿è½½å‘¢ï¼Ÿ</p><h2 id="åœ¨-repo-å±‚æ‰¿è½½äº‹åŠ¡"><a href="#åœ¨-repo-å±‚æ‰¿è½½äº‹åŠ¡" class="headerlink" title="åœ¨ repo å±‚æ‰¿è½½äº‹åŠ¡"></a>åœ¨ repo å±‚æ‰¿è½½äº‹åŠ¡</h2><p>å…¶ä¸­æœ€ç®€å•ä¹Ÿæœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯åœ¨ repo çš„ <code>CreateArticle</code> æ–¹æ³•ä¸­æˆ‘ä»¬å°±ä½¿ç”¨äº‹åŠ¡å»åŒæ—¶åˆ›å»ºæ–‡ç« ä»¥åŠæ ‡ç­¾ä¹‹é—´çš„å…³è”å…³ç³»ã€‚</p><ul><li>æˆ‘ä»¬ä¸æ˜¯æ‰€æœ‰çš„ä¸šåŠ¡åœºæ™¯éƒ½éœ€è¦å…³è”åˆ›å»ºï¼Œæœ‰çš„åœºæ™¯ä¸‹æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå•çº¯çš„æ–¹æ³•åˆæ€ä¹ˆåŠå‘¢ï¼Ÿ</li><li>è¿™ä¹ˆå†™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æŠŠä¸šåŠ¡é€»è¾‘ä¸‹æ²‰åˆ°äº† repo ä¸­ï¼Œåé¢æˆ‘ä»¬è¿˜æœ‰å…¶å®ƒå…³è”ä¹Ÿè¿™ä¹ˆæä¹ˆï¼Ÿ</li></ul><p>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯æˆ‘ä»¬æä¾›ä¸€ä¸ª <code>CreateArticleWithTags</code> æ–¹æ³•è¡¨ç¤ºåŒæ—¶åˆ›å»ºè¿™ä¸¤è€…ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„ <code>CreateArticle</code> å†å†™ä¸€ä¸ªå°±å¥½äº†ã€‚</p><p>ä½†æ˜¯éšç€éœ€æ±‚è¶Šæ¥è¶Šå¤šï¼Œå¯èƒ½åé¢è¿˜æœ‰éœ€è¦å’Œè§’è‰²å…³è”çš„ï¼Œå’Œå•†å“å…³è”çš„ç­‰ç­‰</p><ul><li>éš¾é“æˆ‘ä»¬å°±ä¸€ç§é€»è¾‘å†™ä¸€ä¸ªæ–¹æ³•ä¹ˆã€‚æƒ³æƒ³å°±å¯æ€•</li><li>è¿˜æ˜¯åœ¨å‚æ•°ä¸­åŠ ä¸Šå¾ˆå¤šå¯é€‰çš„ optionsï¼Œç„¶ååœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ä¸æ–­åˆ¤æ–­ã€‚é‚£æˆ‘ä»¬è¿˜æ‹¿ usecase åšä»€ä¹ˆç›´æ¥å†™ä¸€èµ·ä¸æ›´å¥½ä¹ˆï¼Ÿ</li></ul><h2 id="åœ¨-usecase-å±‚æ‰¿è½½äº‹åŠ¡"><a href="#åœ¨-usecase-å±‚æ‰¿è½½äº‹åŠ¡" class="headerlink" title="åœ¨ usecase å±‚æ‰¿è½½äº‹åŠ¡"></a>åœ¨ usecase å±‚æ‰¿è½½äº‹åŠ¡</h2><p>okï¼Œæ‰€ä»¥ç›´æ¥åœ¨ repo å±‚é‡Œé¢æ¥å®ç°çœ‹ä¸Šå»å¥½åƒè¡Œä¸é€šï¼Œé‚£æˆ‘ä»¬å°±æŠŠè§†çº¿å¾€ä¸Šç§»åŠ¨ï¼Œæˆ‘ä»¬åœ¨ usecase æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p>äº‹åŠ¡çš„èƒ½åŠ›æ˜¯åœ¨ repo ä¸Šæä¾›çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ repo å±‚æä¾›ä¸€ä¸ªäº‹åŠ¡æ¥å£ï¼Œç„¶ååœ¨ usecase ä¸­è¿›è¡Œè°ƒç”¨ï¼Œä¿è¯æ˜¯äº‹åŠ¡æ‰§è¡Œçš„å°±è¡Œ</p><h3 id="ä½¿ç”¨-repo-å±‚æä¾›çš„äº‹åŠ¡æ¥å£"><a href="#ä½¿ç”¨-repo-å±‚æä¾›çš„äº‹åŠ¡æ¥å£" class="headerlink" title="ä½¿ç”¨ repo å±‚æä¾›çš„äº‹åŠ¡æ¥å£"></a>ä½¿ç”¨ repo å±‚æä¾›çš„äº‹åŠ¡æ¥å£</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// domain/article.go</span><br><br><span class="hljs-comment">// ArticleRepoTxFunc äº‹åŠ¡æ–¹æ³•</span><br><span class="hljs-keyword">type</span> ArticleRepoTxFunc = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, repo IArticleRepo)</span> <span class="hljs-title">error</span></span><br><br><span class="hljs-comment">// IArticleRepo IArticleRepo</span><br><span class="hljs-keyword">type</span> IArticleRepo <span class="hljs-keyword">interface</span> &#123;<br>	Tx(ctx context.Context, f ArticleRepoTxFunc) error<br>	GetArticle(ctx context.Context, id <span class="hljs-keyword">int</span>) (*Article, error)<br>	CreateArticle(ctx context.Context, article *Article) error<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ repo ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸Šé¢è¿™æ ·å®šä¹‰ï¼Œæä¾›ä¸€ä¸ª <code>Tx</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ª <code>ArticleRepoTxFunc</code> ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸­çš„ repo æ˜¯å¼€å¯äº†äº‹åŠ¡çš„ repoï¼Œé€šè¿‡è¿™ä¸ª repo è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œçš„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// repo/article.go</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *article)</span> <span class="hljs-title">Tx</span><span class="hljs-params">(ctx context.Context, f domain.ArticleRepoTxFunc)</span> <span class="hljs-title">error</span></span> &#123;<br>	<span class="hljs-comment">// æ³¨æ„ï¼Œè¿™é‡Œçš„ r.db æ˜¯ *gorm.DB</span><br>  <span class="hljs-comment">// åœ¨ gorm ä¸­æä¾›äº† Transaction çš„å·¥å…·æ–¹æ³•ç”¨äºæ‰§è¡Œäº‹åŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸è‡ªå·±å†™äº†</span><br>	<span class="hljs-keyword">return</span> r.db.WithContext(ctx).Transaction(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *gorm.DB)</span> <span class="hljs-title">error</span></span> &#123;<br>		<span class="hljs-comment">// æˆ‘ä»¬ä½¿ç”¨äº‹åŠ¡çš„ tx é‡æ–°åˆå§‹åŒ–ä¸€ä¸ª repo</span><br>    <span class="hljs-comment">// è¿™ä¸ª repo åç»­çš„æ‰§è¡Œçš„æ•°æ®åº“ç›¸å…³çš„æ“ä½œå°±éƒ½æ˜¯äº‹åŠ¡çš„äº†</span><br>		repo := NewArticleRepo(tx)<br>		<span class="hljs-keyword">return</span> f(ctx, repo)<br>	&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨ usecase è°ƒç”¨çš„æ—¶å€™å°±å¯ä»¥è¿™æ ·</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// usecase/article.go</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *article)</span> <span class="hljs-title">CreateArticle</span><span class="hljs-params">(ctx context.Context, article *domain.Article, tagIDs []<span class="hljs-keyword">uint</span>)</span> <span class="hljs-title">error</span></span> &#123;<br>	<span class="hljs-keyword">return</span> u.repo.Tx(ctx, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, repo domain.IArticleRepo)</span> <span class="hljs-title">error</span></span> &#123;<br>		err := repo.CreateArticle(ctx, article)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">return</span> err<br>		&#125;<br><br>		<span class="hljs-keyword">var</span> ats []*domain.ArticleTag<br>		<span class="hljs-keyword">for</span> _, tid := <span class="hljs-keyword">range</span> tagIDs &#123;<br>			ats = <span class="hljs-built_in">append</span>(ats, &amp;domain.ArticleTag&#123;<br>				ArticleID: article.ID,<br>				TagID:     tid,<br>			&#125;)<br>		&#125;<br>		<span class="hljs-keyword">return</span> repo.CreateArticleTags(ctx, ats)<br>	&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å†™èµ·æ¥å°±æ•´æ´å¾ˆå¤šäº†ï¼Œä¸šåŠ¡é€»è¾‘å’Œæˆ‘ä»¬æœ€åˆçš„è®¾è®¡ä¸€æ ·ï¼Œåœ¨ usecase ä¸­å®ç°äº†ï¼Œrepo ä¸­æˆ‘ä»¬ä¹Ÿä¿æŒäº†ç®€å•çš„åŸåˆ™ã€‚</p><p>è¿™æ ·æ˜¯ä¸æ˜¯å°±ä¸‡äº‹å¤§å‰äº†å‘¢ï¼Ÿå¦‚æœä¸‡äº‹å¤§å‰äº†è¿™ç¯‡æ–‡ç« åˆ°è¿™å„¿ä¹Ÿå°±åº”è¯¥ç»“æŸäº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ï¼Œè¯´æ˜æˆ‘åœ¨å®è·µçš„è¿‡ç¨‹ä¸­è¿˜ç¢°åˆ°äº†é—®é¢˜</p><p>é—®é¢˜å¾ˆç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ usecase ä¸­ä¸ä»…ä»…éœ€è¦å¤ç”¨ repo ä¸­çš„ä»£ç ï¼Œè¿˜æœ‰å¯èƒ½éœ€è¦å¤ç”¨ usecase ä¸­çš„ä»£ç ï¼Œä¸ç„¶æˆ‘ä»¬å°±å¯èƒ½åœ¨ usecase ä¸­å‡ºç°å¾ˆå¤šç›¸åŒçš„é€»è¾‘ä»£ç ç‰‡æ®µï¼Œä»£ç çš„é‡å¤ç‡å°±å¾ˆé«˜</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ä¼šä¸ä¼šå‘ç°æœ‰ç‚¹ä»€ä¹ˆä¸å¯¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// usecase/article.go</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *article)</span> <span class="hljs-title">A</span><span class="hljs-params">(ctx contect, args args)</span> <span class="hljs-title">error</span></span> &#123;<br>	err := u.CreateArticle(ctx, args.Article) <span class="hljs-comment">// åŒ…å«äº‹åŠ¡</span><br>  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    <span class="hljs-keyword">return</span> err<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> u.UpdateXXX(ctx, args.XXX) <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•ä¸­ä¹Ÿä½¿ç”¨äº†äº‹åŠ¡</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å†…å…¶å®æ˜¯å¼€å¯äº†ä¸¤ä¸ªäº‹åŠ¡ï¼Œè¿™ä¸¤ä¸ªäº‹åŠ¡ä¹‹é—´äº’ä¸ç›¸å…³ï¼Œä¸ç¬¦åˆæˆ‘ä»¬éœ€æ±‚</p><h3 id="åœ¨-usecase-å±‚æä¾›äº‹åŠ¡æ–¹æ³•"><a href="#åœ¨-usecase-å±‚æä¾›äº‹åŠ¡æ–¹æ³•" class="headerlink" title="åœ¨ usecase å±‚æä¾›äº‹åŠ¡æ–¹æ³•"></a>åœ¨ usecase å±‚æä¾›äº‹åŠ¡æ–¹æ³•</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// usecase/article.go</span><br><br><span class="hljs-keyword">type</span> handler <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, usecase domain.IArticleUsecase)</span> <span class="hljs-title">error</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *article)</span> <span class="hljs-title">tx</span><span class="hljs-params">(ctx context.Context, f handler)</span> <span class="hljs-title">error</span></span> &#123;<br>	<span class="hljs-keyword">return</span> u.repo.Tx(ctx, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, repo domain.IArticleRepo)</span> <span class="hljs-title">error</span></span> &#123;<br>		usecase := NewArticleUsecase(repo)<br>		<span class="hljs-keyword">return</span> f(ctx, usecase)<br>	&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ usecase ä¸­ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ª tx æ–¹æ³•ï¼Œå’Œ repo ç±»ä¼¼ï¼Œåœ¨è°ƒç”¨ tx ä¹‹åï¼Œhandler ä¸­çš„æ–¹æ³•çš„éœ€è¦éƒ½æ˜¯ç”¨æ–°çš„å‚æ•° <code>usecase</code> è¿™ä¸ªæ–°çš„ usecase å¯ä»¥ä¿è¯é‡Œé¢çš„ repo è°ƒç”¨éƒ½æ˜¯äº‹åŠ¡çš„</p><p>æ‰€ä»¥æˆ‘ä»¬ä¹‹å‰çš„ <code>A</code> å‡½æ•°å¯ä»¥ä¿®æ”¹ä¸ºè¿™æ ·</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// usecase/article.go</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *article)</span> <span class="hljs-title">A</span><span class="hljs-params">(ctx contect, args args)</span> <span class="hljs-title">error</span></span> &#123;<br>	<span class="hljs-keyword">return</span> u.tx(ctx, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, usecase domain.IArticleUsecase)</span> <span class="hljs-title">error</span></span> &#123;<br>		err := usecase.CreateArticle(ctx, args.Article) <span class="hljs-comment">// åŒ…å«äº‹åŠ¡</span><br>	  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>	    <span class="hljs-keyword">return</span> err<br>	  &#125;<br><br>	  <span class="hljs-keyword">return</span> usecase.UpdateXXX(ctx, args.XXX) <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•ä¸­ä¹Ÿä½¿ç”¨äº†äº‹åŠ¡</span><br>	&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿæˆ‘ä»¬ <code>UpdateXXX</code> æ–¹æ³•ä¸­ä¹Ÿè°ƒç”¨ <code>u.tx</code> æ–¹æ³•ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åå¤å¼€å¯äº‹åŠ¡ï¼Œè™½ç„¶åœ¨ <code>gorm</code> çš„ <code>Transaction</code> æ–¹æ³•æ˜¯æ”¯æŒåµŒå¥—äº‹åŠ¡çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯ä¸è¦æ»¥ç”¨è¿™ä¸ªç‰¹æ€§ã€‚</p><p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ‰§è¡Œçš„æ—¶å€™åˆ¤æ–­ä¸‹å°±è¡Œäº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// usecase/article.go</span><br><br><span class="hljs-keyword">type</span> article <span class="hljs-keyword">struct</span> &#123;<br>	repo domain.IArticleRepo<br>  isTx <span class="hljs-keyword">bool</span> <span class="hljs-comment">// ç”¨äºæ ‡è¯†æ˜¯å¦å¼€å¯äº†äº‹åŠ¡</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨ <code>tx</code> æ–¹æ³•å†…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *article)</span> <span class="hljs-title">tx</span><span class="hljs-params">(ctx context.Context, f handler)</span> <span class="hljs-title">error</span></span> &#123;<br>  <span class="hljs-comment">// å¦‚æœå·²ç»å¼€å¯è¿‡äº‹åŠ¡äº†æˆ‘ä»¬å°±ç›´æ¥å¤ç”¨å°±è¡Œäº†</span><br>	<span class="hljs-keyword">if</span> u.isTx &#123;<br>		<span class="hljs-keyword">return</span> f(ctx, u)<br>	&#125;<br><br>	<span class="hljs-keyword">return</span> u.repo.Tx(ctx, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, repo domain.IArticleRepo)</span> <span class="hljs-title">error</span></span> &#123;<br>		usecase := &amp;article&#123;<br>			repo: repo,<br>			isTx: <span class="hljs-literal">true</span>,<br>		&#125;<br><br>		<span class="hljs-keyword">return</span> f(ctx, usecase)<br>	&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•-Tx-æ–¹æ³•"><a href="#æµ‹è¯•-Tx-æ–¹æ³•" class="headerlink" title="æµ‹è¯• Tx æ–¹æ³•"></a>æµ‹è¯• <code>Tx</code> æ–¹æ³•</h3><p>ç”±äº <code>repo.Tx</code> æœ¬èº«ä¹Ÿæ˜¯æ¥å£çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å…¶å®æˆ‘ä»¬åªéœ€è¦å¯¹ <code>repo.Tx</code> è¿›è¡Œ <code>mock</code> å°±è¡Œäº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> articleHelper <span class="hljs-keyword">struct</span> &#123;<br>	repo *mock_domain.MockIArticleRepo<br>	article *article<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newArticleHelper</span><span class="hljs-params">(t *testing.T)</span> *<span class="hljs-title">articleHelper</span></span> &#123;<br>	ctrl := gomock.NewController(t)<br>	h := &amp;articleHelper&#123;&#125;<br>	h.repo = mock_domain.NewMockIArticleRepo(ctrl)<br>	h.article = NewArticleUsecase(h.repo).(*article)<br>	<span class="hljs-keyword">return</span> h<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Test_article_CreateArticle</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	h := newArticleHelper(t)<br>	<span class="hljs-keyword">type</span> args <span class="hljs-keyword">struct</span> &#123;<br>		ctx     context.Context<br>		article *domain.Article<br>		tagIDs  []<span class="hljs-keyword">uint</span><br>	&#125;<br>	tests := []<span class="hljs-keyword">struct</span> &#123;<br>		name    <span class="hljs-keyword">string</span><br>		args    args<br>		wantErr <span class="hljs-keyword">bool</span><br>	&#125;&#123;<br>		&#123;<br>			name:    <span class="hljs-string">&quot;test&quot;</span>,<br>			args:    args&#123;&#125;,<br>			wantErr: <span class="hljs-literal">false</span>,<br>		&#125;,<br>	&#125;<br>	<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;<br>		t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>			h.repo.EXPECT().<br>				Tx(gomock.Any(), gomock.Any()).<br>				Return(<span class="hljs-literal">nil</span>)<br>			err := h.article.CreateArticle(tt.args.ctx, tt.args.article, tt.args.tagIDs)<br>			<span class="hljs-keyword">if</span> tt.wantErr &#123;<br>				require.NotNil(t, err)<br>			&#125;<br>			require.Nil(t, err)<br>		&#125;)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»†å¿ƒçš„æœ‹å‹å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸ªæµ‹è¯•ç­‰äºæ²¡æœ‰æµ‹è¯•å•Šï¼Œä»£ç éƒ½æ²¡æœ‰è¦†ç›–åˆ°ï¼Œç›´æ¥å°±è¿”å›ç»“æœäº†</p><p>æ˜¯çš„ï¼Œè¿™ç§æƒ…å†µä¸¤ç§å¤„ç†åŠæ³•ï¼Œä¸€ç§æ˜¯å°±æŒ‰ç…§ä¸Šé¢è¿™ä¹ˆå†™ã€‚ç„¶åæˆ‘ä»¬æŠŠäº‹åŠ¡å†…çš„å‡½æ•°å•ç‹¬æå‡ºæ¥ä½œä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ ·å°±éƒ½èƒ½è¦†ç›–åˆ°ï¼Œå¹¶ä¸”ç‹¬ç«‹æµ‹è¯•äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *article)</span> <span class="hljs-title">CreateArticle</span><span class="hljs-params">(ctx context.Context, article *domain.Article, tagIDs []<span class="hljs-keyword">uint</span>)</span> <span class="hljs-title">error</span></span> &#123;<br>	<span class="hljs-keyword">return</span> u.repo.Tx(ctx, u.article)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *article)</span> <span class="hljs-title">createArticle</span><span class="hljs-params">(ctx context.Context, repo domain.IArticleRepo)</span> <span class="hljs-title">error</span></span> &#123;<br>		err := repo.CreateArticle(ctx, article)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			<span class="hljs-keyword">return</span> err<br>		&#125;<br><br>		<span class="hljs-keyword">var</span> ats []*domain.ArticleTag<br>		<span class="hljs-keyword">for</span> _, tid := <span class="hljs-keyword">range</span> tagIDs &#123;<br>			ats = <span class="hljs-built_in">append</span>(ats, &amp;domain.ArticleTag&#123;<br>				ArticleID: article.ID,<br>				TagID:     tid,<br>			&#125;)<br>		&#125;<br>		<span class="hljs-keyword">return</span> repo.CreateArticleTags(ctx, ats)<br>	&#125;<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ˜¯æˆ‘ä»¬åœ¨ mock repo tx æ–¹æ³•çš„æ—¶å€™æ¢ä¸€ç§å†™æ³•, å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// old</span><br>h.repo.EXPECT().<br>				Tx(gomock.Any(), gomock.Any()).<br>				Return(<span class="hljs-literal">nil</span>)<br><br><span class="hljs-comment">// new</span><br>h.repo.EXPECT().<br>		Tx(gomock.Any(), gomock.Any()).<br>		DoAndReturn(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, f domain.ArticleRepoTxFunc)</span> <span class="hljs-title">error</span></span> &#123;<br>			<span class="hljs-keyword">return</span> f(ctx, h.repo)<br>		&#125;).<br>		AnyTimes()<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ–‡ç« åˆ°è¿™é‡Œå°±åˆ°å°¾å£°äº†ï¼ŒåŒæ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨è¿™ä¹ˆå†™å°±å¯ä»¥äº†ä¹ˆï¼Ÿ</p><p>å¯¹äºæˆ‘å½“å‰æ‰€é‡åˆ°çš„ä¸€äº›éœ€æ±‚æ¥è¯´å·²ç»å¯ä»¥è§£å†³äº†ï¼Œå½“ç„¶è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸å®Œç¾ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æ¶‰åŠåˆ°å¤šä¸ª repo çš„æ—¶å€™ï¼Œå½“å‰çš„æ–¹æ³•å°±æ²¡æ³•ç›´æ¥ç”¨äº†ï¼Œè¿˜å¾—è¿›è¡Œä¸€äº›æ”¹é€ ï¼Œè™½ç„¶æˆ‘ä»¬è¦æœ‰è¿œè§ä½†æ˜¯ä¹Ÿä¸è¦æƒ³çš„å¤ªå¤šï¼Œè¿›åŒ–æ˜¯ä¼˜äºå®Œç¾çš„ï¼Œå¦‚æœä½ æœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•æ¬¢è¿åœ¨è¯„è®ºåŒºæ¢è®¨</p><p>ä¸€ä¸ªå°é¢„å‘Šï¼Œæ¥ä¸‹æ¥è¿˜æœ‰å‡ ç¯‡å·¥ç¨‹å®è·µçš„ç›¸å…³æ–‡ç« </p><h2 id="å‚è€ƒææ–™"><a href="#å‚è€ƒææ–™" class="headerlink" title="å‚è€ƒææ–™"></a>å‚è€ƒææ–™</h2><ul><li><a target="_blank" rel="noopener" href="https://github.com/bxcodec/go-clean-arch/pull/36">https://github.com/bxcodec/go-clean-arch/pull/36</a></li><li><a href="https://lailin.xyz/post/go-training-week4-practice.html">https://lailin.xyz/post/go-training-week4-practice.html</a></li></ul><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°<a class="anchorjs-link" aria-label="Anchor" data-anchorjs-icon="î§‹" href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" style="font:1em/1 anchorjs-icons;padding-left:.375em"></a></h2><div class="row"><div class="col-lg-6"><img style="width:100%" src="https://img.lailin.xyz/custom/wechat_white.png" srcset="/img/loading.gif" lazyload alt="wechat"></div><div class="col-lg-2 col-4"><a target="_blank" href="http://s.zhihu.com/B4RT3"><img style="width:100%" src="https://img.lailin.xyz/custom/zhihu.png" srcset="/img/loading.gif" lazyload alt="çŸ¥ä¹"></a></div><div class="col-lg-2 col-4"><a target="_blank" href="https://github.com/mohuishou"><img style="width:100%" src="https://img.lailin.xyz/custom/github.png" srcset="/img/loading.gif" lazyload alt="github"></a></div></div><script>document.addEventListener("DOMContentLoaded",t=>{let e=$("#toc");if(!(e.height()<1)){let t=`
  <a
    class="fancybox fancybox.image"
    target="_blank" href="https://img.lailin.xyz/custom/wechat_white.png"
    itemscope=""
    itemtype="http://schema.org/ImageObject"
    itemprop="url"
    data-fancybox="default"
    rel="default noopener"
    title="wechat"
    data-caption="wechat"
    ><img
      style="width: 80%; margin-left: 1rem;"
      src="https://img.lailin.xyz/custom/wechat_white.png" srcset="/img/loading.gif" lazyload
      srcset="https://img.lailin.xyz/custom/wechat_white.png"
      alt="wechat"
    />
    </a>
  `;e.append(t.replace(/srcset.*?"/,""))}})</script><h2 id="çŒœä½ å–œæ¬¢">çŒœä½ å–œæ¬¢</h2><ul><li><a href="/post/graceful-repo-code.html" rel="recommend">Go å·¥ç¨‹åŒ–(åä¸€) å¦‚ä½•ä¼˜é›…çš„å†™å‡º repo å±‚ä»£ç </a> <span></span></li><li><a href="/post/12338.html" rel="recommend">Ginæºç é˜…è¯» ä»0.1å¼€å§‹</a> <span></span></li><li><a href="/post/go-training-week4-api-design.html" rel="recommend">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ & è®¾è®¡</a> <span></span></li><li><a href="/post/go-training-week4-config.html" rel="recommend">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</a> <span></span></li><li><a href="/post/go-training-week4-clean-arch.html" rel="recommend">Goå·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®°</a> <span></span></li></ul></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">Goè¿›é˜¶è®­ç»ƒè¥</a> <a class="hover-with-bg" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Week04-Go-%E5%B7%A5%E7%A8%8B%E5%8C%96/">Week04: Go å·¥ç¨‹åŒ–</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/go/">go</a> <a class="hover-with-bg" href="/tags/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/">å·¥ç¨‹å®è·µ</a></div></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œç¦æ­¢å…¨æ–‡è½¬è½½</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/post/graceful-repo-code.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Go å·¥ç¨‹åŒ–(åä¸€) å¦‚ä½•ä¼˜é›…çš„å†™å‡º repo å±‚ä»£ç </span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/post/add-catefories-sidebar-in-blog.html"><span class="hidden-mobile">ç»™åšå®¢æ·»åŠ ç« èŠ‚ç›®å½•</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><script type="text/javascript">Fluid.utils.loadComments("#comments",function(){var t="github-light",e="github-dark",s="dark"===(s=document.documentElement.getAttribute("data-user-color-scheme"))?e:t;window.UtterancesThemeLight=t,window.UtterancesThemeDark=e;e=document.createElement("script");e.setAttribute("src","https://utteranc.es/client.js"),e.setAttribute("repo","scuplus/blogComment"),e.setAttribute("issue-term","pathname"),e.setAttribute("label","utterances"),e.setAttribute("theme",s),e.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(e)})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div><div id="bottom"><div id="bottom-drawer" class="bottom-drawer"><div class="category-list"><div class="category row"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-5635160ef7307ccb3bfb116a87b12b17" role="tab" data-toggle="collapse" href="#collapse-5635160ef7307ccb3bfb116a87b12b17" aria-expanded="true">Goè¿›é˜¶è®­ç»ƒè¥(34) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-5635160ef7307ccb3bfb116a87b12b17" role="tabpanel" aria-labelledby="heading-5635160ef7307ccb3bfb116a87b12b17"><div class="category-post-list"></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-a41dee97aac19be1190166bbb774caae" role="tab" data-toggle="collapse" href="#collapse-a41dee97aac19be1190166bbb774caae" aria-expanded="false">Week01: å¾®æœåŠ¡(2) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-a41dee97aac19be1190166bbb774caae" role="tabpanel" aria-labelledby="heading-a41dee97aac19be1190166bbb774caae"><div class="category-post-list"><a href="/post/go-training-01.html" class="list-group-item list-group-item-action"><span class="category-post">å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</span> </a><a href="/post/go-training-02.html" class="list-group-item list-group-item-action"><span class="category-post">å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&amp;å¤šç§Ÿæˆ·</span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-d164da313d64fe1286b62ba12ecff46b" role="tab" data-toggle="collapse" href="#collapse-d164da313d64fe1286b62ba12ecff46b" aria-expanded="false">Week02: Goé”™è¯¯å¤„ç†(1) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-d164da313d64fe1286b62ba12ecff46b" role="tabpanel" aria-labelledby="heading-d164da313d64fe1286b62ba12ecff46b"><div class="category-post-list"><a href="/post/go-training-03.html" class="list-group-item list-group-item-action"><span class="category-post">Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-f10a23eef212070a176eed5d79b6d6ba" role="tab" data-toggle="collapse" href="#collapse-f10a23eef212070a176eed5d79b6d6ba" aria-expanded="false">Week03: Go å¹¶å‘ç¼–ç¨‹(12) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-f10a23eef212070a176eed5d79b6d6ba" role="tabpanel" aria-labelledby="heading-f10a23eef212070a176eed5d79b6d6ba"><div class="category-post-list"><a href="/post/go-training-week3-goroutine.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</span> </a><a href="/post/go-training-week3-go-memory-model.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</span> </a><a href="/post/go-training-week3-data-race.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</span> </a><a href="/post/go-training-week3-sync.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</span> </a><a href="/post/go-training-week3-atomic.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(äº”) æ·±å…¥ç†è§£ sync/atomic</span> </a><a href="/post/go-training-week3-waitgroup.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup</span> </a><a href="/post/go-training-week3-errgroup.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup</span> </a><a href="/post/go-training-week3-once.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å…«) æ·±å…¥ç†è§£ sync.Once</span> </a><a href="/post/go-training-week3-context.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(ä¹) æ·±å…¥ç†è§£ Context</span> </a><a href="/post/go-training-week3-channel.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(å) æ·±å…¥ç†è§£ Channel</span> </a><a href="/post/go-training-week3-sum.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(åä¸€) æ€»ç»“</span> </a><a href="/post/go-training-week5-singleflight.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¹¶å‘ç¼–ç¨‹(åäºŒ) Singleflight</span></a></div></div></div><div class="category-sub row"><a class="category-subitem list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-5f1c09a879adce524fb674e873d85f0d" role="tab" data-toggle="collapse" href="#collapse-5f1c09a879adce524fb674e873d85f0d" aria-expanded="true">Week04: Go å·¥ç¨‹åŒ–(11) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-5f1c09a879adce524fb674e873d85f0d" role="tabpanel" aria-labelledby="heading-5f1c09a879adce524fb674e873d85f0d"><div class="category-post-list"><a href="/post/go-training-week4-clean-arch.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®°</span> </a><a href="/post/go-training-week4-project-layout.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„</span> </a><a href="/post/go-training-week4-wire.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire</span> </a><a href="/post/go-training-week4-api-design.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ &amp; è®¾è®¡</span> </a><a href="/post/go-training-week4-protoc-gen-go-gin.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </span> </a><a href="/post/go-training-week4-config.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</span> </a><a href="/post/go-training-week4-go-module.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</span> </a><a href="/post/go-training-week4-unit-test.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•</span> </a><a href="/post/go-training-week4-practice.html" class="list-group-item list-group-item-action"><span class="category-post">Goå·¥ç¨‹åŒ–(ä¹) é¡¹ç›®é‡æ„å®è·µ</span> </a><a href="/post/clean-arch-transaction.html" class="list-group-item list-group-item-action active"><span class="category-post">Go å·¥ç¨‹åŒ–(å) å¦‚ä½•åœ¨æ•´æ´æ¶æ„ä¸­ä½¿ç”¨äº‹åŠ¡?</span> </a><a href="/post/graceful-repo-code.html" class="list-group-item list-group-item-action"><span class="category-post">Go å·¥ç¨‹åŒ–(åä¸€) å¦‚ä½•ä¼˜é›…çš„å†™å‡º repo å±‚ä»£ç </span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-edde40ce71fea3216c3528e70a2f78d3" role="tab" data-toggle="collapse" href="#collapse-edde40ce71fea3216c3528e70a2f78d3" aria-expanded="false">Week05: è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡(1) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-edde40ce71fea3216c3528e70a2f78d3" role="tabpanel" aria-labelledby="heading-edde40ce71fea3216c3528e70a2f78d3"><div class="category-post-list"><a href="/post/go-training-week5-comment-design-1.html" class="list-group-item list-group-item-action"><span class="category-post">è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡</span></a></div></div></div><div class="category-sub row"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" id="heading-9e5f96df977f309449649723b9fb267c" role="tab" data-toggle="collapse" href="#collapse-9e5f96df977f309449649723b9fb267c" aria-expanded="false">Week06: å¾®æœåŠ¡å¯ç”¨æ€§è®¾è®¡(7) <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-9e5f96df977f309449649723b9fb267c" role="tabpanel" aria-labelledby="heading-9e5f96df977f309449649723b9fb267c"><div class="category-post-list"><a href="/post/go-training-week6-usability-1-bulkhe.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(ä¸€) éš”ç¦»è®¾è®¡</span> </a><a href="/post/go-training-week6-2-token-bucket-1.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(äºŒ) ä»¤ç‰Œæ¡¶åŸç†åŠä½¿ç”¨</span> </a><a href="/post/go-training-week6-3-token-bucket-2.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(ä¸‰) ä»¤ç‰Œæ¡¶çš„å®ç° rate/limt</span> </a><a href="/post/go-training-week6-4-leaky-bucket.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(å››) æ¼æ¡¶ç®—æ³•</span> </a><a href="/post/go-training-week6-4-auto-limiter.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(äº”) è‡ªé€‚åº”é™æµ</span> </a><a href="/post/go-training-week6-6-breaker.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(å…­) ç†”æ–­</span> </a><a href="/post/go-training-week6-7-summary.html" class="list-group-item list-group-item-action"><span class="category-post">Goå¯ç”¨æ€§(ä¸ƒ) æ€»ç»“: ä¸€å¼ å›¾ä¸²è”å¯ç”¨æ€§çŸ¥è¯†ç‚¹</span></a></div></div></div></div></div></div><div id="toc-mobile"><div class="toc-body" id="toc-body-mobile"></div></div></div><div id="bottom-tab"><a class="sub-menu" onclick='showBottomDrawer(this,"#bottom-drawer .category-list")'><i class="iconfont"></i> ç« èŠ‚ </a><a class="sub-menu" onclick='showBottomDrawer(this,"#bottom-drawer #toc-mobile")'><i class="iconfont"></i> ç›®å½• </a><a href="#comments" class="sub-menu" onclick='showBottomDrawer(this,"#comments")'><i class="iconfont"></i> è¯„è®º</a></div></div><script>function showBottomDrawer(s,t){let e=document.querySelector("#bottom-tab");e.childNodes.forEach(t=>{t!=s&&t.classList&&t.classList.remove("active")}),"#comments"!=t&&s.classList.toggle("active");let o=document.querySelector("#bottom-drawer"),c=document.querySelector(t);o.childNodes.forEach(t=>{t!=c&&t.classList&&t.classList.remove("active")}),c.classList.toggle("active"),"#comments"!=t?(c.classList.contains("active")&&!o.classList.contains("active")&&o.classList.add("active"),!c.classList.contains("active")&&o.classList.contains("active")&&o.classList.remove("active")):o.classList.remove("active")}document.onreadystatechange=function(t){let s=$("#bottom-drawer");s.height()<=0||window.tocbot.init({tocSelector:"#toc-body-mobile",contentSelector:".markdown-body",headingSelector:"h1,h2,h3,h4",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:20})}</script></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-x-md"><div class="container custom mx-auto"><script>!function(e,s,p){var r;void 0===e.webpushr&&(e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)},r=s.getElementsByTagName(p)[0],(p=s.createElement(p)).id="webpushr-jssdk",p.async=1,p.src="https://cdn.webpushr.com/app.min.js",r.parentNode.appendChild(p))}(window,document,"script"),webpushr("setup",{key:"BBkZb7rpvsVqVNkORXD9T9T93MJodtpNJD5c1f2HE_XsED3r94An3CKObdyTJ6ub3ARm9LIdeDCVzKLBsK760NM"})</script></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">èœ€ICPå¤‡15014307å·-3</a></span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/events-33e028d78bd6a0739c153c52ae09fc4b.js"></script><script src="/js/plugins-0fbde8af13687afd5119855d6d8cc6c0.js"></script><script src="/js/local-search-336cd0153d3a0c907001488f0c1acbb3.js"></script><script src="/js/img-lazyload-906050e291c80575119e9a45011fed62.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-137859264-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script src="/js/boot-e2e7defad6d45a0409b0143389c87de0.js"></script></body></html>