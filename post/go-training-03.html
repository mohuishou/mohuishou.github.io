<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/icons/touch-icon-apple.png"><link rel="icon" type="image/png" href="/icons/favicon-32x32.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content><meta name="author" content="Mohuishou"><meta name="keywords" content="Go, Docker, PHP"><title>Week02: Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ - Mohuishou</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/assets/css/custom.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>mohuishou</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> é¦–é¡µ</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> åˆ†ç±»</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾</a></li><li class="nav-item"><a class="nav-link" href="/atom.xml"><i class="iconfont icon-rss"></i> rss</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(/img/bg.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-12-01 12:44" pubdate>2020å¹´12æœˆ1æ—¥ ä¸‹åˆ</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 4.2k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 56 åˆ†é’Ÿ</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">Week02: Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</h1><div class="markdown-body" id="post-body"><blockquote><p>æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ</p></blockquote><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><p>å¤ªé•¿ä¸çœ‹ç³»åˆ—ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹åœ¨ go ä¸­ å¦‚ä½•å¤„ç† errorï¼Œå…·ä½“çš„åŸå› æˆ‘ä»¬ä¼šåœ¨ä¸‹é¢çš„å†…å®¹ä¸­è¿›è¡Œè¯¦ç»†çš„è§£é‡Š</p><h3 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h3><ol><li>åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœæœ‰å¼ºä¾èµ–çš„æœåŠ¡å‡ºç°æ•…éšœæ—¶ <code>panic</code> é€€å‡º</li><li>åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰é…ç½®æ˜æ˜¾ä¸ç¬¦åˆè¦æ±‚ï¼Œ å¯ä»¥ <code>panic</code> é€€å‡ºï¼ˆé˜²å¾¡ç¼–ç¨‹ï¼‰</li><li>å…¶ä»–æƒ…å†µä¸‹åªè¦ä¸æ˜¯ä¸å¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œéƒ½ä¸åº”è¯¥ç›´æ¥ <code>panic</code> åº”è¯¥è¿”å› <code>error</code></li><li>åœ¨ç¨‹åºå…¥å£å¤„ï¼Œä¾‹å¦‚ <code>gin</code> ä¸­é—´ä»¶éœ€è¦ä½¿ç”¨ <code>recovery</code> é¢„é˜² <code>panic</code> ç¨‹åºé€€å‡º</li><li>åœ¨ç¨‹åºä¸­æˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨é‡ç”Ÿçš„ <code>goroutine</code><ol><li>å¦‚æœæ˜¯åœ¨è¯·æ±‚ä¸­éœ€è¦æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåº”è¯¥ä½¿ç”¨å¼‚æ­¥ <code>worker</code> ï¼Œæ¶ˆæ¯é€šçŸ¥çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œé¿å…è¯·æ±‚é‡å¤§æ—¶å¤§é‡ <code>goroutine</code> åˆ›å»º</li><li>å¦‚æœéœ€è¦ä½¿ç”¨ <code>goroutine</code> æ—¶ï¼Œåº”è¯¥ä½¿ç”¨åŒä¸€çš„ <code>Go</code> å‡½æ•°è¿›è¡Œåˆ›å»ºï¼Œè¿™ä¸ªå‡½æ•°ä¸­ä¼šè¿›è¡Œ <code>recovery</code> ï¼Œé¿å…å› ä¸ºé‡ç”Ÿ <code>goroutine</code> panic å¯¼è‡´ä¸»è¿›ç¨‹é€€å‡º</li></ol></li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Go</span><span class="hljs-params">(f <span class="hljs-keyword">func</span>()</span>)</span>&#123;
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;
            <span class="hljs-keyword">if</span> err := recovery(); err != <span class="hljs-literal">nil</span> &#123;
                log.Printf(<span class="hljs-string">"panic: %+v"</span>, err)
            &#125;
        &#125;()

        f()
    &#125;()
&#125;</code></pre><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><ol><li>æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>github.com/pkg/errors</code> å¤„ç†åº”ç”¨é”™è¯¯ï¼Œ<strong>æ³¨æ„åœ¨å…¬å…±åº“å½“ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä½¿ç”¨è¿™ä¸ª</strong></li><li><code>error</code> åº”è¯¥æ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªè¿”å›å€¼ï¼Œå½“ <code>error</code> ä¸ä¸º <code>nil</code> æ—¶ï¼Œå‡½æ•°çš„å…¶ä»–è¿”å›å€¼æ˜¯ä¸å¯ç”¨çš„çŠ¶æ€ï¼Œä¸åº”è¯¥å¯¹å…¶ä»–è¿”å›å€¼åšä»»ä½•æœŸå¾…<ol><li><code>func f() (io.Reader, *S1, error)</code> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸çŸ¥é“ <code>io.Reader</code> ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¯èƒ½æœ‰ï¼Œä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€éƒ¨åˆ†</li></ol></li><li>é”™è¯¯å¤„ç†çš„æ—¶å€™åº”è¯¥å…ˆåˆ¤æ–­é”™è¯¯ï¼Œ <code>if err != nil</code> å‡ºç°é”™è¯¯åŠæ—¶è¿”å›ï¼Œä½¿ä»£ç æ˜¯ä¸€æ¡æµç•…çš„ç›´çº¿ï¼Œé¿å…è¿‡å¤šçš„åµŒå¥—</li></ol><pre><code class="hljs go"><span class="hljs-comment">// good case</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
    a, err := A()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        <span class="hljs-keyword">return</span> err
    &#125;

    <span class="hljs-comment">// ... å…¶ä»–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-comment">// bad case</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
    a, err := A()
    <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;
    	<span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>
    &#125;

    <span class="hljs-keyword">return</span> err
&#125;</code></pre><ol start="4"><li>åœ¨<strong>åº”ç”¨ç¨‹åº</strong>ä¸­å‡ºç°é”™è¯¯æ—¶ï¼Œä½¿ç”¨ <code>errors.New</code> æˆ–è€… <code>errors.Errorf</code> è¿”å›é”™è¯¯</li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *usecese)</span> <span class="hljs-title">usecase1</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
    money := u.repo.getMoney(uid)
    <span class="hljs-keyword">if</span> money &lt; <span class="hljs-number">10</span> &#123;
        errors.Errorf(<span class="hljs-string">"ç”¨æˆ·ä½™é¢ä¸è¶³, uid: %d, money: %d"</span>, uid, money)
    &#125;
    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;</code></pre><ol start="5"><li>å¦‚æœæ˜¯è°ƒç”¨<strong>åº”ç”¨ç¨‹åºçš„</strong>å…¶ä»–å‡½æ•°å‡ºç°é”™è¯¯ï¼Œè¯·ç›´æ¥è¿”å›ï¼Œå¦‚æœéœ€è¦æºå¸¦ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ <code>errors.WithMessage</code></li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *usecese)</span> <span class="hljs-title">usecase2</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
    name, err := u.repo.getUserName(uid)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        <span class="hljs-keyword">return</span> errors.WithMessage(err, <span class="hljs-string">"å…¶ä»–é™„åŠ ä¿¡æ¯"</span>)
    &#125;

    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;</code></pre><ol start="6"><li>å¦‚æœæ˜¯è°ƒç”¨å…¶ä»–åº“ï¼ˆæ ‡å‡†åº“ã€ä¼ä¸šå…¬å…±åº“ã€å¼€æºç¬¬ä¸‰æ–¹åº“ç­‰ï¼‰è·å–åˆ°é”™è¯¯æ—¶ï¼Œè¯·ä½¿ç”¨ <code>errors.Wrap</code> æ·»åŠ å †æ ˆä¿¡æ¯<ol><li>åˆ‡è®°ï¼Œä¸è¦æ¯ä¸ªåœ°æ–¹éƒ½æ˜¯ç”¨ <code>errors.Wrap</code> åªéœ€è¦åœ¨é”™è¯¯ç¬¬ä¸€æ¬¡å‡ºç°æ—¶è¿›è¡Œ <code>errors.Wrap</code> å³å¯</li><li>æ ¹æ®åœºæ™¯è¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦å°†å…¶ä»–åº“çš„åŸå§‹é”™è¯¯åæ‰ï¼Œä¾‹å¦‚å¯ä»¥æŠŠ <code>repository</code> å±‚çš„æ•°æ®åº“ç›¸å…³é”™è¯¯åæ‰ï¼Œè¿”å›ä¸šåŠ¡é”™è¯¯ç ï¼Œé¿å…åç»­æˆ‘ä»¬åˆ†å‰²å¾®æœåŠ¡æˆ–è€…æ›´æ¢ <code>ORM</code> åº“æ—¶éœ€è¦å»ä¿®æ”¹ä¸Šå±‚ä»£ç </li><li>æ³¨æ„æˆ‘ä»¬åœ¨åŸºç¡€åº“ï¼Œè¢«å¤§é‡å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ç¼–å†™æ—¶ä¸€èˆ¬ä¸ä½¿ç”¨ <code>errors.Wrap</code> é¿å…å †æ ˆä¿¡æ¯é‡å¤</li></ol></li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
    err := json.Unmashal(&amp;a, data)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        <span class="hljs-keyword">return</span> errors.Wrap(err, <span class="hljs-string">"å…¶ä»–é™„åŠ ä¿¡æ¯"</span>)
    &#125;

    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;</code></pre><ol start="7"><li><strong>ç¦æ­¢</strong>æ¯ä¸ªå‡ºé”™çš„åœ°æ–¹éƒ½æ‰“æ—¥å¿—ï¼Œ<strong>åªéœ€è¦</strong>åœ¨è¿›ç¨‹çš„æœ€å¼€å§‹çš„åœ°æ–¹ä½¿ç”¨ <code>%+v</code> è¿›è¡Œç»Ÿä¸€æ‰“å°ï¼Œä¾‹å¦‚ http/rpc æœåŠ¡çš„ä¸­é—´ä»¶</li><li>é”™è¯¯åˆ¤æ–­ä½¿ç”¨ <code>errors.Is</code> è¿›è¡Œæ¯”è¾ƒ</li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
    err := A()
    <span class="hljs-keyword">if</span> errors.Is(err, io.EOF)&#123;
    	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    &#125;

    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;</code></pre><ol start="9"><li>é”™è¯¯ç±»å‹åˆ¤æ–­ï¼Œä½¿ç”¨ <code>errors.As</code> è¿›è¡Œèµ‹å€¼</li></ol><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
    err := A()

    <span class="hljs-keyword">var</span> errA errorA
    <span class="hljs-keyword">if</span> errors.As(err, &amp;errA)&#123;
    	<span class="hljs-comment">// ...</span>
    &#125;

    <span class="hljs-comment">// å…¶ä»–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;</code></pre><ol start="10"><li>å¦‚ä½•åˆ¤å®šé”™è¯¯çš„ä¿¡æ¯æ˜¯å¦è¶³å¤Ÿï¼Œæƒ³ä¸€æƒ³å½“ä½ çš„ä»£ç å‡ºç°é—®é¢˜éœ€è¦æ’æŸ¥çš„æ—¶å€™ä½ çš„é”™è¯¯ä¿¡æ¯æ˜¯å¦å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿçš„å®šä½é—®é¢˜ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨è¯·æ±‚ä¸­ä¸€èˆ¬ä¼šè¾“å‡ºå‚æ•°ä¿¡æ¯ï¼Œç”¨äºè¾…åŠ©åˆ¤æ–­é”™è¯¯</li><li>å¯¹äºä¸šåŠ¡é”™è¯¯ï¼Œæ¨èåœ¨ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹åˆ›å»ºä¸€ä¸ªé”™è¯¯å­—å…¸ï¼Œé”™è¯¯å­—å…¸é‡Œé¢åº”è¯¥åŒ…å«é”™è¯¯çš„ codeï¼Œå¹¶ä¸”åœ¨æ—¥å¿—ä¸­ä½œä¸ºç‹¬ç«‹å­—æ®µæ‰“å°ï¼Œæ–¹ä¾¿åšä¸šåŠ¡å‘Šè­¦çš„åˆ¤æ–­ï¼Œé”™è¯¯å¿…é¡»æœ‰æ¸…æ™°çš„é”™è¯¯æ–‡æ¡£</li><li>ä¸éœ€è¦è¿”å›ï¼Œè¢«å¿½ç•¥çš„é”™è¯¯<strong>å¿…é¡»</strong>è¾“å‡ºæ—¥å¿—ä¿¡æ¯</li><li>åŒä¸€ä¸ªåœ°æ–¹ä¸åœçš„æŠ¥é”™ï¼Œæœ€å¥½ä¸è¦ä¸åœè¾“å‡ºé”™è¯¯æ—¥å¿—ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´è¢«å¤§é‡çš„é”™è¯¯æ—¥å¿—ä¿¡æ¯æ·¹æ²¡ï¼Œæ— æ³•æ’æŸ¥é—®é¢˜ï¼Œæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯æ‰“å°ä¸€æ¬¡é”™è¯¯è¯¦æƒ…ï¼Œç„¶åæ‰“å°å‡ºé”™è¯¯å‡ºç°çš„æ¬¡æ•°</li><li>å¯¹åŒä¸€ä¸ªç±»å‹çš„é”™è¯¯ï¼Œé‡‡ç”¨ç›¸åŒçš„æ¨¡å¼ï¼Œä¾‹å¦‚å‚æ•°é”™è¯¯ï¼Œä¸è¦æœ‰çš„è¿”å› 404 æœ‰çš„è¿”å› 200</li><li>å¤„ç†é”™è¯¯çš„æ—¶å€™ï¼Œéœ€è¦å¤„ç†å·²åˆ†é…çš„èµ„æºï¼Œä½¿ç”¨ <code>defer</code> è¿›è¡Œæ¸…ç†ï¼Œä¾‹å¦‚æ–‡ä»¶å¥æŸ„</li></ol><h2 id="panic-or-error"><a href="#panic-or-error" class="headerlink" title="panic or error?"></a>panic or error?</h2><ol><li>åœ¨ Go ä¸­ panic ä¼šå¯¼è‡´ç¨‹åºç›´æ¥é€€å‡ºï¼Œæ˜¯ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯ï¼Œå¦‚æœä½¿ç”¨ <code>panic</code> <code>recovery</code> è¿›è¡Œå¤„ç†çš„è¯ï¼Œä¼šå­˜åœ¨å¾ˆå¤šé—®é¢˜<ol><li>æ€§èƒ½é—®é¢˜ï¼Œé¢‘ç¹ panic recovery æ€§èƒ½ä¸å¥½</li><li>å®¹æ˜“å¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œåªè¦æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡æœ‰å¤„ç†åˆ°å°±ä¼šå¯¼è‡´ç¨‹åºè¿›ç¨‹æ•´ä¸ªé€€å‡º</li><li>ä¸å¯æ§ï¼Œä¸€æ—¦ panic å°±å°†å¤„ç†é€»è¾‘ç§»äº¤ç»™äº†å¤–éƒ¨ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½é¢„è®¾å¤–éƒ¨åŒ…ä¸€å®šä¼šè¿›è¡Œå¤„ç†</li></ol></li><li>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ panic å‘¢ï¼Ÿ<ol><li>å¯¹äºçœŸæ­£æ„å¤–çš„æƒ…å†µï¼Œé‚£äº›è¡¨ç¤ºä¸å¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œä¾‹å¦‚ç´¢å¼•è¶Šç•Œã€ä¸å¯æ¢å¤çš„ç¯å¢ƒé—®é¢˜ã€æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨ panic</li></ol></li><li>ä½¿ç”¨ error å¤„ç†æœ‰å“ªäº›å¥½å¤„ï¼Ÿ<ol><li>ç®€å•ã€‚</li><li>è€ƒè™‘å¤±è´¥ï¼Œè€Œä¸æ˜¯æˆåŠŸ(Plan for failure, not success)ã€‚</li><li>æ²¡æœ‰éšè—çš„æ§åˆ¶æµã€‚</li><li>å®Œå…¨äº¤ç»™ä½ æ¥æ§åˆ¶ errorã€‚</li><li>Error are valuesã€‚</li></ol></li></ol><h2 id="ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­-errors-New-ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ"><a href="#ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­-errors-New-ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­ errors.New ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ"></a>ä¸ºä»€ä¹ˆæ ‡å‡†åº“ä¸­ errors.New ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆ</h2><p>ç¿»çœ‹æ ‡å‡†åº“çš„æºä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ <code>errors</code> åº“ä¸­çš„ <code>errorString</code> ç»“æ„ä½“å®ç°äº† <code>error</code> æ¥å£ï¼Œä¸ºä»€ä¹ˆåœ¨ <code>New</code> ä¸€ä¸ª error çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆå‘¢ï¼Ÿ</p><pre><code class="hljs go"><span class="hljs-comment">// New returns an error that formats as the given text.</span>
<span class="hljs-comment">// Each call to New returns a distinct error value even if the text is identical.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(text <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> &amp;errorString&#123;text&#125;
&#125;

<span class="hljs-comment">// errorString is a trivial implementation of error.</span>
<span class="hljs-keyword">type</span> errorString <span class="hljs-keyword">struct</span> &#123;
	s <span class="hljs-keyword">string</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *errorString)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;
	<span class="hljs-keyword">return</span> e.s
&#125;</code></pre><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åŒæ ·åˆ›å»ºäº† errorString çš„ç»“æ„ä½“ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å’Œæ ‡å‡†åº“ä¸­çš„å”¯ä¸€ä¸åŒå°±æ˜¯ï¼Œè‡ªå»ºçš„è¿™ä¸ªè¿”å›çš„æ˜¯å€¼ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆã€‚<br>åœ¨ <code>main</code> å‡½æ•°çš„å¯¹æ¯”ä¸­æˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ <code>errorString</code> åœ¨å¯¹æ¯”çš„æ—¶å€™åªè¦å¯¹åº”çš„å­—ç¬¦ä¸²ç›¸åŒå°±ä¼šè¿”å› trueï¼Œä½†æ˜¯æ ‡å‡†åº“çš„åŒ…ä¸ä¼šã€‚<br>è¿™æ˜¯å› ä¸ºï¼Œåœ¨å¯¹æ¯”ä¸¤ä¸ª struct æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä¼šå»å¯¹æ¯”ï¼Œè¿™ä¸¤ä¸ª struct é‡Œé¢çš„å„ä¸ªå­—æ®µæ˜¯å¦æ˜¯ç›¸åŒçš„ï¼Œå¦‚æœç›¸åŒå°±è¿”å› trueï¼Œä½†æ˜¯å¯¹æ¯”æŒ‡é’ˆçš„æ—¶å€™ä¼šå»åˆ¤æ–­ä¸¤ä¸ªæŒ‡é’ˆçš„åœ°å€æ˜¯å¦ä¸€è‡´ã€‚<br><strong>å¦‚æœå­—ç¬¦ä¸²ç›¸ç­‰å°±è¿”å› true ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</strong><br>å¦‚æœæˆ‘æœ‰ä¸¤ä¸ªåŒ…å®šä¹‰äº†å­—ç¬¦ä¸²ç›¸åŒçš„æƒ³ä¸ªé”™è¯¯ï¼Œåœ¨å…¶ä»–åº“è°ƒç”¨å¯¹æ¯”çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šç”±äºä¸åŒçš„ä¹¦å†™é¡ºåºèµ°è¿›ä¸åŒçš„åˆ†æ”¯å¯¼è‡´ä¸€äº›ä¸å¯é¢„æœŸçš„å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> errorString <span class="hljs-keyword">struct</span> &#123;
	text <span class="hljs-keyword">string</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e errorString)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;
	<span class="hljs-keyword">return</span> e.text
&#125;

<span class="hljs-comment">// New åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> errorString&#123;text: s&#125;
&#125;

<span class="hljs-keyword">var</span> errorString1 = New(<span class="hljs-string">"test a"</span>)
<span class="hljs-keyword">var</span> err1 = errors.New(<span class="hljs-string">"test b"</span>)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
	<span class="hljs-keyword">if</span> errorString1 == New(<span class="hljs-string">"test a"</span>) &#123;
		fmt.Println(<span class="hljs-string">"err string a"</span>) <span class="hljs-comment">// ä¼šè¾“å‡º</span>
	&#125;

	<span class="hljs-keyword">if</span> err1 == errors.New(<span class="hljs-string">"test b"</span>) &#123;
		fmt.Println(<span class="hljs-string">"err b"</span>) <span class="hljs-comment">// ä¸ä¼šè¾“å‡º</span>
	&#125;
&#125;</code></pre><h2 id="error-type-é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­"><a href="#error-type-é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­" class="headerlink" title="error type: é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­"></a>error type: é”™è¯¯å®šä¹‰ä¸åˆ¤æ–­</h2><h3 id="Sentinel-Error"><a href="#Sentinel-Error" class="headerlink" title="Sentinel Error"></a>Sentinel Error</h3><p>å“¨å…µé”™è¯¯ï¼Œå°±æ˜¯å®šä¹‰ä¸€äº›åŒ…çº§åˆ«çš„é”™è¯¯å˜é‡ï¼Œç„¶ååœ¨è°ƒç”¨çš„æ—¶å€™å¤–éƒ¨åŒ…å¯ä»¥ç›´æ¥å¯¹æ¯”å˜é‡è¿›è¡Œåˆ¤å®šï¼Œåœ¨æ ‡å‡†åº“å½“ä¸­å¤§é‡çš„ä½¿ç”¨äº†è¿™ç§æ–¹å¼<br>ä¾‹å¦‚ä¸‹æ–¹ <code>io</code> åº“ä¸­å®šä¹‰çš„é”™è¯¯</p><pre><code class="hljs go"><span class="hljs-comment">// EOF is the error returned by Read when no more input is available.</span>
<span class="hljs-comment">// Functions should return EOF only to signal a graceful end of input.</span>
<span class="hljs-comment">// If the EOF occurs unexpectedly in a structured data stream,</span>
<span class="hljs-comment">// the appropriate error is either ErrUnexpectedEOF or some other error</span>
<span class="hljs-comment">// giving more detail.</span>
<span class="hljs-keyword">var</span> EOF = errors.New(<span class="hljs-string">"EOF"</span>)

<span class="hljs-comment">// ErrUnexpectedEOF means that EOF was encountered in the</span>
<span class="hljs-comment">// middle of reading a fixed-size block or data structure.</span>
<span class="hljs-keyword">var</span> ErrUnexpectedEOF = errors.New(<span class="hljs-string">"unexpected EOF"</span>)

<span class="hljs-comment">// ErrNoProgress is returned by some clients of an io.Reader when</span>
<span class="hljs-comment">// many calls to Read have failed to return any data or error,</span>
<span class="hljs-comment">// usually the sign of a broken io.Reader implementation.</span>
<span class="hljs-keyword">var</span> ErrNoProgress = errors.New(<span class="hljs-string">"multiple Read calls return no data or error"</span>)</code></pre><p>æˆ‘ä»¬åœ¨å¤–éƒ¨åˆ¤å®šçš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨ç­‰å€¼åˆ¤å®šæˆ–è€…ä½¿ç”¨ <code>errors.Is</code> è¿›è¡Œåˆ¤æ–­</p><pre><code class="hljs go"><span class="hljs-keyword">if</span> err == io.EOF &#123;
	<span class="hljs-comment">//...</span>
&#125;

<span class="hljs-keyword">if</span> errors.Is(err, io.EOF)&#123;
	<span class="hljs-comment">//...</span>
&#125;</code></pre><p>è¿™ç§é”™è¯¯å¤„ç†æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå°† error å½“åšåŒ…çš„ API æš´éœ²ç»™äº†ç¬¬ä¸‰æ–¹ï¼Œè¿™æ ·ä¼šå¯¼è‡´åœ¨åšé‡æ„æˆ–è€…å‡çº§çš„æ—¶å€™å¾ˆéº»çƒ¦ï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼åŒ…å«çš„é”™è¯¯ä¿¡æ¯ä¼šååˆ†çš„æœ‰é™</p><h3 id="error-types"><a href="#error-types" class="headerlink" title="error types"></a>error types</h3><p>è¿™ä¸ªå°±ç±»ä¼¼æˆ‘ä»¬å‰é¢å®šä¹‰çš„ <code>errorString</code> ä¸€æ ·å®ç°äº† <code>error</code> çš„æ¥å£ï¼Œç„¶ååœ¨å¤–éƒ¨æ˜¯å¦ç±»å‹æ–­è¨€æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è¿™ç§é”™è¯¯ç±»å‹</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> MyStruct <span class="hljs-keyword">struct</span> &#123;
	s <span class="hljs-keyword">string</span>
    name <span class="hljs-keyword">string</span>
    path <span class="hljs-keyword">string</span>
&#125;



<span class="hljs-comment">// ä½¿ç”¨çš„æ—¶å€™</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span> &#123;
    <span class="hljs-keyword">switch</span> err.(<span class="hljs-keyword">type</span>) &#123;
        <span class="hljs-keyword">case</span> *MyStruct:
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">case</span> others:
        <span class="hljs-comment">// ...</span>
    &#125;
&#125;</code></pre><p>è¿™ç§æ–¹å¼ç›¸å¯¹äºå“¨å…µæ¥è¯´ï¼Œå¯ä»¥åŒ…å«æ›´åŠ ä¸°å¯Œçš„ä¿¡æ¯ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿå°†é”™è¯¯çš„ç±»å‹æš´éœ²ç»™äº†å¤–éƒ¨ï¼Œä¾‹å¦‚æ ‡å‡†åº“ä¸­çš„ <code>os.PathError</code></p><h3 id="Opaque-errors"><a href="#Opaque-errors" class="headerlink" title="Opaque errors"></a>Opaque errors</h3><p>ä¸é€æ˜çš„é”™è¯¯å¤„ç†ï¼Œè¿™ç§æ–¹å¼æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯åªè¿”å›é”™è¯¯ï¼Œæš´éœ²é”™è¯¯åˆ¤å®šæ¥å£ï¼Œä¸è¿”å›ç±»å‹ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ API çš„æš´éœ²ï¼Œåç»­çš„å¤„ç†ä¼šæ¯”è¾ƒçµæ´»ï¼Œè¿™ä¸ªä¸€èˆ¬ç”¨åœ¨å…¬å…±åº“ä¼šæ¯”è¾ƒå¥½</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> temporary <span class="hljs-keyword">interface</span> &#123;
	Temporary() <span class="hljs-keyword">bool</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">IsTemporary</span><span class="hljs-params">(err error)</span> <span class="hljs-title">bool</span></span> &#123;
	te, ok := err.(temporary)
	<span class="hljs-keyword">return</span> ok &amp;&amp; te.Temporary()
&#125;</code></pre><p>è¿™ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥æ–­è¨€é”™è¯¯å®ç°äº†ç‰¹å®šçš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯æ–­è¨€é”™è¯¯æ˜¯ç‰¹å®šçš„ç±»å‹æˆ–å€¼</p><h2 id="error-handle-é”™è¯¯å¤„ç†ä¼˜åŒ–"><a href="#error-handle-é”™è¯¯å¤„ç†ä¼˜åŒ–" class="headerlink" title="error handle: é”™è¯¯å¤„ç†ä¼˜åŒ–"></a>error handle: é”™è¯¯å¤„ç†ä¼˜åŒ–</h2><p>åœ¨ go ä¸­å¸¸å¸¸ä¼šå­˜åœ¨å¤§é‡çš„ <code>if err</code> ä»£ç ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§å¸¸è§çš„å‡å°‘è¿™ç§ä»£ç çš„æ–¹å¼</p><h3 id="bufio-scan"><a href="#bufio-scan" class="headerlink" title="bufio.scan"></a>bufio.scan</h3><p>å¯¹æ¯”ä¸‹é¢ä¸¤ä¸ªå‡½æ•°çš„å¤„ç†æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ <code>count2</code> ä½¿ç”¨ <code>sc.Scan</code> ä¹‹åä¸€ä¸ª <code>if err</code> çš„åˆ¤æ–­éƒ½æ²¡æœ‰ï¼Œæå¤§çš„ç®€åŒ–äº†ä»£ç ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ <code>sc.Scan</code> åšäº†å¾ˆå¤šå¤„ç†ï¼Œåƒå¾ˆå¤šç±»ä¼¼çš„ï¼Œéœ€è¦å¾ªç¯è¯»å–çš„éƒ½å¯ä»¥è€ƒè™‘åƒè¿™æ ·åŒ…è£…ä¹‹åè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å¤–éƒ¨åŒ…è°ƒç”¨çš„æ—¶å€™å°±ä¼šéå¸¸ç®€æ´</p><pre><code class="hljs go"><span class="hljs-comment">// ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">count</span><span class="hljs-params">(r io.Reader)</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, error)</span></span> &#123;
	<span class="hljs-keyword">var</span> (
		br    = bufio.NewReader(r)
		lines <span class="hljs-keyword">int</span>
		err   error
	)

	<span class="hljs-keyword">for</span> &#123;
		<span class="hljs-comment">// è¯»å–åˆ°æ¢è¡Œç¬¦å°±è¯´æ˜æ˜¯ä¸€è¡Œ</span>
		_, err = br.ReadString(<span class="hljs-string">'\n'</span>)
		lines++
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
			<span class="hljs-keyword">break</span>
		&#125;
	&#125;

	<span class="hljs-comment">// å½“é”™è¯¯æ˜¯ EOF çš„æ—¶å€™è¯´æ˜æ–‡ä»¶è¯»å–å®Œæ¯•äº†</span>
	<span class="hljs-keyword">if</span> err != io.EOF &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, err
	&#125;

	<span class="hljs-keyword">return</span> lines, err
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">count2</span><span class="hljs-params">(r io.Reader)</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, error)</span></span> &#123;
	<span class="hljs-keyword">var</span> (
		sc    = bufio.NewScanner(r)
		lines <span class="hljs-keyword">int</span>
	)

	<span class="hljs-keyword">for</span> sc.Scan() &#123;
		lines++
	&#125;

	<span class="hljs-keyword">return</span> lines, sc.Err()
&#125;</code></pre><h3 id="error-writer"><a href="#error-writer" class="headerlink" title="error writer"></a>error writer</h3><p>çœ‹ä¸€ä¸ªæ¥è‡ª go blog çš„ä¾‹å­ï¼š<a href="https://blog.golang.org/errors-are-values" target="_blank" rel="noopener">https://blog.golang.org/errors-are-values</a><br>ä¸€èˆ¬ä»£ç </p><pre><code class="hljs go">_, err = fd.Write(p0[a:b])
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
    <span class="hljs-keyword">return</span> err
&#125;
_, err = fd.Write(p1[c:d])
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
    <span class="hljs-keyword">return</span> err
&#125;
_, err = fd.Write(p2[e:f])
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
    <span class="hljs-keyword">return</span> err
&#125;
<span class="hljs-comment">// and so on</span></code></pre><p>errWriter</p><pre><code class="hljs go"><span class="hljs-keyword">type</span> errWriter <span class="hljs-keyword">struct</span> &#123;
    w   io.Writer
    err error
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ew *errWriter)</span> <span class="hljs-title">write</span><span class="hljs-params">(buf []<span class="hljs-keyword">byte</span>)</span></span> &#123;
    <span class="hljs-keyword">if</span> ew.err != <span class="hljs-literal">nil</span> &#123;
        <span class="hljs-keyword">return</span>
    &#125;
    _, ew.err = ew.w.Write(buf)
&#125;

<span class="hljs-comment">// ä½¿ç”¨æ—¶</span>
ew := &amp;errWriter&#123;w: fd&#125;
ew.write(p0[a:b])
ew.write(p1[c:d])
ew.write(p2[e:f])
<span class="hljs-comment">// and so on</span>
<span class="hljs-keyword">if</span> ew.err != <span class="hljs-literal">nil</span> &#123;
    <span class="hljs-keyword">return</span> ew.err
&#125;</code></pre><p>å¦‚æœå»ç¿» æ ‡å‡†åº“ä¸­ bufio.Writer çš„æºä»£ç ï¼Œä½ ä¼šå‘ç°ä¹Ÿæœ‰è¿™ç§ç”¨æ³•ï¼Œè¿™ç§å°±æ˜¯å°†é‡å¤çš„é€»è¾‘è¿›è¡Œäº†å°è£…ï¼Œç„¶åæŠŠ error æš‚å­˜ï¼Œç„¶åæˆ‘ä»¬å°±åªéœ€è¦åœ¨æœ€ååˆ¤æ–­ä¸€ä¸‹ error å°±è¡Œäº†</p><h2 id="wrap-error-é”™è¯¯åŒ…è£…"><a href="#wrap-error-é”™è¯¯åŒ…è£…" class="headerlink" title="wrap error: é”™è¯¯åŒ…è£…"></a>wrap error: é”™è¯¯åŒ…è£…</h2><h3 id="errors-wrap-æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„-fmt-Errorf-quot-w-quot"><a href="#errors-wrap-æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„-fmt-Errorf-quot-w-quot" class="headerlink" title="errors.wrap æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„ fmt.Errorf(&quot;%w&quot;)"></a>errors.wrap æœ‰ä½•ä½œç”¨ï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†åº“çš„ <code>fmt.Errorf(&quot;%w&quot;)</code></h3><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ ‡å‡†åº“çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å½“ <code>p.wrappedErr != nil</code> çš„æ—¶å€™ï¼ˆä¹Ÿå°±æ˜¯æœ‰ %wï¼‰çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ä¸€ä¸ª <code>wrapError</code> å°†é”™è¯¯åŒ…è£…ï¼Œçœ‹ <code>wrapError</code> çš„æºç å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ–¹æ³•åªæ˜¯åŒ…è£…äº†ä¸€ä¸‹åŸå§‹é”™è¯¯ï¼Œå¹¶ä¸”å¯ä»¥åšåˆ°é™„åŠ ä¸€äº›æ–‡æœ¬ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å †æ ˆä¿¡æ¯ã€‚</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Errorf</span><span class="hljs-params">(format <span class="hljs-keyword">string</span>, a ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;
	p := newPrinter()
	p.wrapErrs = <span class="hljs-literal">true</span>
	p.doPrintf(format, a)
	s := <span class="hljs-keyword">string</span>(p.buf)
	<span class="hljs-keyword">var</span> err error
	<span class="hljs-keyword">if</span> p.wrappedErr == <span class="hljs-literal">nil</span> &#123;
		err = errors.New(s)
	&#125; <span class="hljs-keyword">else</span> &#123;
		err = &amp;wrapError&#123;s, p.wrappedErr&#125;
	&#125;
	p.free()
	<span class="hljs-keyword">return</span> err
&#125;

<span class="hljs-keyword">type</span> wrapError <span class="hljs-keyword">struct</span> &#123;
	msg <span class="hljs-keyword">string</span>
	err error
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *wrapError)</span> <span class="hljs-title">Error</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;
	<span class="hljs-keyword">return</span> e.msg
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *wrapError)</span> <span class="hljs-title">Unwrap</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> e.err
&#125;</code></pre><p>åœ¨çœ‹ä¸€ä¸‹ pkg/errors çš„æºç ï¼Œæˆ‘è‚¯å¯ä»¥å‘ç°é™¤äº†ä½¿ç”¨ <code>withMessage</code> é™„åŠ äº†é”™è¯¯ä¿¡æ¯ä¹‹å¤–è¿˜ä½¿ç”¨ <code>withStack</code> é™„åŠ äº†å †æ ˆä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ç¨‹åºå…¥å£å¤„æ‰“å°æ—¥å¿—ä¿¡æ¯çš„æ—¶å€™å°±å¯ä»¥å°†å †æ ˆä¿¡æ¯ä¸€å¹¶æ‰“å‡ºäº†</p><pre><code class="hljs go"><span class="hljs-comment">// Wrap returns an error annotating err with a stack trace</span>
<span class="hljs-comment">// at the point Wrap is called, and the supplied message.</span>
<span class="hljs-comment">// If err is nil, Wrap returns nil.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Wrap</span><span class="hljs-params">(err error, message <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	&#125;
	err = &amp;withMessage&#123;
		cause: err,
		msg:   message,
	&#125;
	<span class="hljs-keyword">return</span> &amp;withStack&#123;
		err,
		callers(),
	&#125;
&#125;</code></pre><h3 id="ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨-errors-Wrap"><a href="#ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨-errors-Wrap" class="headerlink" title="ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨ errors.Wrap"></a>ä¸ºä»€ä¹ˆä¸å…è®¸å¤„å¤„ä½¿ç”¨ errors.Wrap</h3><p>å› ä¸ºæ¯ä¸€æ¬¡ <code>errors.Wrap</code> çš„è°ƒç”¨éƒ½ä¼šä¸ºé”™è¯¯æ·»åŠ å †æ ˆä¿¡æ¯ï¼Œå¦‚æœå¤„å¤„è°ƒç”¨é‚£ä¼šæœ‰å¤§é‡çš„æ— ç”¨å †æ ˆ<br>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹åªæœ‰ä¸€å¤„ wrap</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
	fmt.Printf(<span class="hljs-string">"err: %+v"</span>, c())
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">a</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> errors.Wrap(fmt.Errorf(<span class="hljs-string">"xxx"</span>), <span class="hljs-string">"test"</span>)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">b</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> a()
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">c</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> b()
&#125;</code></pre><p>çœ‹ç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°å·²ç»å¯ä»¥æ‰“å°å‡ºå…¨éƒ¨çš„å †æ ˆä¿¡æ¯äº†</p><pre><code class="hljs go">err: xxx
test
main.a
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">14</span>
main.b
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">18</span>
main.c
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>
main.main
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>
runtime.main
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>
runtime.goexit
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span></code></pre><p>å†çœ‹å¤šå¤„ wrap çš„ç°è±¡</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
	fmt.Printf(<span class="hljs-string">"err: %+v"</span>, c())
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">a</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> errors.Wrap(fmt.Errorf(<span class="hljs-string">"xxx"</span>), <span class="hljs-string">"a"</span>)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">b</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> errors.Wrap(a(), <span class="hljs-string">"b"</span>)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">c</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
	<span class="hljs-keyword">return</span> errors.Wrap(b(), <span class="hljs-string">"c"</span>)
&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°æ¯ä¸€å¤„ wrap éƒ½æ·»åŠ äº†ä¸€æ¬¡å †æ ˆä¿¡æ¯</p><pre><code class="hljs go">err: xxx
a
main.a
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">14</span>
main.b
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">18</span>
main.c
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>
main.main
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>
runtime.main
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>
runtime.goexit
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span>
b
main.b
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">18</span>
main.c
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>
main.main
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>
runtime.main
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>
runtime.goexit
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span>
c
main.c
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">22</span>
main.main
        /home/ll/project/Go<span class="hljs-number">-000</span>/Week02/blog/wrap.<span class="hljs-keyword">go</span>:<span class="hljs-number">10</span>
runtime.main
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/proc.<span class="hljs-keyword">go</span>:<span class="hljs-number">204</span>
runtime.goexit
        /usr/local/<span class="hljs-keyword">go</span>/src/runtime/asm_amd64.s:<span class="hljs-number">1374</span></code></pre><h2 id="æ ‡å‡†åº“-errors-Is-As-æ€ä¹ˆåˆ¤æ–­é”™è¯¯"><a href="#æ ‡å‡†åº“-errors-Is-As-æ€ä¹ˆåˆ¤æ–­é”™è¯¯" class="headerlink" title="æ ‡å‡†åº“ errors.Is / As æ€ä¹ˆåˆ¤æ–­é”™è¯¯"></a>æ ‡å‡†åº“ errors.Is / As æ€ä¹ˆåˆ¤æ–­é”™è¯¯</h2><h3 id="errors-Is"><a href="#errors-Is" class="headerlink" title="errors.Is"></a>errors.Is</h3><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Is</span><span class="hljs-params">(err, target error)</span> <span class="hljs-title">bool</span></span> &#123;
	<span class="hljs-keyword">if</span> target == <span class="hljs-literal">nil</span> &#123;
		<span class="hljs-keyword">return</span> err == target
	&#125;
	<span class="hljs-comment">// é€šè¿‡åå°„åˆ¤è¯» target æ˜¯å¦å¯ä»¥è¢«æ¯”è¾ƒ</span>
	isComparable := reflectlite.TypeOf(target).Comparable()
	<span class="hljs-keyword">for</span> &#123;
        <span class="hljs-comment">// å¾ªç¯åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span>
		<span class="hljs-keyword">if</span> isComparable &amp;&amp; err == target &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
		&#125;
        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å®ç°äº† is æ¥å£ï¼Œå¦‚æœæœ‰å®ç°å°±ç›´æ¥åˆ¤æ–­</span>
		<span class="hljs-keyword">if</span> x, ok := err.(<span class="hljs-keyword">interface</span>&#123; Is(error) <span class="hljs-keyword">bool</span> &#125;); ok &amp;&amp; x.Is(target) &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
		&#125;

		<span class="hljs-comment">// å»åˆ¤æ–­æ˜¯å¦å®ç°äº† unwrap çš„æ¥å£ï¼Œå¦‚æœå®ç°äº†å°±è¿›è¡Œ unwrap</span>
		<span class="hljs-keyword">if</span> err = Unwrap(err); err == <span class="hljs-literal">nil</span> &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
		&#125;
	&#125;
&#125;</code></pre><h3 id="errors-As"><a href="#errors-As" class="headerlink" title="errors.As"></a>errors.As</h3><p>å’Œ is çš„é€»è¾‘ç±»ä¼¼ï¼Œå°±æ˜¯ä¸æ–­çš„è¿›è¡Œ unwrap è¿›è¡Œæ¯”è¾ƒï¼Œåªè¦æœ‰ä¸€ä¸ªç›¸åŒå°±è¿”å›ï¼Œå¦‚æœä¸€ç›´åˆ°åº•éƒ½ä¸è¡Œå°±è¿”å› false</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">As</span><span class="hljs-params">(err error, target <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">bool</span></span> &#123;
	<span class="hljs-keyword">if</span> target == <span class="hljs-literal">nil</span> &#123;
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"errors: target cannot be nil"</span>)
	&#125;
	val := reflectlite.ValueOf(target)
	typ := val.Type()
	<span class="hljs-keyword">if</span> typ.Kind() != reflectlite.Ptr || val.IsNil() &#123;
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"errors: target must be a non-nil pointer"</span>)
	&#125;
	<span class="hljs-keyword">if</span> e := typ.Elem(); e.Kind() != reflectlite.Interface &amp;&amp; !e.Implements(errorType) &#123;
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"errors: *target must be interface or implement error"</span>)
	&#125;
	targetType := typ.Elem()
	<span class="hljs-keyword">for</span> err != <span class="hljs-literal">nil</span> &#123;
		<span class="hljs-keyword">if</span> reflectlite.TypeOf(err).AssignableTo(targetType) &#123;
			val.Elem().Set(reflectlite.ValueOf(err))
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
		&#125;
		<span class="hljs-keyword">if</span> x, ok := err.(<span class="hljs-keyword">interface</span>&#123; As(<span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-keyword">bool</span> &#125;); ok &amp;&amp; x.As(target) &#123;
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
		&#125;
		err = Unwrap(err)
	&#125;
	<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
&#125;</code></pre><h2 id="å…³æ³¨æˆ‘è·å–æ›´æ–°"><a href="#å…³æ³¨æˆ‘è·å–æ›´æ–°" class="headerlink" title="å…³æ³¨æˆ‘è·å–æ›´æ–°"></a>å…³æ³¨æˆ‘è·å–æ›´æ–°</h2><p>çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸ç‚¹ä¸ªå…³æ³¨èµ°ä¸€æ³¢</p><ul><li><a href="https://lailin.xyz">åšå®¢</a> å¯ä»¥è®¢é˜… RSS</li><li><a href="https://github.com/mohuishou" target="_blank" rel="noopener">Github</a> Follow me</li><li><a href="https://www.zhihu.com/people/mo-hui-shou-76" target="_blank" rel="noopener">çŸ¥ä¹</a> å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li><li><a href="https://toutiao.io/subjects/387401?f=new" target="_blank" rel="noopener">å¼€å‘è€…å¤´æ¡</a> è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘</li></ul><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week3-sync.html">Week03: Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</a></li><li><a href="https://lailin.xyz/post/go-training-week3-data-race.html">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li><a href="https://lailin.xyz/post/go-training-week3-go-memory-model.html">Week03: Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li></ul></div></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/Goè¿›é˜¶è®­ç»ƒè¥/">Goè¿›é˜¶è®­ç»ƒè¥</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/å­¦ä¹ ç¬”è®°/">å­¦ä¹ ç¬”è®°</a> <a class="hover-with-bg" href="/tags/Go/">Go</a> <a class="hover-with-bg" href="/tags/Goè¿›é˜¶è®­ç»ƒè¥/">Goè¿›é˜¶è®­ç»ƒè¥</a> <a class="hover-with-bg" href="/tags/error/">error</a></div></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/post/go-training-week3-goroutine.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Week03: Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/post/go-training-02.html"><span class="hidden-mobile">Week01: å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&å¤šç§Ÿæˆ·</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><script type="text/javascript">function loadUtterances(){var t="github-light",e="github-dark",s=document.documentElement.getAttribute("data-user-color-scheme");s="dark"===s?e:t,window.UtterancesThemeLight=t,window.UtterancesThemeDark=e;var n=document.createElement("script");n.setAttribute("src","https://utteranc.es/client.js"),n.setAttribute("repo","scuplus/blogComment"),n.setAttribute("issue-term","pathname"),n.setAttribute("label","utterances"),n.setAttribute("theme",s),n.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(n)}waitElementVisible("comments",loadUtterances)</script></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:0,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Week02: Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-137859264-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script></body></html>