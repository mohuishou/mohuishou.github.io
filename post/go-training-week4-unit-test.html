<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/icons/touch-icon-apple.png"><link rel="icon" type="image/png" href="/icons/favicon-32x32.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="mohuishou çš„ æŠ€æœ¯åšå®¢, å…³æ³¨äº‘åŸç”Ÿ, Go, K8s, Docker, å¾®æœåŠ¡ç­‰æŠ€æœ¯"><meta name="author" content="Mohuishou"><meta name="keywords" content="Go,Docker,PHP,å­¦ä¹ ç¬”è®°,Go,Goè¿›é˜¶è®­ç»ƒè¥,å·¥ç¨‹åŒ–,å•å…ƒæµ‹è¯•,Goè¿›é˜¶è®­ç»ƒè¥,Week04: Go å·¥ç¨‹åŒ–"><title>Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯• - Mohuishou</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main-8c4c5e426918ae095492d8a940e57fef.css"><link rel="stylesheet" href="/assets/css/custom-6db6671dbe84a966b9771f9ad2d73786.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"lailin.xyz",root:"/",version:"1.8.7",typing:{enable:!1,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!0,baidu:null,google:"UA-137859264-1",gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils-5ecdced2f65030c3508cf0b3db78f4ad.js"></script><script src="/js/color-schema-4678c2299d6eeb96e23435ea339c9331.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>mohuishou</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/"><i class="iconfont icon-category-fill"></i> Go è¿›é˜¶è®­ç»ƒè¥(æ›´æ–°ä¸­)</a></li><li class="nav-item"><a class="nav-link" href="/post/go-design-pattern.html"><i class="iconfont icon-notebook"></i> Go è®¾è®¡æ¨¡å¼</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> æ›´å¤š</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾ </a><a class="dropdown-item" href="/atom.xml"><i class="iconfont icon-rss"></i> rss </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/img/bg.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•">Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•</span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-03-09 10:08" pubdate>2021å¹´3æœˆ9æ—¥ ä¸Šåˆ</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.4k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 45 åˆ†é’Ÿ</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"><div class="sidebar"><p class="sidebar-header">Goè¿›é˜¶è®­ç»ƒè¥</p><div class="sidebar-body" id="sidebar-body"><ol class="sidebar-list sidebar-list-1"><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23xho0000m4t51q602czj").classList.toggle("sidebar-is-collapsed")'>Week01: å¾®æœåŠ¡</a><ol id="sidebar-ckkm23xho0000m4t51q602czj" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-01.html">å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-02.html">å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&amp;å¤šç§Ÿæˆ·</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23ykh0003m4t53mln1w0n").classList.toggle("sidebar-is-collapsed")'>Week02: Goé”™è¯¯å¤„ç†</a><ol id="sidebar-ckkm23ykh0003m4t53mln1w0n" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-03.html">Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm2667n000pm4t52z016wn0").classList.toggle("sidebar-is-collapsed")'>Week03: Go å¹¶å‘ç¼–ç¨‹</a><ol id="sidebar-ckkm2667n000pm4t52z016wn0" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-goroutine.html">Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-go-memory-model.html">Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-data-race.html">Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sync.html">Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-waitgroup.html">Goå¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-atomic.html">Goå¹¶å‘ç¼–ç¨‹(äº”) æ·±å…¥ç†è§£ sync/atomic</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-errgroup.html">Goå¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-once.html">Goå¹¶å‘ç¼–ç¨‹(å…«) æ·±å…¥ç†è§£ sync.Once</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-context.html">Goå¹¶å‘ç¼–ç¨‹(ä¹) æ·±å…¥ç†è§£ Context</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-channel.html">Goå¹¶å‘ç¼–ç¨‹(å) æ·±å…¥ç†è§£ Channel</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sum.html">Goå¹¶å‘ç¼–ç¨‹(åä¸€) æ€»ç»“</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23zra000im4t5en8m0qy9").classList.toggle("sidebar-is-collapsed")'>Week04: Go å·¥ç¨‹åŒ–</a><ol id="sidebar-ckkm23zra000im4t5en8m0qy9" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-clean-arch.html">Goå·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®°</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-project-layout.html">Goå·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-wire.html">Goå·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-api-design.html">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ &amp; è®¾è®¡</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-protoc-gen-go-gin.html">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-config.html">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-go-module.html">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</a></li><li class="sidebar-list-item is-active-li"><a class="sidebar-link sidebar-active-link" href="/post/go-training-week4-unit-test.html">Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-practice.html">Goå·¥ç¨‹åŒ–(ä¹) é¡¹ç›®é‡æ„å®è·µ</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckmgd197g000cieou0z682wci").classList.toggle("sidebar-is-collapsed")'>Week05: è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡</a><ol id="sidebar-ckmgd197g000cieou0z682wci" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week5-comment-design-1.html">è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡ï¼ˆä¸€ï¼‰åŠŸèƒ½æ‹†åˆ†&amp;æ¶æ„è®¾è®¡</a></li></ol></li></ol></div></div></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•</h1><div class="markdown-body"><h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><p>æœ¬ç³»åˆ—ä¸º <a target="_blank" rel="noopener" href="https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;utm_medium=lailin.xyz">Go è¿›é˜¶è®­ç»ƒè¥</a> ç¬”è®°ï¼Œé¢„è®¡ 2021Q2 å®Œæˆæ›´æ–°ï¼Œè®¿é—® <a href="https://lailin.xyz/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">åšå®¢: Go è¿›é˜¶è®­ç»ƒè¥</a> å³å¯æŸ¥çœ‹å½“å‰æ›´æ–°è¿›åº¦ï¼Œéƒ¨åˆ†æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œä½¿ç”¨ PC å¤§å±æµè§ˆä½“éªŒæ›´ä½³ã€‚<strong>3 æœˆè¿›åº¦: 05/15</strong> 3 æœˆå¼€å§‹ä¼šå°è¯•çˆ†æ›´æ¨¡å¼ï¼Œäº‰å–åšåˆ°ä¸¤å¤©æ›´æ–°ä¸€ç¯‡æ–‡ç« ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥æ‹‰åˆ°æ–‡ç« æœ€ä¸‹æ–¹è·å–å…³æ³¨æ–¹å¼ã€‚</p><p>ä»æˆ‘ä»¬å¼€å§‹å¼€å‘ä»¥æ¥ï¼Œåº”è¯¥å¾ˆå¤šäººéƒ½æåˆ°è¿‡æµ‹è¯•çš„é‡è¦æ€§ï¼Œè€Œåœ¨æ‰€æœ‰çš„æµ‹è¯•ç±»å‹å½“ä¸­ï¼Œä»¥å•å…ƒæµ‹è¯•ä¸ºä»£è¡¨çš„å•å…ƒæµ‹è¯•æ— ç–‘æ˜¯æˆæœ¬æœ€å°ï¼Œæ€§ä»·æ¯”æœ€é«˜çš„ä¸€ç§ï¼Œè€Œä¸”æœ‰çš„å…¬å¸ä¸ºäº†ä¿è¯è´¨é‡ä¼šè¦æ±‚å•å…ƒæµ‹è¯•è¦†ç›–ç‡çš„æŒ‡æ ‡ï¼ˆåŒ…æ‹¬æˆ‘ä»¬ï¼‰</p><p><img src="https://mohuishou-blog-sz.oss-cn-shenzhen.aliyuncs.com/image/1614514088908-363f1894-098c-47e5-8289-0e223adda8a6.png" srcset="/img/loading.gif" alt="image.png"><br>æ‰€ä»¥å¸Œæœ›çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›å¤§å®¶å¯ä»¥å¾ˆå¿«çš„åœ¨æˆ‘ä»¬ä¹‹å‰æå‡ºçš„é¡¹ç›®ç»“æ„ä¸Šè¿›è¡Œå•å…ƒæµ‹è¯•çš„ç¼–å†™ï¼Œå¯ä»¥åšåˆ°åˆå¿«åˆå¥½ã€‚<br>æœ¬æ–‡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå‰åŠæ®µä¼šç®€å•ä»‹ç»ä¸€ä¸‹ go çš„å•å…ƒæµ‹è¯•æ€ä¹ˆå†™ï¼Œä¸ä¼šæœ‰å¾ˆå¤æ‚çš„æŠ€å·§ï¼Œå¦‚æœå·²ç»æ¯”è¾ƒäº†è§£å¯ä»¥è·³è¿‡ï¼ŒååŠæ®µä¼šä»‹ç»ä¸€ä¸‹æˆ‘ä»¬åœ¨é¡¹ç›®å½“ä¸­è¯¥å¦‚ä½•å†™ â€œå•å…ƒæµ‹è¯•â€</p><h2 id="å•å…ƒæµ‹è¯•ç®€æ˜æ•™ç¨‹"><a href="#å•å…ƒæµ‹è¯•ç®€æ˜æ•™ç¨‹" class="headerlink" title="å•å…ƒæµ‹è¯•ç®€æ˜æ•™ç¨‹"></a>å•å…ƒæµ‹è¯•ç®€æ˜æ•™ç¨‹</h2><h3 id="go-test"><a href="#go-test" class="headerlink" title="go test"></a>go test</h3><h4 id="ä¸€ä¸ªç®€å•çš„-ğŸŒ°"><a href="#ä¸€ä¸ªç®€å•çš„-ğŸŒ°" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ ğŸŒ°"></a>ä¸€ä¸ªç®€å•çš„ ğŸŒ°</h4><p>é¡¹ç›®ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>â”œâ”€â”€ max.go<br>â””â”€â”€ max_test.go<br></code></pre></td></tr></table></figure><p>max.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> max<br><br><span class="hljs-comment">// Int get the max</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Int</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;<br>	<span class="hljs-keyword">if</span> a &gt; b &#123;<br>		<span class="hljs-keyword">return</span> a<br>	&#125;<br>	<span class="hljs-keyword">return</span> b<br>&#125;<br></code></pre></td></tr></table></figure><p>max_test.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> max<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;testing&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestInt</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	<span class="hljs-keyword">if</span> got := Int(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); got != <span class="hljs-number">2</span> &#123;<br>		t.Errorf(<span class="hljs-string">&quot;exp: %d, got: %d&quot;</span>, <span class="hljs-number">2</span>, got)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">â–¶ go <span class="hljs-built_in">test</span><br>PASS<br>ok      code/max        0.006s<br></code></pre></td></tr></table></figure><p><strong>å•å…ƒæµ‹è¯•æ–‡ä»¶è¯´æ˜</strong></p><ul><li>æ–‡ä»¶åå¿…é¡»æ˜¯<code>_test.go</code>ç»“å°¾çš„ï¼Œè¿™æ ·åœ¨æ‰§è¡Œ<code>go test</code>çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œåˆ°ç›¸åº”çš„ä»£ç ã€‚</li><li>ä½ å¿…é¡»<code>import testing</code>è¿™ä¸ªåŒ…ã€‚</li><li>æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹å‡½æ•°å¿…é¡»æ˜¯<code>Test</code>å¼€å¤´ã€‚</li><li>æµ‹è¯•ç”¨ä¾‹ä¼šæŒ‰ç…§æºä»£ç ä¸­å†™çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li>æµ‹è¯•å‡½æ•°<code>TestX()</code>çš„å‚æ•°æ˜¯<code>testing.T</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥ç±»å‹æ¥è®°å½•é”™è¯¯æˆ–è€…æ˜¯æµ‹è¯•çŠ¶æ€ã€‚</li><li>æµ‹è¯•æ ¼å¼ï¼š<code>func TestXxx (t *testing.T)</code>,<code>Xxx</code>éƒ¨åˆ†å¯ä»¥ä¸ºä»»æ„çš„å­—æ¯æ•°å­—çš„ç»„åˆï¼Œä½†æ˜¯é¦–å­—æ¯ä¸èƒ½æ˜¯å°å†™å­—æ¯[a-z]ï¼Œä¾‹å¦‚<code>Testintdiv</code>æ˜¯é”™è¯¯çš„å‡½æ•°åã€‚</li><li>å‡½æ•°ä¸­é€šè¿‡è°ƒç”¨<code>testing.T</code>çš„<code>Error</code>, <code>Errorf</code>, <code>FailNow</code>, <code>Fatal</code>, <code>FatalIf</code>æ–¹æ³•ï¼Œè¯´æ˜æµ‹è¯•ä¸é€šè¿‡ï¼Œè°ƒç”¨<code>Log</code>æ–¹æ³•ç”¨æ¥è®°å½•æµ‹è¯•çš„ä¿¡æ¯ã€‚</li></ul><h4 id="è¡¨é©±åŠ¨æµ‹è¯•"><a href="#è¡¨é©±åŠ¨æµ‹è¯•" class="headerlink" title="è¡¨é©±åŠ¨æµ‹è¯•"></a>è¡¨é©±åŠ¨æµ‹è¯•</h4><p>åœ¨å®é™…ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦æ‰§è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒæœŸæœ›è¾¾åˆ°æ›´å…¨é¢çš„è¦†ç›–æ•ˆæœï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨è¡¨é©±åŠ¨æµ‹è¯•äº†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestInt_Table</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	tests := []<span class="hljs-keyword">struct</span> &#123;<br>		name <span class="hljs-keyword">string</span><br>		a    <span class="hljs-keyword">int</span><br>		b    <span class="hljs-keyword">int</span><br>		want <span class="hljs-keyword">int</span><br>	&#125;&#123;<br>		&#123;name: <span class="hljs-string">&quot;a&gt;b&quot;</span>, a: <span class="hljs-number">10</span>, b: <span class="hljs-number">2</span>, want: <span class="hljs-number">10</span>&#125;,<br>		&#123;name: <span class="hljs-string">&quot;a&lt;b&quot;</span>, a: <span class="hljs-number">1</span>, b: <span class="hljs-number">2</span>, want: <span class="hljs-number">2</span>&#125;,<br>	&#125;<br><br>	<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;<br>		t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>			<span class="hljs-keyword">if</span> got := Int(tt.a, tt.b); got != tt.want &#123;<br>				t.Errorf(<span class="hljs-string">&quot;exp: %d, got: %d&quot;</span>, tt.want, got)<br>			&#125;<br>		&#125;)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">â–¶ <span class="hljs-keyword">go</span> test -v<br>=== RUN   TestInt<br>--- PASS: TestInt (<span class="hljs-number">0.00</span>s)<br>=== RUN   TestInt_Table<br>=== RUN   TestInt_Table/a&gt;b<br>=== RUN   TestInt_Table/a&lt;b<br>--- PASS: TestInt_Table (<span class="hljs-number">0.00</span>s)<br>    --- PASS: TestInt_Table/a&gt;b (<span class="hljs-number">0.00</span>s)<br>    --- PASS: TestInt_Table/a&lt;b (<span class="hljs-number">0.00</span>s)<br>PASS<br></code></pre></td></tr></table></figure><p><strong>éšæœºæ‰§è¡Œ</strong><br>ä¸Šé¢çš„ä¾‹å­æ˜¯æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ï¼Œå•å…ƒæµ‹è¯•å¤§å¤šéšæœºæ‰§è¡Œæ›´èƒ½å¤Ÿå‘ç°ä¸€äº›æ²¡æœ‰æ³¨æ„åˆ°çš„é”™è¯¯, å¦‚ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ï¼Œåˆ©ç”¨ <code>map</code> çš„ç‰¹æ€§æˆ‘ä»¬å¾ˆå®¹æ˜“å°†ä¸Šé¢è¿™ä¸ªä¾‹å­æ”¹é€ ä¸ºéšæœºæ‰§è¡Œçš„å•å…ƒæµ‹è¯•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestInt_RandTable</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	tests := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">struct</span> &#123;<br>		a    <span class="hljs-keyword">int</span><br>		b    <span class="hljs-keyword">int</span><br>		want <span class="hljs-keyword">int</span><br>	&#125;&#123;<br>		<span class="hljs-string">&quot;a&gt;b&quot;</span>: &#123;a: <span class="hljs-number">10</span>, b: <span class="hljs-number">2</span>, want: <span class="hljs-number">10</span>&#125;,<br>		<span class="hljs-string">&quot;a&lt;b&quot;</span>: &#123;a: <span class="hljs-number">1</span>, b: <span class="hljs-number">2</span>, want: <span class="hljs-number">2</span>&#125;,<br>	&#125;<br><br>	<span class="hljs-keyword">for</span> name, tt := <span class="hljs-keyword">range</span> tests &#123;<br>		t.Run(name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>			<span class="hljs-keyword">if</span> got := Int(tt.a, tt.b); got != tt.want &#123;<br>				t.Errorf(<span class="hljs-string">&quot;exp: %d, got: %d&quot;</span>, tt.want, got)<br>			&#125;<br>		&#125;)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="testfiy"><a href="#testfiy" class="headerlink" title="testfiy"></a>testfiy</h3><p>æ ‡å‡†åº“ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿˜ä¸é”™çš„æµ‹è¯•æ¡†æ¶ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›æ–­è¨€çš„åŠŸèƒ½ï¼Œ<code>testify</code> åŒ…å«äº† æ–­è¨€ã€mockã€suite ä¸‰ä¸ªåŠŸèƒ½ï¼Œmock æ¨èä½¿ç”¨å®˜æ–¹çš„ <code>gomock</code></p><p><code>testify/assert</code> æä¾›äº†éå¸¸å¤šçš„æ–¹æ³•ï¼Œè¿™é‡Œä¸ºå¤§å®¶ä»‹ç»æœ€ä¸ºå¸¸ç”¨çš„ä¸€äº›ï¼Œæ‰€æœ‰çš„æ–¹æ³•å¯ä»¥è®¿é—® <a target="_blank" rel="noopener" href="https://godoc.org/github.com/stretchr/testify/assert">https://godoc.org/github.com/stretchr/testify/assert</a> æŸ¥çœ‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Equal</span><span class="hljs-params">(t TestingT, expected, actual <span class="hljs-keyword">interface</span>&#123;&#125;, msgAndArgs ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">bool</span></span><br><span class="hljs-comment">// åˆ¤æ–­ä¸¤ä¸ªå€¼ä¸ç›¸ç­‰</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NotEqual</span><span class="hljs-params">(t TestingT, expected, actual <span class="hljs-keyword">interface</span>&#123;&#125;, msgAndArgs ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">bool</span></span><br><span class="hljs-comment">// æµ‹è¯•å¤±è´¥ï¼Œæµ‹è¯•ä¸­æ–­</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">FailNow</span><span class="hljs-params">(t TestingT, failureMessage <span class="hljs-keyword">string</span>, msgAndArgs ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">bool</span></span><br><span class="hljs-comment">// åˆ¤æ–­å€¼æ˜¯å¦ä¸ºnilï¼Œå¸¸ç”¨äº error çš„åˆ¤æ–­</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Nil</span><span class="hljs-params">(t TestingT, object <span class="hljs-keyword">interface</span>&#123;&#125;, msgAndArgs ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">bool</span></span><br><span class="hljs-comment">// åˆ¤æ–­å€¼æ˜¯å¦ä¸ä¸ºnilï¼Œå¸¸ç”¨äº error çš„åˆ¤æ–­</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NotNil</span><span class="hljs-params">(t TestingT, object <span class="hljs-keyword">interface</span>&#123;&#125;, msgAndArgs ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">bool</span></span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ–­è¨€æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ª <code>bool</code> å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªè¿”å›å€¼åˆ¤æ–­æ–­è¨€æˆåŠŸ/å¤±è´¥ï¼Œä»è€Œåšä¸€äº›å¤„ç†</p><p>ä¸€ä¸ªä¾‹å­</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestInt_assert_fail</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	got := Int(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>	assert.Equal(t, <span class="hljs-number">1</span>, got)<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ, å¯ä»¥çœ‹åˆ°è¾“å‡ºååˆ†çš„æ¸…æ™°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">=== RUN   TestInt_assert_fail<br>--- FAIL: TestInt_assert_fail (0.00s)<br>    max_test.go:62:<br>                Error Trace:    max_test.go:62<br>                Error:          Not equal:<br>                                expected: 1<br>                                actual  : 2<br>                Test:           TestInt_assert_fail<br>FAIL<br>FAIL    code/max        0.017s<br></code></pre></td></tr></table></figure><h3 id="gomock"><a href="#gomock" class="headerlink" title="gomock"></a>gomock</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p><strong>æ³¨æ„: è¯·åœ¨éé¡¹ç›®æ–‡ä»¶å¤¹æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GO111MODULE=on GOPROXY=https://goproxy.cn go get github.com/golang/mock/mockgen<br></code></pre></td></tr></table></figure><p><code>mockgen</code> æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥å¯¹åŒ…æˆ–è€…æºä»£ç æ–‡ä»¶ç”ŸæˆæŒ‡å®š<strong>æ¥å£</strong>çš„ Mock ä»£ç </p><h4 id="ç”Ÿæˆ-Mock-ä»£ç "><a href="#ç”Ÿæˆ-Mock-ä»£ç " class="headerlink" title="ç”Ÿæˆ Mock ä»£ç "></a>ç”Ÿæˆ Mock ä»£ç </h4><p>æŒ‡å®šæºæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">mockgen -<span class="hljs-built_in">source</span>=./.go  -destination=./a_mock.go  INeedMockInterface<br><br>mockgen -<span class="hljs-built_in">source</span>=æºæ–‡ä»¶è·¯å¾„  -destination=å†™å…¥æ–‡ä»¶çš„è·¯å¾„(æ²¡æœ‰è¿™ä¸ªå‚æ•°è¾“å‡ºåˆ°ç»ˆç«¯) éœ€è¦mockçš„æ¥å£å(å¤šä¸ªæ¥å£é€—å·é—´éš”)<br></code></pre></td></tr></table></figure><p>æŒ‡å®šåŒ…è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mockgen  -destination=å†™å…¥æ–‡ä»¶çš„è·¯å¾„(æ²¡æœ‰è¿™ä¸ªå‚æ•°è¾“å‡ºåˆ°ç»ˆç«¯) åŒ…è·¯å¾„ éœ€è¦mockçš„æ¥å£å(å¤šä¸ªæ¥å£é€—å·é—´éš”)<br></code></pre></td></tr></table></figure><h4 id="ä¸€ä¸ªç®€å•çš„-gomock-ğŸŒ°"><a href="#ä¸€ä¸ªç®€å•çš„-gomock-ğŸŒ°" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ gomock ğŸŒ°"></a>ä¸€ä¸ªç®€å•çš„ gomock ğŸŒ°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// UserAge è·å–ç”¨æˆ·å¹´é¾„</span><br><span class="hljs-keyword">type</span> UserAge <span class="hljs-keyword">interface</span> &#123;<br>	GetAge(user <span class="hljs-keyword">string</span>) <span class="hljs-keyword">int</span><br>&#125;<br><br><span class="hljs-comment">// Simple ä¸€ä¸ªç®€å•çš„ä¾‹å­</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Simple</span><span class="hljs-params">(user <span class="hljs-keyword">string</span>, age UserAge)</span> <span class="hljs-title">string</span></span> &#123;<br>	<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;%s age is: %d&quot;</span>, user, age.GetAge(user))<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestSimple</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	<span class="hljs-comment">// æ–°å»ºä¸€ä¸ªmockå¯¹è±¡</span><br>	ctrl := gomock.NewController(t)<br>	age := mock_mock.NewMockUserAge(ctrl)<br><br>  <span class="hljs-comment">// mock è¿”å›å€¼</span><br>	age.EXPECT().GetAge(gomock.Any()).Return(<span class="hljs-number">1</span>).AnyTimes()<br><br>	assert.Equal(t, <span class="hljs-string">&quot;a age is: 1&quot;</span>, Simple(<span class="hljs-string">&quot;a&quot;</span>, age))<br>&#125;<br></code></pre></td></tr></table></figure><div style="background:#e8f7ff;padding:10px;border:1px solid #abd2da;border-radius:5px;margin-bottom:5px">æœ¬æ–‡åªæ˜¯ç®€å•ä»‹ç»ç”¨æ³•ï¼Œè¯¦ç»†ä½¿ç”¨åŠ API è¯´æ˜å¯ä»¥æŸ¥çœ‹å®˜æ–¹ä»“åº“ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/golang/mock">https://github.com/golang/mock</a></div><h2 id="é¡¹ç›®-â€œå•å…ƒæµ‹è¯•â€"><a href="#é¡¹ç›®-â€œå•å…ƒæµ‹è¯•â€" class="headerlink" title="é¡¹ç›® â€œå•å…ƒæµ‹è¯•â€"></a>é¡¹ç›® â€œå•å…ƒæµ‹è¯•â€</h2><p>æ¥ä¸‹æ¥å°±æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ <a href="https://lailin.xyz/post/go-training-week4-project-layout.html">Go å·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„</a> å½“ä¸­ï¼Œå¦‚ä½•ç¼–å†™å•å…ƒæµ‹è¯•ã€‚è™½ç„¶è¿™é‡Œè¯´çš„æ˜¯å•å…ƒæµ‹è¯•ï¼Œå…¶å®åé¢è®²çš„å…¶å®å¾ˆå¤šä¸æ˜¯å•å…ƒæµ‹è¯•ï¼Œåƒ repo å±‚ï¼Œå¦‚æœæ¶‰åŠåˆ°æ•°æ®åº“åé¢å°±ä¼šè®²åˆ°æˆ‘ä»¬ä¸€èˆ¬ä¼šå¯åŠ¨ä¸€ä¸ªçœŸå®çš„æ•°æ®åº“æ¥æµ‹è¯•ï¼Œè¿™å…¶å®å·²ç»ç®—æ˜¯é›†æˆæµ‹è¯•äº†ï¼Œä½†æ˜¯å®ƒä»ç„¶æ˜¯è½»é‡çº§çš„ã€‚</p><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>è¿™ä¸€å±‚ä¸»è¦å¤„ç†çš„ dto å’Œ do æ•°æ®ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼Œæœ¬èº«æ˜¯ä¸å«ä»€ä¹ˆä¸šåŠ¡é€»è¾‘çš„ï¼Œç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ httpï¼Œæ‰€ä»¥åœ¨è¿™ä¸€å±‚çš„æµ‹è¯•ä¸€èˆ¬ä¼šä½¿ç”¨ httptest æ¥æ¨¡æ‹Ÿå®é™…è¯·æ±‚çš„æµ‹è¯•ã€‚ç„¶ååœ¨å¯¹ usecase å±‚çš„è°ƒç”¨ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨ gomock mock æ‰ç›¸å…³çš„æ¥å£ï¼Œç®€åŒ–æˆ‘ä»¬çš„æµ‹è¯•ã€‚å¦‚æœä½ ä¸æƒ³å†™çš„é‚£ä¹ˆéº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å¯ç”¨ httptest æ¥æµ‹è¯•ï¼Œç›´æ¥æµ‹è¯• service å±‚çš„ä»£ç ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡è¿™æ ·çš„è¯ï¼Œservice å±‚çš„ä»£ç æµ‹è¯•çš„å†…å®¹å°±æ²¡æœ‰å¤šå°‘äº†ï¼Œä¹Ÿå°±æ˜¯çœ‹è½¬æ¢æ•°æ®çš„æ—¶å€™ç¬¦ä¸ç¬¦åˆé¢„æœŸã€‚</p><p>è¿™ä¸€å±‚ä¸»è¦å®Œæˆçš„æµ‹è¯•æ˜¯</p><ul><li>å‚æ•°çš„æ ¡éªŒæ˜¯å¦ç¬¦åˆé¢„æœŸ</li><li>æ•°æ®çš„è½¬æ¢æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå¦‚æœä½ åƒæˆ‘ä¸€æ ·å·æ‡’ä½¿ç”¨äº†ç±»ä¼¼ <a target="_blank" rel="noopener" href="https://pkg.go.dev/github.com/jinzhu/copier">copier</a> çš„å·¥å…·çš„è¯ä¸€å®šè¦å†™è¿™éƒ¨åˆ†çš„å•å…ƒæµ‹è¯•ï¼Œä¸ç„¶è¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºé”™ï¼Œå®¹æ˜“å­—æ®µåä¸ä¸€è‡´å¯¼è‡´ copier çš„å·¥ä½œä¸æ­£å¸¸</li></ul><p>å½“ç„¶å¦‚æœæ—¶é—´æœ‰é™çš„è¯ï¼Œè¿™ä¸€å±‚çš„æµ‹è¯•ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºæ¥å…¥å±‚ç›¸å¯¹æ¥è¯´å˜åŒ–ä¹Ÿæ¯”è¾ƒå¿«ä¸€ç‚¹ï¼Œè¿™æ˜¯è¯´å†™äº†å•å…ƒæµ‹è¯•ï¼ŒåŸºæœ¬ä¸Šåœ¨æµ‹è¯•é˜¶æ®µå¾ˆå°‘ä¼šå‡ºç°ç”±äºå‚æ•°çš„é—®é¢˜æäº¤è¿‡æ¥çš„ bug</p><p>åŒæ ·æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­, é¦–å…ˆæ˜¯ service å±‚çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯è°ƒç”¨äº†ä¸€ä¸‹ï¼Œusecase å±‚çš„æ¥å£</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> _ v1.BlogServiceHTTPServer = &amp;PostService&#123;&#125;<br><br><span class="hljs-comment">// PostService PostService</span><br><span class="hljs-keyword">type</span> PostService <span class="hljs-keyword">struct</span> &#123;<br>	Usecase domain.IPostUsecase<br>&#125;<br><br><span class="hljs-comment">// CreateArticle åˆ›å»ºæ–‡ç« </span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *PostService)</span> <span class="hljs-title">CreateArticle</span><span class="hljs-params">(ctx context.Context, req *v1.Article)</span> <span class="hljs-params">(*v1.Article, error)</span></span> &#123;<br>	article, err := p.Usecase.CreateArticle(ctx, domain.Article&#123;<br>		Title:    req.Title,<br>		Content:  req.Content,<br>		AuthorID: req.AuthorId,<br>	&#125;)<br><br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>	&#125;<br><br>	<span class="hljs-keyword">var</span> resp v1.Article<br>	err = copier.Copy(&amp;resp, &amp;article)<br>	<span class="hljs-keyword">return</span> &amp;resp, err<br>&#125;<br></code></pre></td></tr></table></figure><p>å†çœ‹çœ‹å•å…ƒæµ‹è¯•<br>é¦–å…ˆæ˜¯åˆå§‹åŒ–ï¼Œä¹‹å‰æˆ‘ä»¬è®²åˆ°åˆå§‹åŒ–çš„æ—¶å€™æˆ‘ä»¬ä¸€èˆ¬åœ¨ cmd å½“ä¸­ä½¿ç”¨ wire è‡ªåŠ¨ç”Ÿæˆï¼Œä½†æ˜¯åœ¨å•å…ƒæµ‹è¯•ä¸­ wire å¹¶ä¸å¥½ç”¨ï¼Œå¹¶ä¸”ç”±äºå•å…ƒæµ‹è¯•çš„æ—¶å€™æˆ‘ä»¬çš„ä¾èµ–é¡¹å…¶å®æ²¡æœ‰çœŸå®çš„ä¾èµ–é¡¹é‚£ä¹ˆå¤æ‚æˆ‘ä»¬åªéœ€è¦å…³å¿ƒå½“å‰è¿™ä¸€å±‚çš„ä¾èµ–å³å¯ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™æˆ‘éƒ½æ˜¯æ‰‹å†™åˆå§‹åŒ–<br>ä¸€èˆ¬ä¼šå‘ä¸‹é¢è¿™æ ·ï¼Œä½¿ç”¨ä¸€ä¸ª struct åŒ…è£…èµ·æ¥ï¼Œå› ä¸ºåœ¨åé¢åƒæ˜¯ mock çš„ usecase è¿˜éœ€è¦è°ƒç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> testPostService <span class="hljs-keyword">struct</span> &#123;<br>	post    *PostService<br>	usecase *mock_domain.MockIPostUsecase<br>	handler *gin.Engine<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initPostService</span><span class="hljs-params">(t *testing.T)</span> *<span class="hljs-title">testPostService</span></span> &#123;<br>	ctrl := gomock.NewController(t)<br>	usecase := mock_domain.NewMockIPostUsecase(ctrl)<br>	service := &amp;PostService&#123;Usecase: usecase&#125;<br><br>	handler := gin.New()<br>	v1.RegisterBlogServiceHTTPServer(handler, service)<br><br>	<span class="hljs-keyword">return</span> &amp;testPostService&#123;<br>		post:    service,<br>		usecase: usecase,<br>		handler: handler,<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…çš„æµ‹è¯•ï¼Œè¿™ä¸€å—ä¸»è¦æ˜¯ä¸ºäº†å±•ç¤ºä¸€ä¸ªå®Œæ•´çš„å•å…ƒæµ‹è¯•æ‰€ä»¥è´´çš„ä»£ç ç¨å¾®é•¿äº†ä¸€äº›ï¼Œåé¢çš„ä¸¤å±‚å…·ä½“çš„å•å…ƒæµ‹è¯•ä»£ç éƒ½å¤§åŒå°å¼‚ï¼Œæˆ‘å°±ä¸å†è´´äº†ï¼Œä¸»è¦çš„æ€è·¯å°±æ˜¯æŠŠä¾èµ–çš„æ¥å£éƒ½ç”¨ gomock mock æ‰ï¼Œè¿™æ ·å®é™…å†™å•å…ƒæµ‹è¯•ä»£ç çš„æ—¶å€™å°±ä¼šæ¯”è¾ƒç®€å•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestPostService_CreateArticle</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>	s := initPostService(t)<br>	s.usecase.EXPECT().<br>		CreateArticle(gomock.Any(), gomock.Eq(domain.Article&#123;Title: <span class="hljs-string">&quot;err&quot;</span>, AuthorID: <span class="hljs-number">1</span>&#125;)).<br>		Return(domain.Article&#123;&#125;, fmt.Errorf(<span class="hljs-string">&quot;err&quot;</span>))<br>	s.usecase.EXPECT().<br>		CreateArticle(gomock.Any(), gomock.Eq(domain.Article&#123;Title: <span class="hljs-string">&quot;success&quot;</span>, AuthorID: <span class="hljs-number">2</span>&#125;)).<br>		Return(domain.Article&#123;Title: <span class="hljs-string">&quot;success&quot;</span>&#125;, <span class="hljs-literal">nil</span>)<br><br>	tests := []<span class="hljs-keyword">struct</span> &#123;<br>		name       <span class="hljs-keyword">string</span><br>		params     *v1.Article<br>		want       *v1.Article<br>		wantStatus <span class="hljs-keyword">int</span><br>		wantCode   <span class="hljs-keyword">int</span><br>		wantErr    <span class="hljs-keyword">string</span><br>	&#125;&#123;<br>		&#123;<br>			name: <span class="hljs-string">&quot;å‚æ•°é”™è¯¯ author_id å¿…é¡»&quot;</span>,<br>			params: &amp;v1.Article&#123;<br>				Title:    <span class="hljs-string">&quot;1&quot;</span>,<br>				Content:  <span class="hljs-string">&quot;2&quot;</span>,<br>				AuthorId: <span class="hljs-number">0</span>,<br>			&#125;,<br>			want:       <span class="hljs-literal">nil</span>,<br>			wantStatus: <span class="hljs-number">400</span>,<br>			wantCode:   <span class="hljs-number">400</span>,<br>		&#125;,<br>		&#123;<br>			name: <span class="hljs-string">&quot;å¤±è´¥&quot;</span>,<br>			params: &amp;v1.Article&#123;<br>				Title:    <span class="hljs-string">&quot;err&quot;</span>,<br>				AuthorId: <span class="hljs-number">1</span>,<br>			&#125;,<br>			want:       <span class="hljs-literal">nil</span>,<br>			wantStatus: <span class="hljs-number">500</span>,<br>			wantCode:   <span class="hljs-number">-1</span>,<br>		&#125;,<br>		&#123;<br>			name: <span class="hljs-string">&quot;æˆåŠŸ&quot;</span>,<br>			params: &amp;v1.Article&#123;<br>				Title:    <span class="hljs-string">&quot;success&quot;</span>,<br>				AuthorId: <span class="hljs-number">2</span>,<br>			&#125;,<br>			want: &amp;v1.Article&#123;<br>				Title: <span class="hljs-string">&quot;success&quot;</span>,<br>			&#125;,<br>			wantStatus: <span class="hljs-number">200</span>,<br>			wantCode:   <span class="hljs-number">0</span>,<br>		&#125;,<br>	&#125;<br>	<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;<br>		t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>			<span class="hljs-comment">// ä¸‹é¢è¿™äº›ä¸€èˆ¬éƒ½ä¼šå°è£…åœ¨ä¸€èµ·ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ¼”ç¤º</span><br><br>			<span class="hljs-comment">// åˆå§‹åŒ–è¯·æ±‚</span><br>			b, err := json.Marshal(tt.params)<br>			require.NoError(t, err)<br>			uri := fmt.Sprintf(<span class="hljs-string">&quot;/v1/author/%d/articles&quot;</span>, tt.params.AuthorId)<br>			req := httptest.NewRequest(http.MethodPost, uri, bytes.NewReader(b))<br><br>			<span class="hljs-comment">// åˆå§‹åŒ–å“åº”</span><br>			w := httptest.NewRecorder()<br><br>			<span class="hljs-comment">// è°ƒç”¨ç›¸åº”çš„handleræ¥å£</span><br>			s.handler.ServeHTTP(w, req)<br><br>			<span class="hljs-comment">// æå–å“åº”</span><br>			resp := w.Result()<br>			<span class="hljs-keyword">defer</span> resp.Body.Close()<br>			require.Equal(t, tt.wantStatus, resp.StatusCode)<br><br>			<span class="hljs-comment">// è¯»å–å“åº”body</span><br>			respBody, _ := ioutil.ReadAll(resp.Body)<br>			r := <span class="hljs-keyword">struct</span> &#123;<br>				Code <span class="hljs-keyword">int</span>         <span class="hljs-string">`json:&quot;code&quot;`</span><br>				Msg  <span class="hljs-keyword">string</span>      <span class="hljs-string">`json:&quot;msg&quot;`</span><br>				Data *v1.Article <span class="hljs-string">`json:&quot;data&quot;`</span><br>			&#125;&#123;&#125;<br>			require.NoError(t, json.Unmarshal(respBody, &amp;r))<br><br>			assert.Equal(t, tt.wantCode, r.Code)<br>			assert.Equal(t, tt.want, r.Data)<br>		&#125;)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="usecase"><a href="#usecase" class="headerlink" title="usecase"></a>usecase</h3><p>usecase æ˜¯ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ‰€ä»¥ä¸€èˆ¬å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™éƒ½åº”è¯¥å…ˆå†™è¿™ä¸€å±‚çš„å•è¿œæµ‹è¯•ï¼Œè€Œä¸”è¿™ä¸€å±‚æˆ‘ä»¬æ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œåªéœ€è¦æŠŠ repo å±‚çš„æ¥å£ç›´æ¥ mock æ‰å°±å¯ä»¥äº†ï¼Œæ˜¯éå¸¸çº¯å‡€çš„ä¸€å±‚ï¼Œå…¶å®ä¹Ÿå°±è¿™ä¸€å±‚çš„å•å…ƒæµ‹è¯•æ‰æ˜¯çœŸæ­£çš„å•å…ƒæµ‹è¯•</p><h3 id="repo"><a href="#repo" class="headerlink" title="repo"></a>repo</h3><p>repo å±‚æˆ‘ä»¬ä¸€èˆ¬ä¾èµ– mysql æˆ–è€…æ˜¯ redis ç­‰æ•°æ®åº“ï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯åŠ¨ä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“ç”¨äºæµ‹è¯•å³å¯ã€‚</p><h4 id="æœ¬åœ°"><a href="#æœ¬åœ°" class="headerlink" title="æœ¬åœ°"></a>æœ¬åœ°</h4><p>ç›´æ¥ä½¿ç”¨ docker run å¯¹åº”çš„æ•°æ®åº“å°±å¯ä»¥äº†</p><h4 id="ci-cd"><a href="#ci-cd" class="headerlink" title="ci/cd"></a>ci/cd</h4><p>æˆ‘ä»¬çš„ ci cd æ˜¯ä½¿ç”¨çš„ gitlabï¼Œgitlab æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½ç”¨çš„åŠŸèƒ½æ˜¯æŒ‡å®š serviceï¼Œåªéœ€è¦æŒ‡å®šå¯¹åº”çš„æ•°æ®åº“é•œåƒæˆ‘ä»¬å°±å¯ä»¥åœ¨æµ‹è¯•å®¹å™¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨å¯åŠ¨å¯¹åº”çš„æµ‹è¯•æ•°æ®åº“å®¹å™¨ï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡éƒ½æ˜¯å…¨æ–°çš„ç©ºæ•°æ®åº“ã€‚æˆ‘ä»¬åªéœ€è¦æ¯æ¬¡è·‘å•å…ƒæµ‹è¯•çš„æ—¶å€™å…ˆè·‘ä¸€ä¸‹æ•°æ®åº“çš„ migration å°±å¯ä»¥äº†ã€‚</p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªé…ç½®ç¤ºä¾‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">test:</span><br>  <span class="hljs-attr">stage:</span> <span class="hljs-string">test</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">golang:1.15-alpine-test</span><br>  <span class="hljs-attr">services:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">redis:v4.0.11</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">postgres:10-alpine</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">docker:19-dind</span><br>  <span class="hljs-attr">variables:</span><br>    <span class="hljs-attr">POSTGRES_DB:</span> <span class="hljs-string">test_db</span><br>    <span class="hljs-attr">POSTGRES_USER:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">POSTGRES_PASSWORD:</span> <span class="hljs-number">1234567</span><br>    <span class="hljs-attr">GOPROXY:</span> <span class="hljs-string">&quot;è¿™é‡Œè®¾ç½® proxy åœ°å€&quot;</span><br>    <span class="hljs-attr">CGO_ENABLED:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">script:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">go</span> <span class="hljs-string">mod</span> <span class="hljs-string">download</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">go</span> <span class="hljs-string">run</span> <span class="hljs-string">db/*.go</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">mkdir</span> <span class="hljs-string">artifacts</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">gotestsum</span> <span class="hljs-string">--</span> <span class="hljs-string">-p</span> <span class="hljs-number">1</span> <span class="hljs-string">-v</span> <span class="hljs-string">-coverprofile=./artifacts/coverage.out</span> <span class="hljs-string">-coverpkg=./...</span> <span class="hljs-string">./...</span><br>    <span class="hljs-comment"># å•å…ƒæµ‹è¯•ç»Ÿè®¡å»é™¤ä¸€äº›ä¸éœ€è¦æµ‹è¯•çš„ä»£ç </span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">|</span><br>      <span class="hljs-string">cat</span> <span class="hljs-string">./artifacts/coverage.out</span> <span class="hljs-string">|</span> <span class="hljs-string">\</span><br>      <span class="hljs-string">grep</span> <span class="hljs-string">-v</span> <span class="hljs-string">&quot;/mock/&quot;</span> <span class="hljs-string">|</span> <span class="hljs-string">grep</span> <span class="hljs-string">-v</span> <span class="hljs-string">&quot;/db/&quot;</span> <span class="hljs-string">|</span>  <span class="hljs-string">grep</span> <span class="hljs-string">-v</span> <span class="hljs-string">&quot;pb.go&quot;</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">./artifacts/coverage.out2</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">go</span> <span class="hljs-string">tool</span> <span class="hljs-string">cover</span> <span class="hljs-string">-func=./artifacts/coverage.out2</span><br>  <span class="hljs-comment"># æ•è·å•å…ƒæµ‹è¯•è¦†ç›–ç‡åœ¨ gitlab job ä¸Šæ˜¾ç¤º</span><br>  <span class="hljs-attr">coverage:</span> <span class="hljs-string">&#x27;/total:\s+.*\s+\d+\.\d+%/&#x27;</span><br>  <span class="hljs-attr">artifacts:</span><br>    <span class="hljs-attr">paths:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">artifacts/coverage.out</span><br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å•å…ƒæµ‹è¯•çš„ä»‹ç»å°±åˆ°è¿™é‡Œäº†ï¼Œè¿™ç¯‡æ–‡ç« ä»å•å…ƒæµ‹è¯•çš„åŸºæœ¬å†™æ³•ï¼Œå†åˆ°æˆ‘ä»¬åœ¨é¡¹ç›®å½“ä¸­å¦‚ä½•å†™å•å…ƒæµ‹è¯•éƒ½ç®€å•ä»‹ç»äº†ä¸€ä¸‹ï¼Œå¸Œæœ›ä½ çœ‹äº†è¿™ç¯‡æ–‡ç« èƒ½æœ‰æ‰€æ”¶è·ã€‚</p><p>åŒæ—¶æˆ‘ä»¬ Go å·¥ç¨‹åŒ– è¿™ä¸€ç« èŠ‚çš„å†…å®¹ä¹Ÿæ¥è¿‘å°¾å£°äº†ï¼Œæ•´ç†çš„ææ–™ä¹ŸæŒºå¤šçš„ï¼Œä¸‹ä¸€ç¯‡å°±æ˜¯è¿™ä¸€èŠ‚çš„æœ€åä¸€ç¯‡æ–‡ç« ï¼Œè®²ä¸€è®²æˆ‘åœ¨çœŸå®æ”¹é€ ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ol><li><a target="_blank" rel="noopener" href="https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;utm_medium=lailin.xyz">Go è¿›é˜¶è®­ç»ƒè¥-æå®¢æ—¶é—´</a></li><li><a target="_blank" rel="noopener" href="https://github.com/stretchr/testify">https://github.com/stretchr/testify</a></li><li><a target="_blank" rel="noopener" href="https://github.com/golang/mock">https://github.com/golang/mock</a></li><li><a target="_blank" rel="noopener" href="https://pkg.go.dev/github.com/jinzhu/copier">https://pkg.go.dev/github.com/jinzhu/copier</a></li></ol><div><h2 id="ç›¸å…³æ¨è">ç›¸å…³æ¨è</h2><ul><li><a href="https://lailin.xyz/post/go-training-week5-comment-design-1.html">è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡ï¼ˆä¸€ï¼‰åŠŸèƒ½æ‹†åˆ†&æ¶æ„è®¾è®¡</a></li><li><a href="https://lailin.xyz/post/go-training-week4-practice.html">Goå·¥ç¨‹åŒ–(ä¹) é¡¹ç›®é‡æ„å®è·µ</a></li><li><a href="https://lailin.xyz/post/go-training-week4-go-module.html">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</a></li></ul></div></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">Goè¿›é˜¶è®­ç»ƒè¥</a> <a class="hover-with-bg" href="/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Week04-Go-%E5%B7%A5%E7%A8%8B%E5%8C%96/">Week04: Go å·¥ç¨‹åŒ–</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a> <a class="hover-with-bg" href="/tags/Go/">Go</a> <a class="hover-with-bg" href="/tags/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/">Goè¿›é˜¶è®­ç»ƒè¥</a> <a class="hover-with-bg" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/">å·¥ç¨‹åŒ–</a> <a class="hover-with-bg" href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">å•å…ƒæµ‹è¯•</a></div></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œç¦æ­¢å…¨æ–‡è½¬è½½</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/post/go-training-week4-practice.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Goå·¥ç¨‹åŒ–(ä¹) é¡¹ç›®é‡æ„å®è·µ</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/post/go-training-week4-go-module.html"><span class="hidden-mobile">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><script type="text/javascript">Fluid.utils.waitElementVisible("comments",function(){var t="github-light",e="github-dark",s="dark"===(s=document.documentElement.getAttribute("data-user-color-scheme"))?e:t;window.UtterancesThemeLight=t,window.UtterancesThemeDark=e;e=document.createElement("script");e.setAttribute("src","https://utteranc.es/client.js"),e.setAttribute("repo","scuplus/blogComment"),e.setAttribute("issue-term","pathname"),e.setAttribute("label","utterances"),e.setAttribute("theme",s),e.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(e)})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div class="toc-body" id="toc-body"></div></div></div></div><div id="bottom"><div id="bottom-drawer" class="bottom-drawer"><div class="sidebar"><p class="sidebar-header">Goè¿›é˜¶è®­ç»ƒè¥</p><div class="sidebar-body" id="sidebar-body"><ol class="sidebar-list sidebar-list-1"><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23xho0000m4t51q602czj").classList.toggle("sidebar-is-collapsed")'>Week01: å¾®æœåŠ¡</a><ol id="sidebar-ckkm23xho0000m4t51q602czj" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-01.html">å¾®æœåŠ¡(ä¸€) å¾®æœåŠ¡æ¦‚è§ˆ</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-02.html">å¾®æœåŠ¡(äºŒ) æœåŠ¡å‘ç°&amp;å¤šç§Ÿæˆ·</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23ykh0003m4t53mln1w0n").classList.toggle("sidebar-is-collapsed")'>Week02: Goé”™è¯¯å¤„ç†</a><ol id="sidebar-ckkm23ykh0003m4t53mln1w0n" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-03.html">Goé”™è¯¯å¤„ç†æœ€ä½³å®è·µ</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm2667n000pm4t52z016wn0").classList.toggle("sidebar-is-collapsed")'>Week03: Go å¹¶å‘ç¼–ç¨‹</a><ol id="sidebar-ckkm2667n000pm4t52z016wn0" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-goroutine.html">Goå¹¶å‘ç¼–ç¨‹(ä¸€) goroutine</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-go-memory-model.html">Goå¹¶å‘ç¼–ç¨‹(äºŒ) Go å†…å­˜æ¨¡å‹</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-data-race.html">Goå¹¶å‘ç¼–ç¨‹(ä¸‰) data race</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sync.html">Goå¹¶å‘ç¼–ç¨‹(å››) æ·±å…¥ç†è§£ Mutex</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-atomic.html">Goå¹¶å‘ç¼–ç¨‹(äº”) æ·±å…¥ç†è§£ sync/atomic</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-waitgroup.html">Goå¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-errgroup.html">Goå¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-once.html">Goå¹¶å‘ç¼–ç¨‹(å…«) æ·±å…¥ç†è§£ sync.Once</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-context.html">Goå¹¶å‘ç¼–ç¨‹(ä¹) æ·±å…¥ç†è§£ Context</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-channel.html">Goå¹¶å‘ç¼–ç¨‹(å) æ·±å…¥ç†è§£ Channel</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week3-sum.html">Goå¹¶å‘ç¼–ç¨‹(åä¸€) æ€»ç»“</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckkm23zra000im4t5en8m0qy9").classList.toggle("sidebar-is-collapsed")'>Week04: Go å·¥ç¨‹åŒ–</a><ol id="sidebar-ckkm23zra000im4t5en8m0qy9" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-clean-arch.html">Goå·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®°</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-project-layout.html">Goå·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-wire.html">Goå·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-api-design.html">Goå·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ &amp; è®¾è®¡</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-protoc-gen-go-gin.html">Goå·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç </a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-config.html">Goå·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç†</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-go-module.html">Goå·¥ç¨‹åŒ–(ä¸ƒ) Go Module</a></li><li class="sidebar-list-item is-active-li"><a class="sidebar-link sidebar-active-link" href="/post/go-training-week4-unit-test.html">Goå·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•</a></li><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week4-practice.html">Goå·¥ç¨‹åŒ–(ä¹) é¡¹ç›®é‡æ„å®è·µ</a></li></ol></li><li class="sidebar-list-item"><a class="sidebar-title" onclick='document.querySelector("#sidebar-ckmgd197g000cieou0z682wci").classList.toggle("sidebar-is-collapsed")'>Week05: è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡</a><ol id="sidebar-ckmgd197g000cieou0z682wci" class="sidebar-list sidebar-list-2 sidebar-is-collapsible"><li class="sidebar-list-item"><a class="sidebar-link" href="/post/go-training-week5-comment-design-1.html">è¯„è®ºç³»ç»Ÿæ¶æ„è®¾è®¡ï¼ˆä¸€ï¼‰åŠŸèƒ½æ‹†åˆ†&amp;æ¶æ„è®¾è®¡</a></li></ol></li></ol></div></div><div id="toc-mobile"><div class="toc-body" id="toc-body-mobile"></div></div></div><div id="bottom-tab"><a class="sub-menu" onclick='showBottomDrawer(this,"#bottom-drawer .sidebar")'><i class="iconfont"></i> ç« èŠ‚ </a><a class="sub-menu" onclick='showBottomDrawer(this,"#bottom-drawer #toc-mobile")'><i class="iconfont"></i> ç›®å½• </a><a href="#comments" class="sub-menu" onclick='showBottomDrawer(this,"#comments")'><i class="iconfont"></i> è¯„è®º</a></div></div><script>function showBottomDrawer(s,t){let e=document.querySelector("#bottom-tab");e.childNodes.forEach(t=>{t!=s&&t.classList&&t.classList.remove("active")}),"#comments"!=t&&s.classList.toggle("active");let o=document.querySelector("#bottom-drawer"),c=document.querySelector(t);o.childNodes.forEach(t=>{t!=c&&t.classList&&t.classList.remove("active")}),c.classList.toggle("active"),"#comments"!=t?(c.classList.contains("active")&&!o.classList.contains("active")&&o.classList.add("active"),!c.classList.contains("active")&&o.classList.contains("active")&&o.classList.remove("active")):o.classList.remove("active")}document.onreadystatechange=function(t){let s=$("#bottom-drawer");s.height()<=0||window.tocbot.init({tocSelector:"#toc-body-mobile",contentSelector:".markdown-body",headingSelector:"h1,h2,h3,h4",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:20})}</script></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-x-md"><div class="container custom mx-auto"><script>!function(e,s,p){var r;void 0===e.webpushr&&(e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)},r=s.getElementsByTagName(p)[0],(p=s.createElement(p)).id="webpushr-jssdk",p.async=1,p.src="https://cdn.webpushr.com/app.min.js",r.parentNode.appendChild(p))}(window,document,"script"),webpushr("setup",{key:"BBkZb7rpvsVqVNkORXD9T9T93MJodtpNJD5c1f2HE_XsED3r94An3CKObdyTJ6ub3ARm9LIdeDCVzKLBsK760NM"})</script></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/debouncer-c523e4d3f8b7b837c19f74984acbabf7.js"></script><script src="/js/events-f495e9aefe2285fc712ba316bdf01b26.js"></script><script src="/js/plugins-93fa930e12b7596433529edc1b5458df.js"></script><script src="/js/lazyload-e96b3165477d429bf8096bdbd068d816.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script src="/js/local-search-c277a106ee2a2e265fcd58887e53c0fb.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-137859264-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script>let sidebarBody=document.querySelector(".sidebar .sidebar-body"),sidebarActive=document.querySelector(".sidebar .is-active-li"),bc=sidebarBody.getBoundingClientRect(),ac=sidebarActive.getBoundingClientRect(),t=ac.y-bc.y-bc.height/2;0<t&&sidebarBody.scrollTo({top:t,behavior:"smooth"})</script><script src="/js/boot-b4d619350e67f5b3ceeb2164d30268e0.js"></script><script src="/assets/js/post-content-4067526c74af06e5ffe9a190633d525a.js"></script></body></html>